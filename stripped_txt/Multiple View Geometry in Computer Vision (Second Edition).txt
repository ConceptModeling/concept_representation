this page intentionally left blank multiple view geometry in computer vision second edition richard hartley australian national university canberra australia andrew zisserman university of oxford uk cambridge university press cambridge new york melbourne madrid cape town singapore s o paulo cambridge university press the edinburgh building cambridge uk published in the united states of america by cambridge university press new york www.cambridge.org information on this title cambridge university press this publication is in copyright. subject to statutory exception and to the provision of relevant collective licensing agreements no reproduction of any part may take place without the written permission of cambridge university press. first published in print format ebook ebook paperback paperback cambridge university press has no responsibility for the persistence or accuracy of urls for external or third-party internet websites referred to in this publication and does not guarantee that any content on such websites is or will remain accurate or appropriate. dedication this book is dedicated to joe mundy whose vision and constant search for new ideas led us into this field. contents foreword preface introduction a tour of multiple view geometry introduction the ubiquitous projective geometry camera projections reconstruction from more than one view three-view geometry four view geometry and n-view reconstruction transfer euclidean reconstruction auto-calibration the reward i graphical models the reward ii video augmentation page xi xiii part the background projective geometry transformations and estimation planar geometry the projective plane projective transformations a hierarchy of transformations the projective geometry of topology of the projective plane recovery of affine and metric properties from images outline projective geometry and transformations of more properties of conics closure projective geometry and transformations of points and projective transformations representing and transforming planes lines and quadrics fixed points and lines v vi contents twisted cubics the hierarchy of transformations the plane at infinity the absolute conic the absolute dual quadric closure estimation projective transformations algorithm evaluation and error analysis monte carlo estimation of covariance the direct linear transformation algorithm different cost functions statistical cost functions and maximum likelihood estimation transformation invariance and normalization iterative minimization methods experimental comparison of the algorithms robust estimation automatic computation of a homography closure bounds on performance covariance of the estimated transformation closure part i camera geometry and single view geometry finite cameras the projective camera cameras at infinity other camera models closure outline camera models computation of the camera matrix p basic equations geometric error restricted camera estimation radial distortion closure more single view geometry action of a projective camera on planes lines and conics images of smooth surfaces action of a projective camera on quadrics the importance of the camera centre camera calibration and the image of the absolute conic contents vanishing points and vanishing lines affine measurements and reconstruction determining camera calibration k from a single view single view reconstruction the calibrating conic closure part ii two-view geometry outline epipolar geometry and the fundamental matrix epipolar geometry the fundamental matrix f fundamental matrices arising from special motions geometric representation of the fundamental matrix retrieving the camera matrices the essential matrix closure reconstruction of cameras and structure outline of reconstruction method reconstruction ambiguity the projective reconstruction theorem stratified reconstruction direct reconstruction using ground truth closure computation of the fundamental matrix f basic equations the normalized algorithm the algebraic minimization algorithm geometric distance experimental evaluation of the algorithms automatic computation of f special cases of f-computation correspondence of other entities degeneracies a geometric interpretation of f-computation the envelope of epipolar lines image rectification closure structure computation problem statement linear triangulation methods geometric error cost function sampson approximation geometric correction vii viii contents an optimal solution probability distribution of the estimated point line reconstruction closure scene planes and homographies homographies given the plane and vice versa plane induced homographies given f and image correspondences computing f given the homography induced by a plane the infinite homography h closure affine epipolar geometry affine epipolar geometry the affine fundamental matrix estimating fa from image point correspondences triangulation affine reconstruction necker reversal and the bas-relief ambiguity computing the motion closure part iii three-view geometry outline the trifocal tensor the geometric basis for the trifocal tensor the trifocal tensor and tensor notation transfer the fundamental matrices for three views closure computation of the trifocal tensor t basic equations the normalized linear algorithm the algebraic minimization algorithm geometric distance experimental evaluation of the algorithms automatic computation of t special cases of t closure part iv n-view geometry outline n-linearities and multiple view tensors bilinear relations trilinear relations contents intersections of four planes quadrilinear relations counting arguments number of independent equations choosing equations closure n-view computational methods projective reconstruction bundle adjustment affine reconstruction the factorization algorithm non-rigid factorization projective factorization projective reconstruction using planes reconstruction from sequences closure auto-calibration introduction algebraic framework and problem statement calibration using the absolute dual quadric the kruppa equations a stratified solution calibration from rotating cameras auto-calibration from planes planar motion single axis rotation turntable motion auto-calibration of a stereo rig closure duality carlsson weinshall duality reduced reconstruction closure cheirality quasi-affine transformations front and back of a camera three-dimensional point sets obtaining a quasi-affine reconstruction effect of transformations on cheirality orientation the cheiral inequalities which points are visible in a third view which points are in front of which closure ix x contents degenerate configurations camera resectioning degeneracies in two views carlsson weinshall duality three-view critical configurations closure part v appendices appendix tensor notation appendix gaussian and distributions appendix parameter estimation appendix matrix properties and decompositions appendix least-squares minimization appendix iterative estimation methods appendix some special plane projective transformations bibliography index foreword by olivier faugeras making a computer see was something that leading experts in the field of artificial intelligence thought to be at the level of difficulty of a summer student s project back in the sixties. forty years later the task is still unsolved and seems formidable. a whole field called computer vision has emerged as a discipline in itself with strong connections to mathematics and computer science and looser connections to physics the psychology of perception and the neuro sciences. one of the likely reasons for this half-failure is the fact that researchers had overlooked the fact perhaps because of this plague called naive introspection that perception in general and visual perception in particular are far more complex in animals and humans than was initially thought. there is of course no reason why we should pattern computer vision algorithms after biological ones but the fact of the matter is that the way biological vision works is still largely unknown and therefore hard to emulate on computers and attempts to ignore biological vision and reinvent a sort of silicon-based vision have not been so successful as initially expected. despite these negative remarks computer vision researchers have obtained some outstanding successes both practical and theoretical. on the side of practice and to single out one example the possibility of guiding vehicles such as cars and trucks on regular roads or on rough terrain using computer vision technology was demonstrated many years ago in europe the usa and japan. this requires capabilities for real-time three-dimensional dynamic scene analysis which are quite elaborate. today car manufacturers are slowly incorporating some of these functions in their products. on the theoretical side some remarkable progress has been achieved in the area of what one could call geometric computer vision. this includes the description of the way the appearance of objects changes when viewed from different viewpoints as a function of the objects shape and the cameras parameters. this endeavour would not have been achieved without the use of fairly sophisticated mathematical techniques encompassing many areas of geometry ancient and novel. this book deals in particular with the intricate and beautiful geometric relations that exist between the images of objects in the world. these relations are important to analyze for their own sake because xi xii foreword this is one of the goals of science to provide explanations for appearances they are also important to analyze because of the range of applications their understanding opens up. the book has been written by two pioneers and leading experts in geometric computer vision. they have succeeded in what was something of a challenge namely to convey in a simple and easily accessible way the mathematics that is necessary for understanding the underlying geometric concepts to be quite exhaustive in the coverage of the results that have been obtained by them and other researchers worldwide to analyze the interplay between the geometry and the fact that the image measurements are necessarily noisy to express many of these theoretical results in algorithmic form so that they can readily be transformed into computer code and to present many real examples that illustrate the concepts and show the range of applicability of the theory. returning to the original holy grail of making a computer see we may wonder whether this kind of work is a step in the right direction. i must leave the readers of the book to answer this question and be content with saying that no designer of systems using cameras hooked to computers that will be built in the foreseeable future can ignore this work. this is perhaps a step in the direction of defining what it means for a computer to see. preface over the past decade there has been a rapid development in the understanding and modelling of the geometry of multiple views in computer vision. the theory and practice have now reached a level of maturity where excellent results can be achieved for problems that were certainly unsolved a decade ago and often thought unsolvable. these tasks and algorithms include given two images and no other information compute matches between the images and the position of the points that generate these matches and the cameras that generate the images. given three images and no other information similarly compute the matches between images of points and lines and the position in of these points and lines and the cameras. compute the epipolar geometry of a stereo rig and trifocal geometry of a trinocular rig without requiring a calibration object. compute the internal calibration of a camera from a sequence of images of natural scenes calibration on the fly the distinctive flavour of these algorithms is that they are uncalibrated it is not necessary to know or first need to compute the camera internal parameters as the focal length. underpinning these algorithms is a new and more complete theoretical understanding of the geometry of multiple uncalibrated views the number of parameters involved the constraints between points and lines imaged in the views and the retrieval of cameras and points from image correspondences. for example to determine the epipolar geometry of a stereo rig requires specifying only seven parameters the camera calibration is not required. these parameters are determined from the correspondence of seven or more image point correspondences. contrast this uncalibrated route with the previous calibrated route of a decade ago each camera would first be calibrated from the image of a carefully engineered calibration object with known geometry. the calibration involves determining parameters for each camera. the epipolar geometry would then have been computed from these two sets of parameters. this example illustrates the importance of the uncalibrated approach using the appropriate representation of the geometry makes explicit the parameters xiii xiv preface that are required at each stage of a computation. this avoids computing parameters that have no effect on the final result and results in simpler algorithms. it is also worth correcting a possible misconception. in the uncalibrated framework entities instance point positions in are often recovered to within a precisely defined ambiguity. this ambiguity does not mean that the points are poorly estimated. more practically it is often not possible to calibrate cameras once-and-for-all for instance where cameras are moved a mobile vehicle or internal parameters are changed surveillance camera with zoom. furthermore calibration information is simply not available in some circumstances. imagine computing the motion of a camera from a video sequence or building a virtual reality model from archive film footage where both motion and internal calibration information are unknown. the achievements in multiple view geometry have been possible because of developments in our theoretical understanding but also because of improvements in estimating mathematical objects from images. the first improvement has been an attention to the error that should be minimized in over-determined systems whether it be algebraic geometric or statistical. the second improvement has been the use of robust estimation algorithms as ransac so that the estimate is unaffected by outliers in the data. also these techniques have generated powerful search and matching algorithms. many of the problems of reconstruction have now reached a level where we may claim that they are solved. such problems include estimation of the multifocal tensors from image point correspondences particularly the fundamental matrix and trifocal tensors quadrifocal tensor having not received so much attention. extraction of the camera matrices from these tensors and subsequent projective reconstruction from two three and four views. other significant successes have been achieved though there may be more to learn about these problems. examples include application of bundle adjustment to solve more general reconstruction prob lems. metric reconstruction given minimal assumptions on the camera matrices. automatic detection of correspondences in image sequences and elimination of outliers and false matches using the multifocal tensor relationships. roadplan. the book is divided into six parts and there are seven short appendices. each part introduces a new geometric relation the homography for background the camera matrix for single view the fundamental matrix for two views the trifocal tensor for three views and the quadrifocal tensor for four views. in each case there is a chapter describing the relation its properties and applications and a companion chapter describing algorithms for its estimation from image measurements. the estimation algorithms described range from cheap simple approaches through to the optimal algorithms which are currently believed to be the best available. preface xv part background. this part is more tutorial than the others. it introduces the central ideas in the projective geometry of and example ideal points and the absolute conic how this geometry may be represented manipulated and estimated and how the geometry relates to various objectives in computer vision such as rectifying images of planes to remove perspective distortion. part single view geometry. here the various cameras that model the perspective projection from to an image are defined and their anatomy explored. their estimation using traditional techniques of calibration objects is described as well as camera calibration from vanishing points and vanishing lines. part two view geometry. this part describes the epipolar geometry of two cameras projective reconstruction from image point correspondences methods of resolving the projective ambiguity optimal triangulation transfer between views via planes. part three view geometry. here the trifocal geometry of three cameras is described including transfer of a point correspondence from two views to a third and similarly transfer for a line correspondence computation of the geometry from point and line correspondences retrieval of the camera matrices. part n-views. this part has two purposes. first it extends three view geometry to four views minor extension and describes estimation methods applicable to n-views such as the factorization algorithm of tomasi and kanade for computing structure and motion simultaneously from multiple images. second it covers themes that have been touched on in earlier chapters but can be understood more fully and uniformly by emphasising their commonality. examples include deriving multi-linear view constraints on correspondences auto-calibration and ambiguous solutions. appendices. these describe further background material on tensors statistics parameter estimation linear and matrix algebra iterative estimation the solution of sparse matrix systems and special projective transformations. acknowledgements. we have benefited enormously from ideas and discussions with our colleagues paul beardsley stefan carlsson olivier faugeras andrew fitzgibbon jitendra malik steve maybank amnon shashua phil torr bill triggs. if there are only a countable number of errors in this book then it is due to antonio criminisi david liebowitz and frederik schaffalitzky who have with great energy and devotion read most of it and made numerous suggestions for improvements. similarly both peter sturm and bill triggs have suggested many improvements to various chapters. we are grateful to other colleagues who have read individual chapters david capel lourdes de agapito vicente bob kaucic steve maybank peter tu. we are particularly grateful to those who have provided multiple figures paul beardsley antonio criminisi andrew fitzgibbon david liebowitz and larry shapiro and for individual figures from martin armstrong david capel lourdes de agapito vicente eric hayman phil pritchett luc robert cordelia schmid and others who are explicitly acknowledged in figure captions. xvi preface at cambridge university press we thank david tranah for his constant source of advice and patience and michael behrend for excellent copy editing. a small number of minor errors have been corrected in the reprinted editions and we thank the following readers for pointing these out luis baumela niclas borlin mike brooks jun ho. choi wojciech chojnacki carlo colombo nicolas dano andrew fitzgibbon bogdan georgescu fredrik kahl bob kaucic jae-hak kim hansung lee dennis maier karsten muelhmann david nister andreas olsson st ephane paris frederik schaffalitzky bill severson pedro lopez de teruel alcolea bernard thiesse ken thornton magdalena urbanek gergely vass eugene vendrovsky sui wei and tom a s werner. the second edition. this new paperback edition has been expanded to include some of the developments since the original version of july for example the book now covers the discovery of a closed form factorization solution in the projective case when a plane is visible in the scene and the extension of affine factorization to nonrigid scenes. we have also extended the discussion of single view geometry and three view geometry and added an appendix on parameter estimation. in preparing this second edition we are very grateful to colleagues who have made suggestion for improvements and additions. these include marc pollefeys bill triggs and in particular tom a s werner who provided excellent and comprehensive comments. we also thank antonio criminisi andrew fitzgibbon rob fergus david liebowitz and particularly josef sivic for proof reading and very helpful comments on parts of the new material. as always we are grateful to david tranah of cup. the figures appearing in this book can be downloaded from httpwww.robots.ox.ac.uk vgghzbook.html this site also includes matlab code for several of the algorithms and lists the errata of earlier printings. i am never forget the day my first book is published. every chapter i stole from somewhere else. index i copy from old vladivostok telephone directory. this book this book was sensational! excerpts from nikolai ivanovich lobachevsky by tom lehrer. introduction a tour of multiple view geometry this chapter is an introduction to the principal ideas covered in this book. it gives an informal treatment of these topics. precise unambiguous definitions careful algebra and the description of well honed estimation algorithms is postponed until chapter and the following chapters in the book. throughout this introduction we will generally not give specific forward pointers to these later chapters. the material referred to can be located by use of the index or table of contents. introduction the ubiquitous projective geometry we are all familiar with projective transformations.when we look at a picture we see squares that are not squares or circles that are not circles. the transformation that maps these planar objects onto the picture is an example of a projective transformation. so what properties of geometry are preserved by projective transformations? certainly shape is not since a circle may appear as an ellipse. neither are lengths since two perpendicular radii of a circle are stretched by different amounts by the projective transformation. angles distance ratios of distances none of these are preserved and it may appear that very little geometry is preserved by a projective transformation. however a property that is preserved is that of straightness. it turns out that this is the most general requirement on the mapping and we may define a projective transformation of a plane as any mapping of the points on the plane that preserves straight lines. to see why we will require projective geometry we start from the familiar euclidean geometry. this is the geometry that describes angles and shapes of objects. euclidean geometry is troublesome in one major respect we need to keep making an exception to reason about some of the basic concepts of the geometry such as intersection of lines. two lines are thinking here of geometry almost always meet in a point but there are some pairs of lines that do not do so those that we call parallel. a common linguistic device for getting around this is to say that parallel lines meet at infinity however this is not altogether convincing and conflicts with another dictum that infinity does not exist and is only a convenient fiction. we can get around this by introduction a tour of multiple view geometry enhancing the euclidean plane by the addition of these points at infinity where parallel lines meet and resolving the difficulty with infinity by calling them ideal points. by adding these points at infinity the familiar euclidean space is transformed into a new type of geometric object projective space. this is a very useful way of thinking since we are familiar with the properties of euclidean space involving concepts such as distances angles points lines and incidence. there is nothing very mysterious about projective space it is just an extension of euclidean space in which two lines always meet in a point though sometimes at mysterious points at infinity. coordinates. a point in euclidean is represented by an ordered pair of real numbers y. we may add an extra coordinate to this pair giving a triple y that we declare to represent the same point. this seems harmless enough since we can go back and forward from one representation of the point to the other simply by adding or removing the last coordinate. we now take the important conceptual step of asking why the last coordinate needs to be after all the others two coordinates are not so constrained. what about a coordinate triple y it is here that we make a definition and say that y and represent the same point and furthermore ky k represents the same point as well for any non-zero value k. formally points are represented by equivalence classes of coordinate triples where two triples are equivalent when they differ by a common multiple. these are called the homogeneous coordinates of the point. given a coordinate triple ky k we can get the original coordinates back by dividing by k to get y. the reader will observe that although y represents the same point as the coordinate pair y there is no point that corresponds to the triple y if we try to divide by the last coordinate we get the point which is infinite. this is how the points at infinity arise then. they are the points represented by homogeneous coordinates in which the last coordinate is zero. once we have seen how to do this for euclidean space extending it to a projective space by representing points as homogeneous vectors it is clear that we can do the same thing in any dimension. the euclidean space irn can be extended to a projective space ipn by representing points as homogeneous vectors. it turns out that the points at infinity in the two-dimensional projective space form a line usually called the line at infinity. in three-dimensions they form the plane at infinity. homogeneity. in classical euclidean geometry all points are the same. there is no distinguished point. the whole of the space is homogeneous. when coordinates are added one point is seemingly picked out as the origin. however it is important to realize that this is just an accident of the particular coordinate frame chosen. we could just as well find a different way of coordinatizing the plane in which a different point is considered to be the origin. in fact we can consider a change of coordinates for the euclidean space in which the axes are shifted and rotated to a different position. we may think of this in another way as the space itself translating and rotating to a different position. the resulting operation is known as a euclidean transform. a more general type of transformation is that of applying a linear transformation introduction the ubiquitous projective geometry to irn followed by a euclidean transformation moving the origin of the space. we may think of this as the space moving rotating and finally stretching linearly possibly by different ratios in different directions. the resulting transformation is known as an affine transformation. the result of either a euclidean or an affine transformation is that points at infinity remain at infinity. such points are in some way preserved at least as a set by such transformations. they are in some way distinguished or special in the context of euclidean or affine geometry. from the point of view of projective geometry points at infinity are not any different from other points. just as euclidean space is uniform so is projective space. the property that points at infinity have final coordinate zero in a homogeneous coordinate representation is nothing other than an accident of the choice of coordinate frame. by analogy with euclidean or affine transformations we may define a projective transformation of projective space. a linear transformation of euclidean space irn is represented by matrix multiplication applied to the coordinates of the point. in just the same way a projective transformation of projective space ipn is a mapping of the homogeneous coordinates representing a point in which the coordinate vector is multiplied by a non-singular matrix. under such a mapping points at infinity final coordinate zero are mapped to arbitrary other points. the points at infinity are not preserved. thus a projective transformation of projective space ipn is represented by a linear transformation of homogeneous coordinates in computer vision problems projective space is used as a convenient way of representing the real world by extending it to the projective space. similarly images usually formed by projecting the world onto a representation are for convenience extended to be thought of as lying in the projective space. in reality the real world and images of it do not contain points at infinity and we need to keep our finger on which are the fictitious points namely the line at infinity in the image and the plane at infinity in the world. for this reason although we usually work with the projective spaces we are aware that the line and plane at infinity are in some way special. this goes against the spirit of pure projective geometry but makes it useful for our practical problems. generally we try to have it both ways by treating all points in projective space as equals when it suits us and singling out the line at infinity in space or the plane at infinity in the image when that becomes necessary. affine and euclidean geometry we have seen that projective space can be obtained from euclidean space by adding a line plane at infinity. we now consider the reverse process of going backwards. this discussion is mainly concerned with two and three-dimensional projective space. affine geometry. we will take the point of view that the projective space is initially homogeneous with no particular coordinate frame being preferred. in such a space introduction a tour of multiple view geometry there is no concept of parallelism of lines since parallel lines planes in the threedimensional case are ones that meet at infinity. however in projective space there is no concept of which points are at infinity all points are created equal. we say that parallelism is not a concept of projective geometry. it is simply meaningless to talk about it. in order for such a concept to make sense we need to pick out some particular line and decide that this is the line at infinity. this results in a situation where although all points are created equal some are more equal than others. thus start with a blank sheet of paper and imagine that it extends to infinity and forms a projective space what we see is just a small part of the space that looks a lot like a piece of the ordinary euclidean plane. now let us draw a straight line on the paper and declare that this is the line at infinity. next we draw two other lines that intersect at this distinguished line. since they meet at the line at infinity we define them as being parallel. the situation is similar to what one sees by looking at an infinite plane. think of a photograph taken in a very flat region of the earth. the points at infinity in the plane show up in the image as the horizon line. lines such as railway tracks show up in the image as lines meeting at the horizon. points in the image lying above the horizon image of the sky apparently do not correspond to points on the world plane. however if we think of extending the corresponding ray backwards behind the camera it will meet the plane at a point behind the camera. thus there is a one-to-one relationship between points in the image and points in the world plane. the points at infinity in the world plane correspond to a real horizon line in the image and parallel lines in the world correspond to lines meeting at the horizon. from our point of view the world plane and its image are just alternative ways of viewing the geometry of a projective plane plus a distinguished line. the geometry of the projective plane and a distinguished line is known as affine geometry and any projective transformation that maps the distinguished line in one space to the distinguished line of the other space is known as an affine transformation. by identifying a special line as the line at infinity we are able to define parallelism of straight lines in the plane. however certain other concepts make sense as well as soon as we can define parallelism. for instance we may define equalities of intervals between two points on parallel lines. for instance if a b c and d are points and the lines ab and cd are parallel then we define the two intervals ab and cd to have equal length if the lines ac and bd are also parallel. similarly two intervals on the same line are equal if there exists another interval on a parallel line that is equal to both. euclidean geometry. by distinguishing a special line in a projective plane we gain the concept of parallelism and with it affine geometry. affine geometry is seen as specialization of projective geometry in which we single out a particular line plane according to the dimension and call it the line at infinity. next we turn to euclidean geometry and show that by singling out some special feature of the line or plane at infinity affine geometry becomes euclidean geometry. in introduction the ubiquitous projective geometry doing so we introduce one of the most important concepts of this book the absolute conic. we begin by considering two-dimensional geometry and start with circles. note that a circle is not a concept of affine geometry since arbitrary stretching of the plane which preserves the line at infinity turns the circle into an ellipse. thus affine geometry does not distinguish between circles and ellipses. in euclidean geometry however they are distinct and have an important difference. algebraically an ellipse is described by a second-degree equation. it is therefore expected and true that two ellipses will most generally intersect in four points. however it is geometrically evident that two distinct circles can not intersect in more than two points. algebraically we are intersecting two second-degree curves here or equivalently solving two quadratic equations. we should expect to get four solutions. the question is what is special about circles that they only intersect in two points. the answer to this question is of course that there exist two other solutions the two circles meeting in two other complex points. we do not have to look very far to find these two points. the equation for a circle in homogeneous coordinates y w is of the form this represents the circle with centre represented in homogeneous coordinates as b it is quickly verified that the points y wt i lie on every such circle. to repeat this interesting fact every circle passes through the points i and therefore they lie in the intersection of any two circles. since their final coordinate is zero these two points lie on the line at infinity. for obvious reasons they are called the circular points of the plane. note that although the two circular points are complex they satisfy a pair of real equations w this observation gives the clue of how we may define euclidean geometry. euclidean geometry arises from projective geometry by singling out first a line at infinity and subsequently two points called circular points lying on this line. of course the circular points are complex points but for the most part we do not worry too much about this. now we may define a circle as being any conic curve defined by a seconddegree equation that passes through the two circular points. note that in the standard euclidean coordinate system the circular points have the coordinates i in assigning a euclidean structure to a projective plane however we may designate any line and any two points on that line as being the line at infinity and the circular points. as an example of applying this viewpoint we note that a general conic may be found passing through five arbitrary points in the plane as may be seen by counting the number of coefficients of a general quadratic equation f a circle on the other hand is defined by only three points. another way of looking at this is that it is a conic passing through two special points the circular points as well as three other points and hence as any other conic it requires five points to specify it uniquely. it should not be a surprise that as a result of singling out two circular points one introduction a tour of multiple view geometry obtains the whole of the familiar euclidean geometry. in particular concepts such as angle and length ratios may be defined in terms of the circular points. however these concepts are most easily defined in terms of some coordinate system for the euclidean plane as will be seen in later chapters. euclidean geometry. we saw how the euclidean plane is defined in terms of the projective plane by specifying a line at infinity and a pair of circular points. the same idea may be applied to geometry. as in the two-dimensional case one may look carefully at spheres and how they intersect. two spheres intersect in a circle and not in a general fourth-degree curve as the algebra suggests and as two general ellipsoids other quadric surfaces do. this line of thought leads to the discovery that in homogeneous coordinates y z tt all spheres intersect the plane at infinity in a curve with the equations t this is a second-degree curve conic lying on the plane at infinity and consisting only of complex points. it is known as the absolute conic and is one of the key geometric entities in this book most particularly because of its connection to camera calibration as will be seen later. the absolute conic is defined by the above equations only in the euclidean coordinate system. in general we may consider euclidean space to be derived from projective space by singling out a particular plane as the plane at infinity and specifying a particular conic lying in this plane to be the absolute conic. these entities may have quite general descriptions in terms of a coordinate system for the projective space. we will not here go into details of how the absolute conic determines the complete euclidean geometry. a single example will serve. perpendicularity of lines in space is not a valid concept in affine geometry but belongs to euclidean geometry. the perpendicularity of lines may be defined in terms of the absolute conic as follows. by extending the lines until they meet the plane at infinity we obtain two points called the directions of the two lines. perpendicularity of the lines is defined in terms of the relationship of the two directions to the absolute conic. the lines are perpendicular if the two directions are conjugate points with respect to the absolute conic figure the geometry and algebraic representation of conjugate points are defined in section briefly if the absolute conic is represented by a symmetric matrix and the directions are the points and then they are conjugate with respect to if dt more generally angles may be defined in terms of the absolute conic in any arbitrary coordinate system as expressed by camera projections one of the principal topics of this book is the process of image formation namely the formation of a two-dimensional representation of a three-dimensional world and what we may deduce about the structure of what appears in the images. the drop from three-dimensional world to a two-dimensional image is a projection process in which we lose one dimension. the usual way of modelling this process is by central projection in which a ray from a point in space is drawn from a world point through a fixed point in space the centre of projection. this ray will intersect a specific plane in space chosen as the image plane. the intersection of the ray with the camera projections image plane represents the image of the point. if the structure lies on a plane then there is no drop in dimension. this model is in accord with a simple model of a camera in which a ray of light from a point in the world passes through the lens of a camera and impinges on a film or digital device producing an image of the point. ignoring such effects as focus and lens thickness a reasonable approximation is that all the rays pass through a single point the centre of the lens. in applying projective geometry to the imaging process it is customary to model the world as a projective space equal to along with points at infinity. similarly the model for the image is the projective plane central projection is simply a map from to if we consider points in written in terms of homogeneous coordinates y z tt and let the centre of projection be the origin then we see that the set of all points y z tt for fixed x y and z but varying t form a single ray passing through the point centre of projection and hence all mapping to the same point. thus the final coordinate of y z t is irrelevant to where the point is imaged. in fact the image point is the point in with homogeneous coordinates y zt. thus the mapping may be represented by a mapping of homogeneous coordinates represented by a matrix p with the block structure p where is the identity matrix and a zero making allowance for a different centre of projection and a different projective coordinate frame in the image it turns out that the most general imaging projection is represented by an arbitrary matrix of rank acting on the homogeneous coordinates of the point in mapping it to the imaged point in this matrix p is known as the camera matrix. in summary the action of a projective camera on a point in space may be expressed in terms of a linear mapping of homogeneous coordinates as x y w y w y z t x x y t furthermore if all the points lie on a plane may choose this as the plane z then the linear mapping reduces to x which is a projective transformation. cameras as points. in a central projection points in are mapped to points in all points in a ray passing through the centre of projection projecting to the same point in an image. for the purposes of image projection it is possible to consider all points along such a ray as being equal. we can go one step further and think of the ray through the projection centre as representing the image point. thus the set of all image points is the same as the set of rays through the camera centre. if we represent introduction a tour of multiple view geometry x image plane x x x c x x x x x x x x x x x c x x x x x a x c c x c x x x c x x x x x x c e x x x x c b d fig. the camera centre is the essence. image formation the image points xi are the intersection of a plane with rays from the space points xi through the camera centre c. if the space points are coplanar then there is a projective transformation between the world and image planes xi all images with the same camera centre are related by a projective transformation i compare and in both cases planes are mapped to one another by rays through a centre. in the mapping is between a scene and image plane in between two image planes. if the camera centre moves then the images are in general not related by a projective transformation unless all the space points are coplanar. the ray from through the point y z tt by its first three coordinates y zt it is easily seen that for any constant k the ray kx y zt represents the same ray. thus the rays themselves are represented by homogeneous coordinates. in camera projections fact they make up a space of rays. the set of rays themselves may be thought of as a representation of the image space in this representation of the image all that is important is the camera centre for this alone determines the set of rays forming the image. different camera matrices representing the image formation from the same centre of projection reflect only different coordinate frames for the set of rays forming the image. thus two images taken from the same point in space are projectively equivalent. it is only when we start to measure points in an image that a particular coordinate frame for the image needs to be specified. only then does it become necessary to specify a particular camera matrix. in short modulo field-ofview which we ignore for now all images acquired with the same camera centre are equivalent they can be mapped onto each other by a projective transformation without any information about the points or position of the camera centre. these issues are illustrated in figure calibrated cameras. to understand fully the euclidean relationship between the image and the world it is necessary to express their relative euclidean geometry. as we have seen the euclidean geometry of the world is determined by specifying a particular plane in as being the plane at infinity and a specific conic in that plane as being the absolute conic. for a camera not located on the plane at infinity the plane at infinity in the world maps one-to-one onto the image plane. this is because any point in the image defines a ray in space that meets the plane at infinity in a single point. thus the plane at infinity in the world does not tell us anything new about the image. the absolute conic however being a conic in the plane at infinity must project to a conic in the image. the resulting image curve is called the image of the absolute conic or iac. if the location of the iac is known in an image then we say that the camera is calibrated. in a calibrated camera it is possible to determine the angle between the two rays back-projected from two points in the image. we have seen that the angle between two lines in space is determined by where they meet the plane at infinity relative to the absolute conic. in a calibrated camera the plane at infinity and the absolute conic are projected one-to-one onto the image plane and the iac denoted the projective relationship between the two image points and is exactly equal to the relationship between the intersections of the back-projected rays with the plane at infinity and consequently knowing the iac one can measure the angle between rays by direct measurements in the image. thus for a calibrated camera one can measure angles between rays compute the field of view represented by an image patch or determine whether an ellipse in the image back-projects to a circular cone. later on we will see that it helps us to determine the euclidean structure of a reconstructed scene. example reconstructions from paintings using techniques of projective geometry it is possible in many instances to reconstruct scenes from a single image. this cannot be done without some assumptions being made about the imaged scene. typical techniques involve the analysis of features such as parallel lines and vanishing points to determine the affine structure of the scene for introduction a tour of multiple view geometry a c b d fig. single view reconstruction. original painting st. jerome in his study hendrick van steenwijck joseph r. ritman private collection amsterdam the netherlands. views of the model created from the painting. figures courtesy of antonio criminisi. example by determining the line at infinity for observed planes in the image. knowledge assumptions about angles observed in the scene most particularly orthogonal lines or planes can be used to upgrade the affine reconstruction to euclidean. it is not yet possible for such techniques to be fully automatic. however projective geometric knowledge may be built into a system that allows user-guided single-view reconstruction of the scene. such techniques have been used to reconstruct texture mapped graphical models derived from old-master paintings. starting in the renaissance paintings with extremely accurate perspective were produced. in figure a reconstruction carried out from such a painting is shown. reconstruction from more than one view we now turn to one of the major topics in the book that of reconstructing a scene from several images. the simplest case is that of two images which we will consider first. as a mathematical abstraction we restrict the discussion to scenes consisting of points only. the usual input to many of the algorithms given in this book is a set of point correspondences. in the two-view case therefore we consider a set of correspondences reconstruction from more than one view xi i in two images. it is assumed that there exist some camera matrices p and and a set of points xi that give rise to these image correspondences in the sense that pxi xi and i. thus the point xi projects to the two given data points. however neither the cameras by projection matrices p and nor the points xi are known. it is our task to determine them. it is clear from the outset that it is impossible to determine the positions of the points uniquely. this is a general ambiguity that holds however many images we are given and even if we have more than just point correspondence data. for instance given several images of a cube it is impossible to tell its absolute position it located in a night-club in addis ababa or the british museum its orientation face is facing north or its scale. we express this by saying that the reconstruction is possible at best up to a similarity transformation of the world. however it turns out that unless something is known about the calibration of the two cameras the ambiguity in the reconstruction is expressed by a more general class of transformations projective transformations. this ambiguity arises because it is possible to apply a projective transformation by a matrix h to each point xi and on the right of each camera matrix pj without changing the projected image points thus pjxi there is no compelling reason to choose one set of points and camera matrices over the other. the choice of h is essentially arbitrary and we say that the reconstruction has a projective ambiguity or is a projective reconstruction. however the good news is that this is the worst that can happen. it is possible to reconstruct a set of points from two views up to an unavoidable projective ambiguity. well to be able to say this we need to make a few qualifications there must be sufficiently many points at least seven and they must not lie in one of various well-defined critical configurations. the basic tool in the reconstruction of point sets from two views is the fundamental matrix which represents the constraint obeyed by image points x and if they are to be images of the same point. this constraint arises from the coplanarity of the camera centres of the two views the images points and the space point. given the fundamental matrix f a pair of matching points xi i must satisfy i tfxi where f is a matrix of rank these equations are linear in the entries of the matrix f which means that if f is unknown then it can be computed from a set of point correspondences. a pair of camera matrices p and uniquely determine a fundamental matrix f and conversely the fundamental matrix determines the pair of camera matrices up to a projective ambiguity. thus the fundamental matrix encapsulates the complete projective geometry of the pair of cameras and is unchanged by projective transformation of introduction a tour of multiple view geometry the fundamental-matrix method for reconstructing the scene is very simple consist ing of the following steps given several point correspondences xi equations in the entries of f based on the coplanarity equations i across two views form linear tfxi i find f as the solution to a set of linear equations. compute a pair of camera matrices from f according to the simple formula given in section and the corresponding image point pairs xi given the two cameras i find the point xi that projects to the given image points. solving for x in this way is known as triangulation. the algorithm given here is an outline only and each part of it is examined in detail in this book. the algorithm should not be implemented directly from this brief description. three-view geometry in the last section it was discussed how reconstruction of a set of points and the relative placement of the cameras is possible from two views of a set of points. the reconstruction is possible only up to a projective transformation of space and the corresponding adjustment to the camera matrices. in this section we consider the case of three views. whereas for two views the basic algebraic entity is the fundamental matrix for three views this role is played by the trifocal tensor. the trifocal tensor is a array of numbers that relate the coordinates of corresponding points or lines in three views. just as the fundamental matrix is determined by the two camera matrices and determines them up to projective transformation so in three views the trifocal tensor is determined by the three camera matrices and in turn determines them again up to projective transformation. thus the trifocal tensor encapsulates the relative projective geometry of the three cameras. for reasons that will be explained in chapter it is usual to write some of the indices of a tensor as lower and some as upper indices. these are referred to as the covariant and contravariant indices. the trifocal tensor is of the form t jk having two upper and one lower index. the most basic relationship between image entities in three views concerns a correspondence between two lines and a point. we consider a correspondence x between a point x in one image and two lines in the other two images. this relationship means that there is a point x in space that maps to x in the first image and to points in the other two images. the coordinates of these three images are then related via the trifocal tensor relationship and and and i lying on the lines jl k t jk i xil this relationship gives a single linear relationship between the elements of the tensor. with sufficiently many such correspondences it is possible to solve linearly for the ijk four view geometry and n-view reconstruction and in fact in this situation one can choose any lines elements of the tensor. fortunately one can obtain more equations from a point correspondence x and passing through the points and generate a relation of the sort since it is possible to choose two independent lines passing through and two others passing through one can obtain four independent equations in this way. a total of seven point correspondences are sufficient to compute the trifocal tensor linearly in this way. it can be computed from a minimum of six point correspondences using a non-linear method. the elements of the tensor are not independent however but are related by a set of so called internal constraints. these constraints are quite complicated but tensors satisfying the constraints can be computed in various ways for instance by using the point non-linear method. the fundamental matrix is a tensor also satisfies an internal constraint but a relatively simple one the elements obey det f as with the fundamental matrix once the trifocal tensor is known it is possible to extract the three camera matrices from it and thereby obtain a reconstruction of the scene points and lines. as ever this reconstruction is unique only up to a projective transformation it is a projective reconstruction. thus we are able to generalize the method for two views to three views. there are several advantages to using such a three-view method for reconstruction. it is possible to use a mixture of line and point correspondences to compute the projective reconstruction. with two views only point correspondences can be used. using three views gives greater stability to the reconstruction and avoids unstable configurations that may occur using only two views for the reconstruction. four view geometry and n-view reconstruction it is possible to go one more step with tensor-based methods and define a quadrifocal tensor relating entities visible in four views. this method is seldom used however because of the relative difficulty of computing a quadrifocal tensor that obey its internal constraints. nevertheless it does provide a non-iterative method for computing a projective reconstruction based on four views. the tensor method does not extend to more than four views however and so reconstruction from more than four views becomes more difficult. many methods have been considered for reconstruction from several views and we consider a few of these in the book. one way to proceed is to reconstruct the scene bit by bit using three-view or two-view techniques. such a method may be applied to any image sequence and with care in selecting the right triples to use it will generally succeed. there are methods that can be used in specific circumstances. the task of reconstruction becomes easier if we are able to apply a simpler camera model known as the affine camera. this camera model is a fair approximation to perspective projection whenever the distance to the scene is large compared with the difference in depth between the back and front of the scene. if a set of points are visible in all of a set of n views introduction a tour of multiple view geometry involving an affine camera then a well-known algorithm the factorization algorithm can be used to compute both the structure of the scene and the specific camera models in one step using the singular value decomposition. this algorithm is very reliable and simple to implement. its main difficulties are the use of the affine camera model rather than a full projective model and the requirement that all the points be visible in all views. this method has been extended to projective cameras in a method known as projective factorization. although this method is generally satisfactory it can not be proven to converge to the correct solution in all cases. besides it also requires all points to be visible in all images. other methods for n-view reconstruction involve various assumptions such as knowledge of four coplanar points in the world visible in all views or six or seven points that are visible in all images in the sequence. methods that apply to specific motion sequences such as linear motion planar motion or single axis motion have also been developed. the dominant methodology for the general reconstruction problem is bundle adjustment. this is an iterative method in which one attempts to fit a non-linear model to the measured data point correspondences. the advantage of bundle-adjustment is that it is a very general method that may be applied to a wide range of reconstruction and optimization problems. it may be implemented in such a way that the discovered solution is the maximum likelihood solution to the problem that is a solution that is in some sense optimal in terms of a model for the inaccuracies of image measurements. unfortunately bundle adjustment is an iterative process which can not be guaranteed to converge to the optimal solution from an arbitrary starting point. much research in reconstruction methods seeks easily computable non-optimal solutions that can be used as a starting point for bundle adjustment. an initialization step followed by bundle adjustment is the generally preferred technique for reconstruction. a common impression is that bundle-adjustment is necessarily a slow technique. the truth is that it is quite efficient when implemented carefully. a lengthy appendix in this book deals with efficient methods of bundle adjustment. using n-view reconstruction techniques it is possible to carry out reconstructions automatically from quite long sequences of images. an example is given in figure showing a reconstruction from frames. transfer we have discussed reconstruction from a set of images. another useful application of projective geometry is that of transfer given the position of a point in one more images determine where it will appear in all other images of the set. to do this we must first establish the relationship between the cameras using instance a set of auxiliary point correspondences. conceptually transfer is straightforward given that a reconstruction is possible. for instance suppose the point is identified in two views x and in a third then this may be computed by the following steps and we wish to know its position transfer fig. reconstruction. seven frames of a frame sequence acquired by a hand held camera whilst walking down a street in oxford. two views of the reconstructed point cloud and camera path red curve. figures courtesy of david capel and introduction a tour of multiple view geometry fig. projective ambiguity reconstructions of a mug with the true shape in the centre under projective transformations in the z direction. five examples of the cup with different degrees of projective distortion are shown. the shapes are quite different from the original. respondences xi compute the camera matrices of the three views p triangulate the point x from x and project the point into the third view as i i using p and from other point cor this procedure only requires projective information. an alternative procedure is to use the multi-view tensors fundamental matrix and trifocal tensor to transfer the point directly without an explicit reconstruction. both methods have their advantages. suppose the camera rotates about its centre or that all the scene points of interest lie on a plane. then the appropriate multiple view relations are the planar projective transformations between the images. in this case a point seen in just one image can be transferred to any other image. euclidean reconstruction so far we have considered the reconstruction of a scene or transfer for images taken with a set of uncalibrated cameras. for such cameras important parameters such as the focal length the geometric centre of the image principal point and possibly the aspect ratio of the pixels in the image are unknown. if a complete calibration of each of the cameras is known then it is possible to remove some of the ambiguity of the reconstructed scene. so far we have discussed projective reconstruction which is all that is possible without knowing something about the calibration of the cameras or the scene. projective reconstruction is insufficient for many purposes such as application to computer graphics since it involves distortions of the model that appear strange to a human used to viewing a euclidean world. for instance the distortions that projective transformations induce in a simple object are shown in figure using the technique of projective reconstruction there is no way to choose between any of the possible shapes of the mug in figure and a projective reconstruction algorithm is as likely to come up with any one of the reconstructions shown there as any other. even more severely distorted models may arise from projective reconstruction. in order to obtain a reconstruction of the model in which objects have their correct shape it is necessary to determine the calibration of the cameras. it is easy to see that this is sufficient to determine the euclidean structure of the scene. as we have seen determining the euclidean structure of the world is equivalent to specifying the plane at infinity and the absolute conic. in fact since the absolute conic auto-calibration lies in a plane the plane at infinity it is enough to find the absolute conic in space. now suppose that we have computed a projective reconstruction of the world using calibrated cameras. by definition this means that the iac is known in each of the images let it be denoted by i in the i-th image. the back-projection of each i is a cone in space and the absolute conic must lie in the intersection of all the cones. two cones in general intersect in a fourth-degree curve but given that they must intersect in a conic this curve must split into two conics. thus reconstruction of the absolute conic from two images is not unique rather there are two possible solutions in general. however from three or more images the intersection of the cones is unique in general. thus the absolute conic is determined and with it the euclidean structure of the scene. of course if the euclidean structure of the scene is known then so is the position of the absolute conic. in this case we may project it back into each of the images producing the iac in each image and hence calibrating the cameras. thus knowledge of the camera calibration is equivalent to being able to determine the euclidean structure of the scene. auto-calibration without any knowledge of the calibration of the cameras it is impossible to do better than projective reconstruction. there is no information in a set of feature correspondences across any number of views that can help us find the image of the absolute conic or equivalently the calibration of the cameras. however if we know just a little about the calibration of the cameras then we may be able to determine the position of the absolute conic. suppose for instance that it is known that the calibration is the same for each of the cameras used in reconstructing a scene from an image sequence. by this we mean the following. in each image a coordinate system is defined in which we have measured the image coordinates of corresponding features used to do projective reconstruction. suppose that in all these image coordinate systems the iac is the same but just where it is located is unknown. from this knowledge we wish to compute the position of the absolute conic. one way to find the absolute conic is to hypothesize the position of the iac in one image by hypothesis its position in the other images will be the same. the backprojection of each of the conics will be a cone in space. if the three cones all meet in a single conic then this must be a possible solution for the position of the absolute conic consistent with the reconstruction. note that this is a conceptual description only. the iac is of course a conic containing only complex points and its back-projection will be a complex cone. however algebraically the problem is more tractable. although it is complex the iac may be described by a real quadratic form by a real symmetric matrix. the backprojected cone is also represented by a real quadratic form. for some value of the iac the three back-projected cones will meet in a conic curve in space. generally given three cameras known to have the same calibration it is possible to determine the absolute conic and hence the calibration of the cameras. however introduction a tour of multiple view geometry although various methods have been proposed for this it remains quite a difficult problem. knowing the plane at infinity. one method of auto-calibration is to proceed in steps by first determining the plane on which it lies. this is equivalent to identifying the plane at infinity in the world and hence to determining the affine geometry of the world. in a second step one locates the position of the absolute conic on the plane to determine the euclidean geometry of space. assuming one knows the plane at infinity one can back-project a hypothesised iac from each of a sequence of images and intersect the resulting cones with the plane at infinity. if the iac is chosen correctly the intersection curve is the absolute conic. thus from each pair of images one has a condition that the back-projected cones meet in the same conic curve on the plane at infinity. it turns out that this gives a linear constraint on the entries of the matrix representing the iac. from a set of linear equations one can determine the iac and hence the absolute conic. thus auto-calibration is relatively simple once the plane at infinity has been identified. the identification of the plane at infinity itself is substantially more difficult. auto-calibration given square pixels in the image. if the cameras are partially calibrated then it is possible to complete the calibration starting from a projective reconstruction. one can make do with quite minimal conditions on the calibration of the cameras represented by the iac. one interesting example is the square-pixel constraint on the cameras. what this means is that a euclidean coordinate system is known in each image. in this case the absolute conic lying in the plane at infinity in the world must meet the image plane in its two circular points. the circular points in a plane are the two points where the absolute conic meets that plane. the back-projected rays through the circular points of the image plane must intersect the absolute conic. thus each image with square pixels determines two rays that must meet the absolute conic. given n images the autocalibration task then becomes that of determining a space conic absolute conic that meets a set of rays in space. an equivalent geometric picture is to intersect the set of rays with a plane and require that the set of intersection points lie on a conic. by a simple counting argument one may see that there are only a finite number of conics that meet eight prescribed rays in space. therefore from four images one may determine the calibration albeit up to a finite number of possibilities. the reward i graphical models we have now described all the ingredients necessary to compute realistic graphics models from image sequences. from point matches between images it is possible to carry out first a projective reconstruction of the point set and determine the motion of the camera in the chosen projective coordinate frame. using auto-calibration techniques assuming some restrictions on the calibration of the camera that captured the image sequence the camera may be calibrated and the scene subsequently transformed to its true euclidean structure. the reward ii video augmentation a b fig. three high resolution images pixels from a set of eleven of the cityhall in leuven belgium. three views of a euclidean reconstruction computed from the image set showing the camera positions and point cloud. knowing the projective structure of the scene it is possible to find the epipolar geometry relating pairs of images and this restricts the correspondence search for further matches to a line a point in one image defines a line in the other image on which the yet unknown corresponding point must lie. in fact for suitable scenes it is possible to carry out a dense point match between images and create a dense model of the imaged scene. this takes the form of a triangulated shape model that is subsequently shaded or texture-mapped from the supplied images and used to generate novel views. the steps of this process are illustrated in figure and figure the reward ii video augmentation we finish this introduction with a further application of reconstruction methods to computer graphics. automatic reconstruction techniques have recently become widely used in the film industry as a means for adding artificial graphics objects in real video sequences. computer analysis of the motion of the camera is replacing the previously used manual methods for correctly aligning the artificial inserted object. the most important requirement for realistic insertion of an artificial object in a video introduction a tour of multiple view geometry a c e b d f fig. dense reconstructions. these are computed from the cameras and image of figure untextured and textured reconstruction of the full scene. untextured and textured close up of the area shown in the white rectangle of untextured and textured close up of the area shown in the white rectangle of the dense surface is computed using the three-view stereo algorithm described in figures courtesy of christoph strecha frank verbiest and luc van gool. the reward ii video augmentation a d b e c f fig. augmented video. the animated robot is inserted into the scene and rendered using the computed cameras of figure the augmented frames. figures courtesy of original frames from the sequence. sequence is to compute the correct motion of the camera. unless the camera motion is correctly determined it is impossible to generate the correct sequences of views of the graphics model in a way that will appear consistent with the background video. generally it is only the motion of the camera that is important here we do not need to reconstruct the scene since it is already present in the existing video and novel views of the scene visible in the video are not required. the only requirement is to be able to generate correct perspective views of the graphics model. it is essential to compute the motion of the camera in a euclidean frame. it is not enough merely to know the projective motion of the camera. this is because a euclidean object is to be placed in the scene. unless this graphics object and the cameras are known in the same coordinate frame then generated views of the inserted object will be seen to distort with respect to the perceived structure of the scene seen in the existing video. once the correct motion of the camera and its calibration are known the inserted object may be rendered into the scene in a realistic manner. if the change of the camera calibration from frame to frame is correctly determined then the camera may change focal length during the sequence. it is even possible for the principal point to vary during the sequence through cropping. in inserting the rendered model into the video the task is relatively straight-forward if it lies in front of all the existing scene. otherwise the possibility of occlusions arises in which the scene may obscure parts of the model. an example of video augmentation is shown in figure part the background projective geometry transformations and estimation la reproduction interdite forbidden reproduction ren e magritte. courtesy of museum boijmans van beuningen rotterdam. adagp paris and dacs london outline the four chapters in this part lay the foundation for the representations terminology and notation that will be used in the subsequent parts of the book. the ideas and notation of projective geometry are central to an analysis of multiple view geometry. for example the use of homogeneous coordinates enables non-linear mappings as perspective projection to be represented by linear matrix equations and points at infinity to be represented quite naturally avoiding the awkward necessity of taking limits. chapter introduces projective transformations of these are the transformations that arise when a plane is imaged by a perspective camera. this chapter is more introductory and sets the scene for the geometry of most of the concepts can be more easily understood and visualized in than in specializations of projective transformations are introduced including affine and similarity transformations. particular attention is focussed on the recovery of affine properties parallel lines and metric properties angles between lines from a perspective image. chapter covers the projective geometry of this geometry develops in much the same manner as that of though of course there are extra properties arising from the additional dimension. the main new geometry here is the plane at infinity and the absolute conic. chapter introduces estimation of geometry from image measurements which is one of the main topics of this book. the example of estimating a projective transformation from point correspondences is used to illustrate the basis and motivation for the algorithms that will be used throughout the book. the important issue of what should be minimized in a cost function e.g. algebraic or geometric or statistical measures is described at length. the chapter also introduces the idea of robust estimation and the use of such techniques in the automatic estimation of transformations. chapter describes how the results of estimation algorithms may be evaluated. in particular how the covariance of an estimation may be computed. projective geometry and transformations of this chapter introduces the main geometric ideas and notation that are required to understand the material covered in this book. some of these ideas are relatively familiar such as vanishing point formation or representing conics whilst others are more esoteric such as using circular points to remove perspective distortion from an image. these ideas can be understood more easily in the planar case because they are more easily visualized here. the geometry of which is the subject of the later parts of this book is only a simple generalization of this planar case. in particular the chapter covers the geometry of projective transformations of the plane. these transformations model the geometric distortion which arises when a plane is imaged by a perspective camera. under perspective imaging certain geometric properties are preserved such as collinearity straight line is imaged as a straight line whilst others are not for example parallel lines are not imaged as parallel lines in general. projective geometry models this imaging and also provides a mathematical representation appropriate for computations. we begin by describing the representation of points lines and conics in homogeneous notation and how these entities map under projective transformations. the line at infinity and the circular points are introduced and it is shown that these capture the affine and metric properties of the plane. algorithms for rectifying planes are then given which enable affine and metric properties to be computed from images. we end with a description of fixed points under projective transformations. planar geometry the basic concepts of planar geometry are familiar to anyone who has studied mathematics even at an elementary level. in fact they are so much a part of our everyday experience that we take them for granted. at an elementary level geometry is the study of points and lines and their relationships. to the purist the study of geometry ought properly to be carried out from a geometric or coordinate-free viewpoint. in this approach theorems are stated and proved in terms of geometric primitives only without the use of algebra. the classical approach of euclid is an example of this method. since descartes however it has been seen that geometry may be algebraicized and indeed the theory of geometry may be developed projective geometry and transformations of from an algebraic viewpoint. our approach in this book will be a hybrid approach sometimes using geometric and sometimes algebraic methods. in the algebraic approach geometric entities are described in terms of coordinates and algebraic entities. thus for instance a point is identified with a vector in terms of some coordinate basis. a line is also identified with a vector and a conic section briefly a conic is represented by a symmetric matrix. in fact we often carry this identification so far as to consider that the vector actually is a point or the symmetric matrix is a conic at least for convenience of language. a significant advantage of the algebraic approach to geometry is that results derived in this way may more easily be used to derive algorithms and practical computational methods. computation and algorithms are a major concern in this book which justifies the use of the algebraic method. the projective plane as we all know a point in the plane may be represented by the pair of coordinates y in thus it is common to identify the plane with considering as a vector space the coordinate pair y is a vector a point is identified as a vector. in this section we introduce the homogeneous notation for points and lines on a plane. row and column vectors. later on we will want to consider linear mappings between vector spaces and represent such mappings as matrices. in the usual manner the product of a matrix and a vector is another vector the image under the mapping. this brings up the distinction between column and row vectors since a matrix may be multiplied on the right by a column and on the left by a row vector. geometric entities will by default be represented by column vectors. a bold-face symbol such as x always represents a column vector and its transpose is the row vector xt. in accordance with this convention a point in the plane will be represented by the column vector yt rather than its transpose the row vector y. we write x yt both sides of this equation representing column vectors. points and lines homogeneous representation of lines. a line in the plane is represented by an equation such as ax different choices of a b and c giving rise to different lines. thus a line may naturally be represented by the vector b ct. the correspondence between lines and vectors b ct is not one-to-one since the lines ax by c and are the same for any non-zero constant k. thus the vectors b ct and ka b ct represent the same line for any non-zero k. in fact two such vectors related by an overall scaling are considered as being equivalent. an equivalence class of vectors under this equivalence relationship is known as a homogeneous vector. any particular vector b ct is a representative of the equivalence class. the set of equivalence classes of vectors in forms the projective space the notation indicates that the vector which does not correspond to any line is excluded. the projective plane homogeneous representation of points. a point x yt lies on the line l b ct if and only if ax by c this may be written in terms of an inner product of vectors representing the point as y b ct y that is the point yt in is represented as a by adding a final coordinate of note that for any non-zero constant k and line l the equation ky kl if and only if y it is natural therefore to consider the set of vectors ky kt for varying values of k to be a representation of the point yt in thus just as with lines points are represented by homogeneous vectors. an arbitrary homogeneous vector representative of a point is of the form x representing the point in points then as homogeneous vectors are also elements of one has a simple equation to determine when a point lies on a line namely result the point x lies on the line l if and only if xtl note that the expression xtl is just the inner or scalar product of the two vectors l and x. the scalar product xtl ltx x.l. in general the transpose notation ltx will be preferred but occasionally we will use a to denote the inner product. we distinguish between the homogeneous coordinates x of a point which is a and the inhomogeneous coordinates yt which is a degrees of freedom it is clear that in order to specify a point two values must be provided namely its x- and y-coordinates. in a similar manner a line is specified by two parameters two independent ratios b c and so has two degrees of freedom. for example in an inhomogeneous representation these two parameters could be chosen as the gradient and y intercept of the line. intersection of lines. given two lines l b ct and we wish to find their intersection. define the vector x l where represents the vector or cross product. from the triple scalar product identity l.l we see that ltx thus if x is thought of as representing a point then x lies on both lines l and result the intersection of two lines l and note that the simplicity of this expression for the intersection of the two lines is a direct consequence of the use of homogeneous vector representations of lines and points. example consider the simple problem of determining the intersection of the lines x and y the line x is equivalent to and thus has homogeneous representation l the line y is equivalent to from result the and thus has homogeneous representation intersection point is and hence is the intersection of the two lines. this shows is the point x l b c x l j i k which is the inhomogeneous point as required. projective geometry and transformations of line joining points. an expression for the line passing through two points x and may be derived by an entirely analogous argument. defining a line l by l x it may be verified that both points x and result the line through two points x and is l x lie on l. thus ideal points and the line at infinity intersection of parallel lines. consider two lines axbyc and axbyc these are represented by vectors l b ct and for which the first two coordinates are the same. computing the intersection of these lines gives no difficulty using result the intersection is l cb a and ignoring the scale c this is the point a factor now if we attempt to find the inhomogeneous representation of this point we obtain which makes no sense except to suggest that the point of intersection has infinitely large coordinates. in general points with homogeneous coordinates y do not correspond to any finite point in this observation agrees with the usual idea that parallel lines meet at infinity. b c example consider the two lines x and x here the two lines are parallel and consequently intersect at infinity in homogeneous notation the lines are l and from result their intersection point is x l i j k which is the point at infinity in the direction of the y-axis. ideal points and the line at infinity. homogeneous vectors x such that correspond to finite points in one may augment by adding points with last coordinate the resulting space is the set of all homogeneous namely the projective space the points with last coordinate are known as ideal points or points at infinity. the set of all ideal points may be written with a particular point specified by the ratio note that this set lies on a single line the line at infinity denoted by the vector l indeed one verifies that using result one finds that a line l b ct intersects l in the ideal point a a a line parallel to l intersects l in the same ideal point a irrespective of the value of c in inhomogeneous notation at is a vector tangent to the line and orthogonal to the line normal b and so represents the line s direction. as the line s direction varies the ideal point a varies over l for these reasons the line at infinity can be thought of as the set of directions of lines in the plane. b c note how the introduction of the concept of points at infinity serves to simplify the intersection properties of points and lines. in the projective plane one may state without qualification that two distinct lines meet in a single point and two distinct the projective plane x ideal point x l x o x fig. a model of the projective plane. points and lines of are represented by rays and planes respectively through the origin in lines lying in the represent ideal points and the represents l points lie on a single line. this is not true in the standard euclidean geometry of in which parallel lines form a special case. the study of the geometry of is known as projective geometry. in a coordinatefree purely geometric study of projective geometry one does not make any distinction between points at infinity points and ordinary points. it will however serve our purposes in this book sometimes to distinguish between ideal points and non-ideal points. thus the line at infinity will at times be considered as a special line in projective space. a model for the projective plane. a fruitful way of thinking of is as a set of rays in the set of all vectors as k varies forms a ray through the origin. such a ray may be thought of as representing a single point in in this model the lines in are planes passing through the origin. one verifies that two nonidentical rays lie on exactly one plane and any two planes intersect in one ray. this is the analogue of two distinct points uniquely defining a line and two lines always intersecting in a point. points and lines may be obtained by intersecting this set of rays and planes by the plane as illustrated in figure the rays representing ideal points and the plane representing l are parallel to the plane duality. the reader has probably noticed how the role of points and lines may be interchanged in statements concerning the properties of lines and points. in particular the basic incidence equation ltx for line and point is symmetric since ltx implies xtl in which the positions of line and point are swapped. similarly result and result giving the intersection of two lines and the line through two points are essentially the same with the roles of points and lines swapped. one may enunciate a general principle the duality principle as follows projective geometry and transformations of result duality principle. to any theorem of projective geometry there corresponds a dual theorem which may be derived by interchanging the roles of points and lines in the original theorem. in applying this principle concepts of incidence must be appropriately translated as well. for instance the line through two points is dual to the point through is the point of intersection of two lines. note that is it not necessary to prove the dual of a given theorem once the original theorem has been proved. the proof of the dual theorem will be the dual of the proof of the original theorem. conics and dual conics a conic is a curve described by a second-degree equation in the plane. in euclidean geometry conics are of three main types hyperbola ellipse and parabola from so-called degenerate conics to be defined later. classically these three types of conic arise as conic sections generated by planes of differing orientation degenerate conics arise from planes which contain the cone vertex. however it will be seen that in projective geometry all non-degenerate conics are equivalent under projective transformations. the equation of a conic in inhomogeneous coordinates is bxy dx ey f i.e. a polynomial of degree homogenizing this by the replacements x y gives f or in matrix form where the conic coefficient matrix c is given by xtcx a c c f note that the conic coefficient matrix is symmetric. as in the case of the homogeneous representation of points and lines only the ratios of the matrix elements are important since multiplying c by a non-zero scalar does not affect the above equations. thus c is a homogeneous representation of a conic. the conic has five degrees of freedom which can be thought of as the ratios b c d e f or equivalently the six elements of a symmetric matrix less one for scale. five points define a conic. suppose we wish to compute the conic which passes through a set of points xi. how many points are we free to specify before the conic is determined uniquely? the question can be answered constructively by providing an c the projective plane algorithm to determine the conic. from each point xi places one constraint on the conic coefficients since if the conic passes through yi then dxi eyi f bxiyi cyi axi this constraint can be written as i xiyi i xi yi c where c b c d e f is the conic c represented as a stacking the constraints from five points we obtain and the conic is the null vector of this matrix. this shows that a conic is determined uniquely to scale by five points in general position. the method of fitting a geometric entity relation by determining a null space will be used frequently in the computation chapters throughout this book. tangent lines to conics. the line l tangent to a conic at a point x has a particularly simple form in homogeneous coordinates result the line l tangent to c at a point x on c is given by l cx. proof. the line l cx passes through x since ltx xtcx if l has one-point contact with the conic then it is a tangent and we are done. otherwise suppose that l meets the conic in another point y. then ytcy and xtcy lty from this it follows that ytcx y for all which means that the whole line l cx joining x and y lies on the conic c which is therefore degenerate below. dual conics. the conic c defined above is more properly termed a point conic as it defines an equation on points. given the duality result of it is not surprising that there is also a conic which defines an equation on lines. this dual line conic is also represented by a matrix which we denote as c a line l tangent to the conic c satisfies ltc l the notation c indicates that c is the adjoint matrix of c adjoint is defined in section of appendix for a non-singular symmetric matrix c c to scale. the equation for a dual conic is straightforward to derive in the case that c has full rank from result at a point x on c the tangent is l cx. inverting we find the point x at which the line l is tangent to c is x c since x satisfies xtcx we obtain tc the last step following from c t c because c is symmetric. dual conics are also known as conic envelopes and the reason for this is illustrated projective geometry and transformations of a b fig. points x satisfying xtcx lie on a point conic. lines l satisfying ltc l are tangent to the point conic c. the conic c is the envelope of the lines l. in figure a dual conic has five degrees of freedom. in a similar manner to points defining a point conic it follows that five lines in general position define a dual conic. degenerate conics. if the matrix c is not of full rank then the conic is termed degenerate. degenerate point conics include two lines and a repeated line example the conic c l mt m lt is composed of two lines l and m. points on l satisfy ltx and are on the conic since xtcx similarly points satisfying mtx also satisfy xtcx the matrix c is symmetric and has rank the null vector is x l m which is the intersection point of l and m. degenerate line conics include two points and a repeated point for example the line conic c xyt yxt has rank and consists of lines passing through either of the two points x and y. note that for matrices that are not invertible c. projective transformations in the view of geometry set forth by felix klein in his famous erlangen program geometry is the study of properties invariant under groups of transformations. from this point of view projective geometry is the study of properties of the projective plane that are invariant under a group of transformations known as projectivities. a projectivity is an invertible mapping from points in is homogeneous vectors to points in that maps lines to lines. more precisely definition a projectivity is an invertible mapping h from to itself such that three points and lie on the same line if and only if and do. projectivities form a group since the inverse of a projectivity is also a projectivity and so is the composition of two projectivities. a projectivity is also called a collineation projective transformations helpful name a projective transformation or a homography the terms are synonymous. in definition a projectivity is defined in terms of a coordinate-free geometric concept of point line incidence. an equivalent algebraic definition of a projectivity is possible based on the following result. theorem a mapping h is a projectivity if and only if there exists a non-singular matrix h such that for any point in represented by a vector x it is true that hx hx. to interpret this theorem any point in is represented as a homogeneous x and hx is a linear mapping of homogeneous coordinates. the theorem asserts that any projectivity arises as such a linear transformation in homogeneous coordinates and that conversely any such mapping is a projectivity. the theorem will not be proved in full here. it will only be shown that any invertible linear transformation of homogeneous coordinates is a projectivity. proof. let and lie on a line l. thus ltxi for i let h be a non-singular matrix. one verifies that lth thus the points hxi all lie on the line h tl and collinearity is preserved by the transformation. the converse is considerably harder to prove namely that each projectivity arises in this way. as a result of this theorem one may give an alternative definition of a projective transformation collineation as follows. definition projective transformation. a planar projective transformation is a linear transformation on homogeneous represented by a non-singular matrix x x x or more briefly hx. note that the matrix h occurring in this equation may be changed by multiplication by an arbitrary non-zero scale factor without altering the projective transformation. consequently we say that h is a homogeneous matrix since as in the homogeneous representation of a point only the ratio of the matrix elements is significant. there are eight independent ratios amongst the nine elements of h and it follows that a projective transformation has eight degrees of freedom. a projective transformation projects every figure into a projectively equivalent figure leaving all its projective properties invariant. in the ray model of figure a projective transformation is simply a linear transformation of projective geometry and transformations of o x y x x y x fig. central projection maps points on one plane to points on another plane. the projection also maps lines to lines as may be seen by considering a plane through the projection centre which intersects with the two planes and since lines are mapped to lines central projection is a projectivity and may be represented by a linear mapping of homogeneous coordinates hx. mappings between planes. as an example of how theorem may be applied consider figure projection along rays through a common point centre of projection defines a mapping from one plane to another. it is evident that this point-topoint mapping preserves lines in that a line in one plane is mapped to a line in the other. if a coordinate system is defined in each plane and points are represented in homogeneous coordinates then the central projection mapping may be expressed by hx where h is a non-singular matrix. actually if the two coordinate systems defined in the two planes are both euclidean coordinate systems then the mapping defined by central projection is more restricted than an arbitrary projective transformation. it is called a perspectivity rather than a full projectivity and may be represented by a transformation with six degrees of freedom. we return to perspectivities in section example removing the projective distortion from a perspective image of a plane. shape is distorted under perspective imaging. for instance in figure the windows are not rectangular in the image although the originals are. in general parallel lines on a scene plane are not parallel in the image but instead converge to a finite point. we have seen that a central projection image of a plane section of a plane is related to the original plane via a projective transformation and so the image is a projective distortion of the original. it is possible to undo this projective transformation by computing the inverse transformation and applying it to the image. the result will be a new synthesized image in which the objects in the plane are shown with their correct geometric shape. this will be illustrated here for the front of the building of figure note that since the ground and the front are not in the same plane the projective transformation that must be applied to rectify the front is not the same as the one used for the ground. computation of a projective transformation from point-to-point correspondences will be considered in great detail in chapter for now a method for computing the trans projective transformations a b fig. removing perspective distortion. the original image with perspective distortion the lines of the windows clearly converge at a finite point. synthesized frontal orthogonal view of the front wall. the image of the wall is related via a projective transformation to the true geometry of the wall. the inverse transformation is computed by mapping the four imaged window corners to corners of an appropriately sized rectangle. the four point correspondences determine the transformation. the transformation is then applied to the whole image. note that sections of the image of the ground are subject to a further projective distortion. this can also be removed by a projective transformation. formation is briefly indicated. one begins by selecting a section of the image corresponding to a planar section of the world. local image and world coordinates are selected as shown in figure let the inhomogeneous coordinates of a pair of matching points x and respectively. we use inhomogeneous coordinates here instead of the homogeneous coordinates of the points because it is these inhomogeneous coordinates that are measured directly from the image and from the world plane. the projective transformation of can be written in inhomogeneous form as in the world and image plane be y and y x x x y x x each point correspondence generates two equations for the elements of h which after multiplying out are x y these equations are linear in the elements of h. four point correspondences lead to eight such linear equations in the entries of h which are sufficient to solve for h up to an insignificant multiplicative factor. the only restriction is that the four points must be in general position which means that no three points are collinear. the inverse of the transformation h computed in this way is then applied to the whole image to undo the effect of perspective distortion on the selected plane. the results are shown in figure three remarks concerning this example are appropriate first the computation of the rectifying transformation h in this way does not require knowledge of any of the camera s parameters or the pose of the plane second it is not always necessary to projective geometry and transformations of image x image rt x x x x image image x x x a planar surface b c fig. examples of a projective transformation hx arising in perspective images. the projective transformation between two images induced by a world plane concatenation of two projective transformations is a projective transformation the projective transformation between two images with the same camera centre a camera rotating about its centre or a camera varying its focal length the projective transformation between the image of a plane end of the building and the image of its shadow onto another plane ground plane. figure courtesy of luc van gool. know coordinates for four points in order to remove projective distortion alternative approaches which are described in section require less and different types of information third superior preferred methods for computing projective transformations are described in chapter projective transformations are important mappings representing many more situations than the perspective imaging of a world plane. a number of other examples are illustrated in figure each of these situations is covered in more detail later in the book. transformations of lines and conics transformation of lines. lie on a line l then the transformed points lie on the line under the point transformation i lth this gives the transformation rule for lines hx a line transforms as it was shown in the proof of theorem that if points xi i hxi under a projective transformation h tl. in this way incidence of points on lines is preserved since h tl. one may alternatively write lth note the fundamentally different way in which lines and points transform. points transform according to h whereas lines rows transform according to h this may be explained in terms of covariant or contravariant behaviour. one says that points transform contravariantly and lines transform covariantly. this distinction will be taken up again when we discuss tensors in chapter and is fully explained in appendix transformation of conics. under a point transformation hx becomes xtcx tch a hierarchy of transformations a b c fig. distortions arising under central projection. images of a tiled floor. similarity the circular pattern is imaged as a circle. a square tile is imaged as a square. lines which are parallel or perpendicular have the same relative orientation in the image. affine the circle is imaged as an ellipse. orthogonal world lines are not imaged as orthogonal lines. however the sides of the square tiles which are parallel in the world are parallel in the image. projective parallel world lines are imaged as converging lines. tiles closer to the camera have a larger image than those further away. which is a quadratic form rule for a conic with h tch this gives the transformation transformation hx a conic c transforms to h tch result under a point the presence of h in this equation may be expressed by saying that a conic transforms covariantly. the transformation rule for a dual conic is derived in a similar manner. this gives result under a point transformation c hx a dual conic c transforms to hc ht. a hierarchy of transformations in this section we describe the important specializations of a projective transformation and their geometric properties. it was shown in section that projective transformations form a group. this group is called the projective linear group and it will be seen that these specializations are subgroups of this group. the group of invertible n n matrices with real elements is the general linear group on n dimensions or gln. to obtain the projective linear group the matrices related by a scalar multiplier are identified giving p ln is a quotient group of gln. in the case of projective transformations of the plane n the important subgroups of p include the affine group which is the subgroup of p consisting of matrices for which the last row is and the euclidean group which is a subgroup of the affine group for which in addition the upper left hand matrix is orthogonal. one may also identify the oriented euclidean group in which the upper left hand matrix has determinant we will introduce these transformations starting from the most specialized the isometries and progressively generalizing until projective transformations are reached. projective geometry and transformations of this defines a hierarchy of transformations. the distortion effects of various transformations in this hierarchy are shown in figure some transformations of interest are not groups for example perspectivities the composition of two perspectivities is a projectivity not a perspectivity. this point is covered in section invariants. an alternative to describing the transformation algebraically i.e. as a matrix acting on coordinates of a point or curve is to describe the transformation in terms of those elements or quantities that are preserved or invariant. a invariant of a geometric configuration is a function of the configuration whose value is unchanged by a particular transformation. for example the separation of two points is unchanged by a euclidean transformation and rotation but not by a similarity translation rotation and isotropic scaling. distance is thus a euclidean but not similarity invariant. the angle between two lines is both a euclidean and a similarity invariant. class i isometries isometries are transformations of the plane that preserve euclidean distance iso same metric measure. an isometry is represented as x y cos sin tx sin cos x ty y t r where if then the isometry is orientation-preserving and is a euclidean transformation composition of a translation and rotation. if then the isometry reverses orientation. an example is the composition of a reflection represented by the matrix diag with a euclidean transformation. euclidean transformations model the motion of a rigid object. they are by far the most important isometries in practice and we will concentrate on these. however the orientation reversing isometries often arise as ambiguities in structure recovery. a planar euclidean transformation can be written more concisely in block form as hex where r is a rotation matrix orthogonal matrix such that rtr rrt i t a translation and a null special cases are a pure rotation t and a pure translation r i. a euclidean transformation is also known as a displacement. x a planar euclidean transformation has three degrees of freedom one for the rotation and two for the translation. thus three parameters must be specified in order to define the transformation. the transformation can be computed from two point correspondences. invariants. the invariants are very familiar for instance length distance between two points angle angle between two lines and area. a hierarchy of transformations groups and orientation. an isometry is orientation-preserving if the upper left hand matrix has determinant orientation-preserving isometries form a group orientation-reversing ones do not. this distinction applies also in the case of similarity and affine transformations which now follow. class ii similarity transformations a similarity transformation more simply a similarity is an isometry composed with an isotropic scaling. in the case of a euclidean transformation composed with a scaling no reflection the similarity has matrix representation x y x y s cos s sin tx s cos s sin ty hsx sr t x this can be written more concisely in block form as where the scalar s represents the isotropic scaling. a similarity transformation is also known as an equi-form transformation because it preserves shape a planar similarity transformation has four degrees of freedom the scaling accounting for one more degree of freedom than a euclidean transformation. a similarity can be computed from two point correspondences. invariants. the invariants can be constructed from euclidean invariants with suitable provision being made for the additional scaling degree of freedom. angles between lines are not affected by rotation translation or isotropic scaling and so are similarity invariants. in particular parallel lines are mapped to parallel lines. the length between two points is not a similarity invariant but the ratio of two lengths is an invariant because the scaling of the lengths cancels out. similarly a ratio of areas is an invariant because the scaling cancels out. metric structure. a term that will be used frequently in the discussion on reconstruction is metric. the description metric structure implies that the structure is defined up to a similarity. class iii affine transformations an affine transformation more simply an affinity is a non-singular linear transformation followed by a translation. it has the matrix representation x y x y tx ty projective geometry and transformations of rotation a deformation b fig. distortions arising from a planar affine transformation. rotation by r a deformation r d r note the scaling directions in the deformation are orthogonal. t a x or in block form hax with a a non-singular matrix. a planar affine transformation has six degrees of freedom corresponding to the six matrix elements. the transformation can be computed from three point correspondences. a helpful way to understand the geometric effects of the linear component a of an affine transformation is as the composition of two fundamental transformations namely rotations and non-isotropic scalings. the affine matrix a can always be decomposed as a r r d r where r and r are rotations by and respectively and d is a diagonal matrix d this decomposition follows directly from the svd writing a udvt r d r since u and v are orthogonal matrices. the affine matrix a is hence seen to be the concatenation of a rotation a scaling by and respectively in the x and y directions a rotation back and finally another rotation the only new geometry compared to a similarity is the non-isotropic scaling. this accounts for the two extra degrees of freedom possessed by an affinity over a similarity. they are the angle specifying the scaling direction and the ratio of the scaling parameters the essence of an affinity is this scaling in orthogonal directions oriented at a particular angle. schematic examples are given in figure a hierarchy of transformations invariants. because an affine transformation includes non-isotropic scaling the similarity invariants of length ratios and angles between lines are not preserved under an affinity. three important invariants are parallel lines. consider two parallel lines. these intersect at a point at infinity. under an affine transformation this point is mapped to another point at infinity. consequently the parallel lines are mapped to lines which still intersect at infinity and so are parallel after the transformation. ratio of lengths of parallel line segments. the length scaling of a line segment depends only on the angle between the line direction and scaling directions. suppose the line is at angle to the x-axis of the orthogonal scaling this scaling is direction then the scaling magnitude is common to all lines with the same direction and so cancels out in a ratio of parallel segment lengths. ratio of areas. this invariance can be deduced directly from the decomposition rotations and translations do not affect area so only the scalings by and matter here. the effect is that area is scaled by which is equal to det a. thus the area of any shape is scaled by det a and so the scaling cancels out for a ratio of areas. it will be seen that this does not hold for a projective transformation. an affinity is orientation-preserving or according to whether det a is positive or negative respectively. since det a the property depends only on the sign of the scalings. class iv projective transformations a projective transformation was defined in it is a general non-singular linear transformation of homogeneous coordinates. this generalizes an affine transformation which is the composition of a general non-singular linear transformation of inhomogeneous coordinates and a translation. we have earlier seen the action of a projective transformation section here we examine its block form hpx t a vt v x where the vector v the matrix has nine elements with only their ratio significant so the transformation is specified by eight parameters. note it is not always possible to scale the matrix such that v is unity since v might be zero. a projective transformation between two planes can be computed from four point correspondences with no three collinear on either plane. see figure unlike the case of affinities it is not possible to distinguish between orientation preserving and orientation reversing projectivities in we will return to this point in section projective geometry and transformations of invariants. the most fundamental projective invariant is the cross ratio of four collinear points a ratio of lengths on a line is invariant under affinities but not under projectivities. however a ratio of ratios or cross ratio of lengths on a line is a projective invariant. we return to properties of this invariant in section summary and comparison affinities dof occupy the middle ground between similarities dof and projectivities dof. they generalize similarities in that angles are not preserved so that shapes are skewed under the transformation. on the other hand their action is homogeneous over the plane for a given affinity the det a scaling in area of an object a square is the same anywhere on the plane and the orientation of a transformed line depends only on its initial orientation not on its position on the plane. in contrast for a given projective transformation area scaling varies with position under perspective a more distant square on the plane has a smaller image than one that is nearer as in figure and the orientation of a transformed line depends on both the orientation and position of the source line it will be seen later in section that a line s vanishing point depends only on line orientation not position. the key difference between a projective and affine transformation is that the vector v is not null for a projectivity. this is responsible for the non-linear effects of the projectivity. compare the mapping of an ideal point under an affinity and projectivity first the affine transformation a a t a vt v t a second the projective transformation in the first case the ideal point remains ideal at infinity. in the second it is mapped to a finite point. it is this ability which allows a projective transformation to model vanishing points. decomposition of a projective transformation a projective transformation can be decomposed into a chain of transformations where each matrix in the chain represents a transformation higher in the hierarchy than the previous one. h hs ha hp sr t k i vt v t a vt v with a a non-singular matrix given by a srk tvt and k an upper-triangular matrix normalized as det k this decomposition is valid provided v and is unique if s is chosen positive. a hierarchy of transformations each of the matrices hs ha hp is the essence of a transformation of that type indicated by the subscripts s a p. consider the process of rectifying the perspective image of a plane as in example hp dof moves the line at infinity ha dof affects the affine properties but does not move the line at infinity and finally hs is a general similarity transformation dof which does not affect the affine or projective properties. the transformation hp is an elation described in section example the projective transformation h may be decomposed as cos sin sin cos h this decomposition can be employed when the objective is to only partially determine the transformation. for example if one wants to measure length ratios from the perspective image of a plane then it is only necessary to determine the transformation up to a similarity. we return to this approach in section s since h a h p h s are still projective affine and similarity transformations respectively a general projective transformation may also be decomposed in the form taking the inverse of h in gives h h a and h p h h hp ha hs i vt k sr t note that the actual values of k r t and v will be different from those of the number of invariants the question naturally arises as to how many invariants there are for a given geometric configuration under a particular transformation. first the term number needs to be made more precise for if a quantity is invariant such as length under euclidean transformations then any function of that quantity is invariant. consequently we seek a counting argument for the number of functionally independent invariants. by considering the number of transformation parameters that must be eliminated in order to form an invariant it can be seen that result the number of functionally independent invariants is equal to or greater than the number of degrees of freedom of the configuration less the number of degrees of freedom of the transformation. projective geometry and transformations of group projective dof affine dof similarity dof euclidean dof matrix tx ty tx ty tx ty distortion invariant properties concurrency collinearity order of contact intersection pt contact tangency pt contact inflections pt contact with line tangent discontinuities and cusps. cross ratio of ratio of lengths. parallelism ratio of areas ratio of lengths on collinear or parallel lines midpoints linear combinations of vectors centroids. the line at infinity l ratio of lengths angle. the circular points i j section length area table geometric properties invariant to commonly occurring planar transformations. the matrix a is an invertible matrix r is a rotation matrix and ty a translation. the distortion column shows typical effects of the transformations on a square. transformations higher in the table can produce all the actions of the ones below. these range from euclidean where only translations and rotations occur to projective where the square can be transformed to any arbitrary quadrilateral no three points are collinear. for example a configuration of four points in general position has degrees of freedom for each point and so similarity affinity and zero projective invariants since these transformations have respectively and degrees of freedom. table summarizes the transformation groups and their invariant properties. transformations lower in the table are specializations of those above. a transformation lower in the table inherits the invariants of those above. the projective geometry of the development of the projective geometry of a line proceeds in much the same way as that of the plane. a point x on the line is represented by homogeneous coordinates and a point for which is an ideal point of the line. we will use the notation x to represent the a projective transformation of a line is represented by a homogeneous matrix x and has degrees of freedom corresponding to the four elements of the matrix less one for overall scaling. a projective transformation of a line may be determined from three corresponding points. the projective geometry of fig. projective transformations between lines. there are four sets of four collinear points in this figure. each set is related to the others by a line-to-line projectivity. since the cross ratio is an invariant under a projectivity the cross ratio has the same value for all the sets shown. the cross ratio. the cross ratio is the basic projective invariant of given points xi the cross ratio is defined as cross where xi xj det a few comments on the cross ratio the value of the cross ratio is not dependent on which particular homogeneous representative of a point xi is used since the scale cancels between numerator and denominator. such that then xi xj represents the signed distance from xi to xj. if each point xi is a finite point and the homogeneous representative is chosen the definition of the cross ratio is also valid if one of the points xi is an ideal point. the line if the value of the cross ratio is invariant under any projective transformation of x then cross cross the proof is left as an exercise. equivalently stated the cross ratio is invariant to the projective coordinate frame chosen for the line. figure illustrates a number of projective transformations between lines with equivalent cross ratios. under a projective transformation of the plane a projective transformation is induced on any line in the plane. concurrent lines. a configuration of concurrent lines is dual to collinear points on a line. this means that concurrent lines on a plane also have the geometry in particular four concurrent lines have a cross ratio as illustrated in figure l projective geometry and transformations of x x l l x x a l l l x x x c x x x x b fig. concurrent lines. four concurrent lines li intersect the line l in the four points xi. the cross ratio of these lines is an invariant to projective transformations of the plane. its value is given by the cross ratio of the points cross coplanar points xi are imaged onto a line l in the plane by a projection with centre c. the cross ratio of the image points xi is invariant to the position of the image line l. note how figure may be thought of as representing projection of points in into a image. in particular if c represents a camera centre and the line l represents an image line analogue of the image plane then the points xi are the projections of points xi into the image. the cross ratio of the points xi characterizes the projective configuration of the four image points. note that the actual position of the image line is irrelevant as far as the projective configuration of the four image points is concerned different choices of image line give rise to projectively equivalent configurations of image points. the projective geometry of concurrent lines is important to the understanding of the projective geometry of epipolar lines in chapter topology of the projective plane we make brief mention of the topology of understanding of this section is not required for following the rest of the book. we have seen that the projective plane may be thought of as the set of all homogeneous a vector of this type x may be normalized by multiplication by a non-zero factor so that such a point lies on the unit sphere in however any vector x and x represent the same point in since they differ by a multiplicative factor thus there is a two-to-one correspondence between the unit sphere in and the projective plane the projective plane may be pictured as the unit sphere with opposite points identified. in this representation a line in is modelled as a great circle on the unit sphere ever with opposite points identified. one may verify that any two distinct points on the sphere lie on exactly one great circle and any two great circles intersect in one point antipodal points are identified. in the language of topology the sphere is a covering space of this implies that is not simply-connected which means that there are loops in which cannot be contracted to a point inside to be technical the fundamental group of is the cyclic group of order recovery of affine and metric properties from images a b c d fig. topology of surfaces. common surfaces may be constructed from a paper square a disk with edges glued together. in each case the matching arrow edges of the square are to be glued together in such a way that the directions of the arrows match. one obtains a sphere a torus a klein bottle and a projective plane. only the sphere and torus are actually realizable with a real sheet of paper. the sphere and torus are orientable but the projective plane and klein bottle are not. in the model for the projective plane as a sphere with opposite points identified one may dispense with the lower hemisphere of since points in this hemisphere are the same as the opposite points in the upper hemisphere. in this case may be constructed from the upper hemisphere by identifying opposite points on the equator. since the upper hemisphere of is topologically the same as a disk is simply a disk with opposite points on its boundary identified or glued together. this is not physically possible. constructing topological spaces by gluing the boundary of a disk is a common method in topology and in fact any may be constructed in this way. this is illustrated in figure a notable feature of the projective plane is that it is non-orientable. this means that it is impossible to define a local orientation for instance by a pair of oriented coordinate axes that is consistent over the whole surface. this is illustrated in figure in which it is shown that the projective plane contains an orientationreversing path. the topology of in a similar manner the projective line may be identified as a is a circle with opposite points identified. if we omit the lower half of the circle as being duplicated by the top half then the top half of a circle is topologically equivalent to a line segment. thus is topologically equivalent to a line segment with the two endpoints identified namely a circle recovery of affine and metric properties from images we return to the example of projective rectification of example where the aim was to remove the projective distortion in the perspective image of a plane to the extent that similarity properties ratios of lengths could be measured on the original plane. in that example the projective distortion was completely removed by specifying the position of four reference points on the plane total of degrees of freedom and explicitly computing the transformation mapping the reference points to their images. in fact this overspecifies the geometry a projective transformation has only degrees of freedom more than a similarity so it is only necessary to specify projective geometry and transformations of a b fig. orientation of surfaces. a coordinate frame by an l in the diagram may be transported along a path in the surface eventually coming back to the point where it started. represents a projective plane. in the path shown the coordinate frame by a pair of axes is reversed when it returns to the same point since the identification at the boundary of the square swaps the direction of one of the axes. such a path is called an orientation-reversing path and a surface that contains such a path is called non-orientable. shows the well known example of a m obius strip obtained by joining two opposite edges of a rectangle escher s moebius strip ii ants cordon art b.v. baarn-holland. all rights reserved. as can be verified a path once around the strip is orientation-reversing. degrees of freedom in order to determine metric properties. in projective geometry these degrees of freedom are given physical substance by being associated with geometric objects the line at infinity l dof and the two circular points dof on l this association is often a more intuitive way of reasoning about the problem than the equivalent description in terms of specifying matrices in the decomposition chain in the following it is shown that the projective distortion may be removed once the image of l is specified and the affine distortion removed once the image of the circular points is specified. then the only remaining distortion is a similarity. the line at infinity under a projective transformation ideal points may be mapped to finite points and consequently l is mapped to a finite line. however if the transformation is an affinity then l is not mapped to a finite line but remains at infinity. this is evident directly from the line transformation h t a l a t tta t l the converse is also true i.e. an affine transformation is the most general linear transformation that fixes l and may be seen as follows. we require that a point at infinity say x be mapped to a point at infinity. this requires that similarly so the transformation is an affinity. to summarize result the line at infinity l is a fixed line under the projective transformation h if and only if h is an affinity. however l is not fixed pointwise under an affine transformation showed that under an affinity a point on l ideal point is mapped to a point on l but recovery of affine and metric properties from images h p h p l h l p h a fig. affine rectification. a projective transformation maps l from on a euclidean plane to a finite line l on the plane if a projective transformation is constructed such that l is mapped back to then from result the transformation between the first and third planes must be an affine transformation since the canonical position of l is preserved. this means that affine properties of the first plane can be measured from the third i.e. the third plane is within an affinity of the first. it is not the same point unless it will now be shown that identifying l allows the recovery of affine properties ratio of areas. recovery of affine properties from images once the imaged line at infinity is identified in an image of a plane it is then possible to make affine measurements on the original plane. for example lines may be identified as parallel on the original plane if the imaged lines intersect on the imaged l this follows because parallel lines on the euclidean plane intersect on l and after a projective transformation the lines still intersect on the imaged l since intersections are preserved by projectivities. similarly once l is identified a length ratio on a line may be computed from the cross ratio of the three points specifying the lengths together with the intersection of the line with l provides the fourth point for the cross ratio and so forth. however a less tortuous path which is better suited to computational algorithms is simply to transform the identified l to its canonical position of l the matrix which achieves this transformation can be applied to every point in the image in order to affinely rectify the image i.e. after the transformation affine measurements can be made directly from the rectified image. the key idea here is illustrated in figure if the imaged line at infinity is the line l then provided a suitable projective point transformation which will map l back to l is h ha projective geometry and transformations of a b c fig. affine rectification via the vanishing line. the vanishing line of the plane imaged in is computed from the intersection of two sets of imaged parallel lines. the image is then projectively warped to produce the affinely rectified image in the affinely rectified image parallel lines are now parallel. however angles do not have their veridical world value since they are affinely distorted. see also figure where ha is any affine transformation last row of h is lt. one can verify that under the line transformation h l example affine rectification in a perspective image of a plane the line at infinity on the world plane is imaged as the vanishing line of the plane. this is discussed in more detail in chapter as illustrated in figure the vanishing line l may be computed by intersecting imaged parallel lines. the image is then rectified by applying a projective warping such that l is mapped to its canonical position l this example shows that affine properties may be recovered by simply specifying a line dof. it is equivalent to specifying only the projective component of the transformation decomposition chain conversely if affine properties are known these may be used to determine points and the line at infinity. this is illustrated in the following example. example computing a vanishing point from a length ratio. given two intervals on a line with a known length ratio the point at infinity on the line may be determined. a typical case is where three points are identified on a line in an image. suppose a b and c are the corresponding collinear points on the world line and the length ratio da b db c b is known dx y is the euclidean and recovery of affine and metric properties from images fig. two examples of using equal length ratios on a line to determine the point at infinity. the line intervals used are shown as the thin and thick white lines delineated by points. this construction determines the vanishing line of the plane. compare with figure distance between the points x and y. it is possible to find the vanishing point using the cross ratio. equivalently one may proceed as follows a b measure the distance ratio in the image points a b and c may be represented as coordinates a and ab in a coordinate frame on the line b for computational purposes these points are represented by homogeneous and b similarly which may also be expressed as homogeneous vectors. mapping a b vanishing point on the line the image of the point at infinity coordinates under is the relative to these coordinate frames compute the projective transformation and c have coordinates a and a and b an example of vanishing points computed in this manner is shown in figure example geometric construction of vanishing points from a length ratio. the vanishing points shown in figure may also be computed by a purely geometric construction consisting of the following steps three collinear points in an image corresponding to given draw any line l through and collinear world points with interval ratio a b. points a a b. join the line through o parallel to l meets the line and intersect in o. and and mark off b and c such that the line segments have length ratio coincident with the line this construction is illustrated in figure in the vanishing point projective geometry and transformations of o c b v a a a b b c l fig. a geometric construction to determine the image of the point at infinity on a line given a known length ratio. the details are given in the text. the circular points and their dual under any similarity transformation there are two points on l which are fixed. these are the circular points called the absolute points i j with canonical coordinates i i j i the circular points are a pair of complex conjugate ideal points. to see that they are fixed under an orientation-preserving similarity hsi s cos s sin tx i s cos s sin ty i i se i with an analogous proof for j. a reflection swaps i and j. the converse is also true i.e. if the circular points are fixed then the linear transformation is a similarity. the proof is left as an exercise. to summarize result the circular points i j arefixed points under the projective transformation h if and only if h is a similarity. the name circular points arises because every circle intersects l at the circular points. to see this start from equation for a conic. in the case that the conic is a circle a c and b then f recovery of affine and metric properties from images where a has been set to unity. this conic intersects l in the points for which namely with solution i t j i i.e. any circle intersects l in the circular points. in euclidean geometry it is well known that a circle is specified by three points. the circular points enable an alternative computation. a circle can be computed using the general formula for a conic defined by five points where the five points are the three points augmented with the two circular points. in section it will be shown that identifying the circular points equivalently their dual see below allows the recovery of similarity properties ratios of lengths. algebraically the circular points are the orthogonal directions of euclidean geometry and packaged into a single complex conjugate entity e.g. i consequently it is not so surprising that once the circular points are identified orthogonality and other metric properties are then determined. the conic dual to the circular points. the conic c ijt jit is dual to the circular points. the conic c is a degenerate line conic section which consists of the two circular points. in a euclidean coordinate system it is given by c i i i i the conic c is fixed under similarity transformations in an analogous fashion to the fixed properties of circular points. a conic is fixed if the same matrix results to scale under the transformation rule. since c is a dual conic it transforms according to result hc ht and one can verify that under the point transformation hsx c hsc s c ht the converse is also true and we have result the dual conic c only if h is a similarity. some properties of c in any projective frame is fixed under the projective transformation h if and c has degrees of freedom a homogeneous symmetric matrix has degrees of freedom but the constraint det c reduces the degrees of freedom by projective geometry and transformations of l is the null vector of c lie on l so that itl jtl then this is clear from the definition the circular points c l jitl ijtl jitl angles on the projective plane in euclidean geometry the angle between two lines is computed from the dot product of their normals. for the lines l and m with normals parallel to respectively the angle is cos the problem with this expression is that the first two components of l and m do not have well defined transformation properties under projective transformations are not tensors and so cannot be applied after an affine or projective transformation of the plane. however an analogous expression to which is invariant to projective transformations is ltc lmtc m m cos where c is the conic dual to the circular points. it is clear that in a euclidean coit may be verified that is invariant ordinate system reduces to to projective transformations by using the transformation rules for lines hc ht under the point transformation h tl and dual conics hx. for example the numerator transforms as hth tm ltc m lth ltc m. it may also be verified that the scale of the homogeneous objects cancels between the numerator and denominator. thus is indeed invariant to the projective frame. to summarize we have shown result once the conic c angles may be measured by is identified on the projective plane then euclidean m if l and m satisfy ltc note as a corollary result lines l and m are orthogonal if ltc geometrically section with respect to the conic c length ratios may also be measured once c is identified. consider the triangle shown in figure with vertices a b c. from the standard trigonometric sine rule the ratio of lengths db c da c sin sin where dx y denotes the euclidean distance between the points x and y. using both cos and cos may be computed from the lines for any then the lines are conjugate m and recovery of affine and metric properties from images c a c m n b a l b fig. length ratios. once c measured from the projectively distorted figure. see text for details. is identified the euclidean length ratio db c da c may be projective frame in which c the ratio da b dc a may be determined from the projectively mapped points. is specified. consequently both sin sin and thence recovery of metric properties from images a completely analogous approach to that of section and figure where affine properties are recovered by specifying l enables metric properties to be recovered from an image of a plane by transforming the circular points to their canonical position. suppose the circular points are identified in an image and the image is then rectified by a projective transformation h that maps the imaged circular points to their canonical position i on l from result the transformation between the world plane and the rectified image is then a similarity since it is projective and the circular points are fixed. metric rectification using c neatly packages all the information required for a metric rectification. it enables both the projective and affine components of a projective transformation to be determined leaving only similarity distortions. this is evident from its transformation under a projectivity. if the point transformation is transforms according to result hc ht. using the decomposition chain for h ha hs c ha c hx where the x-coordinate frame is euclidean and hs c the dual conic c projective c ha ht a ht p c ht s t ha hs a ht ht kktv p kkt vtkkt vtkktv but c it is clear that the projective and affine components are determined directly from the image of c is invariant to similarity transformation by result the similarity component is undetermined. consequently result once the conic c distortion may be rectified up to a similarity. is identified on the projective plane then projective actually a suitable rectifying homography may be obtained directly from the in an image using the svd writing the svd of c tified c l l l kkt m m m as projective geometry and transformations of ut c u then by inspection from the rectifying projectivity is h u up to a similarity. the following two examples show typical situations where c may be identified in an image and thence a metric rectification obtained. example metric rectification i suppose an image has been affinely rectified in example above then we require two constraints to specify the degrees of freedom of the circular points in order to determine a metric rectification. these two constraints may be obtained from two imaged right angles on the world plane. line pair l m on the world plane. from result with v in the affinely rectified image correspond to an orthogonal and using suppose the lines which is a linear constraint on the matrix s kkt. the matrix s kkt is symmetric with three independent elements and thus degrees of freedom the overall scaling is unimportant. the orthogonality condition reduces to the equation which may be written as m l l l l s where s is s written as a two such orthogonal line pairs provide two constraints which may be stacked to give a matrix with s determined as the null vector. thus s and hence k is obtained up to scale cholesky decomposition section figure shows an example of two orthogonal line pairs being used to metrically rectify the affinely rectified image computed in figure alternatively the two constraints required for metric rectification may be obtained from an imaged circle or two known length ratios. in the case of a circle the image conic is an ellipse in the affinely rectified image and the intersection of this ellipse with the l directly determines the imaged circular points. can alternatively be identified directly in a perspective image without the conic c first identifying l as is illustrated in the following example. example metric rectification ii we start here from the original perspective image of the plane the affinely rectified image of example suppose lines l and m are images of orthogonal lines on the world plane then from result ltc m and in a similar manner to constraining recovery of affine and metric properties from images a b fig. metric rectification via orthogonal lines i. the affine transformation required to metrically rectify an affine image may be computed from imaged orthogonal lines. two line pairs identified on the affinely rectified image correspond to orthogonal lines on the world plane. the metrically rectified image. note that in the metrically rectified image all lines orthogonal in the world are orthogonal world squares have unit aspect ratio and world circles are circular. a b fig. metric rectification via orthogonal lines ii. the conic c is determined on the perspectively imaged plane front wall of the building using the five orthogonal line pairs shown. the conic c determines the circular points and equivalently the projective transformation necessary to metrically rectify the image the image shown in is the same perspective image as that of figure where the perspective distortion was removed by specifying the world position of four image points. a conic to contain a point this provides a linear constraint on the elements of c namely c where c b c d e f is the conic matrix of c written as a five such constraints can be stacked to form a matrix and c and hence c is obtained as the null vector. this shows that c can be determined linearly from the images of five line pairs which are orthogonal on the world plane. an example of metric rectification using such line pair constraints is shown in figure stratification. note in example the affine and projective distortions are determined in one step by specifying c in the previous example first the projective and subsequently the affine distortions were removed. this two-step approach is termed stratified. analogous approaches apply in and are employed in chapter projective geometry and transformations of c y l x fig. the pole polar relationship. the line l cx is the polar of the point x with respect to the conic c and the point x c is the pole of l with respect to c. the polar of x intersects the conic at the points of tangency of lines from x. if y is on l then ytl ytcx points x and y which satisfy ytcx are conjugate. on reconstruction and chapter on auto-calibration when obtaining a metric from a projective reconstruction. more properties of conics we now introduce an important geometric relation between a point line and conic which is termed polarity. applications of this relation the representation of orthogonality are given in chapter the pole polar relationship a point x and conic c define a line l cx. the line l is called the polar of x with respect to c and the point x is the pole of l with respect to c. the polar line l cx of the point x with respect to a conic c intersects the conic in two points. the two lines tangent to c at these points intersect at x. this relationship is illustrated in figure proof. consider a point y on c. the tangent line at y is cy and this line contains x if xtcy using the symmetry of c the condition xtcy is that the point y lies on the line cx. thus the polar line cx intersects the conic in the point y at which the tangent line contains x. as the point x approaches the conic the tangent lines become closer to collinear and their contact points on the conic also become closer. in the limit that x lies on c the polar line has two-point contact at x and we have if the point x is on c then the polar is the tangent line to the conic at x. see result more properties of conics example a circle of radius r centred on the x-axis at x a has the equation and is represented by the conic matrix c a a the polar line of the origin is given by l a this is a vertical line at x if r a the origin lies on the circle. in this case the polar line is the y-axis and is tangent to the circle. it is evident that the conic induces a map between points and lines of this map is a projective construction since it involves only intersections and tangency both properties that are preserved under projective transformations. a projective map between points and lines is termed a correlation unfortunate name given its more common usage. definition a correlation is an invertible mapping from points of to lines of it is represented by a non-singular matrix a as l ax. a correlation provides a systematic way to dualize relations involving points and lines. it need not be represented by a symmetric matrix but we will only consider symmetric correlations here because of the association with conics. conjugate points. if the point y is on the line l cx then ytl ytcx any two points x y satisfying ytcx are conjugate with respect to the conic c. the conjugacy relation is symmetric if x is on the polar of y then y is on the polar of x. this follows simply because of the symmetry of the conic matrix the point x is on the polar of y if xtcy and the point y is on the polar of x if ytcx since xtcy ytcx if one form is zero then so is the other. there is a dual conjugacy relationship for lines two lines l and m are conjugate if ltc m classification of conics this section describes the projective and affine classification of conics. projective normal form for a conic. since c is a symmetric matrix it has real eigenvalues and may be decomposed as a product c utdu section where u is an orthogonal matrix and d is diagonal. applying the projective transformation represented by u conic c is transformed to another conic u tcu u tutduu d. this shows that any conic is equivalent under projective transformation to one with a diagonal matrix. let d where or and each di thus d may be written in the form d projective geometry and transformations of a l l b l c fig. affine classification of point conics. a conic is an ellipse parabola or hyperbola according to whether it has no real intersection is tangent to contact or has real intersections with l under an affine transformation l is a fixed line and intersections are preserved. thus this classification is unaltered by an affinity. i di. note that now transforming once where more by the transformation the conic d is transformed to a conic with matrix with each or further transformation by permutation matrices may be carried out to ensure that values occur before values which in turn precede values finally by multiplying by if necessary one may ensure that there are at least as many entries as the various types of conics may now be enumerated and are shown in table diagonal equation conic type improper conic no real points. circle single real point two lines x y single line x counted twice. table projective classification of point conics. any plane conic is projectively equivalent to one of the types shown in this table. those conics for which for some i are known as degenerate conics and are represented by a matrix of rank less than the conic type column only describes the real points of the conics for example as a complex conic consists of the line pair x iy. affine classification of conics. the classification of proper conics in euclidean geometry into hyperbola ellipse and parabola is well known. as shown above in projective geometry these three types of conic are projectively equivalent to a circle. however in affine geometry the euclidean classification is still valid because it depends only on the relation of l to the conic. the relation for the three types of conic is illustrated in figure fixed points and lines e h e e e x e e x fig. fixed points and lines of a plane projective transformation. there are three fixed points and three fixed lines through these points. the fixed lines and points may be complex. algebraically the fixed points are the eigenvectors ei of the point transformation hx and the fixed lines eigenvectors of the line transformation h tl. note the fixed line is not fixed pointwise under the transformation points on the line are mapped to other points on the line only the fixed points are mapped to themselves. fixed points and lines we have seen by the examples of l and the circular points that points and lines may be fixed under a projective transformation. in this section the idea is investigated more thoroughly. here the source and destination planes are identified same so that the transformation maps points x to points in the same coordinate system. the key idea is that an eigenvector corresponds to a fixed point of the transformation since for an eigenvector e with eigenvalue he e and e and e represent the same point. often the eigenvector and eigenvalue have physical or geometric significance in computer vision applications. a matrix has three eigenvalues and consequently a plane projective transformation has up to three fixed points if the eigenvalues are distinct. since the characteristic equation is a cubic in this case one or three of the eigenvalues and corresponding eigenvectors is real. a similar development can be given for fixed lines which since lines transform as h tl correspond to the eigenvectors of ht. the relationship between the fixed points and fixed lines is shown in figure note the lines are fixed as a set not fixed pointwise i.e. a point on the line is mapped to another point on the line but in general the source and destination points will differ. there is nothing mysterious here the projective transformation of the plane induces a projective transformation on the line. a projective transformation is represented by a homogeneous matrix this projectivity has two fixed points corresponding to the two eigenvectors of the matrix. these fixed points are those of the projective transformation. a further specialization concerns repeated eigenvalues. suppose two of the eigenvalues say are identical and that there are two distinct eigenvectors corresponding to then the line containing the eigenvectors will be fixed pointwise i.e. it is a line of fixed points. for suppose x then hx projective geometry and transformations of i.e. a point on the line through two degenerate eigenvectors is mapped to itself differing by scale. another possibility is that but that there is only one corresponding eigenvector. in this case the eigenvector has algebraic dimension equal to two but geometric dimension equal to one. then there is one fewer fixed point instead of various cases of repeated eigenvalues are discussed further in appendix we now examine the fixed points and lines of the hierarchy of projective transformation subgroups of section affine transformations and the more specialized forms have two eigenvectors which are ideal points and which correspond to the eigenvectors of the upper left matrix. the third eigenvector is finite in general. a euclidean matrix. the two ideal fixed points are the complex conjugate pair of circular points i j with corresponding eigenvalues e i where is the rotation angle. the third eigenvector which has unit eigenvalue is called the pole. the euclidean transformation is equal to a pure rotation by about this point with no translation. a special case is that of a pure translation where here the eigenvalues are triply degenerate. the line at infinity is fixed pointwise and there is a pencil of fixed lines through the point ty which corresponds to the translation direction. consequently lines parallel to t are fixed. this is an example of an elation section a similarity matrix. the two ideal fixed points are again the circular points. the eigenvalues are sei se i the action can be understood as a rotation and isotropic scaling by s about the finite fixed point. note that the eigenvalues of the circular points again encode the angle of rotation. an affine matrix. the two ideal fixed points can be real or complex conjugates but the fixed line l through these points is real in either case. closure the literature a gentle introduction to plane projective geometry written for computer vision researchers is given in the appendix of mundy and zisserman a more formal approach is that of semple and kneebone but is more readable. on the recovery of affine and metric scene properties for an imaged plane collins and beveridge use the vanishing line to recover affine properties from satellite images and liebowitz and zisserman use metric information on the plane such as right angles to recover the metric geometry. notes and exercises affine transformations. closure show that an affine transformation can map a circle to an ellipse but cannot map an ellipse to a hyperbola or parabola. prove that under an affine transformation the ratio of lengths on parallel line segments is an invariant but that the ratio of two lengths that are not parallel is not. projective transformations. show that there is a three-parameter family of projective transformations which fix a set a unit circle at the origin i.e. a unit circle at the origin is mapped to a unit circle at the origin use result to compute the transformation. what is the geometric interpretation of this family? isotropies. show that two lines have an invariant under a similarity transformation and that two lines and two points have an invariant under a projective transformation. in both cases the equality case of the counting argument is violated. show that for these two cases the respective transformation cannot be fully determined although it is partially determined. invariants. using the transformation rules for points lines and conics show two lines and two points not lying on the lines have the invariant i the previous question. a conic c and two points and in general position have the invari ant i show that the projectively invariant expression for measuring angles is equivalent to laguerre s projectively invariant expression involving a cross ratio with the circular points the cross ratio. prove the invariance of the cross ratio of four collinear points under projective transformations of the line hint start with the transformation of two points on the line written as i xi and j xj where equality is not up to scale then from the properties of determinants show that i j det xi xj and continue from here. i an alternative derivation method is given in j polarity. figure shows the geometric construction of the polar line for a point x outside an ellipse. give a geometric construction for the polar when the point is inside. hint start by choosing any line through x. the pole of this line is a point on the polar of x. conics. if the sign of the conic matrix c is chosen such that two eigenvalues are positive and one negative then internal and external points may be distinguished according to the sign of xtcx the point x is insideonoutside the conic projective geometry and transformations of c if xtcx is negativezeropositive respectively. this can seen by example from a circle c under projective transformations internality is invariant though its interpretation requires care in the case of an ellipse being transformed to a hyperbola figure dual conics. show that the matrix cl represents a rank dual conic which consists of the two points at which the line l intersects the conic c notation is defined in special projective transformations. suppose points on a scene plane are related by reflection in a line for example a plane object with bilateral symmetry. show that in a perspective image of the plane the points are related by a projectivity h satisfying i. furthermore show that under h there is a line of fixed points corresponding to the imaged reflection line and that h has an eigenvector not lying on this line which is the vanishing point of the reflection direction is a planar harmonic homology see section now suppose that the points are related by a finite rotational symmetry for example points on a hexagonal bolt head. show in this case that hn i where n is the order of rotational symmetry for a hexagonal symmetry that the eigenvalues of h determine the rotation angle and that the eigenvector corresponding to the real eigenvalue is the image of the centre of the rotational symmetry. projective geometry and transformations of this chapter describes the properties and entities of projective or many of these are straightforward generalizations of those of the projective plane described in chapter for example in euclidean is augmented with a set of ideal points which are on a plane at infinity this is the analogue of l in parallel lines and now parallel planes intersect on not surprisingly homogeneous coordinates again play an important role here with all dimensions increased by one. however additional properties appear by virtue of the extra dimension. for example two lines always intersect on the projective plane but they need not intersect in the reader should be familiar with the ideas and notation of chapter before reading this chapter. we will concentrate here on the differences and additional geometry introduced by adding the extra dimension and will not repeat the bulk of the material of the previous chapter. points and projective transformations a point x in is represented in homogeneous coordinates as a specifically the homogeneous vector x with represents the point y zt of with inhomogeneous coordinates x y z for example a homogeneous representation of y zt is x y z homogeneous points with represent points at infinity. a projective transformation acting on is a linear transformation on homogeneous represented by a non-singular matrix hx. the matrix h representing the transformation is homogeneous and has degrees of freedom. the degrees of freedom follow from the elements of the matrix less one for overall scaling. as in the case of planar projective transformations the map is a collineation are mapped to lines which preserves incidence relations such as the intersection point of a line with a plane and order of contact. projective geometry and transformations of representing and transforming planes lines and quadrics in points and planes are dual and their representation and development is analogous to the point line duality in lines are self-dual in planes a plane in may be written as clearly this equation is unaffected by multiplication by a non-zero scalar so only the three independent ratios of the plane coefficients are significant. it follows that a plane has degrees of freedom in the homogeneous representation of the plane is the homogenizing by the replacements x y z gives or more concisely tx which expresses that the point x is on the plane the first components of correspond to the plane normal of euclidean geometry notation as d where n y zt using inhomogeneous notation becomes the familiar plane equation written in and d in this form is the distance of the plane from the origin. join and incidence relations. planes and points and lines. for example in there are numerous geometric relations between a plane is defined uniquely by the join of three points or the join of a line and point in general position the points are not collinear or incident with the line in the latter case. two distinct planes intersect in a unique line. three distinct planes intersect in a unique point. these relations have algebraic representations which will now be developed in the case of points and planes. the representations of the relations involving lines are not as simple as those arising from vector algebra of l x y and are postponed until line representations are introduced in section three points define a plane. suppose three points xi are incident with the plane then each point satisfies and thus txi i stacking these equations into a matrix gives xt xt xt representing and transforming planes lines and quadrics since three points and in general position are linearly independent it follows that the matrix composed of the points as rows has rank the plane defined by the points is thus obtained uniquely to scale as the null-space. if the matrix has only a rank of and consequently the null-space is then the points are collinear and define a pencil of planes with the line of collinear points as axis. in where points are dual to lines a line l through two points x y can similarly be obtained as the null-space of the matrix with xt and yt as rows. however a more convenient direct formula l x y is also available from vector algebra. in the analogous expression is obtained from properties of determinants and minors. we start from the matrix m which is composed of a general point x and the three points xi which define the plane the determinant det m when x lies on since the point x is then expressible as a linear combination of the points xi i expanding the determinant about the column x we obtain det m where djkl is the determinant formed from the jkl rows of the matrix since det m for points on we can then read off the plane coefficients as t this is the solution vector null-space of above. example suppose the three points defining the plane are where y zt. then plane normal is computed as and similarly for the other components giving x t t t this is the familiar result from euclidean vector geometry where for example the three planes define a point. the development here is dual to the case of three points defining a plane. the intersection point x of three planes i can be computed straightforwardly as the null-space of the matrix composed of the planes as rows projective geometry and transformations of fig. a line may be specified by its points of intersection with two orthogonal planes. each intersection point has degrees of freedom which demonstrates that a line in has a total of degrees of freedom. a direct solution for x in terms of determinants of submatrices is obtained as an analogue of though computationally a numerical solution would be obtained by algorithm the two following results are direct analogues of their counterparts. projective transformation. under the point transformation forms as hx a plane trans h t parametrized points on a plane. the points x on the plane may be written as x mx where the columns of the matrix m generate the rank null-space of t i.e. tm and the x is a point on the projective plane parametrizes points on the plane m is not unique of course. suppose the plane is b c dt and a is non-zero then mt can be written as mt where p ba ca dat. this parametrized representation is simply the analogue in of a line l in defined as a linear combination of its null-space as x a b where lta ltb lines a line is defined by the join of two points or the intersection of two planes. lines have degrees of freedom in a convincing way to count these degrees of freedom is to think of a line as defined by its intersection with two orthogonal planes as in figure the point of intersection on each plane is specified by two parameters producing a total of degrees of freedom for the line. lines are very awkward to represent in since a natural representation for an object with degrees of freedom would be a homogeneous the problem is that a homogeneous vector cannot easily be used in mathematical expressions together with the representing points and planes. to overcome this problem representing and transforming planes lines and quadrics a number of line representations have been proposed and these differ in their mathematical complexity. we survey three of these representations. in each case the representation provides mechanisms for a line to be defined by the join of two points a dual version where the line is defined by the intersection of two planes and also a map between the two definitions. the representations also enable join and incidence relations to be computed for example the point at which a line intersects a plane. i. null-space and span representation. this representation builds on the intuitive geometric notion that a line is a pencil family of collinear points and is defined by any two of these points. similarly a line is the axis of a pencil of planes and is defined by the intersection of any two planes from the pencil. in both cases the actual points or planes are not important fact two points have degrees of freedom and are represented by two far too many parameters. this notion is captured mathematically by representing a line as the span of two vectors. suppose a b are two space points. then the line joining these points is represented by the span of the row space of the matrix w composed of at and bt as rows at bt w then the span of wt is the pencil of points a b on the line. the span of the right null-space of w is the pencil of planes with the line as axis. it is evident that two other points and on the line will generate a matrix with the same span as w so that the span and hence the representation is independent of the particular points used to define it. to prove the null-space property suppose that p and q are a basis for the null-space. then wp and consequently atp btp so that p is a plane containing the points a and b. similarly q is a distinct plane also containing the points a and b. thus a and b lie on both the independent planes p and q so the line defined by w is the plane intersection. any plane of the pencil with the line as axis is given by the span the dual representation of a line as the intersection of two planes p q follows in a similar manner. the line is represented as the span the row space of the matrix w composed of pt and qt as rows w pt qt with the properties the span of w t is the pencil of planes the span of the null-space of w with the line as axis. is the pencil of points on the line. projective geometry and transformations of the two representations are related by w wt w w t where is a null matrix. example the x-axis is represented as w w where the points a and b are here the origin and ideal point in the x-direction and the planes p and q are the xy- and xz-planes respectively. join and incidence relations are also computed from null-spaces. the plane defined by the join of the point x and line w is obtained from the null-space of m from the null-space of m w xt w t if the null-space of m is then x is on w otherwise m the point x defined by the intersection of the line w with the plane is obtained if the null-space of m is then the line w is on otherwise mx these properties can be derived almost by inspection. for example the first is equivalent to three points defining a plane the span representation is very useful in practical numerical implementations where null-spaces can be computed simply by using the svd algorithm section available with most matrix packages. the representation is also useful in estimation problems where it is often not a problem that the entity being estimated is over-parametrized the discussion of section ii. pl ucker matrices. here a line is represented by a skew-symmetric homogeneous matrix. in particular the line joining the two points a b is represented by the matrix l with elements lij aibj biaj or equivalently in vector notation as l abt bat first a few properties of l l has rank its null-space is spanned by the pencil of planes with the line as axis fact lw t with a null-matrix. representing and transforming planes lines and quadrics the representation has the required degrees of freedom for a line. this is accounted as follows the skew-symmetric matrix has independent non-zero elements but only their ratios are significant and furthermore because det l the elements satisfy a constraint below. the net number of degrees of freedom is then the relation l abt bat is the generalization to of the vector product formula l x y of for a line l defined by two points x y all represented by the matrix l is independent of the points a b used to define it since if a different point c on the line is used with c a b then the resulting matrix is l act cat aat bt bat abt bat l. under the point transformation hx the matrix transforms as hlht i.e. it is a tensor appendix example from the x-axis is represented as l where the points a and b are in the previous example the origin and ideal point in the x-direction respectively. a dual pl ucker representation l two planes p q is obtained for a line formed by the intersection of l pqt qpt and has similar properties to l. under the point transformation transforms as l l simple rewrite rule h tlh the matrix l hx the matrix can be obtained directly from l by a l l l l l l the correspondence rule is very simple the indices of the dual and original component always include all the numbers so if the original is ij then the dual is those numbers of which are not ij. for example join and incidence properties are very nicely represented in this notation the plane defined by the join of the point x and line l is and l x if and only if x is on l. l x projective geometry and transformations of the point defined by the intersection of the line l with the plane is and l if and only if l is on x l the properties of two more lines can be obtained from the null-space of the matrix m for example if the lines are coplanar then mt has a null-space corresponding to the plane of the lines. example the intersection of the x-axis with the plane x is given by x l as x which is the inhomogeneous point y zt iii. pl ucker line coordinates. elements of the skew-symmetric pl ucker matrix l the pl ucker line coordinates are the six non-zero l this is a homogeneous and thus is an element of it follows from evaluating det l that the coordinates satisfy the equation a l only corresponds to a line in if it satisfies the geometric interpretation of this constraint is that the lines of define a surface in which is known as the klein quadric a quadric because the terms of are suppose two lines l l are the joins of the points a b and respectively. the quadratic in the pl ucker line coordinates. condition for this is that deta it can be shown that the determinant lines intersect if and only if the four points are coplanar. a necessary and sufficient expands as deta l. since the pl ucker coordinates are independent of the particular points used to define them the bilinear product l is independent of the points used in the derivation and only depends on the lines l and l. then we have result two lines l and l are coplanar thus intersect if and only if l this product appears in a number of useful formulae the element is conventionally used instead of as it eliminates negatives in many of the subsequent formulae. representing and transforming planes lines and quadrics a l only represents a line in if this is simply repeating suppose two lines l l are the intersections of the planes p q and respec the klein quadric constraint above. tively. then l detp and again the lines intersect if and only if l if l is the intersection of two planes p and q and l is the join of two points a and b then l pl ucker coordinates are useful in algebraic derivations. they will be used in defining the map from a line in to its image in chapter quadrics and dual quadrics a quadric is a surface in defined by the equation where q is a symmetric matrix. often the matrix q and the quadric surface it defines are not distinguished and we will simply refer to the quadric q. xtqx many of the properties of quadrics follow directly from those of conics in section to highlight a few a quadric has degrees of freedom. these correspond to the ten independent elements of a symmetric matrix less one for scale. nine points in general position define a quadric. if the matrix q is singular then the quadric is degenerate and may be defined by fewer points. a quadric defines a polarity between a point and a plane in a similar manner to the polarity defined by a conic between a point and a line the plane qx is the polar plane of x with respect to q. in the case that q is non-singular and x is outside the quadric the polar plane is defined by the points of contact with q of the cone of rays through x tangent to q. if x lies on q then qx is the tangent plane to q at x. the intersection of a plane with a quadric q is a conic c. computing the conic can be tricky because it requires a coordinate system for the plane. recall from that a coordinate system for the plane can be defined by the complement space to as x mx. points on are on q if xtqx xtmtqmx these points lie on a conic c since xtcx with c mtqm. under the point transformation hx a quadric transforms as h tqh the dual of a quadric is also a quadric. dual quadrics are equations on planes the adjoint q tangent planes to the point quadric q satisfy tq where q projective geometry and transformations of or q if q is invertible. under the point transformation transforms as hx a dual quadric q hq ht. the algebra of imaging a quadric is far simpler for a dual quadric than a point quadric. this is detailed in chapter classification of quadrics since the matrix q representing a quadric is symmetric it may be decomposed as q utdu where u is a real orthogonal matrix and d is a real diagonal matrix. further by appropriate scaling of the rows of u one may write q htdh where d is diagonal with entries equal to or we may further ensure that the zero entries of d appear last along the diagonal and that the entries appear first. now replacement of q htdh by d is equivalent to a projective transformation effected by the matrix h thus up to projective equivalence we may assume that the quadric is represented by a matrix d of the given simple form. the signature of a diagonal matrix d denoted is defined to be the number of entries minus the number of entries. this definition is extended to arbitrary real symmetric matrices q by defining such that q htdh where h is a real matrix. it may be proved that the signature is well defined being independent of the particular choice of h. since the matrix representing a quadric is defined only up to sign we may assume that its signature is non-negative. then the projective type of a quadric is uniquely determined by its rank and signature. this will allow us to enumerate the different projective equivalence classes of quadrics. a quadric represented by a diagonal matrix corresponds to a set of points satisfying an equation one may set t to get an equation for the non-infinite points on the quadric. see table examples of quadric surfaces are shown in figure figure rank diagonal equation realization no real points sphere hyperboloid of one sheet one point cone at the origin single line two planes x y the plane x table categorization of point quadrics. twisted cubics fig. non-ruled quadrics. this shows plots of a sphere ellipsoid hyperboloid of two sheets and paraboloid. they are all projectively equivalent. fig. ruled quadrics. two examples of a hyperboloid of one sheet are given. these surfaces are given by equations and xy z respectively and are projectively equivalent. note that these two surfaces are made up of two sets of disjoint straight lines and that each line from one set meets each line from the other set. the two quadrics shown here are projectively not affinely equivalent. ruled quadrics. quadrics fall into two classes ruled and unruled quadrics. a ruled quadric is one that contains a straight line. more particularly as shown in figure the non-degenerate ruled quadric of one sheet contains two families of straight lines called generators. for more properties of ruled quadrics refer to the most interesting of the quadrics are the two quadrics of rank note that these two quadrics differ even in their topological type. the quadric of signature sphere is enough topologically a sphere. on the other hand the hyperboloid of sheet is not topologically equivalent to a sphere. in fact it is topologically a torus equivalent to this gives the clearest indication that they are not projectively equivalent. twisted cubics the twisted cubic may be considered to be a analogue of a conic in other ways it is a quadric surface which is the analogue of a conic. projective geometry and transformations of fig. degenerate quadrics. the two most important degenerate quadrics are shown the cone and two planes. both these quadrics are ruled. the matrix representing the cone has rank and the nullvector represents the nodal point of the cone. the matrix representing the two planes has rank and the two generators of the rank null-space are two points on the intersection line of the planes. a conic in the projective plane may be described as a parametrized curve given by the equation a where a is a non-singular matrix. in an analogous manner a twisted cubic is defined to be a curve in given in parametric form as a where a is a non-singular matrix. since a twisted cubic is perhaps an unfamiliar object various views of the curve are shown in figure in fact a twisted cubic is a quite benign space curve. properties of a twisted cubic. let c be a non-singular twisted cubic. then c is not contained within any plane of it intersects a general plane at three distinct points. a twisted cubic has degrees of freedom as for the matrix a less for a projectivity on the parametrization which leaves the curve unaltered. requiring the curve to pass through a point x places two constraints on c since x is three independent ratios but only two constraints once is eliminated. thus there is a unique c through six points in general position. finally all non-degenerate twisted cubics are projectively equivalent. this is clear from the definition a projective transformation a maps c to the standard form c and since the hierarchy of transformations fig. various views of the twisted cubic t t. the curve is thickened to a tube to aid in visualization. all twisted cubics can be mapped to this curve it follows that all twisted cubics are projectively equivalent. a classification of the various special cases of a twisted cubic such as a conic and coincident line are given in the twisted cubic makes an appearance as the horopter for two-view geometry and plays the central role in defining the degenerate set for camera resectioning the hierarchy of transformations there are a number of specializations of a projective transformation of which will appear frequently throughout this book. the specializations are analogous to the strata of section for planar transformations. each specialization is a subgroup and is identified by its matrix form or equivalently by its invariants. these are summarized in table this table lists only the additional properties of the transformations over their counterparts the transformations of also have the invariants listed in table for the corresponding transformations. the degrees of freedom of a projective transformation are accounted for as seven for a similarity for rotation three for translation one for isotropic scaling five for affine scalings and three for the projective part of the transformation. two of the most important characterizations of these transformations are parallelism and angles. for example after an affine transformation lines which were originally parallel remain parallel but angles are skewed and after a projective transformation parallelism is lost. in the following we briefly describe a decomposition of a euclidean transformation that will be useful when discussing special motions later in this book. the screw decomposition a euclidean transformation on the plane may be considered as a specialization of a euclidean transformation of with the restrictions that the translation vector t lies in the plane and the rotation axis is perpendicular to the plane. however euclidean actions on are more general than this because the rotation axis and translation are not perpendicular in general. the screw decomposition enables any euclidean projective geometry and transformations of group projective dof matrix a vt t v a sr r t t t affine dof similarity dof euclidean dof distortion invariant properties intersection and tangency of surfaces in contact. sign of gaussian curvature. parallelism of planes volume ratios centroids. the plane at infinity section the absolute conic section volume. table geometric properties invariant to commonly occurring transformations of the matrix a is an invertible matrix r is a rotation matrix t ty tzt a translation v a general v a scalar and a null the distortion column shows typical effects of the transformations on a cube. transformations higher in the table can produce all the actions of the ones below. these range from euclidean where only translations and rotations occur to projective where five points can be transformed to any other five points no three points are collinear or four coplanar. action rotation composed with a translation to be reduced to a situation almost as simple as the case. the screw decomposition is that result any particular translation and rotation is equivalent to a rotation about a screw axis together with a translation along the screw axis. the screw axis is parallel to the rotation axis. in the case of a translation and an orthogonal rotation axis planar motion the motion is equivalent to a rotation alone about the screw axis. proof. we will sketch a constructive geometric proof that can easily be visualized. consider first the case a euclidean transformation on the plane. it is evident from figure that a screw axis exists for such transformations. for the case decompose the translation t into two components t t parallel and orthogonal respectively to the rotation axis direction t t then the euclidean motion is partitioned into two parts first a rotation about the screw the plane at infinity y r x o t y o a x y s x o y o b x fig. euclidean motion and a screw axis. the frame y undergoes a translation t and a rotation by to reach the frame the motion is in the plane orthogonal to the rotation axis. this motion is equivalent to a single rotation about the screw axis s. the screw axis lies on the perpendicular bisector of the line joining corresponding points such that the angle between the lines joining s to the corresponding points is in the figure the corresponding points are the two frame origins and has the value y screw axis o t a s a o screw axis o a s o t s o b fig. euclidean motion and the screw decomposition. any euclidean rotation r and translation t may be achieved by a rotation about the screw axis followed by a translation along the screw axis by here a is the direction of the rotation axis that ra a and t is decomposed as t t which are vector components parallel and orthogonal respectively to the rotation axis direction the point s is closest to o on the screw axis that the line from s to o is perpendicular to the direction of a. similarly is the point on the screw axis closest to axis which covers the rotation and t second a translation by along the screw axis. the complete motion is illustrated in figure the screw decomposition can be determined from the fixed points of the matrix representing the euclidean transformation. this idea is examined in the exercises at the end of the chapter. the plane at infinity in planar projective geometry identifying the line at infinity l allowed affine properties of the plane to be measured. identifying the circular points on l then allowed projective geometry and transformations of the measurement of metric properties. in the projective geometry of the corresponding geometric entities are the plane at infinity and the absolute conic the plane at infinity has the canonical position in affine it contains the directions d and enables the identification of affine properties such as parallelism. in particular two planes are parallel if and only if their line of intersection is on a line is parallel to another line or to a plane if the point of intersection is on we then have in that any pair of planes intersect in a line with parallel planes intersecting in a line on the plane at infinity. the plane is a geometric representation of the degrees of freedom required to specify affine properties in a projective coordinate frame. in loose terms the plane at infinity is a fixed plane under any affine transformation but sees moved by a projective transformation. the degrees of freedom of thus measure the projective component of a general homography they account for the degrees of freedom of this general transformation compared to an affinity dof. more formally result the plane at infinity is a fixed plane under the projective transformation h if and only if h is an affinity. the proof is the analogue of the derivation of result it is worth clarifying two points the plane is in general only fixed as a set under an affinity it is not fixed pointwise. under a particular affinity example a euclidean motion there may be planes in addition to which are fixed. however only is fixed under any affinity. these points are illustrated in more detail by the following example. example consider the euclidean transformation represented by the matrix he r cos sin cos sin this is a rotation by about the z-axis with a zero translation is a planar screw motion see section geometrically it is evident that the family of xy-planes orthogonal to the rotation axis are simply rotated about the z-axis by this transformation. this means that there is a pencil of fixed planes orthogonal to the z-axis. the planes are fixed as sets but not pointwise as any point on the axis is rotated in horizontal circles by this euclidean action. algebraically the fixed planes of h are the eigenvectors of ht to section in this case the eigenvalues are e i and the corresponding eigenvectors of ht i the absolute conic i e are the eigenvectors and do not correspond to real planes and will not be discussed further here. the eigenvectors and are degenerate. thus there is a pencil of fixed planes which is spanned by these eigenvectors. the axis of this pencil is the line of intersection of the the planes to the z-axis with and the pencil includes the example also illustrates the connection between the geometry of the projective plane and projective a plane intersects in a line which is the line at infinity l of the plane a projective transformation of induces a subordinate plane projective transformation on affine properties of a reconstruction. in later chapters on reconstruction for example chapter it will be seen that the projective coordinates of the scene can be reconstructed from multiple views. once is identified in projective i.e. its projective coordinates are known it is then possible to determine affine properties of the reconstruction such as whether geometric entities are parallel they are parallel if they intersect on a more algorithmic approach is to transform so that the identified is moved to its canonical position at after this mapping we then have the situation that the euclidean scene where has the coordinates and our reconstruction are related by a projective transformation that fixes at it follows from result that the scene and reconstruction are related by an affine transformation. thus affine properties can now be measured directly from the coordinates of the entities. the absolute conic the absolute conic is a conic on in a metric frame and points on satisfy note that two equations are required to define for directions on points with the defining equation can be written so that corresponds to a conic c with matrix c i. it is thus a conic of purely imaginary points on projective geometry and transformations of the conic is a geometric representation of the additional degrees of freedom that are required to specify metric properties in an affine coordinate frame. a key property of is that it is a fixed conic under any similarity transformation. more formally result the absolute conic is a fixed conic under the projective transformation h if and only if h is a similarity transformation. proof. since the absolute conic lies in the plane at infinity a transformation fixing it must fix the plane at infinity and hence must be affine. such a transformation is of the form ha t a restricting to the plane at infinity the absolute conic is represented by the matrix and since it is fixed by ha one has a tia i to scale and taking inverses gives aat i. this means that a is orthogonal hence a scaled rotation or scaled rotation with reflection. this completes the proof. even though does not have any real points it shares the properties of any conic such as that a line intersects a conic in two points the pole polar relationship etc. here are a few particular properties of is only fixed as a set by a general similarity it is not fixed pointwise. this means that under a similarity a point on may travel to another point on but it is not mapped to a point off the conic. all circles intersect in two points. suppose the support plane of the circle is then intersects in a line and this line intersects in two points. these two points are the circular points of all spheres intersect in metric properties. once its support plane have been identified in projective then metric properties such as angles and relative lengths can be measured. consider two lines with directions and the angle between these directions in a euclidean world frame is given by cos this may be written as cos where and are the points of intersection of the lines with the plane containing the conic and is the matrix representation of the absolute conic in that plane. the absolute dual quadric d a d d b l fig. orthogonality and on orthogonal directions are conjugate with respect to a plane normal direction d and the intersection line l of the plane with are in pole polar relation with respect to the expression reduces to in a euclidean world frame where i. however the expression is valid in any projective coordinate frame as may be verified from the transformation properties of points and conics on page there is no simple formula for the angle between two planes computed from the directions of their surface normals. orthogonality and polarity. we now give a geometric representation of orthogonality in a projective space based on the absolute conic. the main device will be the pole polar relationship between a point and line induced by a conic. an immediate consequence of is that two directions and are orthogonal if dt thus orthogonality is encoded by conjugacy with respect to the great advantage of this is that conjugacy is a projective relation so that in a projective frame by a projective transformation of euclidean directions can be identified as orthogonal if they are conjugate with respect to in that frame general the matrix of is not i in a projective frame. the geometric representation of orthogonality is shown in figure this representation is helpful when considering orthogonality between rays in a camera for example in determining the normal to a plane through the camera centre section if image points are conjugate with respect to the image of then the corresponding rays are orthogonal. again a more algorithmic approach is to projectively transform the coordinates so that is mapped to its canonical position and then metric properties can be determined directly from coordinates. the absolute dual quadric recall that is defined by two equations it is a conic on the plane at infinity. the dual of the absolute conic is a degenerate dual quadric in called the absolute dual quadric and denoted q geometrically q consists of the planes tangent to so that is the rim of q this is called a rim quadric. think of the set of planes tangent to an ellipsoid and then squash the ellipsoid to a pancake. is represented by a homogeneous matrix of rank which in algebraically q projective geometry and transformations of metric has the canonical form q i we will show that any plane in the dual absolute quadric envelope is indeed tangent to so the q is truly a dual of consider a plane represented by kt. this plane is in the envelope defined by q which given the form is equivalent to vtv now section v represents the line in which the plane kt meets the plane at infinity. this line is tangent to the absolute conic if and only if vtiv thus the envelope of q is made up of just those planes tangent to the absolute conic. if and only if tq since this is an important fact we consider it from another angle. consider the absolute conic as the limit of a series of squashed ellipsoids namely quadrics represented by the matrix q k. as k these quadrics become increasingly close to the plane at infinity and in the limit the only points they contain are the points with that is points on the absolute conic. however the dual of q is the quadric q which in the limit becomes the absolute dual quadric q q k is a degenerate quadric and has degrees of freedom symmetric matrix has independent elements but the irrelevant scale and zero determinant condition each reduce the degrees of freedom by it is a geometric representation of the degrees of freedom that are required to specify metric properties in a projective coordinate frame. q has a significant advantage over in algebraic manipulations because both and are contained in a single geometric object which requires two equations in order to specify it. in the following we give its three most important properties. result the absolute dual quadric q tion h if and only if h is a similarity. is fixed under the projective transforma the dual quadric q proof. this follows directly from the invariance of the absolute conic under a similarity transform since the planar tangency relationship between q and is transformation invariant. nevertheless we give an independent direct proof. since q if and only if q is a dual quadric it transforms according to so it is fixed under h ht. applying this with an arbitrary transform hq we find i h t a vt k i t a vt k aat av vtat vtv at v tt k closure which must be true up to scale. by inspection this equation holds if and only if v and a is a scaled orthogonal matrix rotation and possible reflection. in other words h is a similarity transform. result the plane at infinity is the null-vector of q this is easily verified when q has its canonical form in a metric frame since then with q this property holds in any frame as may be readily seen algebraically from the transformation properties of planes and dual hx then q h q quadrics if ht q hth t hq result the angle between two planes and is given by h t and q cos q t q t t q proof. to consider two planes with euclidean coordinates has the form and reduces in a euclidean frame q cos nt which is the angle between the planes expressed in terms of a scalar product of their normals. if the planes and q are projectively transformed will still determine the angle between planes due to the transformation properties of planes and dual quadrics. the details of the last part of the proof are left as an exercise but are a direct analogue of the derivation of result on the angle between two lines in computed using the dual of the circular points. planes in are the analogue of lines in and the absolute dual quadric is the analogue of the dual of the circular points. closure the literature the textbooks cited in chapter are also relevant here. see also for a general background from the perspective of descriptive geometry and hilbert and cohnvossen for many clearly explained properties of curves and surfaces. an important representation for points lines and planes in which is omitted in this chapter is the grassmann cayley algebra. in this representation geometric operations such as incidence and joins are represented by a bracket algebra based on matrix determinants. a good introduction to this area is given by and its application to multiple view tensors is illustrated in projective geometry and transformations of faugeras and maybank introduced into the computer vision literature order to determine the multiplicity of solutions for relative orientation and triggs introduced q in for use in auto-calibration. notes and exercises pl ucker coordinates. using pl ucker line coordinates l write an expression for the point of intersection of a line with a plane and the plane defined by a point and a line. now derive the condition for a point to be on a line and a line to be on show that parallel planes intersect in a line on hint start from a plane. to determine the line of intersection of two parallel planes l show that parallel lines intersect on projective transformations. show that a projective transformation of can map an ellipsoid to a paraboloid or hyperboloid of two sheets but cannot map an ellipsoid to a hyperboloid of one sheet a surface with real rulings. screw decomposition. show that the matrix representing the euclidean transformation t a the direction of the rotation axis i.e. ra a has two complex conjugate eigenvalues and two equal real eigenvalues and the following eigenvector structure if a is perpendicular to t then the eigenvectors corresponding to the real eigenvalues are distinct otherwise the eigenvectors corresponding to the real eigenvalues are coincident and on choose simple cases such as another case is given on page in the first case the two real points corresponding to the real eigenvalues define a line of fixed points. this is the screw axis for planar motion. in the second case the direction of the screw axis is defined but it is not a line of fixed points. what do the eigenvectors corresponding to the complex eigenvalues represent? estimation projective transformations in this chapter we consider the problem of estimation. in the present context this will be taken to mean the computation of some transformation or other mathematical quantity based on measurements of some nature. this definition is somewhat vague so to make it more concrete here are a number of estimation problems of the type that we would like to consider. homography. given a set of points xi in and a corresponding set of i likewise in compute the projective transformation that takes each i. in a practical situation the points xi and i are points in two images points xi to the same image each image being considered as a projective plane to camera projection. given a set of points xi in space and a set of corresponding points xi in an image find the to projective mapping that maps xi to xi. such a to projection is the mapping carried out by a projective camera as discussed in chapter fundamental matrix computation. given a set of points xi in one image and corresponding points i in another image compute the fundamental matrix f consistent with these correspondences. the fundamental matrix discussed in chapter is a singular matrix f satisfying trifocal tensor computation. given a set of point correspondences xi i across three images compute the trifocal tensor. the trifocal tensor discussed in chapter is a tensor t jk relating points or lines in three views. tfxi for all i. i i i these problems have many features in common and the considerations that relate to one of the problems are also relevant to each of the others. therefore in this chapter the first of these problems will be considered in detail. what we learn about ways of solving this problem will teach us how to proceed in solving each of the other problems as well. apart from being important for illustrative purposes the problem of estimating projective transformations is of importance in its own right. we consider a set of point correspondences xi i between two images. our problem is to compute a matrix h such that hxi i for each i. estimation projective transformations number of measurements required. the first question to consider is how many corresponding points xi i are required to compute the projective transformation h. a lower bound is available by a consideration of the number of degrees of freedom and number of constraints. on the one hand the matrix h contains entries but is defined only up to scale. thus the total number of degrees of freedom in a projective transformation is on the other hand each point-to-point correspondence accounts for two constraints since for each point xi in the first image the two degrees of freedom of the point in the second image must correspond to the mapped point hxi. a point has two degrees of freedom corresponding to the x and y components each of which may be specified separately. alternatively the point is specified as a homogeneous which also has two degrees of freedom since scale is arbitrary. as a consequence it is necessary to specify four point correspondences in order to constrain h fully. approximate solutions. it will be seen that if exactly four correspondences are given then an exact solution for the matrix h is possible. this is the minimal solution. such solutions are important as they define the size of the subsets required in robust estimation algorithms such as ransac described in section however since points are measured inexactly noise if more than four such correspondences are given then these correspondences may not be fully compatible with any projective transformation and one will be faced with the task of determining the best transformation given the data. this will generally be done by finding the transformation h that minimizes some cost function. different cost functions will be discussed during this chapter together with methods for minimizing them. there are two main categories of cost function those based on minimizing an algebraic error and those based on minimizing a geometric or statistical image distance. these two categories are described in section the gold standard algorithm. there will usually be one cost function which is optimal in the sense that the h that minimizes it gives the best possible estimate of the transformation under certain assumptions. the computational algorithm that enables this cost function to be minimized is called the gold standard algorithm. the results of other algorithms are assessed by how well they compare to this gold standard. in the case of estimating a homography between two views the cost function is the assumptions for optimality are given in section and the gold standard is algorithm the direct linear transformation algorithm i. the transformation is given by the equation we begin with a simple linear algorithm for determining h given a set of four to point correspondences xi i hxi. note that this is an equation involving homogeneous vectors thus the i and hxi are not equal they have the same direction but may differ in magnitude by a nonzero scale factor. the equation may be expressed in terms of the vector cross product as hxi this form will enable a simple linear solution for h to be derived. i the direct linear transformation algorithm if the j-th row of the matrix h is denoted by hj t then we may write writing i i y i w it the cross product may then be given explicitly as hxi y i hxi w x i i w y i i x i i hj for j this gives a set of three equations in the entries since hj txi xt i of h which may be written in the form xt i xt w y i i xt i i w i xt x i i xt y x i i xt i i these equations have the form aih where ai is a matrix and h is a made up of the entries of the matrix h h h with hi the i th element of h. three remarks regarding these equations are in order here. the equation aih is an equation linear in the unknown h. the matrix elements of ai are quadratic in the known coordinates of the points. although there are three equations in only two of them are linearly pendent the third row is obtained up to scale from the sum of x i times the first row and y i times the second. thus each point correspondence gives two equations in the entries of h. it is usual to omit the third equation in solving for h then future reference the set of equations becomes w i xt w i i xt i xt y x i i xt i i this will be written aih where ai is now the matrix of it i y of the point i are the coordinates measured in the image. other choices are possible however as will be seen later. the equations hold for any homogeneous coordinate representation i y i which means that i. one may choose w i w estimation projective transformations solving for h each point correspondence gives rise to two independent equations in the entries of h. given a set of four such point correspondences we obtain a set of equations ah where a is the matrix of equation coefficients built from the matrix rows ai contributed from each correspondence and h is the vector of unknown entries of h. we seek a non-zero solution h since the obvious solution h is of no interest to us. if is used then a has dimension and if the dimension is in either case a has rank and thus has a null-space which provides a solution for h. such a solution h can only be determined up to a non-zero scale factor. however h is in general only determined up to scale so the solution h gives the required h. a scale may be arbitrarily chosen for h by a requirement on its norm such as over-determined solution if more than four point correspondences xi i are given then the set of equations ah derived from is over-determined. if the position of the points is exact then the matrix a will still have rank a one dimensional null-space and there is an exact solution for h. this will not be the case if the measurement of image coordinates is inexact termed noise there will not be an exact solution to the overdetermined system ah apart from the zero solution. instead of demanding an exact solution one attempts to find an approximate solution namely a vector h that minimizes a suitable cost function. the question that naturally arises then is what should be minimized? clearly to avoid the solution h an additional constraint is required. generally a condition on the norm is used such as the value of the norm is unimportant since h is only defined up to scale. given that there is no exact solution to ah it seems natural to attempt to minimize the norm instead subject to the usual constraint this is identical to the problem of finding the minimum of the quotient as shown in section the solution is the eigenvector of ata with least eigenvalue. equivalently the solution is the unit singular vector corresponding to the smallest singular value of a. the resulting algorithm known as the basic dlt algorithm is summarized in algorithm inhomogeneous solution an alternative to solving for h directly as a homogeneous vector is to turn the set of equations into a inhomogeneous set of linear equations by imposing a condition hj for some entry of the vector h. imposing the condition hj is justified by the observation that the solution is determined only up to scale and this scale can be chosen such that hj for example if the last element of h which corresponds to is chosen as unity then the resulting equations derived from are xiw i yiw i wiw i xiw i yiw i wiw i xiy xix i i yiy yix i i h wiy i i wix where h is an consisting of the first components of h. concatenating the equations from four correspondences then generates a matrix equation of the form the direct linear transformation algorithm objective given n to point correspondences matrix h such that algorithm i hxi. i determine the homography rows need be used in general. i compute the matrix ai from only the first two for each correspondence xi assemble the n matrices ai into a single matrix a. obtain the svd of a the unit singular vector corresponding to the smallest singular value is the solution h. specifically if a udvt with d diagonal with positive diagonal entries arranged in descending order down the diagonal then h is the last column of v. the matrix h is determined from h as in algorithm the basic dlt for h see algorithm which includes normalization. m h b where m has columns and b is an such an equation may be solved for h using standard techniques for solving linear equations as gaussian elimination in the case where m contains just rows minimum case or by least-squares techniques in the case of an over-determined set of equations. however if in fact hj is the true solution then no multiplicative scale k can exist such that khj this means that the true solution cannot be reached. for this reason this method can be expected to lead to unstable results in the case where the chosen hj is close to zero. consequently this method is not recommended in general. example it will be shown that is zero if the coordinate origin is mapped to a point at infinity by h. since represents the coordinate origin and also represents the line at infinity l this condition may be written as thus in a perspective image of a scene plane the line at infinity is imaged as the vanishing line of the plane chapter for example the horizon is the vanishing line of the ground plane. it is not uncommon for the horizon to pass through the image centre and for the coordinate origin to coincide with the image centre. in this case the mapping that takes the image to the world plane maps the origin to the line at infinity so that the true solution has consequently an normalization can be a serious failing in practical situations. degenerate configurations consider a minimal solution in which a homography is computed using four point correspondences and suppose that three of the points are collinear. the question is whether this is significant. if the corresponding points are also collinear then one might suspect that the homography is not sufficiently constrained and there will exist a family of homographies mapping xi to i. on the other hand if the corresponding points are not collinear then clearly there can be no transformation h taking xi to i since a projective transformation must preserve collinearity. never estimation projective transformations is that h the equations express the condition that therefore the condition corresponding to h i theless the set of eight homogeneous equations derived from must have a non-zero solution giving rise to a matrix h. how is this apparent contradiction to be resolved? hxi for i and so the matrix h found by solving the system of equations will satisfy this condition. suppose that are collinear and let l be the line that they lie on so that ltxi lt which is a matrix of rank in this case for i now define h one verifies that h xi for i since ltxi on the other h xi is satisfied for hand h all i. note that the vector h is given by h t and one easily verifies that this vector satisfies for all i. the problem with this solution for h is a rank matrix and hence does not represent a projective transformation. as a consequence the points h xi for i are not well defined. lt is a solution to there are two cases either h is the unique solution to scale or there is a further solution h. in the first case since h is a singular matrix there exists no transformation taking each xi to are not. in the second case where a further solution h exists then any matrix of the form h h is a solution. thus a family of transformations exist and it follows that the equations derived from are not independent. i. this occurs when are collinear but we showed that if are collinear then h i a situation where a configuration does not determine a unique solution for a particular class of transformation is termed degenerate. note that the definition of degeneracy involves both the configuration and the type of transformation. the degeneracy problem is not limited to a minimal solution however. if additional i.e. error-free correspondences are supplied which are also collinear on l then the degeneracy is not resolved. solutions from lines and other entities the development to this point and for the rest of the chapter is exclusively in terms of computing homographies from point correspondences. however an identical development can be given for computing homographies from line correspondences. starting from the line transformation li i a matrix equation of the form ah can be derived with a minimal solution requiring four lines in general position. similarly a homography may be computed from conic correspondences and so forth. there is the question then of how many correspondences are required to compute the homography any other relation. the general rule is that the number of constraints must equal or exceed the number of degrees of freedom of the transformation. for example in each corresponding point or line generates two constraints on h in each corresponding point or plane generates three constraints. thus in the correspondence of four points or four lines is sufficient to compute h since with the number of degrees of freedom of the homography. in a homography has degrees of freedom and five points or five planes are required. for a planar affine transformation dof only three corresponding points or lines are required and so on. a conic provides five constraints on a homography. different cost functions fig. geometric equivalence of point line configurations. a configuration of two points and two lines is equivalent to five lines with four concurrent or five points with four collinear. care has to be taken when computing h from correspondences of mixed type. for example a homography cannot be determined uniquely from the correspondences of two points and two lines but can from three points and one line or one point and three lines even though in each case the configuration has degrees of freedom. the case of three lines and one point is geometrically equivalent to four points since the three lines define a triangle and the vertices of the triangle uniquely define three points. we have seen that the correspondence of four points in general position uniquely determines a homography which means that the correspondence of three lines and one point also uniquely determines a homography. similarly the case of three points and a line is equivalent to four lines and again the correspondence of four lines in general position no three concurrent uniquely determines a homography. however as a quick sketch shows the case of two points and two lines is equivalent to five lines with four concurrent or five points with four collinear. as shown in the previous section this configuration is degenerate and a one-parameter family of homographies map the two-point and two-line configuration to the corresponding configuration. different cost functions we will now describe a number of cost functions which may be minimized in order to determine h for over-determined solutions. methods of minimizing these functions are described later in the chapter. algebraic distance the dlt algorithm minimizes the norm the vector ah is called the residual vector and it is the norm of this error vector that is minimized. the components of this vector arise from the individual correspondences that generate each row of the matrix a. each correspondence xi i contributes a partial error vector from or towards the full error vector this vector is the algebraic error vector associated with the point correspondence xi i and the homography h. the norm of this vector is a scalar which is called the algebraic distance i w i xt w i i xt i xt y x i i xt i i h more generally and briefly for any two vectors and we may write where a estimation projective transformations the relation of this distance to a geometric distance is described in section given a set of correspondences the quantity ah is the algebraic error vector for the complete set and one sees that i i i the concept of algebraic distance originated in the conic-fitting work of bookstein its disadvantage is that the quantity that is minimized is not geometrically or statistically meaningful. as bookstein demonstrated the solutions that minimize algebraic distance may not be those expected intuitively. nevertheless with a good choice of normalization will be discussed in section methods which minimize algebraic distance do give very good results. their particular advantages are a linear thus a unique solution and computational cheapness. often solutions based on algebraic distance are used as a starting point for a non-linear minimization of a geometric or statistical cost function. the non-linear minimization gives the solution a final polish geometric distance next we discuss alternative error functions based on the measurement of geometric distance in the image and minimization of the difference between the measured and estimated image coordinates. notation. vectors x represent the measured image coordinates x represent estimated values of the points and x represent true values of the points. error in one image. we start by considering error only in the second image with points in the first measured perfectly. clearly this will not be true in most practical situations with images. an example where the assumption is more reasonable is in estimating the projective transformation between a calibration pattern or a world plane where points are measured to a very high accuracy and its image. the appropriate quantity to be minimized is the transfer error. this is the euclidean image distance in the second image between the measured point and the point h x at which the corresponding point x is mapped from the first image. we use the notation dx y to represent the euclidean distance between the inhomogeneous points represented by x and y. then the transfer error for the set of correspondences is i h the estimated homography h is the one for which the error is minimized. i symmetric transfer error. in the more realistic case where image measurement errors occur in both the images it is preferable that errors be minimized in both images and not solely in the one. one way of constructing a more satisfactory error function is to consider the forward and backward transformation and sum the geometric errors corresponding to each of these two transformations. thus the error is different cost functions dxi h i i the first term in this sum is the transfer error in the first image and the second term is the transfer error in the second image. again the estimated homography h is the one for which is minimized. reprojection error both images an alternative method of quantifying error in each of the two images involves estimating a correction for each correspondence. one asks how much it is necessary to correct the measurements in each of the two images in order to obtain a perfectly matched set of image points. one should compare this with the geometric one-image transfer error which measures the correction that it is necessary to make to the measurements in one image second image in order to get a set of perfectly matching points. in the present case we are seeking a homography h and pairs of perfectly matched points xi and i that minimize the total error function dxi i subject to i h xi i. i i minimizing this cost function involves determining both h and a set of subsidiary correspondences xi and this estimation models for example the situation that wish to estimate a point on the world plane from xi measured correspondences xi i arise from images of points on a world plane. we i which is then reprojected to the estimated perfectly matched correspondence xi i. this reprojection error function is compared with the symmetric error function in figure it will be seen in section that is related to the maximum likelihood estimation of the homography and correspondences. comparison of geometric and algebraic distance we return to the case of errors only in the second image. let define a vector x becomes it and i h xi. using this notation the left hand side of it i y i w i i w i y aih i w y w i x i i w i y x i i w i this vector is the algebraic error vector associated with the point correspondence xi i and the camera mapping h. thus w x i i w i x i for points i and i i y i the geometric distance is i w i i iw i x i w iw i y i w estimation projective transformations x d x x d image image h h h h d x x image image fig. a comparison between symmetric transfer error and reprojection error when estimating a homography. the points x and are the measured points. under the estimated homography the points and hx do not correspond perfectly neither do the points x and h however the estimated points x and h x. using the notation dx y for the euclidean image distance between x and y the symmetric transfer error is dx h do correspond perfectly by the homography the reprojection error is dx i i w iw i. i w thus geometric distance is related to but not quite the same as algebraic distance. note though that if w i then the two distances are identical. one can always assume that wi thus expressing the points xi in the usual form xi yi for one important class of homographies the values of w i will always be as well. a affine transformation is represented by a matrix of the form ha i ha xi that w one verifies immediately from i if wi this demonstrates that in the case of an affine transformation geometric distance and algebraic distance are identical. the dlt algorithm is easily adapted to enforce the condition that the last row of h has the form by setting hence for affine transformations geometric distance can be minimized by the linear dlt algorithm based on algebraic distance. geometric interpretation of reprojection error the estimation of a homography between two planes can be thought of as fitting a surface to points in a space each pair of image points x defines a single point denoted x in a measurement space formed by concatenating the inhomogeneous coordinates of x and for a given specific homography h the image correspondences x that satisfy define an algebraic vh in which is the a variety is the simultaneous zero-set of one or more multivariate polynomials defined in irn different cost functions y intersection of two quadric hypersurfaces. the surface is a quadric in because each the elements of h determine the row of is a degree polynomial in x y x coefficient of each term of the polynomial and so h specifies the particular quadric. the two independent equations of define two such quadrics. it in the task of estimating a homography begiven points xi yi x comes the task of finding a variety vh that passes most nearly passes through the points xi. in general of course it will not be possible to fit a variety precisely. in this xi let xi yi x case let vh be some variety corresponding to a transformation h and for each point it be the closest point to xi lying on the variety vh. one sees i y i y immediately that i x i y dxi i thus geometric distance in is equivalent to the reprojection error measured in both the images and finding the variety vh and points on vh that minimize the squared sum of distances to the measured points xi is equivalent to finding the homography h the point on vh that lies closest to a measured point x is a point where the line and the estimated points xi and i that minimize the reprojection error function between x and is perpendicular to the tangent plane to vh at thus where d is the perpendicular distance of the point x to the variety vh. as may be seen from the conic-fitting analogue discussed below there may be more than one such perpendicular from x to vh. the distance d is invariant to rigid transformations of and this includes as a special case rigid transformations of the coordinates y of each image individually. this point is returned to in section d dxi i y conic analogue. before proceeding further we will first sketch an analogous estimation problem that can be visualized more easily. the problem is fitting a conic to points which occupies a useful intermediate position between fitting a straight line curvature too simple and fitting a homography dimensions with non-zero curvature. consider the problem of fitting a conic to a set of n points yit on the plane such that an error based on geometric distance is minimized. the points may be thought of as correspondences xi yi. the transfer distance and reprojection distance are illustrated in figure it is clear from this figure that d is less than or equal to the transfer error. the algebraic distance of a point x from a conic c is defined as dalgx xtcx. i dalgxi with a suitable a linear solution for c can be obtained by minimizing normalization on c. there is no linear expression for the perpendicular distance of a point y to a conic c since through each point in there are up to lines perpendicular to c. the solution can be obtained from the roots of a quartic. however a function d c may be defined which returns the shortest distance between a conic estimation projective transformations y d x d a a d y c b d dy b x fig. a conic may be estimated from a set of points by minimizing symmetric transfer error y or the sum of squared perpendicular distances the analogue of transfer error is to consider x x as perfect and measure the distance dy to the conic in the y direction and similarly for dx. for point a it is clear that d dx and d dy. also d is more stable than dx or dy as illustrated by point b where dx cannot be defined. i d over the five and a point. a conic can then be estimated by minimizing parameters of c though this cannot be achieved by a linear solution. given a conic c and a measured point x a corrected point x is obtained simply by choosing the closest point on c. we return now to estimating a homography. in the case of an affine transformation the variety is the intersection of two hyperplanes i.e. it is a linear subspace of dimension this follows from the form of the affine matrix which for hax yields one linear constraint between x x each of which defines a hyperplane in an analogue of this situation is line fitting to points on the plane. in both cases the relation transformation or line may be estimated by minimizing the perpendicular distance of points to the variety. in both cases there is a closed form solution as discussed in the following section. y and another between x y y sampson error the geometric error is quite complex in nature and minimizing it requires the simultaneous estimation of both the homography matrix and the points xi i. this non-linear estimation problem will be discussed further in section its complexity contrasts with the simplicity of minimizing the algebraic error the geometric interpretation of geometric error given in section leads to a further cost function that lies between the algebraic and geometric cost functions in terms of complexity but gives a close approximation to geometric error. we will refer to this cost function as sampson error since sampson used this approximation for conic fitting. as described in section the vector that minimizes the geometric error is the closest point on the variety vh to the measurement x. this point can not be estimated directly except via iteration because of the non-linear nature of the variety to the point assuming that the cost function is well approximated linearly in the vh. the idea of the sampson error function is to estimate a first-order approximation neighbourhood of the estimated point. the discussion to follow is related directly to different cost functions the homography estimation problem but applies substantially unchanged to the other estimation problems discussed in this book. that lies on vh will satisfy for a given homography h any point x y x the equation or ah to emphasize the dependency on x we will write this instead as chx where chx is in this case a to first order this cost function may be approximated by a taylor expansion y chx x chx x. if we write x x and desire to lie on the variety vh so that then the result is chx ch x x which we will henceforth write as j x where j is the partial-derivative matrix and is the cost chx associated with x. the minimization problem that we now face is to find the smallest x that satisfies this equation namely find the vector x that minimizes subject to j x the standard way to solve problems of this type is to use lagrange multipliers. a vector of lagrange multipliers is introduced and the problem reduces to that of x x tj x where the factor is simply introduced finding the extrema of t for convenience. taking derivatives with respect to x and equating to zero gives ch x x tj t from which we obtain x jt the derivative with respect to gives j x the original constraint. substituting for x leads to jjt which may be solved for giving and so finally x jtjjt and x x. the norm is the sampson error t x x example sampson approximation for a conic we will compute the sampson approximation to the geometric distance d c between a point x and conic c shown in figure in this case the conic variety vc is defined by the equation xtcx so that x yt is a xtcx is a scalar and j is the matrix given by j x y this means that jjt is a scalar. the elements of j may be computed by the chain rule as x x x x where denotes the i-th component of the cx. then from estimation projective transformations jjt a few points to note measurements are x y and where the for the homography estimation problem x y x chx is the algebraic error vector aih a and ai is defined in j chx x is a matrix. for example y y w i y i xt i xt i x w y note the similarity of to the algebraic error the sampson error may be interpreted as being the mahalanobis norm section one could alternatively use a defined by in which case j has dimension and is a however in general the sampson error and consequently the solution x will be independent of whether or is used. the sampson error is derived here for a single point pair. in applying this to the estimation of a homography h from several point correspondences xi i the errors corresponding to all the point correspondences must be summed giving d i i i where and j both depend on h. to estimate h this expression must be minimized over all values of h. this is a simple minimization problem in which the set of variable parameters consists only of the entries some other parametrization of h. this derivation of the sampson error assumed that each point had isotropic error distribution the same in each image. the appropriate formulae for more general gaussian error distributions are given in the exercises at the end of this chapter. linear cost function the algebraic error vector chx axh is typically multilinear in the entries of x. the case where axh is linear is however important in its own right. the first point to note is that in this case the first-order approximation to geometric error given by the taylor expansion in is exact higher order terms are zero which means that the sampson error is identical to geometric error. in addition the variety vh defined by the equation chx a set of linear equations is a hyperplane depending on h. the problem of finding h now becomes a hyperplane fitting problem find the best fit to the data xi among the hyperplanes parametrized by h. different cost functions as an example of this idea a linear algorithm which minimizes geometric error for an affine transformation is developed in the exercises at the end of this chapter. another geometric interpretation it was shown in section that finding a homography that takes a set of points xi to another set i is equivalent to the problem of fitting a variety of a given type to a set of points in we now consider a different interpretation in which the set of all measurements is represented by a single point in a measurement space irn the estimation problems we consider may all be fitted into a common framework. in abstract terms the estimation problem has two components a measurement space irn consisting of measurement vectors x and a model which in abstract terms may be thought of simply as a subset s of points in irn a measurement vector x that lies inside this subset is said to satisfy the model. typically the subspace that satisfies the model is a submanifold or variety in irn. now given a measurement vector x in irn the estimation problem is to find the vector closest to x that satisfies the model. it will now be pointed out how the homography estimation problem fits into this i i framework. error in both images. let be a set of measured matched points for i n. in all there are measurements namely two coordinates in each of two images for n points. thus the set of matched points represents a point in irn where n the vector made up of the coordinates of all the matched points in both images will be denoted x. of course not all sets of point pairs xi i are related via a homography h. a set of point correspondences for which there exists a projective transformation h satisfying i hxi for all i constitutes the subset of irn satisfying the model. in general this set of points will form a submanifold s in irn fact a variety of some dimension. the dimension of this submanifold is equal to the minimal number of parameters that may be used to parametrize the submanifold. one may arbitrarily choose n points xi in the first image. in addition a homography h may be chosen arbitrarily. once these choices have been made the points i in the second image are determined by i h xi. thus a feasible choice of points is determined by a set of parameters the coordinates of the points xi plus the independent parameters of freedom of the transformation h. thus the submanifold s irn has dimension and hence codimension and an estimated point irn lying on s one easily verifies that given a set of measured point pairs corresponding to a point x in irn thus finding the point on s lying closest to x in irn is equivalent to minimizing the cost function given by the estimated correct correspondences xi dxi i i i i are those corresponding to the closest surface point in irn once is known h may be estimation projective transformations computed. i error in one image only. in the case of error in one image one has a set of correspondences xi the points xi are assumed perfect. the inhomogeneous coordinates space has dimension n the vector consists of the inhomogeneous coorof the i constitute the measurement vector x. hence in this case the measurement vectors satisfying the model is the set as h varies over the set of all homography dinates of the mapped perfect points h xn. the set of measurement matrices. once again this subspace is a variety. its dimension is since this is the total number of degrees of freedom of the homography matrix h. as with the previous case the codimension is one verifies that i h thus finding the closest point on s to the measurement vector x is equivalent to minimizing the cost function i statistical cost functions and maximum likelihood estimation in section various cost functions were considered that were related to geometric distance between estimated and measured points in an image. the use of such cost functions is now justified and then generalized by a consideration of error statistics of the point measurements in an image. in order to obtain a best estimate of h it is necessary to have a model for the measurement error noise we are assuming here that in the absence of measurement error the true points exactly satisfy a homography i.e. i h xi. a common assumption is that image coordinate measurement errors obey a gaussian normal probability distribution. this assumption is surely not justified in general and takes no account of the presence of outliers erroneous measurements in the measured data. methods for detecting and removing outliers will be discussed later in section once outliers have been removed the assumption of a gaussian error model if still not strictly justified becomes more tenable. therefore for the present we assume that image measurement errors obey a zero-mean isotropic gaussian distribution. this distribution is described in section specifically we assume that the noise is gaussian on each image coordinate with zero mean and uniform standard deviation this means that x x x with x obeying a gaussian distribution with variance if it is further assumed that the noise on each measurement is independent then if the true point is x the probability density function of each measured point x is prx dx e error in one image. second image. the probability of obtaining the set of correspondences xi first we consider the case where the errors are only in the is i log i i h constant. i i h statistical cost functions and maximum likelihood estimation simply the product of their individual pdfs since the errors on each point are assumed independent. then the pdf of the noise-perturbed data is i is to be interpreted as meaning the probability of obtaining the given that the true homography is h. the log-likelihood of the set ih e i the symbol measurements of correspondences is i i the maximum likelihood estimate of the homography h maximizes this loglikelihood i.e. minimizes thus we note that ml estimation is equivalent to minimizing the geometric error function i error in both images. correspondences are xi h xi then the pdf of the noise-perturbed data is xi following a similar development to the above if the true prxi ih e i i i the additional complication here is that we have to seek corrected image measurements that play the role of the true measurements x above. thus the ml estimate of the projective transformation h and the correspondences is the homography h and corrected correspondences xi that minimize i i i dxi i with reprojection error function i h xi. note that in this case the ml estimate is identical with minimizing the mahalanobis distance. in the general gaussian case one may assume a vector of measurements x satisfying a gaussian distribution function with covariance matrix the cases above are equivalent to a covariance matrix which is a multiple of the identity. maximizing the log-likelihood is then equivalent to minimizing the mahalanobis distance section xt x. in the case where there is error in each image but assuming that errors in one image are independent of the error in the other image the appropriate cost function is estimation projective transformations are the covariance matrices of the measurements in the two images. finally if we assume that the errors for all the points xi and i are independent i respectively then the above expression where and with individual covariance matrices i and expands to i i i i this equation allows the incorporation of the type of anisotropic covariance matrices that arise for point locations computed as the intersection of two non-perpendicular lines. in the case where the points are known exactly in one of the two images errors being confined to the other image one of the two summation terms in disappears. transformation invariance and normalization we now start to discuss the properties and performance of the dlt algorithm of section and how it compares with algorithms minimizing geometric error. the first topic is the invariance of the algorithm to different choices of coordinates in the image. it is clear that it would generally be undesirable for the result of an algorithm to be dependent on such arbitrary choices as the origin and scale or even orientation of the coordinate system in an image. invariance to image coordinate transformations image coordinates are sometimes given with the origin at the top-left of the image and sometimes with the origin at the centre. the question immediately occurs whether this makes a difference to the results of computing the transformation. similarly if the units used to express image coordinates are changed by multiplication by some factor then is it possible that the result of the algorithm changes also? more generally to what extent is the result of an algorithm that minimizes a cost function to estimate a homography dependent on the choice of coordinates in the image? suppose for instance that the image coordinates are changed by some similarity affine or even projective transformation before running the algorithm. will this materially change the result? formally suppose that coordinates x in one image are replaced by x tx and are coordinates x. this relation implies that is the transformation matrix for the hx we derive the equation homographies. substituting in the equation point correspondences x taking xi to find the from the correspondences xi set h the transformation matrix h found in this way applies to the original untransformed point correspondences xi i. what choice should be made for the transformations t and will be left unspecified for now. the question to be decided now is whether the transform the image coordinates according to transformations xi txi and in the other image are replaced by an alternative method of finding the transformation i is therefore suggested as follows. where t and i i. i. transformation invariance and normalization outcome of this algorithm is independent of the transformations t and being applied. ideally it ought to be at least when t and are similarity transformations since the choice of a different scale orientation or coordinate origin in the images should not materially affect the outcome of the algorithm. in the subsequent sections it will be shown that an algorithm that minimizes geometric error is invariant to similarity transformations. on the other hand for the dlt algorithm as described in section the result unfortunately is not invariant to similarity transformations. the solution is to apply a normalizing transformation to the data before applying the dlt algorithm. this normalizing transformation will nullify the effect of the arbitrary selection of origin and scale in the coordinate frame of the image and will mean that the combined algorithm is invariant to a similarity transformation of the image. appropriate normalizing transformations will be discussed later. i i yield the trans i where xi txi and non-invariance of the dlt algorithm consider a set of correspondences xi i and a matrix h that is the result of the dlt i and let be defined by following section the question to be decided here is the following algorithm applied to this set of corresponding points. consider further a related set of correspondences xi does the dlt algorithm applied to the correspondence set xi we will use the following notation matrix ai is the dlt equation matrix derived from a point correspondence xi i and a is the matrix formed by stacking the ai. matrix ai is similarly defined in terms of the correspondences xi i where xi txi and result let be a similarity transformation with scale factor s and let t be an arbitrary projective transformation. further suppose h is any homography and let h be defined by h then a where h and h are the vectors of entries of h and h. hxi. note that aih is the vector consisting of the proof. define the vector first two entries of let be similarly defined in terms of the transformed quantities as xi i for some projective transformations t and xi. one computes hxi i i i i i i i represents the cofactor matrix of where and the second-last equality follows from lemma for a general transformation t the error vectors aih and h the first two components of and are not simply related. however in ai the special case where where r is a rotation matrix t is a translation and s is a scaling factor. in this case we is a similarity transformation one may write sr t s see that sees that r ttr s estimation projective transformations applying just to the first two components of one ai h sraih. dalg error except for constant scale. since rotation does not affect vector norms one sees that a as required. this result may be expressed in terms of algebraic error as i hxi. xi thus there is a one-to-one correspondence between h giving rise to the same it may appear therefore that the matrices h and minimizing the algebraic error will be related by the formula and hence one may retrieve h as the product this conclusion is false however. for although h and so defined give rise to the same error the condition imposed as a constraint on the solution is not equivalent to the condition specifically and are not related in any simple manner. thus there is no oneto-one correspondence between h and giving rise to the same error subject to the constraint specifically dalg dalg i subject to subject to subject to minimize minimize minimize i i i thus the method of transformation leads to a different solution for the computed transformation matrix. this is a rather undesirable feature of the dlt algorithm as it stands that the result is changed by a change of coordinates or even simply a change of the origin of coordinates. if the constraint under which the norm is minimized is invariant under the transformation however then one sees that the computed matrices h and h are related in the right way. examples of minimization conditions for which h is transformation-invariant are discussed in the exercises at the end of this chapter. invariance of geometric error it will be shown now that minimizing geometric error to find h is invariant under similarity euclidean transformations. as before consider a point correspondence x and a transformation matrix h. also define a related set of correspondences x where x tx and t and x represent euclidean transformations of one verifies that and be defined suppose that d hx where the last equality holds because euclidean distance is unchanged under a euclidean transformation such as this shows that if h minimizes the geometric error for a set of correspondences minimizes the geometric error for the transformed transformation invariance and normalization set of correspondences and so minimizing geometric error is invariant under euclidean transformations. for similarity transformations geometric error is multiplied by the scale factor of the transformation hence the minimizing transformations correspond in the same way as in the euclidean transformation case. minimizing geometric error is invariant to similarity transformations. normalizing transformations as was shown in section the result of the dlt algorithm for computing homographies depends on the coordinate frame in which points are expressed. in fact the result is not invariant to similarity transformations of the image. this suggests the question whether some coordinate systems are in some way better than others for computing a homography. the answer to this is an emphatic yes. in this section a method of normalization of the data is described consisting of translation and scaling of image coordinates. this normalization should be carried out before applying the dlt algorithm. subsequently an appropriate correction to the result expresses the computed h with respect to the original coordinate system. apart from improved accuracy of results data normalization provides a second desirable benefit namely that an algorithm that incorporates an initial data normalization step will be invariant with respect to arbitrary choices of the scale and coordinate origin. this is because the normalization step undoes the effect of coordinate changes by effectively choosing a canonical coordinate frame for the measurement data. thus algebraic minimization is carried out in a fixed canonical frame and the dlt algorithm is in practice invariant to similarity transformations. isotropic scaling. as a first step of normalization the coordinates in each image are translated a different translation for each image so as to bring the centroid of the set of all points to the origin. the coordinates are also scaled so that on the average a point x is of the form x y wt with each of x y and w having the same average magnitude. rather than choose different scale factors for each coordinate direction an isotropic scaling factor is chosen so that the x and y-coordinates of a point are scaled equally. to this end we choose to scale the coordinates so that the average distance of a point x from the origin is equal to this means that the average point is equal to in summary the transformation is as follows the points are translated so that their centroid is at the origin. the points are then scaled so that the average distance from the origin is equal to this transformation is applied to each of the two images independently. why is normalization essential? the recommended version of the dlt algorithm with data normalization is given in algorithm we will now motivate why this estimation projective transformations version of the algorithm incorporating data normalization should be used in preference to the basic dlt of algorithm note that normalization is also called pre-conditioning in the numerical literature. the dlt method of algorithm uses the svd of a udvt to obtain a solution to the overdetermined set of equations ah these equations do not have an exact solution the matrix a will not have rank for noisy data but the vector h given by the last column of v provides a solution which minimizes to this is equivalent to finding the rank matrix a which is closest to a in frobenius norm and obtaining h as the exact solution of ah the matrix a is given by a u dvt where d is d with the smallest singular value set to zero. the matrix a has rank and minimizes the difference to a in frobenius norm because u where is the frobenius norm i.e. the square root of the sum of squares of all entries. without normalization typical image points xi i are of the order y wt i.e. x y are much larger than w. in a the entries xx will xy be of order entries xw etc. of order and entries ww will be unity. replacing a by a means that some entries are increased and others decreased such that the square sum of differences of these changes is minimal the resulting matrix has rank however and this is the key point increasing the term ww by means a huge change in the image points whereas increasing the term xx by means only a slight change. this is the reason why all entries in a must have similar magnitude and why normalization is essential. yw yx yy the effect of normalization is related to the condition number of the set of dlt equations or more precisely the ratio of the first to the second-last singular value of the equation matrix a. this point is investigated in more detail in for the present it is sufficient to say that for exact data and infinite precision arithmetic the results will be independent of the normalizing transformation. however in the presence of noise the solution will diverge from the correct result. the effect of a large condition number is to amplify this divergence. this is true even for infinite-precision arithmetic this is not a round-off error effect. the effect that this data normalization has on the results of the dlt algorithm is shown graphically in figure the conclusion to be drawn here is that data normalization gives dramatically better results. the examples shown in the figure are chosen to make the effect easily visible. however a marked advantage remains even in cases of computation from larger numbers of point correspondences with points more widely distributed. to emphasize this point we remark data normalization is an essential step in the dlt algorithm. it must not be considered optional. data normalization becomes even more important for less well conditioned problems such as the dlt computation of the fundamental matrix or the trifocal tensor which will be considered in later chapters. transformation invariance and normalization objective given n to point correspondences matrix h such that algorithm i hxi. i determine the homography normalization of x compute a similarity transformation t consisting of a translation and scaling that takes points xi to a new set of points xi such that the centroid of the points xi is the coordinate origin and their average distance from the origin is image transforming points normalization of dlt apply algorithm to the correspondences xi compute a similar transformation for the points in the second denormalization set h i to i. i to obtain a homogra algorithm the normalized dlt for homographies. a b fig. results of monte carlo simulation section of computation of homographies. a set of points by large crosses was used to compute a homography. each of the points is mapped the noise-free case to the point with the same coordinates so that homography h is the identity mapping. now trials were made with each point being subject to pixel gaussian noise in one image. reference the large crosses are pixels across. the mapping h computed using the dlt algorithm was then applied to transfer a further point into the second image. the projections of this point are shown with small crosses and the ellipse computed from their scatter matrix is also shown. are the results without data normalization and the results with normalization. the leftand rightmost reference points have coordinates and non-isotropic scaling. other methods of scaling are also possible. in non-isotropic scaling the centroid of the points is translated to the origin as before. after this translation the points form a cloud about the origin. scaling is then carried out so that the two principal moments of the set of points are both equal to unity. thus the set of points will form an approximately symmetric circular cloud of points of radius about the origin. experimental results given in suggest that the extra effort required for non-isotropic scaling does not lead to significantly better results than isotropic scaling. a further variant on scaling was discussed in based on a statistical analysis of the estimator its bias and variance. in that paper it was observed that some columns of a are not affected by noise. this applies to the third and sixth columns in i such error-free entries in a should not corresponding to the entry wiw be varied in finding a the closest rank-deficient approximation to a. a method known estimation projective transformations as total least squares fixed columns is used to find the best solution. for estimation of the fundamental matrix chapter reports slightly improved results compared with non-isotropic scaling. scaling with points near infinity. consider the case of estimation of a homography between an infinite plane and an image. if the viewing direction is sufficiently oblique then very distant points in the plane may be visible in the image even points at infinity points if the horizon is visible. in this case it makes no sense to normalize the coordinates of points in the infinite plane by setting the centroid at the origin since the centroid may have very large coordinates or be undefined. an approach to normalization in this case is considered in exercise on page iterative minimization methods this section describes methods for minimizing the various geometric cost functions developed in section and section minimizing such cost functions requires the use of iterative techniques. this is unfortunate because iterative techniques tend to have certain disadvantages compared to linear algorithms such as the normalized dlt algorithm they are slower. they generally need an initial estimate at which to start the iteration. they risk not converging or converging to a local minimum instead of the global minimum. selection of a stopping criterion for iteration may be tricky. consequently iterative techniques generally require more careful implementation. the technique of iterative minimization generally consists of five steps cost function. a cost function is chosen as the basis for minimization. dif ferent possible cost functions were discussed in section parametrization. the transformation other entity to be computed is expressed in terms of a finite number of parameters. it is not in general necessary that this be a minimum set of parameters and there are in fact often advantages to over-parametrization. the discussion below. function specification. a function must be specified that expresses the cost in terms of the set of parameters. initialization. a suitable initial parameter estimate is computed. this will generally be done using a linear algorithm such as the dlt algorithm. iteration. starting from the initial solution the parameters are iteratively refined with the goal of minimizing the cost function. a word about parametrization for a given cost function there are often several choices of parametrization. the general strategy that guides parametrization is to select a set of parameters that cover the complete space over which one is minimizing while at the same time allowing one to iterative minimization methods compute the cost function in a convenient manner. for example h may be parametrized by parameters that is it is over-parametrized since there are really only degrees of freedom overall scale not being significant. a minimal parametrization the same number of parameters as degrees of freedom would involve only parameters. in general no bad effects are likely to occur if a minimization problem of this type is over-parametrized as long as for all choices of parameters the corresponding object is of the desired type. in particular for homogeneous objects such as the projection matrix encountered here it is usually not necessary or advisable to attempt to use a minimal parametrization by removing the scale-factor ambiguity. the reasoning is the following it is not necessary to use minimal parametrization because a well-performing non-linear minimization algorithm will notice that it is not necessary to move in redundant directions such as the matrix scaling direction. the algorithm described in gill and murray which is a modification of the gauss newton method has an effective strategy for discarding redundant combinations of the parameters. similarly the levenberg-marquardt algorithm section handles redundant parametrizations easily. it is not advisable because it is found empirically that the cost function surface is more complicated when minimal parametrizations are used. there is then a greater possibility of becoming stuck in a local minimum. one other issue that arises in choosing a parametrization is that of restricting the transformation to a particular class. for example suppose h is known to be a homology then as described in section it may be parametrized as h i vat vta where is a scalar and v and a a homology has degrees of freedom which correspond here to the scalar and the directions of v and a. if h is parametrized by its matrix entries then the estimated h is unlikely to exactly be a homology. however if h is parametrized by v and a total of parameters then the estimated h is guaranteed to be a homology. this parametrization is consistent with a homology is also an over-parametrization. we will return to the issues of consistent local minimal and over-parametrization in later chapters. the issues are also discussed further in appendix function specification it has been seen in section that a general class of estimation problems is concerned with a measurement space irn containing a model surface s. given a measurement x irn the estimation task is to find the point lying on s closest to x. in the case where a non-isotropic gaussian error distribution is imposed on irn the word closest is to be interpreted in terms of mahalanobis distance. iterative minimization methods will now be described in terms of this estimation model. in iterative estimation through parameter fitting the model surface s is locally parametrized and the parameters are allowed to vary to minimize the distance to the measured point. more specifically one has a measurement vector x irn with covariance matrix estimation projective transformations a set of parameters are represented as a vector p irm a mapping f irm irn is defined. the range of this mapping is least locally the model surface s in irn representing the set of allowable measurements. the cost function to be minimized is the squared mahalanobis distance f f f in effect we are attempting to find a set of parameters p such that f x or failing that to bring f as close to x as possible with respect to mahalanobis distance. the levenberg marquardt algorithm is a general tool for iterative minimization when the cost function to be minimized is of this type. we will now show how the various different types of cost functions described in this chapter fit into this format. error in one image. here one fixes the coordinates of points xi in the first image and varies h so as to minimize cost function namely i h i the measurement vector x is made up of the inhomogeneous coordinates of the points i. one may choose as parameters the vector h of entries of the homography matrix h. the function f is defined by f h xn where it is understood that here and in the functions below hxi indicates the inhomogeneous coordinates. one verifies that f is equal to symmetric transfer error. in the case of the symmetric cost function dxi h i i one chooses as measurement vector x the made up of the inhomogeneous coordinates of the points xi followed by the inhomogeneous coordinates of the points i. the parameter vector as before is the vector h of entries of h and the function f is defined by f h n xn. as before we find that f is equal to reprojection error. minimizing the cost function is more complex. the difficulty is that it requires a simultaneous minimization over all choices of points xi as well as the entries of the transformation matrix h. if there are many point correspondences then this becomes a very large minimization problem. thus the problem may be parametrized by the coordinates of the points xi and the entries of the matrix h a total of parameters. the coordinates of i are not required since they are related to the other parameters by i h xi. the parameter vector is therefore p xn. the measurement vector contains the inhomogeneous coordinates of all the points xi and iterative minimization methods i. the function f is defined by xn n f xn i h xi. one verifies that f with x a is equal to the cost where function this cost function must be minimized over all parameters. sampson approximation. in contrast with parameters of reprojection error minimizing the error in one image or symmetric transfer error requires a minimization over the entries of the matrix h only in general a more tractable problem. the sampson approximation to reprojection error enables reprojection error also to be minimized with only parameters. this is an important consideration since the iterative solution of an m-parameter non-linear minimization problem using a method such as levenberg marquardt involves the solution of an m m set of linear equations at each iteration step. this is a problem with complexity hence it is appropriate to keep the size of m low. the sampson error avoids minimizing over the parameters of reprojection error because effectively it determines the variables xi for each particular choice of h. consequently the minimization then only requires the parameters of h. in practice this approximation gives excellent results provided the errors are small compared to the measurements. initialization an initial estimate for the parametrization may be found by employing a linear technique. for example the normalized dlt algorithm directly provides h and thence the h used to parametrize the iterative minimization. in general if there are n correspondences then all will be used in the linear solution. however as will be seen in section on robust estimation when the correspondences contain outliers it may be advisable to use a carefully selected minimal set of correspondences four correspondences. linear techniques or minimal solutions are the two initialization techniques recommended in this book. an alternative method that is sometimes used instance see is to carry out a sufficiently dense sampling of parameter space iterating from each sampled starting point and retaining the best result. this is only possible if the dimension of the parameter space is sufficiently small. sampling of parameter space may be done either randomly or else according to some pattern. another initialization method is simply to do without any effective initialization at all starting the iteration at a given fixed point in parameter space. this method is not often viable. iteration is very likely to fall into a false minimum or not converge. even in the best case the number of iteration steps required will increase the further one starts from the final solution. for this reason using a good initialization method is the best plan. estimation projective transformations objective given n image point correspondences estimate h of the homography mapping between the images. the mle involves also solving for a set of subsidiary points xi which minimize i determine the maximum likelihood dxi i where algorithm i h xi. i geometric minimization of either sampson error initialization compute an initial estimate of h to provide a starting point for the geometric minimization. for example use the linear normalized dlt algorithm or use ransac to compute h from four point correspondences. minimize the sampson approximation to the geometric error the cost is minimized using the newton algorithm of section or levenberg marquardt algorithm of section over a suitable parametrization of h. for example the matrix may be parametrized by its entries. or gold standard error compute an initial estimate of the subsidiary variables xi using the measured points or the sampson correction to these points given by minimize the cost dxi i i over h and xi i n. the cost is minimized using the levenberg marquardt algorithm over variables for the n points xi and for the homography matrix h. if the number of points is large then the sparse method of minimizing this cost func tion given in section is the recommended approach. algorithm the gold standard algorithm and variations for estimating h from image correspondences. the gold standard algorithm is preferred to the sampson method for homography computation. iteration methods there are various iterative methods for minimizing the chosen cost function of which the most popular are newton iteration and the levenberg marquardt method. these methods are described in appendix other general methods for minimizing a cost function are available such as powell s method and the simplex method both described in summary. the ideas in this section are collected together in algorithm which describes the gold standard and sampson methods for estimating the homography mapping between point correspondences in two images. experimental comparison of the algorithms a b c fig. three images of a plane which are used to compare methods of computing projective transformations from corresponding points. method pair figure a b pair figure a c linear normalized gold standard linear unnormalized homogeneous scaling sampson error in view affine theoretical optimal table residual errors in pixels for the various algorithms. experimental comparison of the algorithms the algorithms are compared for the images shown in figure table shows the results of testing several of the algorithms described in this chapter. residual error is shown for two pairs of images. the methods used are fairly self-explanatory with a few exceptions. the method affine was an attempt to fit the projective transformation with an optimal affine mapping. the optimal is the ml estimate assuming a noise level of one pixel. the first pair of images are and of figure with point correspondences. it appears that all methods work almost equally well the affine method. the optimal residual is greater than the achieved results because the noise level is less than one pixel. image of figure was produced synthetically by resampling and the second pair consists of and with point correspondences. in this case almost all methods perform almost optimally as shown in the table the exception is the affine method to perform badly since it is not an affine transformation and the unnormalized linear method. the unnormalized method is expected to perform badly maybe not this badly. just why it performs well in the first pair and very badly for the second pair is not understood. in any case it is best to avoid this method and use a normalized linear or gold standard method. a further evaluation is presented in figure the transformation to be estimated is the one that maps the chessboard image shown here to a square grid aligned with the estimation projective transformations r o r r e l a u d i s e r r o r r e l a u d i s e r number of points b noise level noise level d r o r r e l a u d i s e r a c fig. comparison of the dlt and gold standard algorithms to the theoretically optimal residual error. the homography is computed between a chessboard and this image. in all three graphs the result for the gold standard algorithm overlap and are indistinguishable from the theoretical minimum. residual error as a function of the number of points. the effect of varying noise level for points and points. axes. as may be seen the image is substantially distorted with respect to a square grid. for the experiments randomly selected points in the image were chosen and matched with the corresponding point on the square grid. the dlt algorithm and the gold standard algorithm are compared to the theoretical minimum or residual error chapter note that for noise up to pixels the dlt algorithm performs adequately. however for a noise level of pixels it fails. note however that in a image an error of pixels is extremely high. for less severe homographies closer to the identity map the dlt performs almost as well as the gold standard algorithm. robust estimation up to this point it has been assumed that we have been presented with a set of correspondences where the only source of error is in the measurement of the point s position which follows a gaussian distribution. in many practical situations this assumption is not valid because points are mismatched. the mismatched points are outliers to the gaussian error distribution. these outliers can severely disturb the i robust estimation c a d b b a fig. robust line estimation. the solid points are inliers the open points outliers. a leastsquares regression fit to the point data is severely affected by the outliers. in the ransac algorithm the support for lines through randomly selected point pairs is measured by the number of points within a threshold distance of the lines. the dotted lines indicate the threshold distance. for the lines shown the support is for line both of the points a and b are inliers and for line where the point c is an outlier. estimated homography and consequently should be identified. the goal then is to determine a set of inliers from the presented correspondences so that the homography can then be estimated in an optimal manner from these inliers using the algorithms described in the previous sections. this is robust estimation since the estimation is robust to outliers following a different and possibly unmodelled error distribution. ransac we start with a simple example that can easily be visualized estimating a straight line fit to a set of points. this can be thought of as estimating a affine transformation x ax b between corresponding points lying on two lines. the problem which is illustrated in figure is the following given a set of data points find the line which minimizes the sum of squared perpendicular distances regression subject to the condition that none of the valid points deviates from this line by more than t units. this is actually two problems a line fit to the data and a classification of the data into inliers points and outliers. the threshold t is set according to the measurement noise example t and is discussed below. there are many types of robust algorithms and which one to use depends to some extent on the proportion of outliers. for example if it is known that there is only one outlier then each point can be deleted in turn and the line estimated from the remainder. here we describe in detail a general and very successful robust estimator the random sample consensus algorithm of fischler and bolles the ransac algorithm is able to cope with a large proportion of outliers. the idea is very simple two of the points are selected randomly these points define a line. the support for this line is measured by the number of points that lie within a distance threshold. this random selection is repeated a number of times and the line with most support is deemed the robust fit. the points within the threshold distance are the inliers constitute the eponymous consensus set. the intuition is that if one of the points is an outlier then the line will not gain much support see figure estimation projective transformations furthermore scoring a line by its support has the additional advantage of favouring better fits. for example the line in figure has a support of whereas the line where the sample points are neighbours has a support of only consequently even though both samples contain no outliers the line will be selected. more generally we wish to fit a model in this case a line to data and the random sample consists of a minimal subset of the data in this case two points sufficient to determine the model. if the model is a planar homography and the data a set of point correspondences then the minimal subset consists of four correspondences. the application of ransac to the estimation of a homography is described below. as stated by fischler and bolles the ransac procedure is opposite to that of conventional smoothing techniques rather than using as much of the data as possible to obtain an initial solution and then attempting to eliminate the invalid data points ransac uses as small an initial data set as feasible and enlarges this set with consistent data when possible the ransac algorithm is summarized in algorithm three questions immedi ately arise objective robust fit of a model to a data set s which contains outliers. algorithm randomly select a sample of s data points from s and instantiate the model from this subset. determine the set of data points si which are within a distance threshold t of the model. the set si is the consensus set of the sample and defines the inliers of s. if the size of si number of inliers is greater than some threshold t re-estimate the model using all the points in si and terminate. if the size of si is less than t select a new subset and repeat the above. after n trials the largest consensus set si is selected and the model is re-estimated using all the points in the subset si. algorithm the ransac robust estimation algorithm adapted from a minimum of s data points are required to instantiate the free parameters of the model. the three algorithm thresholds t t and n are discussed in the text. what is the distance threshold? we would like to choose the distance threshold t such that with a probability the point is an inlier. this calculation requires the probability distribution for the distance of an inlier from the model. in practice the distance threshold is usually chosen empirically. however if it is assumed that the measurement error is gaussian with zero mean and standard deviation then a value for t may be computed. in this case the square of the point distance is a sum of squared gaussian variables and follows a m distribution with m degrees of freedom where m equals the codimension of the model. for a line the codimension is only the perpendicular distance to the line is measured. if the model is a point the codimension is and the square of the distance is the sum of squared x and y measurement errors. robust estimation the probability that the value of a mulative chi-squared distribution are described in section from the cumulative distribution m random variable is less than is given by the cum both of these distributions inlier outlier with f m usually is chosen as so that there is a probability that the point is an inlier. this means that an inlier will only be incorrectly rejected of the time. values of t for and for the models of interest in this book are tabulated in table codimension m model line fundamental matrix homography camera matrix trifocal tensor table the distance threshold f spondence is an inlier. m for a probability of that the point how many samples? it is often computationally infeasible and unnecessary to try every possible sample. instead the number of samples n is chosen sufficiently high to ensure with a probability p that at least one of the random samples of s points is free from outliers. usually p is chosen at suppose w is the probability that any selected data point is an inlier and thus w is the probability that it is an outlier. then at least n selections of s points are required where wsn p so that n p table gives examples of n for p for a given s and sample size proportion of outliers s table the number n of samples required to ensure with a probability p that at least one sample has no outliers for a given size of sample s and proportion of outliers example for the line-fitting problem of figure there are n data points of estimation projective transformations which two are outliers so that from table for a minimal subset of size s at least n samples are required. this should be compared with the cost of exhaustively trying every point pair in which case samples are required notation means the number of choices of among n specifically nn note the number of samples is linked to the proportion rather than number of outliers. this means that the number of samples required may be smaller than the number of outliers. consequently the computational cost of the sampling can be acceptable even when the number of outliers is large. the number of samples increases with the size of the minimal subset a given and p. it might be thought that it would be advantageous to use more than the minimal subset three or more points in the case of a line because then a better estimate of the line would be obtained and the measured support would more accurately reflect the true support. however this possible advantage in measuring support is generally outweighed by the severe increase in computational cost incurred by the increase in the number of samples. how large is an acceptable consensus set? a rule of thumb is to terminate if the size of the consensus set is similar to the number of inliers believed to be in the data set given the assumed proportion of outliers i.e. for n data points t for the line-fitting example of figure a conservative estimate of is so that t determining the number of samples adaptively. it is often the case that the fraction of data consisting of outliers is unknown. in such cases the algorithm is initialized using a worst case estimate of and this estimate can then be updated as larger consistent sets are found. for example if the worst case guess is and a consensus set with of the data is found as inliers then the updated estimate is this idea of probing the data via the consensus sets can be applied repeatedly in order to adaptively determine the number of samples n. to continue the example above the worst case estimate of determines an initial n according to when a consensus set containing more than of the data is found we then know that there is at least that proportion of inliers. this updated estimate of determines a reduced n from this update is repeated at each sample and whenever a consensus set with lower than the current estimate is found then n is again reduced. the algorithm terminates as soon as n samples have been performed. it may occur that a sample is found for which determines an n less than the number of samples that have already been performed. in such a case sufficient samples have been performed and the algorithm terminates. in pseudo-code the adaptive computation of n is summarized in algorithm this adaptive approach works very well and in practice covers the questions of both robust estimation n sample count while n sample count repeat choose a sample and count the number of inliers. set of inlierstotal number of points set n from and with p increment the sample count by terminate. algorithm adaptive algorithm for determining the number of ransac samples. c d b a a c d b a b fig. robust ml estimation. the grey points are classified as inliers to the line. a line defined by points has a support of four points b c d. the ml line fit least-squares to the four points. this is a much improved fit over that defined by points are classified as inliers. the number of samples and terminating the algorithm. the initial can be chosen as in which case the initial n will be infinite. it is wise to use a conservative probability p such as in table on page gives example s and n s when computing a homography. robust maximum likelihood estimation the ransac algorithm partitions the data set into inliers largest consensus set and outliers rest of the data set and also delivers an estimate of the model computed from the minimal set with greatest support. the final step of the ransac algorithm is to re-estimate the model using all the inliers. this re-estimation should be optimal and will involve minimizing a ml cost function as described in section in the case of a line ml estimation is equivalent to orthogonal regression and a closed form solution is available. in general though the ml estimation involves iterative minimization and the minimal set estimate provides the starting point. the only drawback with this procedure which is often the one adopted is that the inlier outlier classification is irrevocable. after the model has been optimally fitted to the consensus set there may well be additional points which would now be classified as inliers if the distance threshold was applied to the new model. for example suppose the line in figure was selected by ransac. this line has a support of four points all inliers. after the optimal fit to these four points there are now points which would correctly be classified as inliers. these two steps optimal fit to inliers reclassify inliers using can then be iterated until the number of inliers converges. estimation projective transformations a least-squares fit with inliers weighted by their distance to the model is often used at this stage. robust cost function. an alternative to minimizing c minimize a robust version including all data. a suitable robust cost function is i i over the inliers is to i d i with inlier outlier here d i are point errors and is a robust cost function where outliers are given a fixed cost. the motivation for the threshold is the same as that of where is defined. the quadratic cost for inliers arises from the gaussian error model as described in section the constant cost for outliers in the robust cost function arises from the assumption that outliers follow a diffuse or uniform distribution the loglikelihood of which is a constant. it might be thought that outliers could be excluded from the cost function by simply thresholding on d i. the problem with thresholding alone is that it would result in only outliers being included because they would incur no cost. the cost function d allows the minimization to be conducted on all points whether they are outliers or inliers. at the start of the iterative minimization d differs from c only by a constant by times the number of outliers. however as the minimization progresses outliers can be redesignated inliers and this typically occurs in practice. a discussion and comparison of cost functions is given in appendix other robust algorithms in ransac a model instantiated from a minimal set is scored by the number of data points within a threshold distance. an alternative is to score the model by the median of the distances to all points in the data. the model with least median is then selected. this is least median of squares estimation where as in ransac minimum size subset samples are selected randomly with the number of samples obtained from the advantage of lms is that it requires no setting of thresholds or a priori knowledge of the variance of the error. the disadvantage of lms is that it fails if more than half the data is outlying for then the median distance will be to an outlier. the solution is to use the proportion of outliers to determine the selection distance. for example if there are outliers then a distance below the median value quartile say should be used. both the ransac and lms algorithms are able to cope with a large proportion of outliers. if the number of outliers is small then other robust methods may well be more efficient. these include case deletion where each point in turn is deleted and the model fitted to the remaining data and iterative weighted least-squares where a data point s influence on the fit is weighted inversely by its residual. generally these methods are not recommended. both torr and xu and zhang describe and compare various robust estimators for estimating the fundamental matrix. automatic computation of a homography objective compute the homography between two images. algorithm interest points compute interest points in each image. putative correspondences compute a set of interest point matches based on proxim ity and similarity of their intensity neighbourhood. ransac robust estimation repeat for n samples where n is determined adap tively as in algorithm select a random sample of correspondences and compute the homography h. calculate the distance d for each putative correspondence. compute the number of inliers consistent with h by the number of correspon dences for which d t pixels. choose the h with the largest number of inliers. in the case of ties choose the solution that has the lowest standard deviation of inliers. optimal estimation re-estimate h from all correspondences classified as inliers by minimizing the ml cost function using the levenberg marquardt algorithm of section guided matching further interest point correspondences are now determined using the estimated h to define a search region about the transferred point position. the last two steps can be iterated until the number of correspondences is stable. algorithm automatic estimation of a homography between two images using ransac. automatic computation of a homography this section describes an algorithm to automatically compute a homography between two images. the input to the algorithm is simply the images with no other a priori information required and the output is the estimated homography together with a set of interest points in correspondence. the algorithm might be applied for example to two images of a planar surface or two images acquired by rotating a camera about its centre. the first step of the algorithm is to compute interest points in each image. we are then faced with a chicken and egg problem once the correspondence between the interest points is established the homography can be computed conversely given the homography the correspondence between the interest points can easily be established. this problem is resolved by using robust estimation here ransac as a search engine the idea is first to obtain by some means a set of putative point correspondences. it is expected that a proportion of these correspondences will in fact be mismatches. ransac is designed to deal with exactly this situation estimate the homography and also a set of inliers consistent with this estimate true correspondences and outliers mismatches. the algorithm is summarized in algorithm with an example of its use shown in figure and the steps described in more detail below. algorithms with essentially the same methodology enable the automatic computation of the fundamental matrix and trifocal tensor directly from image pairs and triplets respectively. this computation is described in chapter and chapter estimation projective transformations determining putative correspondences. the aim in the absence of any knowledge of the homography is to provide an initial point correspondence set. a good proportion of these correspondences should be correct but the aim is not perfect matching since ransac will later be used to eliminate the mismatches. think of these as seed correspondences. these putative correspondences are obtained by detecting interest points independently in each image and then matching these interest points using a combination of proximity and similarity of intensity neighbourhoods as follows. for brevity the interest points will be referred to as corners however these corners need not be images of physical corners in the scene. the corners are defined by a minimum of the image auto-correlation function. for each corner at y in image the match with highest neighbourhood crosscorrelation in image is selected within a square search region centred on y. symmetrically for each corner in image the match is sought in image occasionally there will be a conflict where a corner in one image is claimed by more than one corner in the other. in such cases a winner takes all scheme is applied and only the match with highest cross-correlation is retained. a variation on the similarity measure is to use squared sum of intensity differences instead of cross-correlation cc is invariant to the affine mapping of the intensity values i i scaling plus offset which often occurs in practice between images. ssd is not invariant to this mapping. however ssd is often preferred when there is small variation in intensity between images because it is a more sensitive measure than cc and is computationally cheaper. ransac for a homography. the ransac algorithm is applied to the putative correspondence set to estimate the homography and the correspondences which are consistent with this estimate. the sample size is four since four correspondences determine a homography. the number of samples is set adaptively as the proportion of outliers is determined from each consensus set as described in algorithm there are two issues what is the distance in this case? and how should the samples be selected? distance measure the simplest method of assessing the error of a correspondence from a homography h is to use the symmetric transfer error i.e. transfer dx h is the point dence. a better though more expensive distance measure is the reprojection error dx h x is the perfect correspondence. this measure is more expensive because x must also be computed. a further alternative is sampson error. where x where sample selection there are two issues here. first degenerate samples should be disregarded. for example if three of the four points are collinear then a homography cannot be computed second the sample should consist of points with a good spatial distribution over the image. this is because of the extrapolation problem an estimated homography will accurately map the region straddled by the computation points but the accuracy generally deteriorates automatic computation of a homography with distance from this region of four points in the very top corner of the image. distributed spatial sampling can be implemented by tiling the image and ensuring by a suitable weighting of the random sampler that samples with points lying in different tiles are the more likely. robust ml estimation and guided matching. the aim of this final stage is twofold first to obtain an improved estimate of the homography by using all the inliers in the estimation than only the four points of the sample second to obtain more inlying matches from the putative correspondence set because a more accurate homography is available. an improved estimate of the homography is then computed from the inliers by minimizing an ml cost function. this final stage can be implemented in two ways. one way is to carry out an ml estimation on the inliers then recompute the inliers using the new estimated h and repeat this cycle until the number of inliers converges. the ml cost function minimization is carried out using the levenberg marquardt algorithm described in section the alternative is to estimate the homography and inliers simultaneously by minimizing a robust ml cost function of as described in section the disadvantage of the simultaneous approach is the computational effort incurred in the minimization of the cost function. for this reason the cycle approach is usually the more attractive. application domain the algorithm requires that interest points can be recovered fairly uniformly across the image and this in turn requires scenes and resolutions which support this requirement. scenes should be lightly textured images of blank walls are not ideal. the search window proximity constraint places an upper limit on the image motion of corners disparity between views. however the algorithm is not defeated if this constraint is not applied and in practice the main role of the proximity constraint is to reduce computational complexity as a smaller search window means that fewer corner matches must be evaluated. ultimately the scope of the algorithm is limited by the success of the corner neighbourhood similarity measure or cc in providing disambiguation between correspondences. failure generally results from lack of spatial invariance the measures are only invariant to image translation and are severely degraded by transformations outside this class such as image rotation or significant differences in foreshortening between images. one solution is to use measures with a greater invariance to the homography mapping between images for example measures which are rotationally invariant. an alternative solution is to use an initial estimate of the homography to map between intensity neighbourhoods. details are beyond the scope of this discussion but are provided in the use of robust estimation confers moderate immunity to independent motion changes in shadows partial occlusions etc. estimation projective transformations a c e g b d f h fig. automatic computation of a homography between two images using ransac. the motion between views is a rotation about the camera centre so the images are exactly related by a homography. left and right images of keble college oxford. the images are pixels. detected corners superimposed on the images. there are approximately corners on each image. the following results are superimposed on the left image putative matches shown by the line linking corners note the clear mismatches outliers of the putative matches inliers correspondences consistent with the estimated h final set of correspondences after guided matching and mle. closure implementation and run details interest points are obtained using the harris corner detector. this detector localizes corners to sub-pixel accuracy and it has been found empirically that the correspondence error is usually less than a pixel when obtaining seed correspondences in the putative correspondence stage of the algorithm the threshold on the neighbourhood similarity measure for match acceptance is deliberately conservative to minimize incorrect matches ssd threshold is for the guided matching stage this threshold is relaxed is doubled so that additional putative correspondences are available. number of inliers adaptive n table the results of the adaptive algorithm used during ransac to compute the homography for figure n is the total number of samples required as the algorithm runs for p probability of no outliers in the sample. the algorithm terminated after samples. for the example of figure the images are pixels and the search window pixels i.e. the entire image. of course a much smaller search window could have been used given the actual point disparities in this case. often in video sequences a search window of pixels suffices a square of side centred on the current position. the inlier threshold was t pixels. a total of samples were required with the sampling run as shown in table the guided matching required two iterations of the mle inlier classification cycle. the rms values for d pixel error were before the mle and after. the levenberg marquardt algorithm required iterations. closure this chapter has illustrated the issues and techniques that apply to estimating the tensors representing multiple view relations. these ideas will reoccur in each of the computation chapters throughout the book. in each case there are a minimal number of correspondences required degenerate configurations that should be avoided algebraic and geometric errors that can be minimized when more than the minimal number of correspondences are available parametrizations that enforce internal constraints on the tensor etc. the literature the dlt algorithm dates back at least to sutherland sampson s classic paper on conic fitting improvement on the equally classic bookstein algorithm estimation projective transformations appeared in normalization was made public in the computer vision literature by hartley related reading on numerical methods may be found in the excellent numerical recipes in c and also gill and murray for iterative minimization. fischler and bolles ransac was one of the earliest robust algorithms and in fact was developed to solve a computer vision problem from points. the original paper is very clearly argued and well worth reading. other background material on robustness may be found in rousseeuw the primary application of robust estimation in computer vision was to estimating the fundamental matrix by torr and murray using ransac and zhang et al. using lms. the automatic ml estimation of a homography was described by torr and zisserman notes and exercises computing homographies of ipn. the derivation of and assumed that the dimension of i is three so that the cross-product is defined. however may be derived in a way that generalizes to all dimensions. assuming that w i we may solve for the unknown scale factor explicitly by writing hxi kxi yi from the third coordinate we obtain k and substituting this into the original equation gives x i y i which leads directly to computing homographies for ideal points. i is an ideal point so that w i then the pair of equations collapses to a single equation although does contain two independent equations. to avoid such degeneracy while including only the minimum number of equations a good way to proceed is as follows. we may rewrite the equation i hxi as if one of the points hxi i is a matrix with rows orthogonal to i each leads to a separate linear equation in the entries of h. the matrix may be obtained by deleting the first row of an orthogonal matrix m satisi t. a householder matrix section where i row of i i fying is an easily constructed matrix with the desired property. i so that i scaling unbounded point sets. in the case of points at or near infinity in a plane it is neither reasonable nor feasible to normalize coordinates using the isotropic non-isotropic scaling schemes presented in this chapter since the centroid and scale are infinite or near infinite. a method that seems to give good results is to normalize the set of points xi yi wit such that i i i yi i i i xi i i i i i closure note that the coordinates xi and yi appearing here are the homogeneous coordinates and the conditions no longer imply that the centroid is at the origin. investigate methods of achieving this normalization and evaluate its properties. transformation invariance of dlt. we consider computation of a homography by minimizing algebraic error subject to various constraints. prove the following cases if is minimized subject to the constraint then the result is invariant under change of scale but not translation of coordinates. if instead the constraint is then the result is similarity invariant. affine case the same is true for the constraint expressions for image coordinate derivatives. for the map y are the inhomogeneous coordinates of the image point hx derive the following expressions y w y x derivative wrt x x where hj t is the j th row of h. derivative wrt h with h as defined in h x y x xt xt y sampson error with non-isotropic error distributions. the derivation of sampson error in section assumed that points were measured with circular error distributions. in the case where the point x y x is measured with covariance matrix x it is appropriate instead to minimize the mahalanobis norm x x. show that in this case the formulae corresponding to and are x xjtj xjt x t x y and x xj t note that if the measurements in the two images are independent then the covariance matrix x will be block-diagonal with two diagonal blocks corresponding to the two images. sampson error programming hint. in the case of homography estimation and in fact every other similar problem considered in this book the cost function chx axh of section is multilinear in the coordinates estimation projective transformations objective given n image point correspondences which minimizes reprojection error in both images i determine the affine homography ha algorithm express points as inhomogeneous translate the points xi by a translation t i by a translation so that their centroid is at the origin. do the same to the points henceforth work with the translated coordinates. form the n matrix a whose rows are the vectors xt i i i t yi x i y i. let and be the right singular-vectors of a corresponding to the two largest let cb where b and c are the blocks such that singular values. the required homography is b c ha and the corresponding estimate of the image points is given by algorithm the gold standard algorithm for estimating an affine homography ha from image correspondences. of x. this means that the partial derivative chx x may be very simply computed. for instance the derivative chx y x y x chx y x y chx y x y is exact not a finite difference approximation. this means that for programming purposes one does not need to code a special routine for taking derivatives the routine for computing chx will suffice. denoting by ei the vector containing in the i-th position and otherwise one sees that chx xi chx ei chx and further jjt ei chx ei chx t i also note that computationally it is more efficient to solve jjt directly for rather than take the inverse as minimizing geometric error for affine transformations. given a set of correspondences yi i find an affine transformation ha that minimizes geometric error we will step through the derivation of a linear algorithm based on sampson s approximation which is exact in this case. the complete method is summarized in algorithm i y closure show that the optimum affine transformation takes the centroid of the xi to the centroid of i so by translating the points to have their centroid at the origin the translation part of the transformation is determined. it is only necessary then to determine the upper-left submatrix of ha which represents the linear part of the transformation. tt lies on vh if and only if the point xi so vh is a subspace of any subspace may be expressed as ix for suitable thus given measurements xi the estimation task is equivalent to finding the best-fitting subspace. i i given a matrix m with rows xt i the best-fitting subspace to the xi is spanned by the singular vectors and corresponding to the two largest singular values of m. by solving the equations the corresponding to the subspace spanned by and is found computing homographies of from line correspondences. consider computing a homography h from lines correspondences alone assuming the lines are in general position in there are two questions how many correspondences are required? and how to formulate the algebraic constraints to obtain a solution for h? it might be thought that four line correspondences would be sufficient because each line in has four degrees of freedom and thus four lines should provide constraints on the degrees of freedom of h. however a configuration of four lines is degenerate section for computing the transformation as there is a isotropy subgroup. this is discussed further in equations linear in h can be obtained in the following way t i hxj i j where h transfers a line defined by the two points to a line defined by the intersection of the two planes this method was derived in where more details are to be found. algorithm evaluation and error analysis this chapter describes methods for assessing and quantifying the results of estimation algorithms. often it is not sufficient to simply have an estimate of a variable or transformation. instead some measure of confidence or uncertainty is also required. two methods for computing this uncertainty are outlined here. the first is based on linear approximations and involves concatenating various jacobian expressions. the second is the easier to implement monte carlo method. bounds on performance once an algorithm has been developed for the estimation of a certain type of transformation it is time to test its performance. this may be done by testing it on real or on synthetic data. in this section testing on synthetic data will be considered and a methodology for testing will be sketched. we recall the notational convention a quantity such as x represents a measured image point. estimated quantities are represented by a hat such as x or h. true values are represented by a bar such as x or h. typically testing will begin with the synthetic generation of a set of image correspondences xi i between two images. the number of such correspondences will vary. corresponding points will be chosen in such a way that they correspond via a given fixed projective transformation h and the correspondence is exact in the sense that i h xi precisely up to machine accuracy. next artificial gaussian noise will be added to the image measurements by perturbing both the x- and y-coordinates of the point by a zero-mean gaussian random variable with known variance. the resulting noisy points are denoted xi and i. a suitable gaussian random number generator is given in the estimation algorithm is then run to compute the estimated quantity. for the projective transformation problem considered in chapter this means the projective transformation itself and also perhaps estimates of the correct original noise-free image points. the algorithm is then evaluated according to how closely the computed model matches the input data or alternatively how closely the estimated model agrees with the original bounds on performance noise-free data. this procedure should be carried out many times with different noise a different seed for the random number generator though each time with the same noise variance in order to obtain a statistically meaningful performance evaluation. error in one image to illustrate this we continue our investigation of the problem of homography estimation. for simplicity we consider the case where noise is added to the coordinates of the second image only. thus xi xi for all i. let xi i be a set of noisy matched points between two images generated from a perfectly matched set of data by injection of gaussian noise with variance in each of the two coordinates of the second image. let there be n such matched points. from this data a projective transformation h is estimated using any one of the algorithms described in chapter obviously the estimated transformation h will not generally map xi to i nor xi to precisely because of the injected noise in the coordinates of i i. the rms residual error i measures the average difference between the noisy input data i and the estimated points i h xi. it is therefore appropriately called residual error. it measures how well the computed transformation matches the input data and as such is a suitable quality measure for the estimation procedure. the value of the residual error is not in itself an absolute measure of the quality of the solution obtained. for instance consider the projectivity problem in the case where the input data consists of just matched points. since a projective transformation is defined uniquely and exactly by point correspondences any reasonable algorithm will compute an h that matches the points exactly in the sense that i hxi. this means that the residual error is zero. one cannot expect any better performance from an algorithm than this. i and not to the original noise-free data i. in fact since the difference between the noise-free and the noisy coordinates has variance in the minimal four-point case the residual difference between projected points hxi and the noise-free data i also has variance thus in the case of points the model fits the noisy input data perfectly the residual is zero but does not give a very close approximation to the true noise-free values. note that h matches the projected points to the input data with more than point matches the value of the residual error will increase. in fact intuitively one expects that as the number of measurements points increases the estimated model should agree more and more closely with the noise-free true values. asymptotically the variance should decrease in inverse proportion to the number of point matches. at the same time the residual error will increase. algorithm evaluation and error analysis p f x fig. as the values of the parameters p vary the function image traces out a surface sm through the true value x. error in both images in the case of error in both images the residual error is dxi i are estimated points such that i h xi. where xi and i optimal estimators bounds for estimation performance will be considered in a general framework and then specialized to the two cases of error in one or both images. the goal is to derive formulae for the expected residual error of the maximum likelihood estimate as described previously minimization of geometric error is equivalent to mle and so the goal of any algorithm implementing minimization of geometric error should be to achieve the theoretical bound given for the mle. another algorithm minimizing a different cost function as algebraic error can be judged according to how close it gets to the bound given by the mle. a general estimation problem is concerned with a function f from irm to irn as described in section where irm is a parameter space and irn is a space of measurements. consider now a point x irn for which there exists a vector of parameters p irm such that f x a point x in the range of f with preimage p. in the context of projectivities with measurements in the second image only this corresponds to a noise-free set of points i h xi. the x- and y-components of the n points i i n constitute the n-vector x with n and the parameters of the homography constitute the vector p which may be an or depending on the parametrization of h. let x be a measurement vector chosen according to an isotropic gaussian distribution with mean the true measurement x and variance n notation means that each of the n components has variance as the value of the parameter vector p varies in a neighbourhood of the point p the value of the function f traces out a surface sm in irn through the point x. this is illustrated in figure the surface sm bounds on performance n x x x s fig. geometry of the errors in measurement space using the tangent plane approximation to sm. the estimated point is the closest point on sm to the measured point x. the residual error is the distance between the measured point x and the estimation error is the distance from to the true point x. the point on sm closest to x. the ml estimator is the one that returns this closest point is given by the range of f. the dimension of the surface as a submanifold of irn is equal to d where d is the number of essential parameters is the number of degrees of freedom or minimum number of parameters. in the single-image error case this equals since the mapping determined by the matrix h is independent of scale. now given a measurement vector x the maximum likelihood estimate is to x that lies on this surface. denote this ml estimate by is the foot of the perpendicular from x onto the tangent plane. the residual error is the distance from the point x to the estimated value furthermore the distance from to unknown x is the distance from the optimally estimated value to the true we now assume that in the neighbourhood of x the surface is essentially planar and is well approximated by the tangent surface at least for neighbourhoods around x of the order of magnitude of noise variance. in this linear approximation the ml estimate value as seen in figure our task is to compute the expected value of these errors. computing the expected ml residual error has now been abstracted to a geometric problem as follows. the total variance of an n-dimensional gaussian distribution is the trace of the covariance matrix that is the sum of variances in each of the axial directions. this is of course unchanged by a change of orthogonal coordinate frame. for an n-dimensional isotropic gaussian distribution with independent variances in each variable the total variance is n now given an isotropic gaussian random variable defined on irn with total variance n and mean the true point x we wish to compute the expected distance of the random variable from a dimension d hyperplane passing through x. the projection of a gaussian random variable in irn onto the d-dimensional tangent plane gives the distribution of the estimation error difference between the estimated value and the true result. projection onto the algorithm evaluation and error analysis d-dimensional normal to the tangent surface gives the distribution of the residual error. by a rotation of axes if necessary one may assume without loss of generality that integration over the the tangent surface coincides with the first d coordinate axes. remaining axial directions provides the following result. result the projection of an isotropic gaussian distribution defined on irn with total variance n onto a subspace of dimension s is an isotropic gaussian distribution with total variance s the proof of this is straightforward and is omitted. we apply this in the two cases where s d and s n d to obtain the following results. result consider an estimation problem where n measurements are to be modelled by a function depending on a set of d essential parameters. suppose the measurements are subject to independent gaussian noise with standard deviation in each measurement variable. the rms residual error of the measured from the estimated value for the ml estimator is dn the rms estimation error of the estimated from the true value for the ml estimator is where x and x are respectively the measured estimated and true values of the measurement vector. result follows directly from result by dividing by n to get the variance per measurement then taking a square root to get standard deviation instead of variance. these values give lower bounds for residual error against which a particular estima tion algorithm may be measured. homography error in one image. for the projectivity estimation problem considered in this chapter assuming error in the second image only we have d and n where n is the number of point matches. thus we have for this problem graphs of these errors as n varies are shown in figure bounds on performance r o r r e l a u d i s e r r o r r e l a u d i s e r number of points a number of points b fig. optimal error when noise is present in one image and in both images as the number of points varies. an error level of one pixel is assumed. the descending curve shows the estimation error and the ascending curve shows the residual error error in both images. in this case n and d as before assuming linearity of the tangent surface in the neighbourhood of the true measurement vector result gives the following expected errors. n n graphs of these errors as n varies are also shown in figure an interesting observation to be made from this graph is that the asymptotic error and not as in the case of error in one image. with respect to the true values is this result is expected since in effect one has two measurements of the position of each point one in each image related by the projective transformation. with two measurements of a point the variance in the estimate of the point position decreases by a factor of by contrast in the previous case where errors occur in one image only one has one exact measurement for each point in the first image. thus as the transformation h is estimated with greater and greater accuracy the exact position of the point in the second image becomes known with uncertainty asymptotically approaching mahalanobis distance. the formulae quoted above were derived under the assumption that the error distribution in measurement space was an isotropic gaussian distribution meaning that errors in each coordinate were independent. this assumption is not essential. we may assume any gaussian distribution of error with covariance matrix the formulae of result remain true with being replaced with the expected the standard deviation also disappears mahalanobis distance since it is taken care of by the mahalanobis distance. this follows from a simple change of coordinates in the measurement space irn in this new coordinate frame to make the covariance matrix equal to the identity. mahalanobis distance becomes the same as euclidean distance. algorithm evaluation and error analysis determining the correct convergence of an algorithm the relations given in and give a simple way of determining correct convergence of an estimation algorithm without the need to determine the number of degrees of freedom of the problem. as seen in figure the measurement space corresponding to the model specified by the parameter vector p forms a surface sm. if near the noise-free data x the surface is nearly planar then it may be approximated by its tangent plane and the three points x and x form a right-angled triangle. in most estimation problems this assumption of planarity will be very close to correct at the scale set by typical noise magnitude. in this case the pythagorean equality may be written as in evaluating an algorithm with synthetic data this equality allows a simple test to see whether the algorithm has converged to the optimal value. if the estimated value satisfies this equality then it is a strong indication that the algorithm has found the true global minimum. note that it is unnecessary in applying this test to determine the number of degrees of freedom of the problem. a few more properties are listed this test can be used to determine on a run-by-run basis whether the algorithm has succeeded. thus with repeated runs it allows an estimate of the percentage success rate for the algorithm. this test can only be used for synthetic data or at least data for which the true measurements x are known. the equality depends on the assumption that the surface sm consisting of valid measurements is locally planar. if the equality is not satisfied for a particular run of the estimation algorithm then this is because the surface is not planar or more the test is a test for the algorithm finding the global not a local solution. if likely because the algorithm is failing to find the best solution. chance if the algorithm finds the incorrect point settles to a local cost minimum then the right-hand-side of is likely to be much larger than the left-hand-side. the condition is unlikely to be satisfied entirely by covariance of the estimated transformation in the previous section the ml estimate was considered and how its expected average error may be computed. comparing the achieved residual error or estimation error of an algorithm against the ml error is a good way of evaluating the performance of a particular estimation algorithm since it compares the results of the algorithm against the best that may be achieved optimum estimate in the absence of any other prior information. nevertheless the chief concern is how accurately the transformation itself has been computed. the uncertainty of the estimated transformation depends on many factors including the number of points used to compute it the accuracy of the given point matches as well as the configuration of the points in question. to illustrate the importance of the configuration suppose the points used to compute the transformation are covariance of the estimated transformation close to a degenerate configuration then the transformation may not be computed with great accuracy. for instance if the transformation is computed from a set of points that lie close to a straight line then the behaviour of the transformation in the dimension perpendicular to that line is not accurately determined. thus whereas the achievable residual error and estimation error were seen to be dependent only on the number of point correspondences and their accuracy by contrast the accuracy of the computed transformation is dependent on the particular points. the uncertainty of the computed transformation is conveniently captured in the covariance matrix of the transformation. since h is a matrix with entries its covariance matrix will be a matrix. in this section it will be seen how this covariance matrix may be computed. forward propagation of covariance the covariance matrix behaves in a pleasantly simple manner under affine transformations as described in the following theorem. result let v be a random vector in irm with mean v and covariance matrix and suppose that f irm irn is an affine mapping defined by f f v av v. then f is a random variable with mean f v and covariance matrix a at. note that it is not assumed that a is a square matrix. instead of giving a proof of this theorem we give an example. example let x and y be independent random variables with mean and standard deviations of and respectively. what are the mean and standard deviation of x f y f next we compute the variance of x the mean is x and a is the matrix thus the variance of x is the matrix thus has standard deviation find the covariance matrix of example let x given that x and y have the same distribution as before. in this case is a at and y y y and y one computes a at in this case the matrix a have variance deviation whereas x one sees that both x are negatively correlated with covariance ex thus and y if v is a random vector in irm and f irm irn is a non-linear propagation. non-linear function acting on v then we may compute an approximation to the mean and covariance of f by assuming that f is approximately affine in the vicinity of the mean of the distribution. the affine approximation to f is f f v jv v where j is the partial derivative matrix f v evaluated at v. note that j has dimension n m. then we have the following result. result let v be a random vector in irm with mean v and covariance matrix algorithm evaluation and error analysis and let f irm irn be differentiable in a neighbourhood of v. then up to a firstorder approximation f is a random variable with mean f v and covariance j jt where j is the jacobian matrix of f evaluated at v. the extent to which this result gives a good approximation to the actual mean and variance of f v depends on how closely the function f is approximated by a linear function in a region about v commensurate in size with the support of the probability distribution of v. example let x yt be a gaussian random vector with mean and f y then one may covariance matrix let x compute the true values of the mean and standard deviation of f y according to the formulae p yf ydxdy p yf y x x where p y e is the gaussian probability distribution one obtains x applying the approximation given by result and noting that j we find that the estimated values are x thus as long as is small this is a close approximation to the correct values of the mean and variance of x the following table shows the true and approximated values for the mean and standard deviation of f y for two different values of x x estimate true for reference in the case one sees that as long as of the total distribution the value f y differs from its linear approximation by no more than covariance of the estimated transformation example more generally assuming that x and y are independent zero-mean gaussian random variables one may compute that for the function f y bxy dx ey f mean a variance x c y f x x y y x y which are close to the estimated values mean f variance x and y are small. x y as long as backward propagation of covariance the material in this and the following section is more advanced. the examples in section show the straightforward application of the results of these sections and can be read first. consider a differentiable mapping f from a parameter space irm to a measurement space irn and let a gaussian probability distribution be defined on irn with covariance matrix let sm be the image of the mapping f. we assume that m n and that sm has the same dimension m as the parameter space irm. thus we are not considering the over-parametrized case at present. a vector p in irm represents a parametrization of the point f on sm. finding the point on sm closest in mahalanobis distance to a given point x in irn defines a map from irn to the surface sm. we call this mapping irn sm. now f is by assumption invertible on the surface sm and we define f by composing the map irn sm and f sm irm we have a mapping parameters p corresponding to the ml estimate in principle we may propagate the irn irm. this mapping assigns to a measurement vector x the set of sm irm to be the inverse function. f covariance of the probability distribution in the measurement space irn to compute a covariance matrix for the set of parameters p corresponding to ml estimation. our goal is to apply result or result we consider first the case where the mapping f is an affine mapping from irm into is also an affine mapping and irn. we will show next that the mapping f compute the covariance of the estimated parameters f thereby allowing us to apply result to a specific form will be given for f since f is affine we may write f f p where f x is the mean of the probability distribution on irn since we are assuming that the surface a measurement vector x the ml estimate minimizes f sm f has dimension m the rank of j is equal to its column dimension. given thus we seek to minimize this latter quantity. however and this is minimized in section when f x p x algorithm evaluation and error analysis writing p f f and f we see that this shows that f result we see that the covariance matrix for is is affine and x f x f is its linear part. applying recalling that is symmetric. we have proved the following theorem. result backward transport of covariance affine case. let f irm irn be an affine mapping of the form f p where j has rank m. let x be a random variable in irn with mean x f and covariance matrix let parameters corresponding to the ml estimate then f irn irm be the mapping that maps a measurement x to the set of f is a random variable with mean p and covariance matrix p x j in the case where f is not affine an approximation to the mean and covariance may be obtained by approximating f by an affine function in the usual way as follows. result backward transport of covariance non-linear case. let f irm irn be a differentiable mapping and let j be its jacobian matrix evaluated at a point p. suppose that j has rank m. then f is one-to-one in a neighbourhood of p. let x be a random variable in irn with mean x f and covariance matrix x. let rameters corresponding to the ml estimate then to first-order f irn irm be the mapping that maps a measurement x to the set of paf is a random variable with mean p and covariance matrix x j over-parametrization one may generalize result and result to the case of redundant sets of parameters the over-parametrized case. in this case the mapping f from the parameter space irm to measurement space irn is not locally one-to-one. for instance in the case of estimating a homography as discussed in section there is a mapping f where p is a representing the entries of the homography matrix h. since the homography has only degrees of freedom the mapping f is not one-to-one. in particular for any constant k the matrix kh represents the same map and so the image coordinate vectors f and f are equal. in the general case of a mapping f irm irn the jacobian matrix j does not have full rank m but rather a smaller rank d m. this rank d is called the number of essential parameters. the matrix jt x j in this case has dimension m but rank covariance of the estimated transformation p s f x x fig. back propagation mapping f maps constrained parameter surface to measurement space. a measurement x is mapped a mapping to the closest point on the surface to the parameter space providing the ml estimate of the parameters. the fsp and then back via f covariance of x is transferred via f to a covariance of the parameters. clearly does not hold since the matrix d m. the formula p on the right side is not invertible. x j in fact it is clear that without any further restriction the elements of the estimated vector may vary without bound namely through multiplication by an arbitrary constant k. hence the elements have infinite variance. it is usual to restrict the estimated homography matrix h or more generally the parameter vector p by imposing some constraint. the usual constraint is that though other constraints are possible such as demanding that the last parameter should equal section thus the parameter vector p is constrained to lie on a surface in the parameter space or generally irm in the first case the surface is the unit sphere in irm. the constraint pm represents a plane in irm in the general case we may assume that the estimated vector p lies on some submanifold of irm as in the following theorem. result backward transport of covariance over-parametrized case. let f irm irn be a differentiable mapping taking a parameter vector p to a measurement vector x. let sp be a smooth manifold of dimension d embedded in irm passing through point p and such that the map f is one-to-one on the manifold sp in a neighbourhood of p mapping sp locally to a manifold f in irn the function f restricted to the surface f in a neighbourhood of has a local inverse denoted f x. let a gaussian distribution on irn be defined with mean x and covariance matrix x and let irn f be the mapping that takes a point in irn to the closest the probability point on f with respect to mahalanobis norm x. via f distribution on irn with covariance matrix x induces a probability distribution on irm with covariance matrix to first-order equal to p x ja aatjt where a is any m d matrix whose column vectors span the tangent space to sp at p. this is illustrated in figure the notation x ja defined by is dis x ja cussed further in section algorithm evaluation and error analysis proof. the proof of result is straightforward. let d be the number of essential parameters. one defines a map g ird irm mapping an open neighbourhood u in ird to an open set of sp containing the point p. then the combined mapping f g ird irn is one-to-one on the neighbourhood u. let us denote the partial derivative matrices of f by j and of g by a. the matrix of partial derivatives of f g is then ja. result now applies and one sees that the probability distribution function with covariance matrix on irn may be transported backwards to a covariance matrix on ird. transporting this forwards again to irm applying result we arrive at the covariance matrix aatjt on sp. this matrix which will be denoted here by is related to the pseudo-inverse of as defined in section the expression is not dependent on the particular choice of the matrix a as long as the column span of a is unchanged. in particular if a is replaced by ab for any invertible d d matrix b then the value of does not change. thus any matrix a whose columns span the tangent space of sp at p will do. note that the proof gives a specific way of computing a matrix a spanning the tangent space namely the jacobian matrix of g. in many instances as we will see there are easier ways of finding a. note that the covariance matrix is singular. in particular it has dimension m and rank d m. this is because the variance of the estimated parameter set in directions orthogonal to the constraint surface sp is zero there can be no variation in that direction. note that whereas jt is non-invertible the d d matrix atjt has rank d and is invertible. an important case occurs when the constraint surface is locally orthogonal to the null-space of the jacobian matrix. denote by nlx the left null-space of matrix x namely the space of all vectors x such that xtx then shown in section the pseudo-inverse x is given by x xa aatxa if and only if nla lx. the following result then derives directly from result result let f irm irn be a differentiable mapping taking p to x and let j be the jacobian matrix of f. let a gaussian distribution on irn be defined at x with irn irm as in result be the mapping covariance matrix x and let f taking a measurement x to the mle parameter vector p constrained to lie on a surface induces a distribution on sp locally orthogonal to the null-space of j. then f irm with covariance matrix to first-order equal to p x j. note that the restriction that p be constrained to lie on a surface locally orthogonal to the null-space of j is in many cases the natural constraint. for instance if p is a homogeneous parameter vector as the entries of a homogeneous matrix the restriction is satisfied for the usual constraint in such a case the constraint surface is the unit sphere and the tangent plane at any point is perpendicular to the parameter vector. on the other hand since p is a homogeneous vector the function covariance of the estimated transformation f is invariant to changes of scale and so j has a null-vector in the radial direction thus perpendicular to the constraint surface. in other cases it is often not critical what restriction we place on the parameter set for the purpose of computing the covariance matrix of the parameters. in addition since the pseudo-inversion operation is its own inverse we can retrieve the original matrix from its pseudo-inverse according to jt p. one can then compute the covariance matrix corresponding to any other subspace according to x j x ja pa where the columns of a span the constrained subspace of parameter space. application and examples error in one image. let us consider the application of this theory to the problem of finding the covariance of an estimated homography h. first we look at the case where the error is limited to the second image. the matrix h is represented by a parameter vector which will be denoted by h instead of p so as to remind us that it is made up of the entries of h. the covariance of the estimated h is a symmetric matrix. we are given a set of matched points xi i. the points xi are fixed true values and the points i are considered as random variables subject to gaussian noise with variance in each component or if desired with a more general covariance. the function f is defined as mapping a h representing a matrix h to the made up of the coordinates of the points i make up a composite vector in irn which we denote by as we have seen as h varies the point f traces out an surface sp in each point i consistent closest point with the first-image points xi. given a vector of measurements one selects the on the surface sp with respect to mahalanobis distance. the pre-image subject to constraint represents the estimated homography h f matrix h estimated using the ml estimator. from the probability distribution of values of one wishes to derive the distribution of the estimated h. the covariance matrix h is given by result this covariance matrix corresponds to the constraint thus a procedure for computing the covariance matrix of the estimated transforma on the surface represents a set of points i h xi. the coordinates of tion is as follows. estimate the transformation h from the given data. compute the jacobian matrix jf the covariance matrix of the estimated h is given by h f h evaluated at h. jf we investigate the two last steps of this method in slightly more detail. computation of the derivative matrix. j nt where ji the jacobian matrix h. this matrix has a natural decomposition into blocks so that j i h is given in i h. a formula for consider first i t jt t algorithm evaluation and error analysis xt i xt i x i xt y i xt i i ji w i i represents the vector yi i h h. an important case is when the image measurements where xt stacking these matrices on top of each other for all points xi gives the derivative matrix i are independent random vectors. in this case diag n where each i is the covariance matrix of the i-th measured point h i. then one computes j ji jt i i i example we consider the simple numerical example of a point correspondence containing just points as follows namely the identity map on the points of a projective basis. we assume that points xi are known exactly and points i have one pixel standard deviation in each coordinate direction. this means that the covariance matrix obviously the computed homography will be the identity map. for simplicity we normalize it so that it is indeed the identity matrix and hence instead of the usual normalization in this case all the w i in are equal to the matrix j is easily computed from to equal i is the identity. jtj j then covariance of the estimated transformation to take the pseudo-inverse of this matrix we may use where a is a matrix with columns spanning the tangent plane to the constraint surface. since h is computed subject to the condition which represents a hypersphere the constraint surface is perpendicular to the vector h corresponding to the computed homography h. a householder matrix a section corresponding to the vector h has the property that ah so the first columns of a perpendicular to h as required. this allows the pseudo-inverse to be computed exactly without using svd. applying the pseudo-inverse is computed to be h the diagonals give the individual variances of the entries of h. this computed covariance is used to assess the accuracy of point transfer in example error in both images in the case of error in both images computation of the covariance of the transformation is a bit more complicated. as seen in section one may define a set of parameters where parameters describe the transformation matrix and parameters xi represent estimates of the points in the first image. more conveniently one may over-parametrize by using parameters for the transformation h. the jacobian matrix naturally splits up into two parts as j b where a and b are the derivatives with respect to the camera parameters and the points xi respectively. applying one computes jt x j at bt x a at x b x a bt x b the pseudo-inverse of this matrix is the covariance of the parameter set and the top-left block of this pseudo-inverse is the covariance of the entries of h. a detailed discussion of this is given in section where it is shown how one can make use of the block structure of the jacobian to simplify the computation. in example on estimating the covariance of h from four points in the previous section the covariance turns out to be h j namely twice the covariance computed for noise in one image only. this assumes that points are measured with the same covariance in both images. this simple relationship between the covariances in the one and two-image cases does not generally hold. algorithm evaluation and error analysis using the covariance matrix in point transfer once one has the covariance one may compute the uncertainty associated with a given point transfer. consider a new point x in the first image not used in the computation of the transformation h. the corresponding point in the second image is hx. however because of the uncertainty in the estimation of h the correct location of the point will also have associated uncertainty. one may compute this uncertainty from the covariance matrix of h. the covariance matrix for the point is given by the formula jh hjt h where jh h. a formula for h is given in if in addition the point x itself is measured with some uncertainty then one has instead jh hjt h jx xjt x assuming that there is no cross-correlation between x and h which is reasonable since point x is assumed to be a new point not used in the computation of the transformation h. a formula for the jacobian matrix jx x is given in the covariance matrix given by is expressed in terms of the covariance matrix h of the transformation h. we have seen that this covariance matrix h depends on the particular constraint used in estimating h according to it may therefore appear that also depends on the particular method used to constrain h. it may however be verified that these formulae are independent of the particular constraint a used to compute the covariance matrix p example to continue example let the computed homography h be given by the identity matrix with covariance matrix h as in consider an arbitrary point y mapped to the point hx. in this case the covariance matrix jh hjt h may be computed symbolically to equal x ja. note that and are even functions of x and y whereas is an odd function. this is a consequence of the symmetry about the x and y axes of the point set used to compute h. also note that and differ by swapping x and y which is a further consequence of the symmetry of the defining point set. as may be seen the variance varies as the fourth power of x and hence the standard deviation varies as the square. this shows that extrapolating the values of transformed points hx far beyond the set of points used to compute h is not reliable. more specifically the rms uncertainty of the position of is equal to trace which one finds is equal to where r is the radial distance from the origin. note the interesting fact that the rms error is only dependent on the radial distance. in fact one may verify that the probability distribution for point its depends only on the radial distance of monte carlo estimation of covariance fig. rms error in the position of a projected point from the origin. the homography h is computed from evenly spaced points on a unit circle around the origin with errors in the second image only. the rms error is proportional to the assumed error in the points used to compute h and the vertical axis is calibrated in terms of this assumed error. as a function of radial distance of two principal axes pointing radially and tangentially. figure shows the graph of the rms error in as a function of r. this example has computed the covariance of a transferred point in the minimal case of four point correspondences. for more than four correspondences the situation is not substantially different. extrapolation beyond the set of points used to compute the homography is unreliable. in fact one may show that if h is computed from n points evenly spaced around a unit circle of as in the computation above then the rms error is equal to so the error exhibits the same quadratic growth. monte carlo estimation of covariance the method of estimating covariance discussed in the previous sections has relied on an assumption of linearity. in other words it has been assumed that the surface f is locally flat in the vicinity of the estimated point at least over a region corresponding to the approximate extent of the noise distribution. it has also been assumed that the method of estimation of the transformation h was the maximum likelihood estimate. if the surface is not entirely flat then the estimate of covariance may be incorrect. in addition a particular estimation method may be inferior to the ml estimate thereby introducing additional uncertainty in the values of the estimated transformation h. a general expensive method of getting an estimate of the covariance is by exhaustive simulation. assuming that the noise is drawn from a given noise distribution one starts with a set of point matches corresponding perfectly to a given transformation. one then adds noise to the points and computes the corresponding transformation using the chosen estimation procedure. the covariance of the transformation h or a further transferred point is then computed statistically from multiple trials with noise drawn from the assumed noise distribution. this is illustrated for the case of the identity mapping in figure both the analytical and the monte carlo methods of estimating covariance of the transformation h may be applied to the estimation of covariance from real data for which one does not know the true value of h. from the given data an estimate of h and the corresponding true values of the points i and xi are computed. then the algorithm evaluation and error analysis fig. transfer of a point under the identity mapping for the normalized and unnormalized dlt algorithm. see also figure for further explanation. covariance is computed as if the estimated values were the true values of the matched data points and the transformation. the resulting covariance matrix is assumed to be the covariance of the true transformation. this identification is based on the assumption that the true values of the data points are sufficiently close to the estimated values that the covariance matrix is essentially unaffected. closure an extended discussion of bias and variance of estimated parameters is given in appendix the literature the derivations throughout this chapter have been considerably simplified by only using first-order taylor expansions and assuming gaussian error distributions. similar ideas covariance can be developed for other distributions by using the fisher information matrix. related reading may be found in kanatani press et al. and other statistical textbooks. criminisi et al. give many examples of the computed covariances in point transfer as the correspondences used to determine the homography vary in number and position. notes and exercises consider the problem of computing a best line fit to a set of points in the plane using orthogonal regression. suppose that n points are measured with independent standard deviations of in each coordinate. what is the expected rms distance of each point from a fitted line? answer in section a method is given for computing a projective reconstruction from a set of point correspondences across m views where of the point correspondences are presumed to be known to be from a plane. suppose the planar correspondences are known exactly and the other n image points are measured with pixel error coordinate in each image. what is the expected residual error of j part i camera geometry and single view geometry the cyclops c. on canvas by odilon redon rijksmuseum kroller-muller otterlo netherlands art library outline this part of the book concentrates on the geometry of a single perspective camera. it contains three chapters. chapter describes the projection of scene space onto a image plane. the camera mapping is represented by a matrix and in the case of mapping points it is a matrix p which maps from homogeneous coordinates of a world point in to homogeneous coordinates of the imaged point on the image plane. this matrix has in general degrees of freedom and the properties of the camera such as its centre and focal length may be extracted from it. in particular the internal camera parameters such as the focal length and aspect ratio are packaged in a matrix k which is obtained from p by a simple decomposition. there are two particularly important classes of camera matrix finite cameras and cameras with their centre at infinity such as the affine camera which represents parallel projection. chapter describes the estimation of the camera matrix p given the coordinates of a set of corresponding world and image points. the chapter also describes how constraints on the camera may be efficiently incorporated into the estimation and a method of correcting for radial lens distortion. chapter has three main topics. first it covers the action of a camera on geometric objects other than finite points. these include lines conics quadrics and points at infinity. the image of pointslines at infinity are vanishing pointslines. the second topic is camera calibration in which the internal parameters k of the camera matrix are computed without computing the entire matrix p. in particular the relation of the internal parameters to the image of the absolute conic is described and the calibration of a camera from vanishing points and vanishing lines. the final topic is the calibrating conic. this is a simple geometric device for visualizing camera calibration. camera models a camera is a mapping between the world space and a image. the principal camera of interest in this book is central projection. this chapter develops a number of camera models which are matrices with particular properties that represent the camera mapping. it will be seen that all cameras modelling central projection are specializations of the general projective camera. the anatomy of this most general camera model is examined using the tools of projective geometry. it will be seen that geometric entities of the camera such as the projection centre and image plane can be computed quite simply from its matrix representation. specializations of the general projective camera inherit its properties for example their geometry is computed using the same algebraic expressions. the specialized models fall into two major classes those that model cameras with a finite centre and those that model cameras with centre at infinity of the cameras at infinity the affine camera is of particular importance because it is the natural generalization of parallel projection. this chapter is principally concerned with the projection of points. the action of a camera on other geometric entities such as lines is deferred until chapter finite cameras in this section we start with the most specialized and simplest camera model which is the basic pinhole camera and then progressively generalize this model through a series of gradations. the models we develop are principally designed for ccd like sensors but are also applicable to other cameras for example x-ray images scanned photographic negatives scanned photographs from enlarged negatives etc. the basic pinhole model. we consider the central projection of points in space onto a plane. let the centre of projection be the origin of a euclidean coordinate system and consider the plane z f which is called the image plane or focal plane. under the pinhole camera model a point in space with coordinates x y zt is mapped to the point on the image plane where a line joining the point x to the centre of projection meets the image plane. this is shown in figure by similar triangles one quickly y camera models x x y p x x z y c principal axis f image plane c camera centre f y z p z fig. pinhole camera geometry. c is the camera centre and p the principal point. the camera centre is here placed at the coordinate origin. note the image plane is placed in front of the camera centre. computes that the point y zt is mapped to the point xz f yz f on the image plane. ignoring the final image coordinate we see that y zt xz f yzt describes the central projection mapping from world to image coordinates. this is a mapping from euclidean to euclidean the centre of projection is called the camera centre. it is also known as the optical centre. the line from the camera centre perpendicular to the image plane is called the principal axis or principal ray of the camera and the point where the principal axis meets the image plane is called the principal point. the plane through the camera centre parallel to the image plane is called the principal plane of the camera. central projection using homogeneous coordinates. if the world and image points are represented by homogeneous vectors then central projection is very simply expressed as a linear mapping between their homogeneous coordinates. in particular may be written in terms of matrix multiplication as x y z f x f y z f x y z f the matrix in this expression may be written as diagf f where diagf f is a diagonal matrix and represents a matrix divided up into a block identity matrix plus a column vector here the zero vector. we now introduce the notation x for the world point represented by the homogeneous y z x for the image point represented by a homogeneous and p for the homogeneous camera projection matrix. then is written compactly as x px which defines the camera matrix for the pinhole model of central projection as p diagf f finite cameras y cam p x cam y y x x fig. image y and camera ycam coordinate systems. principal point offset. the expression assumed that the origin of coordinates in the image plane is at the principal point. in practice it may not be so that in general there is a mapping y zt xz px f yz pyt where pyt are the coordinates of the principal point. see figure this equation may be expressed conveniently in homogeneous coordinates as x y z f f y zpy f x zpx f k z px f py x y z px f py now writing then has the concise form x ki the matrix k is called the camera calibration matrix. in we have written y z as xcam to emphasize that the camera is assumed to be located at the origin of a euclidean coordinate system with the principal axis of the camera pointing straight down the z-axis and the point xcam is expressed in this coordinate system. such a coordinate system may be called the camera coordinate frame. camera rotation and translation. in general points in space will be expressed in terms of a different euclidean coordinate frame known as the world coordinate frame. the two coordinate frames are related via a rotation and a translation. see figure if is an inhomogeneous representing the coordinates of a point in the world coordinate frame and represents the same point in the camera coordinate frame then we may write where represents the coordinates of the camera xcam x. r r x x kri y z camera models y cam c xcam zcam r t z o x y fig. the euclidean transformation between the world and camera coordinate frames. centre in the world coordinate frame and r is a rotation matrix representing the orientation of the camera coordinate frame. this equation may be written in homogeneous coordinates as putting this together with leads to the formula contained in k are called the internal camera parameters or the internal orientation where x is now in a world coordinate frame. this is the general mapping given by a pinhole camera. one sees that a general pinhole camera p kri has degrees of freedom for k elements f px py for r and for the parameters of the camera. the parameters of r and which relate the camera orientation and the world to image transformation as t. in this case the camera matrix is where from t position to a world coordinate system are called the external parameters or the exterior orientation. it is often convenient not to make the camera centre explicit and instead to represent p kr t simply ccd cameras. the pinhole camera model just derived assumes that the image coordinates are euclidean coordinates having equal scales in both axial directions. in the case of ccd cameras there is the additional possibility of having non-square pixels. if image coordinates are measured in pixels then this has the extra effect of introducing unequal scale factors in each direction. in particular if the number of pixels per unit x k y x k s y p kri finite cameras distance in image coordinates are mx and my in the x and y directions then the transformation from world coordinates to pixel coordinates is obtained by multiplying on the left by an extra factor diagmx my thus the general form of the calibration matrix of a ccd camera is where x f mx and y f my represent the focal length of the camera in terms of pixel dimensions in the x and y direction respectively. similarly is the principal point in terms of pixel dimensions with coordinates mxpx and mypy. a ccd camera thus has degrees of freedom. finite projective camera. for added generality we can consider a calibration matrix of the form the added parameter s is referred to as the skew parameter. the skew parameter will be zero for most normal cameras. however in certain unusual instances which are described in section it can take non-zero values. a camera for which the calibration matrix k is of the form will be called a finite projective camera. a finite projective camera has degrees of freedom. this is the same number of degrees of freedom as a matrix defined up to an arbitrary scale. note that the left hand submatrix of p equal to kr is non-singular. conversely any matrix p for which the left hand submatrix is non-singular is the kri indeed letting m be the left submatrix of p one decomposes m as camera matrix of some finite projective camera because p can be decomposed as p therefore be written p mi m kri where is the last column of p. in short the set of camera matrices of finite projective cameras is identical with the set of homogeneous matrices for which the left hand submatrix is non-singular. a product m kr where k is upper-triangular of the form and r is a rotation matrix. this decomposition is essentially the rq matrix decomposition described in section of which more will be said in section the matrix p can general projective cameras. the final step in our hierarchy of projective cameras is to remove the non-singularity restriction on the left hand submatrix. a general projective camera is one represented by an arbitrary homogeneous matrix of rank it has degrees of freedom. the rank requirement arises because if the rank is camera models camera centre. the camera centre is the right null-space c of p i.e. pc finite camera is not singular c camera at infinity is singular c i.e. md m d where d is the null of m column points. for i the column vectors pi are vanishing points in the image corresponding to the x y and z axes respectively. column is the image of the coordinate origin. principal plane. the principal plane of the camera is the last row of p. axis planes. the planes and first and second rows of p represent planes in space through the camera centre corresponding to points that map to the image lines x and y respectively. principal point. the image point is the principal point of the camera where is the third row of m. principal ray. the principal ray of the camera is the ray passing through the camera centre c with direction vector the principal axis vector v is directed towards the front of the camera. table summary of the properties of a projective camera p. the matrix is represented by the block form p less than this then the range of the matrix mapping will be a line or point and not the whole plane in other words not a image. the projective camera a general projective camera p maps world points x to image points x according to x px. building on this mapping we will now dissect the camera model to reveal how geometric entities such as the camera centre are encoded. some of the properties that we consider will apply only to finite projective cameras and their specializations whilst others will apply to general cameras. the distinction will be evident from the context. the derived properties of the camera are summarized in table camera anatomy a general projective camera may be decomposed into blocks according to p where m is a matrix. it will be seen that if m is non-singular then this is a finite camera otherwise it is not. camera centre. the matrix p has a right null-space because its rank is whereas it has columns. suppose the null-space is generated by the c that is pc it will now be shown that c is the camera centre represented as a homogeneous consider the line containing c and any other point a in points on this line may be represented by the join x a the projective camera c p p p o z y x fig. the three image points defined by the columns pi i of the projection matrix are the vanishing points of the directions of the world axes. under the mapping x px points on this line are projected to x px pa pa since pc that is all points on the line are mapped to the same image point pa which means that the line must be a ray through the camera centre. it follows that c is the homogeneous representation of the camera centre since for all choices of a the line x is a ray through the camera centre. this result is not unexpected since the image point pc is not defined the case of finite cameras the result may be established directly since c and the camera centre is the unique point in space for which the image is undefined. in is clearly the null-vector of p kri the result is true even in the case where the first submatrix m of p is singular. in this singular case though the null-vector has the form c where md the camera centre is then a point at infinity. camera models of this class are discussed in section column vectors. the columns of the projective camera are which have a geometric meaning as particular image points. with the notation that the columns of p are pi i then are the vanishing points of the world coordinate x y and z axes respectively. this follows because these points are the images of the axes directions. for example the x-axis has direction d which is imaged at pd. see figure the column is the image of the world origin. row vectors. the rows of the projective camera are which may be interpreted geometrically as particular world planes. these planes are examined next. we introduce the notation that the rows of p are pit so that p camera models y x p p y x principal plane fig. two of the three planes defined by the rows of the projection matrix. the principal plane. the principal plane is the plane through the camera centre parallel to the image plane. it consists of the set of points x which are imaged on the line at infinity of the image. explicitly px y thus a point lies on the principal plane of the camera if and only if in other words is the vector representing the principal plane of the camera. if c is the camera centre then pc and so in particular that is c lies on the principal plane of the camera. axis planes. consider the set of points x on the plane this set satisfies and so is imaged at px y wt which are points on the image y-axis. again it follows from pc that and so c lies also on the plane consequently the plane is defined by the camera centre and the line x in the image. similarly the plane is defined by the camera centre and the line y unlike the principal plane the axis planes and are dependent on the image x- and y-axes i.e. on the choice of the image coordinate system. thus they are less tightly coupled to the natural camera geometry than the principal plane. in particular the line of intersection of the planes and is a line joining the camera centre and image origin i.e. the back-projection of the image origin. this line will not coincide in general with the camera principal axis. the planes arising from pi are illustrated in figure the camera centre c lies on all three planes and since these planes are distinct the p matrix has rank it must lie on their intersection. algebraically the condition for the centre to lie on all three planes is pc which is the original equation for the camera centre given above. the principal point. the principal axis is the line passing through the camera centre c with direction perpendicular to the principal plane the axis intersects the image plane at the principal point. we may determine this point as follows. in general the normal to a plane is the vector this may alternatively be represented by a point on the plane at infinity. in the case of the principal plane of the camera this point is which we denote projecting that point using the camera matrix p gives the principal point of the camera note that only the left hand part of p is involved in this the projective camera formula. in fact the principal point is computed as where is the third row of m. the principal axis vector. although any point x not on the principal plane may be mapped to an image point according to x px in reality only half the points in space those that lie in front of the camera may be seen in an image. let p be written as p it has just been seen that the vector points in the direction of the principal axis. we would like to define this vector in such a way that it points in the direction towards the front of the camera positive direction. note however that p is only defined up to sign. this leaves an ambiguity as to whether or points in the positive direction. we now proceed to resolve this ambiguity. we start by considering coordinates with respect to the camera coordinate frame. according to the equation for projection of a point to a point in the image is given by x pcamxcam ki where xcam is the point expressed in camera coordinates. in this case observe that the vector v points towards the front of the camera in the direction of the principal axis irrespective of the scaling of pcam. for example if pcam kpcam then v which has the if the point is expressed in world coordinates then p kkr same direction. where m kkr. since detr the vector v is again unaffected by scaling. in summary v is a vector in the direction of the principal axis directed towards the front of the camera. action of a projective camera on points forward projection. as we have already seen a general projective camera maps a point in space x to an image point according to the mapping x px. points d on the plane at infinity represent vanishing points. such points map to and thus are only affected by m the first submatrix of p. x pd md back-projection of points to rays. given a point x in an image we next determine the set of points in space that map to this point. this set will constitute a ray in space passing through the camera centre. the form of the ray may be specified in several ways depending on how one wishes to represent a line in a pl ucker representation is postponed until section here the line is represented as the join of two points. we know two points on the ray. these are the camera centre c pc and the point px where p is the pseudo-inverse of p. the pseudo-inverse of p is the for which pp i section point px lies matrix p ptppt camera models x c m x m fig. if the camera matrix p is normalized so that and det m and x wx y px where x y z then w is the depth of the point x from the camera centre in the direction of the principal ray of the camera. on the ray because it projects to x since ppx x x. then the ray is the line formed by the join of these two points x c. p the camera centre is given by m an image point x back in the case of finite cameras an alternative expression can be developed. writing projects to a ray intersecting the plane at infinity at the point d and d provides a second point on the ray. again writing the line as the join of two points on the ray m m x m x depth of points next we consider the distance a point lies in front of or behind the principal x y z plane of the camera. consider a camera matrix p projecting a point c be the camera centre. then w c since pc for in to the image point x wx y px. let the camera centre c. however c where is the principal ray direction so w can be interpreted as the dot product of the ray from the camera centre to the point x with the principal ray direction. if the camera matrix is normalized so that det m and then is a unit vector pointing in the positive axial direction. then w may be interpreted as the depth of the point x from the camera centre c in the direction of the principal ray. this is illustrated in figure any camera matrix may be normalized by multiplying it by an appropriate factor. however to avoid having always to deal with normalized camera matrices the depth of a point may be computed as follows result let x y z tt be a point and p be a camera matrix for a finite camera. suppose px y z tt wx y then depthx p signdet mw the projective camera is the depth of the point x in front of the principal plane of the camera. this formula is an effective way to determine if a point x is in front of the camera. one verifies that the value of depthx p is unchanged if either the point x or the camera matrix p is multiplied by a constant factor k. thus depthx p is independent of the particular homogeneous representation of x and p. decomposition of the camera matrix let p be a camera matrix representing a general projective camera. we wish to find the camera centre the orientation of the camera and the internal parameters of the camera from p. finding the camera centre. the camera centre c is the point for which pc numerically this right null-vector may be obtained from the svd of p see section algebraically the centre c y z tt may be obtained as x y z t finding the camera orientation and internal parameters. in the case of a finite camera according to p kr we may easily find both k and r by decomposing m as m kr using the rqdecomposition. this decomposition into the product of an upper-triangular and orthogonal matrix is described in section the matrix r gives the orientation of the camera whereas k is the calibration matrix. the ambiguity in the decomposition is removed by requiring that k have positive diagonal entries. the matrix k has the form k x s y where x is the scale factor in the x-coordinate direction y is the scale factor in the y-coordinate direction s is the skew are the coordinates of the principal point. the aspect ratio is y x. example the camera matrix p e e e camera models with p has centre and the matrix m decomposes as m kr when is s as was shown in section a true ccd camera has only four internal camera parameters since generally s if s then this can be interpreted as a skewing of the pixel elements in the ccd array so that the x- and y-axes are not perpendicular. this is admittedly very unlikely to happen. in realistic circumstances a non-zero skew might arise as a result of taking an image of an image for example if a photograph is re-photographed or a negative is enlarged. consider enlarging an image taken by a pinhole camera as an ordinary film camera where the axis of the magnifying lens is not perpendicular to the film plane or the enlarged image plane. the most severe distortion that can arise from this picture of a picture process is a planar homography. suppose the original camera is represented by the matrix p then the camera representing the picture of a picture is hp where h is the homography matrix. since h is non-singular the left submatrix of hp is non-singular and can be decomposed as the product kr and k need not have s note however that the k and r are no longer the calibration matrix and orientation of the original camera. on the other hand one verifies that the process of taking a picture of a picture does not change the apparent camera centre. indeed since h is non-singular hpc if and only if pc where is the decomposition required? if the camera p is constructed from then the parameters are known and a decomposition is clearly unnecessary. so the question arises where would one obtain a camera for which the decomposition is not known? in fact cameras will be computed in myriad ways throughout this book and decomposing an unknown camera is a frequently used tool in practice. for example cameras can be computed directly by calibration where the camera is computed from a set of world to image correspondences and indirectly by computing a multiple view relation as the fundamental matrix or trifocal tensor and subsequently computing projection matrices from this relation. a note on coordinate orientation. in the derivation of the camera model and its parametrization it is assumed that the coordinate systems used in both the image and the world are right handed systems as shown in figure however a common practice in measuring image coordinates is that the y-coordinate increases in the downwards direction thus defining a left handed coordinate system contrary to figure a recommended practice in this case is to negate the y-coordinate of the image point so that the coordinate system again becomes right handed. however if the projective camera the image coordinate system is left handed then the consequences are not grave. the relationship between world and image coordinates is still expressed by a camera matrix. decomposition of this camera matrix according to with k of the form is still possible with x and y positive. the difference is that r now represents the orientation of the camera with respect to the negative z-axis. in addition the depth of points given by will be negative instead of positive for points in front of the camera. if this is borne in mind then it is permissible to use left handed coordinates in the image. euclidean vs projective spaces the development of the sections to this point has implicitly assumed that the world and image coordinate systems are euclidean. ideas have been borrowed from projective geometry as directions corresponding to points on and the convenient notation of homogeneous coordinates has allowed central projection to be represented linearly. in subsequent chapters of the book we will go further and use a projective coordinate frame. this is easily achieved for suppose the world coordinate frame is projective then the transformation between the camera and world coordinate frame is again represented by a homogeneous matrix xcam hx and the resulting map from projective to the image is still represented by a matrix p with rank in fact at its most general the projective camera is a map from to and covers the composed effects of a projective transformation of a projection from to an image and a projective transformation of the image. this follows simply by concatenating the matrices representing these mappings homography p homography which results in a matrix. however it is important to remember that cameras are euclidean devices and simply because we have a projective model of a camera it does not mean that we should eschew notions of euclidean geometry. euclidean and affine interpretations. although a matrix can always be decomposed as in section to obtain a rotation matrix a calibration matrix k and so forth euclidean interpretations of the parameters so obtained are only meaningful if the image and space coordinates are in an appropriate frame. in the decomposition case a euclidean frame is required for both image and on the other hand the interpretation of the null-vector of p as the camera centre is valid even if both frames are projective the interpretation requires only collinearity which is a projective notion. the interpretation of as the principal plane requires at least affine frames for the image and finally the interpretation of as the principal ray requires an affine image frame but a euclidean world frame in order for the concept of orthogonality the principal plane to be meaningful. camera models perspective weak perspective increasing focal length increasing distance from camera fig. as the focal length increases and the distance between the camera and object also increases the image remains the same size but perspective effects diminish. cameras at infinity we now turn to consider cameras with centre lying on the plane at infinity. this means that the left hand block of the camera matrix p is singular. the camera centre may be found from pc just as with finite cameras. cameras at infinity may be broadly classified into two different types affine cameras and non-affine cameras. we consider first of all the affine class of cameras which are the most important in practice. definition an affine camera is one that has a camera matrix p in which the last row is of the form it is called an affine camera because points at infinity are mapped to points at infinity. affine cameras consider what happens as we apply a cinematographic technique of tracking back while zooming in in such a way as to keep objects of interest the same this is illustrated in figure we are going to model this process by taking the limit as both the focal length and principal axis distance of the camera from the object increase. in analyzing this technique we start with a finite projective camera the see vertigo hitchcock and mishima schrader camera matrix may be written as cameras at infinity kri k has orientation denoted by matrix r and internal parameters matrix k of the form given in from section the principal ray of the camera is in the direction where rit is the i-th row of the rotation matrix. this camera is located at position and of the vector and the value is the distance of the world origin from the replacing in by gives the camera matrix at time t now we consider what happens if the camera centre is moved backwards along the principal ray at unit speed for a time t so that the centre of the camera is moved to camera centre in the direction of the principal ray. k where the terms are zero for i because r is a rotation matrix. the scalar dt t is the depth of the world origin with respect to the camera centre in the direction of the principal ray of the camera. thus the effect of tracking along the principal ray is to replace the entry of the matrix by the depth dt of the camera centre from the world origin. dt pt k next we consider zooming such that the camera focal length is increased by a factor k. this magnifies the image by a factor k. it is shown in section that the effect of zooming by a factor k is to multiply the calibration matrix k on the right by diagk k now we combine the effects of tracking and zooming. we suppose that the magnification factor is k so that the image size remains fixed. the resulting camera matrix at time t derived from is pt k and one can ignore the factor when t the camera matrix pt corresponds with now in the limit as dt tends to infinity this matrix becomes k dt dt p lim t pt k which is just the original camera matrix with the first three entries of the last row set to zero. from definition p is an instance of an affine camera. camera models error in employing an affine camera it may be noted that the image of any point on the plane through the world origin perpendicular to the principal axis direction is unchanged by this combined zooming and motion. indeed such a point may be written as one then verifies that ptx p x for all t since for points not on this plane the images under and p differ and we will now investigate the extent of this error. consider a point x which is at a perpendicular distance from this plane. the point can be represented as x x and is imaged by the cameras and p at x where x y now writing the calibration matrix as xaffine p x k xproj k y x y k where is an upper-triangular matrix gives xproj x xaffine x the image point for is obtained by dehomogenizing by dividing by the third element as xproj and for p the inhomogeneous image point is xaffine the relationship between the two points is therefore xaffine xproj which shows that the effect of the affine approximation p to the true camera matrix is to move the image of a point x radially towards or away from the principal point by a factor equal to this is illustrated in figure affine imaging conditions. from the expressions for xproj and xaffine we can deduce that cameras at infinity xaffine xproj xproj which shows that the distance between the true perspective image position and the position obtained using the affine camera approximation p will be small provided the depth relief is small compared to the average depth and the distance of the point from the principal ray is small. the latter condition is satisfied by a small field of view. in general images acquired using a lens with a longer focal length tend to satisfy these conditions as both the field of view and the depth of field are smaller than those obtained by a short focal length lens with the same ccd array. for scenes at which there are many points at different depths the affine camera is not a good approximation. for instance where the scene contains close foreground as well as background objects an affine camera model should not be used. however a different affine model can be used for each region in these circumstances. decomposition of p the camera matrix may be written as p t r where r consists of the two first rows of a rotation matrix t is the vector and the vector the matrix is upper-triangular. d t r p t r one quickly verifies that so we may replace by d product gives and assume that multiplying out this r t k p r t t r thus making appropriate substitutions for t or we can write the affine camera matrix in one of the two forms r t r p consequently the camera p can be interpreted in terms of these decompositions in camera models x weak perspective c perspective f d fig. perspective vs weak perspective projection. the action of the weak perspective camera is equivalent to orthographic projection onto a plane z followed by perspective projection from the plane. the difference between the perspective and weak perspective image point depends both on the distance of the point x from the plane and the distance of the point from the principal ray. one of two ways either with or with t using the second decomposition of the image of the world origin is p xt consequently the value of is dependent on the particular choice of world coordinates and hence is not an intrinsic property of the camera itself. this means that the camera matrix p does not have a principal point. therefore it is preferable to use the first decomposition of p in and write p t r where the two matrices represent the internal camera parameters and external camera parameters of p parallel projection. in summary the essential differences between p and a finite camera are the parallel projection matrix trix of a finite camera the calibration matrix the principal point is not defined. replaces k of a finite camera replaces the canonical projection ma a hierarchy of affine cameras in a similar manner to the development of the finite projection camera taxonomy in section we can start with the basic operation of parallel projection and build a hierarchy of camera models representing progressively more general cases of parallel projection. cameras at infinity orthographic projection. consider projection along the z-axis. this is represented by a matrix of the form p t r h p this mapping takes a point y z to the image point y dropping the z-coordinate. for a general orthographic projection mapping we precede this map by a eu clidean coordinate change of the form writing t we see that a general orthographic camera is of the form an orthographic camera has five degrees of freedom namely the three parameters describing the rotation matrix r plus the two offset parameters and an orthographic projection matrix p t is characterized by a matrix m with last row zero with the first two rows orthogonal and of unit norm and scaled orthographic projection. a scaled orthographic projection is an orthographic projection followed by isotropic scaling. thus in general its matrix may be written in the form k p k it has six degrees of freedom. a scaled orthographic projection matrix p t is characterized by a matrix m with last row zero and the first two rows orthogonal and of equal norm. weak perspective projection. analogous to a finite ccd camera we may consider the case of a camera at infinity for which the scale factors in the two axial image directions are not equal. such a camera has a projection matrix of the form x p y it has seven degrees of freedom. a weak perspective projection matrix p t is characterized by a matrix m with last row zero and first two rows orthogonal they need not have equal norm as is required in the scaled orthographic case. the geometric action of this camera is illustrated in figure the affine camera pa. as has already been seen in the case of p a general camera matrix of the affine form and with no restrictions on its elements may be decomposed as camera models x pa s y it has eight degrees of freedom and may be thought of as the parallel projection version of the finite projective camera in full generality an affine camera has the form pa it has eight degrees of freedom corresponding to the eight non-zero and non-unit matrix elements. we denote the top left submatrix by the sole restriction on the affine camera is that has rank this arises from the requirement that the rank of p is the affine camera covers the composed effects of an affine transformation of an orthographic projection from to an image and an affine transformation of the image. this follows simply by concatenating the matrices representing these mappings pa affine which results in a matrix of the affine form. projection under an affine camera is a linear mapping on inhomogeneous coordinates affine composed with a translation x y x t y z which is written more concisely as x the point t is the image of the world origin. the camera models of this section are seen to be affine cameras satisfying additional constraints thus the affine camera is an abstraction of this hierarchy. for example in the case of the weak perspective camera the rows of are scalings of rows of a rotation matrix and thus are orthogonal. more properties of the affine camera the plane at infinity in space is mapped to points at infinity in the image. this is easily seen by computing pax y z y extending the terminology of finite cameras at infinity projective cameras we interpret this by saying that the principal plane of the camera is the plane at infinity. the optical centre since it lies on the principal plane must also lie on the plane at infinity. from this we have conversely any projective camera matrix for which the principal plane is the plane at infinity is an affine camera matrix. parallel world lines are projected to parallel image lines. this follows because parallel world lines intersect at the plane at infinity and this intersection point is mapped to a point at infinity in the image. hence the image lines are parallel. the vector d satisfying is the direction of parallel projection and the camera centre since pa d any camera which consists of the composed effects of affine transformations of space or of the image with parallel projection will have the affine form. for example para-perspective projection consists of two such mappings the first is parallel projection onto a plane through the centroid and parallel to the image plane. the direction of parallel projection is the ray joining the centroid to the camera centre. this parallel projection is followed by an affine transformation a similarity between and the image. thus a para-perspective camera is an affine camera. general cameras at infinity an affine camera is one for which the principal plane is the plane at infinity. as such its camera centre lies on the plane at infinity. however it is possible for the camera centre to lie on the plane at infinity without the whole principal plane being the plane at infinity. a camera centre lies at infinity if p with m a singular matrix. this is clearly a weaker condition than insisting that the last row of m is zero as is the case for affine cameras. if m is singular but the last row of m is not zero then the camera is not affine but not a finite projective camera either. such a camera is rather a strange object however and will not be treated in detail in this book. we may compare the properties of affine and non-affine infinite cameras affine camera non-affine camera camera centre on principal plane is image of points on on l yes yes yes yes no no in general in both cases the camera centre is the direction of projection. furthermore in the case of an affine camera all non-infinite points are in front of the camera. for a non-affine camera space is partitioned into two sets of points by the principal plane. a general camera at infinity could arise from a perspective image of an image produced by an affine camera. this imaging process corresponds to left-multiplying the camera models line of motion y perspective axis image plane x orthographic axis instantaneous view plane fig. acquisition geometry of a pushbroom camera. affine camera by a general matrix representing the planar homography. the resulting matrix is still a camera at infinity but it does not have the affine form since parallel lines in the world will in general appear as converging lines in the image. other camera models pushbroom cameras the linear pushbroom camera is an abstraction of a type of sensor common in satellites for instance the spot sensor. in such a camera a linear sensor array is used to capture a single line of imagery at a time. as the sensor moves the sensor plane sweeps out a region of space the name pushbroom capturing the image a single line at a time. the second dimension of the image is provided by the motion of the sensor. in the linear pushbroom model the sensor is assumed to move in a straight line at constant velocity with respect to the ground. in addition one assumes that the orientation of the sensor array with respect to the direction of travel is constant. in the direction of the sensor the image is effectively a perspective image whereas in the direction of the sensor motion it is an orthographic projection. the geometry of the lp camera is illustrated in figure it turns out that the mapping from object space into the image may be described by a camera matrix just as with a general projective camera. however the way in which this matrix is used is somewhat different. let x y z be an object point and let p be the camera matrix of the lp camera. suppose that px y wt. then the corresponding image point as an inhomogeneous is ywt. one must compare this with the projective camera mapping. in that case the point represented by y wt is ywt. note the difference that in the lp case the coordinate x is not divided by the factor w to get the image coordinate. in this formula the x-axis in the image is the direction of the sensor motion whereas the y-axis is in the direction of the linear sensor array. the camera has degrees of freedom. another way of writing the formula for lp projection is other camera models x x y yz where x y is the image point. note that the y-coordinate behaves projectively whereas the x is obtained by orthogonal projection of the point x on the direction perpendicular to the plane the vector represents the sweep plane of the camera at time t that is the moment when the line with coordinates x is captured. mapping of lines. one of the novel features of the lp camera is that straight lines in space are not mapped to straight lines in the image are mapped to straight lines in the case of a projective camera see section the set of points x lying on a line may be written as d where y z is a point on the line and d dy dz is the intersection of this line with the plane at infinity. in this case we compute from x td td td y this may be written as a pair of equations x abt and y ef t. eliminating t from these equations leads to an equation of the form x y x y which is the equation of a hyperbola in the image plane asymptotic in one direction to the line x and in the other direction to the line y a hyperbola is made up of two curves. however only one of the curves making up the image of a line actually appears in the image the other part of the hyperbola corresponds to points lying behind the camera. line cameras this chapter has dealt with the central projection of onto a image. an analogous development can be given for the central projection of a plane onto a line contained in the plane. see figure the camera model for this geometry is x y z x y which is a linear mapping from homogeneous representation of the plane to a homogeneous representation of the line. the camera has degrees of freedom. again the null-space c of thep projection matrix is the camera centre and the matrix can be decomposed in a similar manner to the finite projective camera as c where c is the inhomogeneous representing the centre dof is a rotation matrix dof and camera models x the internal calibration matrix dof. closure this chapter has covered camera models their taxonomy and anatomy. the subsequent chapters cover the estimation of cameras from a set of world to image correspondences and the action of a camera on various geometric objects such as lines and quadrics. vanishing points and vanishing lines are also described in more detail in chapter the literature defined a hierarchy of camera models including para-perspective. mundy and zisserman generalized this with the affine camera. faugeras developed properties of the projective camera in his textbook further details on the linear pushbroom camera are given in and on the camera in notes and exercises let be a projective image and be an image of image of an image. let the composite image be denoted by i show that the apparent camera centre of i is the same as that of speculate on how this explains why a portrait s eyes follow you round the room. verify on the other hand that all other parameters of i and may be different. show that the ray back-projected from an image point x under a projective camera p in may be written as l ptx p where l is the dual pl ucker representation of a line the affine camera. show that the affine camera is the most general linear mapping on homogeneous coordinates that maps parallel world lines to parallel image lines. to do this consider the projection of points on and show that only if p has the affine form will they map to points at infinity in the image. show that for parallel lines mapped by an affine camera the ratio of lengths on line segments is an invariant. what other invariants are there under an affine camera? the rational polynomial camera is a general camera model used extensively closure in the satellite surveillance community. image coordinates are defined by the ratios x nxxdxx y nyxdyx where the functions nx dx ny dy are homogeneous cubic polynomials in the point x. each cubic has coefficients so that overall the camera has degrees of freedom. all of the cameras surveyed in this chapter affine pushbroom are special cases of the rational polynomial camera. its disadvantage is that it is severely over-parametrized for these cases. more details are given in hartley and saxena camera by applying a homography h on the right such that a finite projective camera p may be transformed to an orthographic ph kri porthog last row of h is chosen so that h has rank then since x phh imaging under p is equivalent to first transforming the points x to h and then applying an orthographic projection. thus the action of any camera may be considered as a projective transformation of followed by orthographic projection. computation of the camera matrix p this chapter describes numerical methods for estimating the camera projection matrix from corresponding and image entities. this computation of the camera matrix is known as resectioning. the simplest such correspondence is that between a point x and its image x under the unknown camera mapping. given sufficiently many correspondences xi xi the camera matrix p may be determined. similarly p may be determined from sufficiently many corresponding world and image lines. if additional constraints apply to the matrix p such as that the pixels are square then a restricted camera matrix subject to these constraints may be estimated from world to image correspondences. throughout this book it is assumed that the map from to the image is linear. this assumption is invalid if there is lens distortion. the topic of radial lens distortion correction is dealt with in this chapter. the internal parameters k of the camera may be extracted from the matrix p by the decomposition of section alternatively the internal parameters can be computed directly without necessitating estimating p by the methods of chapter basic equations we assume a number of point correspondences xi xi between points xi and image points xi are given. we are required to find a camera matrix p namely a matrix such that xi pxi for all i. the similarity of this problem with that of computing a projective transformation h treated in chapter is evident. the only difference is the dimension of the problem. in the case the matrix h has dimension whereas in the present case p is a matrix. as one may expect much of the material from chapter applies almost unchanged to the present case. as in section for each correspondence xi xi we derive a relationship wixt yixt i i i wixt xixt i yixt xixt i i where each pit is a the i-th row of p. alternatively one may choose to use only the first two equations wixt wixt i i yixt xixt i i basic equations since the three equations of are linearly dependent. from a set of n point correspondences we obtain a matrix a by stacking up the equations for each correspondence. the projection matrix p is computed by solving the set of equations ap where p is the vector containing the entries of the matrix p. minimal solution. since the matrix p has entries and scale degrees of freedom it is necessary to have equations to solve for p. since each point correspondence leads to two equations at a minimum such correspondences are required to solve for p. the indicates that only one of the equations is used from the sixth point so one needs only to know the x-coordinate alternatively the y-coordinate of the sixth image point. given this minimum number of correspondences the solution is exact i.e. the space points are projected exactly onto their measured images. the solution is obtained by solving ap where a is an matrix in this case. in general a will have rank and the solution vector p is the right null-space of a. over-determined solution. if the data is not exact because of noise in the point coordinates and n point correspondences are given then there will not be an exact solution to the equations ap as in the estimation of a homography a solution for p may be obtained by minimizing an algebraic or geometric error. in the case of algebraic error the approach is to minimize subject to some normalization constraint. possible constraints are where is the vector namely the first three entries in the last row of p. the first of these is preferred for routine use and will be used for the moment. we will return to the second normalization constraint in section in either case the residual ap is known as the algebraic error. using these equations the complete dlt algorithm for computation of the camera matrix p proceeds in the same manner as that for h given in algorithm degenerate configurations. analysis of the degenerate configurations for estimation of p is rather more involved than in the case of the homography. there are two types of configurations in which ambiguous solutions exist for p. these configurations will be investigated in detail in chapter the most important critical configurations are as follows the camera and points all lie on a twisted cubic. computation of the camera matrix p the points all lie on the union of a plane and a single straight line containing the camera centre. for such configurations the camera cannot be obtained uniquely from the images of the points. instead it may move arbitrarily along the twisted cubic or straight line respectively. if data is close to a degenerate configuration then a poor estimate for p is obtained. for example if the camera is distant from a scene with low relief such as a near-nadir aerial view then this situation is close to the planar degeneracy. data normalization. it is important to carry out some sort of data normalization just as in the homography estimation case. the points xi in the image are appropriately normalized in the same way as before. namely the points should be translated so that their centroid is at the origin and scaled so that their rms distance from the origin is what normalization should be applied to the points xi is a little more problematical. in the case where the variation in depth of the points from the camera is relatively slight it makes sense to carry out the same sort of normalization. thus the centroid of the points is translated to the origin and their coordinates are scaled so that the rms distance from the origin is that the average point has coordinates of magnitude this approach is suitable for a compact distribution of points such as those on the calibration object of figure in the case where there are some points that lie at a great distance from the camera the previous normalization technique does not work well. for instance if there are points close to the camera as well as points that lie at infinity are imaged as vanishing points or close to infinity as may occur in oblique views of terrain then it is not possible or reasonable to translate the points so that their centroid is at the origin. the normalization method described in exercise on page would be more appropriately used in such a case though this has not been thoroughly tested. with appropriate normalization the estimate of p is carried out in the same manner as algorithm for h. line correspondences. it is a simple matter to extend the dlt algorithm to take account of line correspondences as well. a line in may be represented by two points and through which the line passes. now according to result the plane formed by back-projecting from the image line l is equal to ptl. the condition that the point xj lies on this plane is then ltpxj for j each choice of j gives a single linear equation in the entries of the matrix p so two equations are obtained for each to line correspondence. these equations being linear in the entries of p may be added to the equations obtained from point correspondences and a solution to the composite equation set may be computed. as in the case of homographies one may define geometric error. suppose for the moment that world points xi are known far more accurately than the geometric error geometric error objective given n world to image point correspondences xi determine the maximum likelihood estimate of the camera projection matrix p i.e. the p which minimizes i dxi algorithm linear solution. compute an initial estimate of p using a linear method such as algorithm normalization use a similarity transformation t to normalize the image points and a second similarity transformation u to normalize the space points. suppose the normalized image points are xi txi and the normalized space points are xi uxi. dlt form the matrix a by stacking the equations generated by each correspondence xi xi. write p for the vector containing the entries of the matrix p. a solution of ap subject to is obtained from the unit singular vector of a corresponding to the smallest singular value. minimize geometric error. using the linear estimate as a starting point minimize the geometric error i d xi p over p using an iterative algorithm such as levenberg marquardt. denormalization. the camera matrix for the original coordinates is obtained from p as p t pu. algorithm the gold standard algorithm for estimating p from world to image point correspondences in the case that the world points are very accurately known. measured image points. for example the points xi might arise from an accurately machined calibration object. then the geometric error in the image is dxi i min p i where xi is the measured point and xi is the point pxi i.e. the point which is the exact image of xi under p. if the measurement errors are gaussian then the solution of dxi is the maximum likelihood estimate of p. just as in the homography case minimizing geometric error requires the use of iterative techniques such as levenberg marquardt. a parametrization of p is required and the vector of matrix elements p provides this. the dlt solution or a minimal solution may be used as a starting point for the iterative minimization. the complete gold standard algorithm is summarized in algorithm example camera estimation from a calibration object we will compare the dlt algorithm with the gold standard algorithm for data computation of the camera matrix p fig. an image of a typical calibration object. the black and white checkerboard pattern tsai grid is designed to enable the positions of the corners of the imaged squares to be obtained to high accuracy. a total of points were identified and used to calibrate the camera in the examples of this chapter. fy fxfy skew residual linear iterative table dlt and gold standard calibration. from the calibration object shown in figure the image points xi are obtained from the calibration object using the following steps canny edge detection straight line fitting to the detected linked edges. intersecting the lines to obtain the imaged corners. if sufficient care is taken the points xi are obtained to a localization accuracy of far better than of a pixel. a rule of thumb is that for a good estimation the number of constraints measurements should exceed the number of unknowns camera parameters by a factor of five. this means that at least points should be used. table shows the calibration results obtained by using the linear dlt method and the gold standard method. note that the improvement achieved using the gold standard algorithm is very slight. the difference of residual of one thousandth of a pixel is insignificant. errors in the world points it may be the case that world points are not measured with infinite accuracy. in this case one may choose to estimate p by minimizing a geometric error or an image geometric error or both. if only errors in the world points are considered then the geometric error is de fined as i geometric error c x i f d x i x i w fig. the dlt algorithm minimizes the sum of squares of geometric distance between the point xi and the point i mapping exactly onto xi and lying in the plane through xi parallel to the principal plane of the camera. a short calculation shows that wd f where is the closest point in space to xi that maps exactly onto xi via xi this requires that one augment the set of parameters by including parameters the more generally if errors in both the world and image points are considered then a weighted sum of world and image errors is minimized. as in the homography case estimated points. one minimizes dmahxi where dmah represents mahalanobis distance with respect to the known error covariance matrices for each of the measurements xi and xi. in the simplest case the mahalanobis distance is simply a weighted geometric distance where the weights are chosen to reflect the relative accuracy of measurements of the image and points and also the fact that image and world points are typically measured in different units. geometric interpretation of algebraic error suppose all the points xi in the dlt algorithm are normalized such that xi yi zi and xi yi in this case it was seen in section widxi that the quantity being minimized by the dlt algorithm is where wi xi yi pxi. however according to wi depthx p thus the value wi may be interpreted as the depth of the point xi from the camera in the direction along the principal ray provided the camera is normalized so that referring to figure one sees that widxi xi is proportional to f i is a point mapping to xi and lying in a plane through xi parallel to the principal plane of the camera. thus the algebraic error being minimized is equal to f x where f is the focal length and i is the correction that needs to be made to the measured points in order to correspond precisely with the measured image points xi. the restriction is that the correction must be made in the direction perpendicular to the principal axis of the camera. because of this restriction the point i is not the same as the clos the distance dxi est point to xi that maps to xi. however for points xi not too far from the principal i dxi computation of the camera matrix p i is a reasonable approximation to the distance the dlt slightly weights the points farther away from the principal ray by ray of the camera the distance dxi i which is slightly larger than in minimizing the squared sum of dxi addition the presence of the focal length f in the expression for algebraic error suggests that the dlt algorithm will be biased towards minimizing focal length at a cost of a slight increase in geometric error. transformation invariance. we have just seen that by minimizing subject to the constraint one may interpret the solution in terms of minimizing geometric distances. such an interpretation is not affected by similarity transformations in either space or the image space. thus one is led to expect that carrying out translation and scaling of the data either in the image or in point coordinates will not have any effect on the solutions. this is indeed the case as may be shown using the arguments of section estimation of an affine camera the methods developed above for the projective cameras can be applied directly to affine cameras. an affine camera is one for which the projection matrix has last row in the dlt estimation of the camera in this case one minimizes subject to this condition on the last row of p. as in the case of computing affine transformations for affine cameras algebraic error and geometric image error are equal. this means that geometric image distances may be minimized by a linear algorithm. suppose as above that all the points xi are normalized such that xi yi zi and xi yi and also that the last row of p has the affine form. then for a single correspondence reduces to xt i xt i which shows that the squared algebraic error in this case equals the squared geometric error xi yi i yi xi i dxi this result may also be seen geometrically by comparison of figure and figure a linear estimation algorithm for an affine camera which minimizes geometric error is given in algorithm under the assumption of gaussian measurement errors this is the maximum likelihood estimate of pa. restricted camera estimation the dlt algorithm as it has so far been described computes a general projective camera matrix p from a set of to point correspondences. the matrix p with centre at a finite point may be decomposed as p kr where r is a restricted camera estimation objective given n world to image point correspondences xi determine the maximum likelihood estimate of the affine camera projection matrix pa i.e. the camera p which minimizes i dxi subject to the affine constraint algorithm normalization use a similarity transformation t to normalize the image points and a second similarity transformation u to normalize the space points. suppose the normalized image points are xi txi and the normalized space points are xi uxi with unit last component. each correspondence xi xi contributes equations xt i xt i xi yi which are stacked into a matrix equation b where is the containing the first two rows of pa. the solution is obtained by the pseudo-inverse of section denormalization the camera matrix for the original coordinates is and obtained from pa as b a pa t pau algorithm the gold standard algorithm for estimating an affine camera matrix pa from world to image correspondences. rotation matrix and k has the form x k s y the non-zero entries of k are geometrically meaningful quantities the internal calibration parameters of p. one may wish to find the best-fit camera matrix p subject to restrictive conditions on the camera parameters. common assumptions are the skew s is zero. the pixels are square x y. the principal point is known. the complete camera calibration matrix k is known. in some cases it is possible to estimate a restricted camera matrix with a linear algorithm the exercises at the end of the chapter. as an example of restricted estimation suppose that we wish to find the best pinhole camera model is projective camera with s and x y that fits a set of point measurements. this problem may be solved by minimizing either geometric or algebraic error as will be discussed next. computation of the camera matrix p minimizing geometric error. to minimize geometric error one selects a set of parameters that characterize the camera matrix to be computed. for instance suppose we wish to enforce the constraints s and x y. one can parametrize the camera matrix using the remaining parameters. these are plus parameters rep resenting the orientation r and location of the camera. let this set of parameters be denoted collectively by q. the camera matrix p may then be explicitly computed in terms of the parameters. the geometric error may then be minimized with respect to the set of parameters using iterative minimization as levenberg marquardt. note that in the case of minimization of image error only the size of the minimization problem is unknown camera parameters. in other words the lm minimization is minimizing a function f in the case of minimization of and error the function f is from since the points must be included among the measurements and minimization also includes estimation of the true positions of the points. minimizing algebraic error. it is possible to minimize algebraic error instead in which case the iterative minimization problem becomes much smaller as will be explained next. consider the parametrization map taking a set of parameters q to the corresponding camera matrix p kr let this map be denoted by g. effectively one has a map p gq where p is the vector of entries of the matrix p. minimizing algebraic error over all point matches is equivalent to minimizing in general the matrix a may have a the reduced measurement matrix. very large number of rows. it is possible to replace a by a square matrix a such that ptatap for any vector p. such a matrix a is called a reduced measurement matrix. one way to do this is using the singular value decomposition let a udvt be the svd of a and define a dvt. then ata a t a as required. another way of obtaining a is to use the qr decomposition a q a where q has orthogonal columns and a is upper triangular and square. note that the mapping q agq is a mapping from to this is a simple parameter-minimization problem that may be solved using the levenberg marquardt method. the important point to note is the following given a set of n world to image correspondences xi xi the problem of ing a constrained camera matrix p that minimizes the sum of algebraic distances i dalgxi reduces to the minimization of a function independent of the number n of correspondences. p kr with k as in then p satisfies the condition minimization of takes place over all values of the parameters q. note that if since these entries are the same as the last row of the rotation matrix r. thus minimizing agq will lead to a matrix p satisfying the constraints s and x y and scaled restricted camera estimation such that all point correspondences. and which in addition minimizes the algebraic error for initialization. one way of finding camera parameters to initialize the iteration is as follows. use a linear algorithm such as dlt to find an initial camera matrix. clamp fixed parameters to their desired values instance set s and set x y to the average of their values obtained using dlt. set variable parameters to their values obtained by decomposition of the initial camera matrix section ideally the assumed values of the fixed parameters will be close to the values obtained by the dlt. however in practice this is not always the case. then altering these parameters to their desired values results in an incorrect initial camera matrix that may lead to large residuals and difficulty in converging. a method which works better in practice is to use soft constraints by adding extra terms to the cost function. thus for the case where s and x y one adds extra terms w x to the cost function. in the case of geometric image error the cost function becomes dxi w x i one begins with the values of the parameters estimated using the dlt. the weights begin with low values and are increased at each iteration of the estimation procedure. thus the values of s and the aspect ratio are drawn gently to their desired values. finally they may be clamped to their desired values for a final estimation. exterior orientation. suppose that all the internal parameters of the camera are known then all that remains to be determined are the position and orientation pose of the camera. this is the exterior orientation problem which is important in the analysis of calibrated systems. to compute the exterior orientation a configuration with accurately known position in a world coordinate frame is imaged. the pose of the camera is then sought. such a situation arises in hand eye calibration for robotic systems where the position of the camera is required and also in model-based recognition using alignment where the position of an object relative to the camera is required. there are six parameters that must be determined three for the orientation and three for the position. as each world to image point correspondence generates two constraints it would be expected that three points are sufficient. this is indeed the case and the resulting non-linear equations have four solutions in general. experimental evaluation results of constrained estimation for the calibration grid of example are given in table both the algebraic and geometric minimization involve an iterative minimization computation of the camera matrix p fy fxfy skew residual algebraic geometric table calibration for a restricted camera matrix. over parameters. however the algebraic method is far quicker since it minimizes only errors instead of in the geometric minimization. note that fixing skew and aspect ratio has altered the values of the other parameters table and increased the residual. covariance estimation. the techniques of covariance estimation and propagation of the errors into an image may be handled in just the same way as in the homography case similarly the minimum expected residual error may be computed as in result assuming that all errors are in the image measurements the expected ml residual error is equal to where d is the number of camera parameters being fitted for a full pinhole camera model. this formula may also be used to estimate the accuracy of the point measurements given a residual error. in the case of example where n and this results in a value of this value is greater than expected. the reason as we will see later lies in the camera model we are ignoring radial distortion. example covariance ellipsoid for an estimated camera suppose that the camera is estimated using the maximum likelihood standard method optimizing over a set of camera parameters. the estimated covariance of the point measurements can then be used to compute the covariance of the camera model by back-propagation according to result this gives camera where j is the jacobian matrix of the measured points in terms of the camera parameters. uncertainty in world points may also be taken into account in this way. if the camera is parametrized in terms of meaningful parameters as camera position then the variance of each parameter can be measured directly from the diagonal entries of the covariance matrix. points j knowing the covariance of the camera parameters error bounds or ellipsoids can be computed. for instance from the covariance matrix for all the parameters we may extract the subblock representing the covariance matrix of the camera position c. a confidence ellipsoid for the camera centre is then defined by ct c c where is computed from the inverse cumulative sired confidence level namely f n distribution in terms of the de n figure here n is the radial distortion a b fig. camera centre covariance ellipsoids. five images of stanislas square france for which calibration points are known. camera centre covariance ellipsoids corresponding to each image computed for cameras estimated from the imaged calibration points. note the typical cigar shape of the ellipsoid aligned towards the scene data. figure courtesy of vincent lepetit marie-odile berger and gilles simon. number of variables that is in the case of the camera centre. with the chosen level of certainty the camera centre lies inside the ellipsoid. figure shows an example of ellipsoidal uncertainty regions for computed camera centres. given the estimated covariance matrix for the computed camera the techniques of section may be used to compute the uncertainty in the image positions of further world points. radial distortion the assumption throughout these chapters has been that a linear model is an accurate model of the imaging process. thus the world point image point and optical centre are collinear and world lines are imaged as lines and so on. for real lenses this assumption will not hold. the most important deviation is generally a radial distortion. in practice this error becomes more significant as the focal length price of the lens decreases. see figure the cure for this distortion is to correct the image measurements to those that would have been obtained under a perfect linear camera action. the camera is then effectively again a linear device. this process is illustrated in figure this correction must computation of the camera matrix p a b fig. short vs long focal lengths. note the curved imaged lines at the periphery in which are images of straight scene lines. radial distortion linear image correction fig. the image of a square with significant radial distortion is corrected to one that would have been obtained under a perfect linear lens. be carried out in the right place in the projection process. lens distortion takes place during the initial projection of the world onto the image plane according to subsequently the calibration matrix reflects a choice of affine coordinates in the image translating physical locations in the image plane to pixel coordinates. we will denote the image coordinates of a point under ideal pinhole projection by x y measured in units of focal-length. thus for a point x we have x y where xcam is the point in camera coordinates related to world coordinates by the actual projected point is related to the ideal point by a radial displacement. thus radial distortion is modelled as xd yd l r x y where x y is the ideal image position obeys linear projection. yd is the actual image position after radial distortion. r is the radial distance l r is a distortion factor which is a function of the radius r only. from the centre for radial distortion. radial distortion correction of distortion. in pixel coordinates the correction is written x xc lrx xc y yc lry yc. where y are the measured coordinates x y are the corrected coordinates and yc is the centre of radial distortion with note if the aspect ratio is not unity then it is necessary to correct for this when computing r. with this correction the coordinates x y are related to the coordinates of the world point by a linear projective camera. choice of the distortion function and centre. the function lr is only defined for positive values of r and an approximation to an arbitrary function lr may be given by a taylor expansion lr the coefficients for radial correction xc yc are considered part of the interior calibration of the camera. the principal point is often used as the centre for radial distortion though these need not coincide exactly. this correction together with the camera calibration matrix specifies the mapping from an image point to a ray in the camera coordinate system. computing the distortion function. the function lr may be computed by minimizing a cost based on the deviation from a linear mapping. for example algorithm estimates p by minimizing geometric image error for calibration objects such as the tsai grids of figure the distortion function may be included as part of the imaging process and the parameters i computed together with p during the iterative minimization of the geometric error. similarly the distortion function may be computed when estimating the homography between a single tsai grid and its image. a simple and more general approach is to determine lr by the requirement that images of straight scene lines should be straight. a cost function is defined on the imaged lines as the distance between the line joining the imaged line s ends and its mid-point after the corrective mapping by lr. this cost is iteratively minimized over the parameters i of the distortion function and the centre of radial distortion. this is a very practical method for images of urban scenes since there are usually plenty of lines available. it has the advantage that no special calibration pattern is required as the scene provides the calibration entities. example radial correction. the function lr is computed for the image of figure by minimizing a cost based on the straightness of imaged scene lines. the image is pixels and the correction and centre are computed as xc yc pixels where pixels are normalized by the average half-size of the image. this is a correction by pixels at the image periphery. the result of warping the image is shown in figure example we continue with the example of the calibration grid shown in figure and discussed in example radial distortion was removed by the straight line computation of the camera matrix p a b fig. radial distortion correction. the original image with lines which are straight in the world but curved in the image. several of these lines are annotated by dashed curves. the image warped to remove the radial distortion. note that the lines in the periphery of the image are now straight but that the boundary of the image is curved. method and then the camera calibrated using the methods described in this chapter. the results are given in table note that the residuals after radial correction are substantially smaller. estimation of the error of point measurements from the residual leads to a value of pixels. since radial distortion involves selective stretching of the image it is quite plausible that the effective focal length of the image is changed as seen here. fy fxfy skew residual linear iterative algebraic iterative linear iterative algebraic iterative table calibration with and without radial distortion correction. the results above the line are after radial correction the results below for comparison are without radial distortion the previous tables. the upper two methods in each case solve for the general camera model the lower two are for a constrained model with square pixels. in correcting for radial distortion it is often not actually necessary to warp the image. measurements can be made in the original image for example the position of a corner feature and the measurement simply mapped according to the question of where features should be measured does not have an unambiguous answer. warping the image will distort noise models of averaging and may well introduce aliasing effects. for this reason feature detection on the unwarped image will often be preferable. however feature grouping such as linking edgels into straight line primitives is best performed after warping since thresholds on linearity may well be erroneously exceeded in the original image. closure closure the literature the original application of the dlt in was for camera computation. estimation by iterative minimization of geometric errors is a standard procedure of photogrammetrists e.g. see a minimal solution for a calibrated camera from the image of points was the original problem studied by fischler and bolles in their ransac paper. solutions to this problem reoccur often in the literature a good treatment is given in and also quasi-linear solutions for one more than the minimum number of point correspondences xi xi are in and another class of methods which are not covered here is the iterative estimation of a projective camera starting from an affine one. the algorithm of model based pose in lines of code by dementhon and davis is based on this idea. a similar method is used in devernay and faugeras introduced a straight line method for comin the photogrammetry puting radial distortion into the computer vision literature. literature the method is known as plumb line correction see notes and exercises given world-to-image point correspondences xi xi show that there are in general four solutions for a camera matrix p with zero skew that exactly maps the world to image points. given world-to-image point correspondences xi xi show that there are in general four solutions for a camera matrix p with known calibration k that exactly maps the world to image points. find a linear algorithm for computing the camera matrix p under each of the following conditions the camera location not orientation is known. the direction of the principal ray of the camera is known. the camera location and the principal ray of the camera are known. the camera location and complete orientation of the camera are known. the camera location and orientation are known as well as some subset of the internal camera parameters x y s and conflation of focal length and position on principal axis. compare the imaged position of a point of depth d before and after an increase in camera focal length f or a displacement of the camera backwards along the principal axis. let yt and be the image coordinates of the point before and y computation of the camera matrix p after the change. following a similar derivation to that of show that x y k x y x y where kf f for a focal length change or for a displacement skew s and x y f. for a set of calibration points xi with depth relief i small compared to the average depth i i i.e. is approximately constant across the set. it follows that in calibrating i from such a set similar image residuals are obtained by changing the focal length kf or displacing the camera consequently the estimated parameters of focal length and position on the principal axis are correlated. pushbroom camera computation. the pushbroom camera described in section may also be computed using a dlt method. the x part of the projection matrix has degrees of freedom which may be determined by four or more point correspondences xi xi the y part of the projection matrix has degrees of freedom and may be determined from correspondences. hence a minimal solution requires points. details are given in more single view geometry chapter introduced the projection matrix as the model for the action of a camera on points. this chapter describes the link between other entities and their images under perspective projection. these entities include planes lines conics and quadrics and we develop their forward and back-projection properties. the camera is dissected further and reduced to its centre point and image plane. two properties are established images acquired by cameras with the same centre are related by a plane projective transformation and images of entities on the plane at infinity do not depend on camera position only on camera rotation and internal parameters k. the images of entities lines conics on are of particular importance. it will be seen that the image of a point on is a vanishing point and the image of a line on a vanishing line their images depend on both k and camera rotation. however the image of the absolute conic depends only on k it is unaffected by the camera s rotation. the conic is intimately connected with camera calibration k and is established. it follows that defines the angle between the relation rays back-projected from image points. these properties enable camera relative rotation to be computed from vanishing points independently of camera position. further since k enables the angle between rays to be computed from image points in turn k may be computed from the known angle between rays. in particular k may be determined from vanishing points corresponding to orthogonal scene directions. this means that a camera can be calibrated from scene features without requiring known world coordinates. a final geometric entity introduced in this chapter is the calibrating conic which enables a geometric visualization of k. action of a projective camera on planes lines and conics in this section indeed in most of this book it is only the form and rank of the camera projection matrix p that is important in determining its action. the particular properties and relations of its elements are often not relevant. more single view geometry c x z x x y fig. perspective image of points on a plane. the xy-plane of the world coordinate frame is aligned with the plane points on the image and scene planes are related by a plane projective transformation. on planes the point imaging equation x px is a map from a point in a world coordinate frame to a point in image coordinates. we have the freedom to choose the world coordinate frame. suppose it is chosen such that the xy-plane corresponds to a plane in the scene so that points on the scene plane have zero z-coordinate as shown in figure is assumed that the camera centre does not lie on the scene plane. then if the columns of p are denoted as pi the image of a point on is given by x px x y x y so that the map between points x y on and their image x is a general planar homography plane to plane projective transformation x hx with h a matrix of rank this shows that the most general transformation that can occur between a scene plane and an image plane under perspective imaging is a plane projective transformation. if the camera is affine then a similar derivation shows that the scene and image planes are related by an affine transformation. example for a calibrated camera p kr t the homography between a world plane at z and the image is where ri are the columns of r. h k t on lines forward projection. a line in projects to a line in the image. this is easily seen geometrically the line and camera centre define a plane and the image is the intersection of this plane with the image plane and is proved algebraically action of a projective camera on planes lines and conics l l c fig. line projection. a line l in is imaged as a line l by a perspective camera. the image line l is the intersection of the plane defined by l and the camera centre c with the image plane. conversely an image line l back-projects to a plane in the plane is the pull-back of the line. by noting that if a b are points in and a b their images under p then a point x a b on a line which is the join of a b in projects to a point x b pa pb a b which is on the line joining a and b. back-projection of lines. the set of points in space which map to a line in the image is a plane in space defined by the camera centre and image line as shown in figure algebraically result the set of points in space mapping to a line l via the camera matrix p is the plane ptl. proof. a point x lies on l if and only if xtl a space point x maps to a point px which lies on the line if and only if xtptl thus if ptl is taken to represent a plane then x lies on this plane if and only if x maps to a point on the line l. in other words ptl is the back-projection of the line l. geometrically there is a star family of planes through the camera centre and the three rows of the projection matrix pit are a basis for this star. the plane ptl is a linear combination of this basis corresponding to the element of the star containing the camera centre and the line l. for example if l then the plane is and is the back projection of the image x-axis. pl ucker line representation. understanding this material on pl ucker line mapping is not required for following the rest of the book. we now turn to forward projection of lines. if a line in is represented by pl ucker coordinates then its image can be expressed as a linear map on these coordinates. we will develop this map for both the matrix and line representations. more single view geometry result under the camera mapping p a line in represented as a pl ucker matrix l as defined in is imaged as the line l where plpt. where the notation is defined in proof. suppose as above that a pa b pb. the pl ucker matrix l for the line through a b in is l abt bat. then the matrix m plpt abt bat is and antisymmetric with null-space a b. consequently m b and since the line through the image points is given by l a b this completes the proof. it is clear from the form of that there is a linear relation between the image line coordinates li and the world line coordinates ljk but that this relation is quadratic in the elements of the point projection matrix p. thus may be rearranged such that the map between the pl ucker line coordinates l and the image line coordinates l is represented by a single matrix. it can be shown that definition the line projection matrix p is the matrix of rank given by p where pit are the rows of the point camera matrix p and pi pj are the pl ucker line coordinates of the intersection of the planes pi and pj. then the forward line projection is given by result under the line projection matrix p a line in represented by pl ucker line coordinates l as defined in is mapped to the image line l pl where the product l is defined in proof. suppose the line in is the join of the points a and b and these project to a pa b pb respectively. then the image line l a b consider the first element where the second equality follows from the other components follow in a similar manner. action of a projective camera on planes lines and conics the line projection matrix p plays the same role for lines as p does for points. the rows of p may be interpreted geometrically as lines in a similar manner to the interpretation of the rows of the point camera matrix p as planes given in section the rows pit of p are the principal plane and axis planes of the camera. the rows of p are the lines of intersection of pairs of these camera planes. for example the first row of p is and this is the pl ucker line representation of the line of intersection of the y axis plane and the principal plane the three lines corresponding to the three rows of p intersect at the camera centre. consider lines l in for which pl these lines are in the null-space of p. since each row of p is a line and from result the product if two lines intersect if follows that l intersects each of the lines represented by the rows of p. these lines are the intersection of the camera planes and the only point on all camera planes is the camera centre. thus we have the lines l in for which pl pass through the camera centre. the matrix p has a null-space. allowing for the homogeneous scale factor this null-space is a two-parameter family of lines containing the camera centre. this is to be expected since there is a star parameter family of lines in concurrent with a point. on conics back-projection of conics. a conic c back-projects to a cone. a cone is a degenerate quadric i.e. the matrix representing the quadric does not have full rank. the cone vertex in this case the camera centre is the null-vector of the quadric matrix. result under the camera p the conic c back-projects to the cone qco ptcp. proof. a point x lies on c if and only if xtcx a space point x maps to a point px which lies on the conic if and only if xtptcpx thus if qco ptcp is taken to represent a quadric then x lies on this quadric if and only if x maps to a point on the conic c. in other words qco is the back-projection of the conic c. note the camera centre c is qcoc ptcpc example suppose that p ki then the conic c back-projects to the cone the degenerate quadric since the vertex of qco kt c ktck the matrix qco has rank its null-vector is the camera centre c more single view geometry n k x n x contour generator a apparent contour c b fig. contour generator and apparent contour. for parallel projection for central projection. the ray from the camera centre through x is tangent to the surface at x. the set of such tangent points x defines the contour generator and their image defines the apparent contour. in general the contour generator is a space curve. figure courtesy of roberto cipolla and peter giblin. images of smooth surfaces the image outline of a smooth surface s results from surface points at which the imaging rays are tangent to the surface as shown in figure similarly lines tangent to the outline back-project to planes which are tangent planes to the surface. definition the contour generator is the set of points x on s at which rays are tangent to the surface. the corresponding image apparent contour is the set of points x which are the image of x i.e. is the image of the apparent contour is also called the outline and profile if the surface is viewed in the direction of x from the camera centre then the surface appears to fold or to have a boundary or occluding contour. it is evident that the contour generator depends only on the relative position of the camera centre and surface not on the image plane. however the apparent contour is defined by the intersection of the image plane with the rays to the contour generator and so does depend on the position of the image plane. in the case of parallel projection with direction k consider all the rays parallel to k which are tangent to s see figure these rays form a cylinder of tangent rays and the curve along which this cylinder is tangent to s is the contour generator the curve in which the cylinder meets the image plane is the apparent contour note that both and depend in an essential way on k. the set slips over the surface as the direction of k changes. for example with s a sphere is the great circle orthogonal to k. in this case the contour generator is a plane curve but in general is a space curve. we next describe the projection properties of quadrics. for this class of surface algebraic expressions can be developed for the contour generator and apparent contour. action of a projective camera on quadrics c fig. the cone of rays for a quadric. the vertex of the cone is the camera centre. the contour generator of a quadric is a plane curve conic which is the intersection of the quadric with the polar plane of the camera centre c. action of a projective camera on quadrics a quadric is a smooth surface and so its outline curve is given by points where the back-projected rays are tangent to the quadric surface as shown in figure suppose the quadric is a sphere then the cone of rays between the camera centre and quadric is right-circular i.e. the contour generator is a circle with the plane of the circle orthogonal to the line joining the camera and sphere centres. this can be seen from the rotational symmetry of the geometry about this line. the image of the sphere is obtained by intersecting the cone with the image plane. it is clear that this is a classical conic section so that the apparent contour of a sphere is a conic. in particular if the sphere centre lies on the principal camera axis then the conic is a circle. now consider a projective transformation of this geometry. under this map the sphere is transformed to a quadric and the apparent contour to a conic. however since intersection and tangency are preserved the contour generator is a conic. consequently the apparent contour of a general quadric is a conic and the contour generator is also a conic. we will now give algebraic representations for these geometric results. forward projection of quadrics. since the outline arises from tangency it is not surprising that the dual of the quadric q is important here since it defines the tangent planes to the quadric q. result under the camera matrix p the outline of the quadric q is the conic c given by c pq pt. proof. this expression is simply derived from the observation that lines l tangent to the conic outline satisfy ltc l these lines back-project to planes ptl that are tangent to the quadric and thus satisfy tq then it follows that for each line tq ltpq ptl ltc l more single view geometry and since this is true for all lines tangent to c the result follows. note the similarity of with the projection of a line represented by a pl ucker matrix an expression for the projection of the point quadric q can be derived from but it is quite complicated. however the plane of the contour generator is easily expressed in terms of q the plane of for a quadric q and camera with centre c is given by qc. this result follows directly from the pole polar relation for a point and quadric of section its proof is left as an exercise. note the intersection of a quadric and plane is a conic. so is a conic and its image which is the apparent contour is also a conic as has been seen above. we may also derive an expression for the cone of rays formed by the camera centre and quadric. this cone is a degenerate quadric of rank result the cone with vertex v and tangent to the quadric q is the degenerate quadric qco note that qcov so that v is the vertex of the cone as required. the proof is omitted. example we write the quadric in block form q q qt then if v which corresponds to the cone vertex being at the centre of the world coordinate frame qco qqt which is clearly a degenerate quadric. the importance of the camera centre an object in and camera centre define a set of rays and an image is obtained by intersecting these rays with a plane. often this set is referred to as a cone of rays even though it is not a classical cone. suppose the cone of rays is intersected by two planes as shown in figure then the two images i and i are clearly related by a perspective map. this means that images obtained with the same camera centre may be mapped to one another by a plane projective transformation in other words they are projectively equivalent and so have the same projective properties. a camera can thus be thought of as a projective imaging device measuring projective properties of the cone of rays with vertex the camera centre. the result that the two images i and i are related by a homography will now be derived algebraically to obtain a formula for this homography. consider two cameras p kri the importance of the camera centre c x x x fig. the cone of rays with vertex the camera centre. an image is obtained by intersecting this cone with a plane. a ray between a point x and the camera centre c pierces the planes in the image points x and all such image points are related by a planar homography hx. with the same centre. note that since the cameras have a common centre there is a simple relation between them namely it then follows that the images of a point x by the two cameras are related as that is the corresponding image points are related by a planar homography matrix as hx where h we will now investigate several cases of moving the image plane whilst fixing the camera centre. for simplicity the world coordinate frame will be chosen to coincide with the camera s so that p ki it will be assumed that the image plane never contains the centre as the image would then be degenerate. moving the image plane consider first an increase in focal length. to a first approximation this corresponds to a displacement of the image plane along the principal axis. the image effect is a simple magnification. this is only a first approximation because with a compound lens zooming will perturb both the principal point and the effective camera centre. algebraically if x are the images of a point x before and after zooming then x ki so that a short calculation shows that hx with h if only the focal lengths differ between k and then ki k where is the inhomogeneous principal point and k f is the magnification factor. this result follows directly from similar triangles the effect of zooming by a more single view geometry a b c fig. between images and the camera rotates about the camera centre. corresponding points is images of the same point are related by a plane projective transformation. note that points at different depths which are coincident in image such as the mug lip and cat body are also coincident in so there is no motion parallax in this case. however between images and the camera rotates about the camera centre and translates. under this general motion coincident points of differing depth in are imaged at different points in so there is motion parallax in this case due to the camera translation. factor k is to move the image point x on a line radiating from the principal point to k x k algebraically using the most general form the point of the calibration matrix k we may write ki k ka k k ki ki k a this shows that the effect of zooming by a factor k is to multiply the calibration matrix k on the right by diagk k camera rotation a second common example is where the camera is rotated about its centre with no change in the internal parameters. examples of this pure rotation are given in figure and figure algebraically if x are the images of a point x before and after the pure rotation x ki k x krk krk hx with h krk this homography is a conjugate rotation and is so that discussed further in section for now we mention a few of its properties by way of an example. example properties of a conjugate rotation the homography h krk has the same eigenvalues to scale as the rotation matrix namely ei e i where is an unknown scale factor h is scaled such that det h then consequently the angle of rotation between views may be computed directly from the phase of the complex eigenvalues of h. similarly it can be the importance of the camera centre a b c fig. synthetic views. source image. fronto-parallel view of the corridor floor generated from using the four corners of a floor tile to compute the homography. fronto-parallel view of the corridor wall generated from using the four corners of the door frame to compute the homography. shown exercises that the eigenvector of h corresponding to the real eigenvalue is the vanishing point of the rotation axis. for example between images and of figure there is a pure rotation of the camera. the homography h is computed by algorithm and from this the angle of rotation is estimated as and the axis vanishing point as i.e. virtually at infinity in the y direction so the rotation axis is almost parallel to the y-axis. the transformation h krk is an example of the infinite homography mapping h that will appear many times through this book. it is defined in section the conjugation property is used for auto-calibration in chapter applications and examples the homographic relation between images with the same camera centre can be exploited in several ways. one is the creation of synthetic images by projective warping. another is mosaicing where panoramic images can be created by using planar homographies to sew together views obtained by a rotating camera. example synthetic views new images corresponding to different camera orientations the same camera centre can be generated from an existing image by warping with planar homographies. in a fronto-parallel view a rectangle is imaged as a rectangle and the world and image rectangle have the same aspect ratio. conversely a fronto-parallel view can be synthesized by warping an image with the homography that maps a rectangle imaged as a quadrilateral to a rectangle with the correct aspect ratio. the algorithm is compute the homography h which maps the image quadrilateral to a rectangle with the correct aspect ratio. projectively warp the source image with this homography. examples are shown in figure more single view geometry fig. three images acquired by a rotating camera may be registered to the frame of the middle one as shown by projectively warping the outer images to align with the middle one. example planar panoramic mosaicing images acquired by a camera rotating about its centre are related to each other by a planar homography. a set of such images may be registered with the plane of one of the images by projectively warping the other images as illustrated in figure fig. planar panoramic mosaicing. eight images of thirty acquired by rotating a camcorder about its centre. the thirty images are registered using planar homographies and composed into the single panoramic mosaic shown. note the characteristic bow tie shape resulting from registering to an image at the middle of the sequence. in outline the algorithm is choose one image of the set as a reference. compute the homography h which maps one of the other images of the set to this reference image. the importance of the camera centre projectively warp the image with this homography and augment the reference image with the non-overlapping part of the warped image. repeat the last two steps for the remaining images of the set. the homographies may be computed by identifying least four corresponding points or by using the automatic method of algorithm an example saic is shown in figure projective notation it will be seen in chapter that if canonical projective coordinates are chosen for world and image points i.e. and then the camera matrix a d p b d c d which means b satisfies xi pxi i and also that pa this is known as the reduced d that the camera centre is c camera matrix and it is clearly completely specified by the degrees of freedom of the camera centre c. this is a further illustration of the fact that all images acquired by cameras with the same camera centre are projectively equivalent the camera has been reduced to its essence a projective device whose action is to map to with only the position of the camera centre affecting the result. this camera representation is used in establishing duality relations in chapter d c b c moving the camera centre the cases of zooming and camera rotation illustrate that moving the image plane whilst fixing the camera centre induces a transformation between images that depends only on the image plane motion but not on the structure. conversely no information on structure can be obtained by this action. however if the camera centre is moved then the map between corresponding image points does depend on the structure and indeed may often be used to determine the structure. this is the subject of much of the remainder of this book. how can one determine from the images alone whether the camera centre has moved? consider two points which have coincident images in the first view i.e. the points are on the same ray. if the camera centre is moved along that ray the image coincidence is lost. this relative displacement of previously coincident image points is termed parallax and is illustrated in figure and shown schematically in figure if the scene is static and motion parallax is evident between two views then the camera centre has moved. indeed a convenient method for obtaining a camera more single view geometry x l x c x x x c fig. motion parallax. the images of the space points and are coincident when viewed by the camera with centre c. however when viewed by a camera with centre which does not lie on the line l through and the images of the space points are not coincident. in fact the line through the image points is the image of the ray l and will be seen in chapter to be an epipolar line. the vector between the points is the parallax. and and motion that is only a rotation about its centre example for a camera mounted on a robot head is to adjust the motion until there is no parallax. an important special case of structure is when all scene points are coplanar. in this case the images of corresponding points are related by a planar homography even if the camera centre is moved. the map between images in this case is discussed in detail in chapter on planes. in particular vanishing points which are images of points on the plane are related by a planar homography for any camera motion. we return to this in section camera calibration and the image of the absolute conic up to this point we have discussed projective properties of the forward and backprojection of various entities lines conics these properties depend only on the form of the projective camera matrix p. now we describe what is gained if the camera internal calibration k is known. it will be seen that euclidean properties such as the angle between two rays can then be measured. what does calibration give? an image point x back-projects to a ray defined by x and points on the ray are written as d in the camera euclidean coordinate frame then the camera centre. calibration relates the image point to the ray s direction. suppose these points map to the point x ki dt kd up to scale. conversely the direction d is obtained from the image point x as d k thus we have established result the camera calibration matrix k is the transformation between x and the ray s direction d k measured in the camera s euclidean coordinate frame. note d k is in general not a unit vector. camera calibration and the image of the absolute conic c d fig. the angle between two rays. the angle between two rays with directions corresponding to image points respectively may be obtained from the familiar cosine formula for the angle between two vectors cos dt dt dt tk xt tk xt tk xt the formula shows that if k and consequently the matrix k tk is known then the angle between rays can be measured from their corresponding image points. a camera for which k is known is termed calibrated. a calibrated camera is a direction sensor able to measure the direction of rays like a protractor. the calibration matrix k also provides a relation between an image line and a scene plane result an image line l defines a plane through the camera centre with normal direction n ktl measured in the camera s euclidean coordinate frame. note the normal n will not in general be a unit vector. proof. points x on the line l back-project to directions d k which are orthogonal to the plane normal n and thus satisfy dtn xtk tn since points on l satisfy xtl it follows that l k tn and hence n ktl. the image of the absolute conic we now derive a very important result which relates the calibration matrix k to the image of the absolute conic first we must determine the map between the plane at infinity and the camera image plane. points on may be written as x and are imaged by a general camera p kri as x px kri d krd. this shows that more single view geometry the mapping between and an image is given by the planar homography x hd with h kr. note that this map is independent of the position of the camera c and depends only on the camera internal calibration and orientation with respect to the world coordinate frame. now since the absolute conic is on we can compute its image under h and find of the absolute image k tk result the proof. from result under a point homography x hx a conic c maps as c h tch it follows that which is the conic c i on maps to k trr so the iac tikr conic conic iac is the like the conic is an imaginary point conic with no real points. for the moment it may be thought of as a convenient algebraic device but it will be used in computations later in this chapter and also in chapter on camera auto-calibration. a few remarks here the image of the absolute conic depends only on the internal parameters k of the matrix p it does not depend on the camera orientation or position. it follows from that the angle between two rays is given by the simple expression cos xt xt xt this expression is independent of the projective coordinate frame in the image that is it is unchanged under projective transformation of the image. to see this consider any projective transformation h. the points xi are transformed to hxi and transforms any image conic to h t h thus is unchanged and hence holds in any projective coordinate frame in the image. a particularly important specialization of is that if two image points and correspond to orthogonal directions then xt this equation will be used at several points later in the book as it provides a linear constraint on we may also define the dual image of the absolute conic diac as kkt. this is a dual conic whereas is a point conic it contains no real points. the conic and is given by is the image of q pq pt. camera calibration and the image of the absolute conic result shows that once equivalently is identified in an image then k is also determined. this follows because a symmetric matrix may be uniquely decomposed into a product kkt of an upper-triangular matrix with positive diagonal entries and its transpose by the cholesky factorization result it was seen in chapter that a plane intersects in a line and this line intersects in two points which are the circular points of the imaged circular points lie on at the points at which the vanishing line of the plane intersects these final two properties of are the basis for a calibration algorithm as shown in the following example. example a simple calibration device the image of three squares planes which are not parallel but which need not be orthogonal provides sufficiently many constraints to compute k. consider one of the squares. the correspondences between its four corner points and their images define the homography h between the plane of the square and the image. applying this homography to circular points on determines their images as i thus we have two points on the yet unknown a similar procedure applied to the other squares generates a total of six points on from which it may be computed five points are required to determine a conic. in outline the algorithm has the following steps for each square compute the homography h that maps its corner points to their imaged points. alignment of the plane coordinate system with the square is a similarity transformation and does not affect the position of the circular points on the plane. compute the imaged circular points for the plane of that square as i writing h the imaged circular points are fit a conic to the six imaged circular points. the constraint that the imaged circular points lie on may be rewritten as two real constraints. if t and the imaginary and real parts lies on then give respectively ht and ht ht which are equations linear in the conic is determined up to scale from five or more such equations. using the cholesky factorization. compute the calibration k from figure shows a calibration object consisting of three planes imprinted with squares and the computed matrix k. for the purpose of internal calibration the squares have the advantage over a standard calibration object figure that no measured co-ordinates are required. more single view geometry k a b fig. calibration from metric planes. three squares provide a simple calibration object. the planes need not be orthogonal. the computed calibration matrix using the algorithm of example the image size is pixels. x a x image x b l image fig. orthogonality represented by conjugacy and pole polar relationships. image points back-project to orthogonal rays if the points are conjugate with respect to i.e. xt the point x and line l back-project to a ray and plane that are orthogonal if x and l are pole polar with respect to i.e. l x. for example section the vanishing point of the normal direction to a plane and the vanishing line of the plane are pole polar with respect to we will return to camera calibration in section where vanishing points and lines provide constraints on k. the geometric constraints that are used in example are discussed further in section orthogonality and the conic is a device for representing orthogonality in an image. it has already been seen that if two image points and back-project to orthogonal rays then the points satisfy xt similarly it may be shown that result a point x and line l back-projecting to a ray and plane respectively that are orthogonal are related by l x. geometrically these relations express that image points back-projecting to orthogonal rays are conjugate with respect to and that a point and line projecting to an orthogonal ray and plane are in a pole polar relationship x. see section a schematic representation of these two relations is given in figure vanishing points and vanishing lines these geometric representations of orthogonality and indeed the projective representation of the angle between two rays measured from image points are simply specializations and a recapitulation of relations derived earlier in the book. for example we have already developed a projective representation of the angle between two lines in namely cos dt dt dt where and are the directions of the lines are the points at which the lines intersect rays are lines in which are coincident at the camera centre and so may be applied directly to rays. this is precisely what does it is simply computed in the image. under the map h kr which is the homography between the plane in the world coordinate frame and the image plane ht h and substituting these relations into gives di h similarly the conjugacy and pole polar relations for orthogonality in the image are a direct image of those on as can be seen by comparing figure with figure in practice these orthogonality results find greatest application in the case of vanish ing points and vanishing lines. vanishing points and vanishing lines one of the distinguishing features of perspective projection is that the image of an object that stretches off to infinity can have finite extent. for example an infinite scene line is imaged as a line terminating in a vanishing point. similarly parallel world lines such as railway lines are imaged as converging lines and their image intersection is the vanishing point for the direction of the railway. vanishing points the perspective geometry that gives rise to vanishing points is illustrated in figure it is evident that geometrically the vanishing point of a line is obtained by intersecting the image plane with a ray parallel to the world line and passing through the camera centre. thus a vanishing point depends only on the direction of a line not on its position. consequently a set of parallel world lines have a common vanishing point as illustrated in figure algebraically the vanishing point may be obtained as a limiting point as follows points on a line in through the point a and with direction d are written as x a d see figure as the parameter varies from to the point x varies from the finite point a to the point d at infinity. under a projective camera p ki a point x is imaged at x px a pd a kd where a is the image of a. then the vanishing point v of the line is obtained as the more single view geometry x v x v c d x a x x x d x a x d c v b plane to line camera. the points xi i are fig. vanishing point formation. equally spaced on the world line but their spacing on the image line monotonically decreases. in the limit x the world point is imaged at x v on the vertical image line and at on the inclined image line. thus the vanishing point of the world line is obtained by intersecting the image plane with a ray parallel to the world line through the camera centre c. to plane camera. the vanishing point v of a line with direction d is the intersection of the image plane with a ray parallel to d through c. the world line may be parametrized as x a d where a is a point on the line and d limit v lim x lim kd kd. from result v kd means that the vanishing point v back-projects to a ray with direction d. note that v depends only on the direction d of the line not on its position specified by a. in the language of projective geometry this result is obtained directly in projective the plane at infinity is the plane of directions and all lines with the same direction intersect in the same point chapter the vanishing point is simply the image of this intersection. thus if a line has direction d then it intersects in the point x then v is the image of x d v px ki kd. to summarize result the vanishing point of lines with direction d in is the intersection vanishing points and vanishing lines v of the image plane with a ray through the camera centre with direction d namely v kd. note lines parallel to the image plane are imaged as parallel lines since v is at infinity in the image. however the converse that parallel image lines are the image of parallel scene lines does not hold since lines which intersect on the principal plane are imaged as parallel lines. example camera rotation from vanishing points vanishing points are images of points at infinity and provide orientation information in a similar manner to that provided by the fixed stars. consider two images of a scene obtained by calibrated cameras where the two cameras differ in orientation and position. the points at infinity are part of the scene and so are independent of the camera. their images the vanishing points are not affected by the change in camera position but are affected by the camera rotation. suppose both cameras have the same calibration matrix k and the camera rotates by r between views. let a scene line have vanishing point vi in the first view and i in the second. the vanishing point vi has direction di measured in the first camera s euclidean coordinate frame and the corresponding vanishing point i measured in the second camera s euclidean coordinate frame. these directions can be computed from the vanishing points for example di k where the normalizing factor is included to ensure that di is a unit vector. the directions di and are related by the camera rotation as i rdi which represents two independent constraints on r. thus the rotation matrix r can be computed from two such corresponding directions. i has direction i the angle between two scene lines. we have seen that the vanishing point of a scene line back-projects to a ray parallel to the scene line. consequently which determines the angle between rays back-projected from image points enables the angle between the directions of two scene lines to be measured from their vanishing points result let and be the vanishing points of two lines in an image and let be the image of the absolute conic in the image. if is the angle between the two line directions then cos vt vt vt a note on computing vanishing points often vanishing points are computed from the image of a set of parallel line segments though they may be determined in other ways for example by using equal length intervals on a line as described in example and example in the case of imaged parallel line segments the objective is to estimate their common image intersection which is the image of the direction of the parallel scene lines. due to measurement noise the imaged line segments will generally not intersect in a unique more single view geometry v a b c fig. ml estimate of a vanishing point from imaged parallel scene lines. estimating the vanishing point v involves fitting a line thin here through v to each measured line thick here. the ml estimate of v is the point which minimizes the sum of squared orthogonal distances between the fitted lines and the measured lines end points. measured line segments are shown in white and fitted lines in black. a close-up of the dashed square in note the very slight angle between the measured and fitted lines. point. commonly the vanishing point is then computed by intersecting the lines pairwise and using the centroid of these intersections or finding the closest point to all the measured lines. however these are not optimal procedures. under the assumption of gaussian measurement noise the maximum likelihood estimate of the vanishing point and line segments is computed by determining a set of lines that do intersect in a single point and which minimize the sum of squared orthogonal distances from the endpoints of the measured line segments as shown in figure this minimization may be computed numerically using the levenberg marquardt algorithm note that if the lines are defined by fitting to many points rather than just their end points one can use the method described in section to reduce each line to an equivalent pair of weighted end points which can then be used in this algorithm. figure shows an example of a vanishing point computed in this manner. it is evident that the residuals between the measured and fitted lines are very small. vanishing lines parallel planes in intersect in a common line and the image of this line is the vanishing line of the plane. geometrically the vanishing line is constructed as shown in figure by intersecting the image with a plane parallel to the scene plane through the camera centre. it is clear that a vanishing line depends only on the orientation of the scene plane it does not depend on its position. since lines parallel to a plane intersect the plane at it is easily seen that the vanishing point of a line parallel to a plane lies on the vanishing line of the plane. an example is shown in figure if the camera calibration k is known then a scene plane s vanishing line may be used to determine information about the plane and we mention three examples here the plane s orientation relative to the camera may be determined from its vanishing line. from result a plane through the camera centre with normal vanishing points and vanishing lines v v l a l b n c n fig. vanishing line formation. the two sets of parallel lines on the scene plane converge to the vanishing points and in the image. the line l through and is the vanishing line of the plane. the vanishing line l of a plane is obtained by intersecting the image plane with a plane through the camera centre c and parallel to a b c fig. vanishing points and lines. the vanishing line of the ground plane horizon of the corridor may be obtained from two sets of parallel lines on the plane. the vanishing points of lines which are nearly parallel to the image plane are distant from the finite image. note the monotonic decrease in the spacing of the imaged equally spaced parallel lines corresponding to the sides of the floor tiles. the vanishing point of lines parallel to a plane the ground plane lies on the vanishing line of the plane. more single view geometry direction n intersects the image plane in the line l k tn. consequently l is the vanishing line of planes perpendicular to n. thus a plane with vanishing line l has orientation n ktl in the camera s euclidean coordinate frame. the plane may be metrically rectified given only its vanishing line. this can be seen by considering a synthetic rotation of the camera in the manner of example since the plane normal is known from the vanishing line the camera can be synthetically rotated by a homography so that the plane is frontoparallel parallel to the image plane. the computation of this homography is discussed in exercise the angle between two scene planes can be determined from their vanishing lines. suppose the vanishing lines are and then the angle between the planes is given by lt lt lt cos the proof is left as an exercise. computing vanishing lines a common way to determine a vanishing line of a scene plane is first to determine vanishing points for two sets of lines parallel to the plane and then to construct the line through the two vanishing points. this construction is illustrated in figure alternative methods of determining vanishing points are shown in example and example however the vanishing line may be determined directly without using vanishing points as an intermediate step. for example the vanishing line may be computed given an imaged set of equally spaced coplanar parallel lines. this is a useful method in practice because such sets commonly occur in man-made structures such as stairs windows on the wall of a building fences radiators and zebra crossings. the following example illustrates the projective geometry involved. example the vanishing line given the image of three coplanar equally spaced parallel lines a set of equally spaced lines on the scene plane may be represented as ax where takes integer values. this set pencil of lines may be written as n b nt b where is the line at infinity on the scene plane. under perspective imaging the point transformation is x and the corresponding line map is ln h n nl where l the image of is the vanishing line of the plane. the imaged geometry is shown in figure note all lines ln intersect in a common vanishing point is given by li lj for i j and the spacing decreases monotonically with n. the vanishing line l may be determined from three lines of the set provided their index is identified. for example from the image of three equally spaced lines and the closed form solution for the vanishing line is by l vanishing points and vanishing lines l a l l n l l l l c b v fig. determining a planes vanishing line from imaged equally spaced parallel lines. image of a vertical fence with equally spaced bars. the computed vanishing line l from three equally spaced bars apart. note the vanishing point of the horizontal lines lies on this vanishing line. the spacing between the imaged lines ln monotonically decreases with n. the proof is left as an exercise. figure shows a vanishing line computed in this way. orthogonality relationships amongst vanishing points and lines it is often the case in practice that the lines and planes giving rise to vanishing points are orthogonal. in this case there are particularly simple relationships amongst their vanishing points and lines involving and furthermore these relations can be used to determine and consequently the camera calibration k as will be seen in section it follows from that the vanishing points of two perpendicular world lines satisfy vt this means that the vanishing points are conjugate with respect to as illustrated in figure similarly it follows from result that the vanishing point v of a direction perpendicular to a plane with vanishing line l satisfies l v. this means that the vanishing point and line are in a pole polar relation with respect to as is also illustrated in figure summarizing these image relations the vanishing points of lines with perpendicular directions satisfy vt if a line is perpendicular to a plane then their respective vanishing point v and vanishing line l are related by l v and inversely v l. the vanishing lines of two perpendicular planes satisfy lt more single view geometry c image plane l a l b fig. geometry of a vertical vanishing point and ground plane vanishing line. the vertical vanishing point v is the image of the vertical footprint of the camera centre on the ground plane the vanishing line l partitions all points in scene space. any scene point projecting onto the vanishing line is at the same distance from the plane as the camera centre if it lies above the line it is farther from the plane and if below then it is closer to the plane than the camera centre. for example suppose the vanishing line l of the ground plane horizon is identified in an image and the internal calibration matrix k is known then the vertical vanishing point v is the vanishing point of the normal direction to the plane may be obtained from v l. affine measurements and reconstruction it has been seen in section that identifying a scene plane s vanishing line allows affine properties of the scene plane to be measured. if in addition a vanishing point for a direction not parallel to the plane is identified then affine properties can be computed for the of the perspectively imaged scene. we will illustrate this idea for the case where the vanishing point corresponds to a direction orthogonal to the plane although orthogonality is not necessary for the construction. the method described in this section does not require that the internal calibration of the camera k be known. it will be convenient to think of the scene plane as the horizontal ground plane in which case the vanishing line is the horizon. similarly it will be convenient to think of the direction orthogonal to the scene plane as vertical so that v is the vertical vanishing point. this situation is illustrated in figure suppose we wish to measure the relative lengths of two line segments in the vertical direction as shown in figure we will show the following result result given the vanishing line of the ground plane l and the vertical vanishing point v then the relative length of vertical line segments can be measured provided their end point lies on the ground plane. clearly the relative lengths cannot be measured directly from their imaged lengths because as a vertical line recedes deeper into the scene further from the camera then its imaged length decreases. the construction to determine the relative lengths proceeds in two steps affine measurements and reconstruction l u image a v c d b l d image d v fig. computing length ratios of parallel scene lines. geometry the vertical line segments and have length and respectively. the base points are on the ground plane. we wish to compute the scene length ratio from the imaged configuration. in the scene the length of the line segment may be transferred to by constructing a line parallel to the ground plane to generate the point image geometry l is the ground plane image of by the intersection of and the line the line is parallel to in vanishing line and v the vertical vanishing point. a corresponding parallel line construction in the image requires first determining the vanishing point u from the images bi of bi and then determining the image. the points and are constructed by intersecting with the lines and respectively. the distance ratio is the computed estimate of step map the length of one line segment onto the other. in the length of may be compared to by constructing a line parallel to the ground plane in the direction that transfers onto this transferred point will be denoted figure in the image a corresponding construction is carried out by first determining the vanishing point u which is the intersection of with l. now any scene line parallel to is imaged as a line through u so in particular the intersection of the line with defines the image of the transferred point image of the line through parallel to is the line through and u. the figure step determine the ratio of lengths on the scene line. we now have four collinear points on an imaged scene line and wish to determine the actual length ratio in the scene. the four collinear image points are and v. these may be treated as images of scene points at distances and respectively along the scene line. the affine ratio may be obtained by applying a projective transfor more single view geometry objective given the vanishing line of the ground plane l and the vertical vanishing point v and the top and base points of two line segments as in figure compute the ratio of lengths of the line segments in the scene. algorithm compute the vanishing point u l. compute the transferred point u v represent the four points and v on the image line by their distance from and v respectively. compute a projective transformation mapping homogeneous coordinates and maps the vanishing point v to infinity. a suitable matrix is given by the distance of the scene points and from on may then be ob tained from the position of the points and their distance ratio is then given by v algorithm computing scene length ratios from a single image. mation to the image line which maps v to infinity. a geometric construction of this projectivity is shown in figure example details of the algorithm to carry out these two steps are given in algorithm note no knowledge of the camera calibration k or pose is necessary to apply the algorithm. in fact the position of the camera centre relative to the ground plane can also be computed. the algorithm is well conditioned even when the vanishing point andor line are at infinity in the image. for example under affine image conditionings or if the image plane is parallel to the vertical scene direction that v is at infinity. in these cases the distance ratio simplifies to example measuring a person s height in a single image suppose we have an image which contains sufficient information to compute the ground plane vanishing line and the vertical vanishing point and also one object of known height for which the top and base are imaged. then the height of a person standing on the ground plane can be measured anywhere in the scene provided that their head and feet are both visible. figure shows an example. the scene contains plenty of horizontal lines from which to compute a horizontal vanishing point. two such vanishing points determine the vanishing line of the floor is the horizon for this image. the scene also contains plenty of vertical lines from which to compute a vertical vanishing point assuming that the two people are standing vertically then their relative height may be computed directly from their length ratio using algorithm their absolute height may be determined by comput determining camera calibration k from a single view a c b d fig. height measurements using affine properties. the original image. we wish to measure the height of the two people. the image after radial distortion correction section the vanishing line is computed from two vanishing points corresponding to horizontal directions. the lines used to compute the vertical vanishing points are also shown. the vertical vanishing point is not shown since it lies well below the image. using the known height of the filing cabinet on the left of the image the absolute height of the two people are measured as described in algorithm the measured heights are within of ground truth. the computation of the uncertainty is described in ing their height relative to an object on the ground plane with known height. here the known height is provided by the filing cabinet. the result is shown in figure determining camera calibration k from a single view we have seen that once is known the angle between rays can be measured. conversely if the angle between rays is known then a constraint is placed on each known angle between two rays gives a constraint of the form on unfortunately for arbitrary angles and known and this gives a quadratic constraint on the entries of if the lines are perpendicular however reduces to vt and the constraint on is linear. a linear constraint on also results from a vanishing point and vanishing line arising from a line and its orthogonal plane. a common example is a vertical direction and horizontal plane as in figure from l v. writing this as l v more single view geometry condition vanishing points corresponding to orthogonal lines vanishing point v and vanishing line l corresponding to orthogonal line and plane constraint vt v metric plane imaged with known homography h ht ht ht zero skew square pixels type constraints linear linear linear linear linear table scene and internal constraints on removes the homogeneous scaling factor and results in three homogeneous equations linear in the entries of these are equivalent to two independent constraints on all these conditions provide linear constraints on given a sufficient number of such constraints may be computed and hence the camera calibration k also follows since the number of entries of that need be determined from scene constraints of this sort can be reduced if the calibration matrix k has a more specialized form than in the case where k is known to have zero skew or square pixels x y and s we can take advantage of this condition to help find in particular it is quickly verified by direct computation that result if s then if in addition x y then thus in solving for the image of the absolute conic one may easily take into account the zero-skew or square-aspect ratio constraint on the camera if such a constraint is known to exist. one may also verify that no such simple connection as result exists between the entries of k and those of kkt. we have now seen three sources of constraints on metric information on a plane imaged with a known homography see vanishing points and lines corresponding to perpendicular directions and planes internal constraints such as zero skew or square pixels as in result these constraints are summarized in table we now describe how these constraints may be combined to estimate and thence k. since all the above constraints the internal constraints are described algebraically as linear equations on it is a simple matter to combine them as rows of determining camera calibration k from a single view objective compute k via by combining scene and internal constraints. algorithm represent as a homogeneous w where each available constraint from table may be written as atw for example for the orthogonality constraint ut v where u and v the a is given by a similar constraints vectors are obtained from the other sources of scene and internal constraints. for example a metric plane generates two such constraints. n matrix for n constraints. stack the equations atw from each constraint in the form aw where a is a solve for w using the svd as in algorithm this determines decompose into k using matrix inversion and cholesky factorization section algorithm computing k from scene and internal constraints. a constraint matrix. all constraints may be collected together so that for n constraints the system of equations may be written as aw where a is a n matrix and w is a containing the six distinct homogeneous entries of with a minimum of constraint equations an exact solution is found. with more than five equations a least-squares solution is found by algorithm the method is summarized in algorithm with more than the minimum required five constraints we have the option to apply some of the constraints as hard constraints that is constraints that will be satisfied exactly. this can be done by parametrizing so that the constraints are satisfied explicitly instance setting for the zero skew constraint and also for the square-pixel constraint. the minimization method of algorithm may also be used to enforce hard constraints. otherwise treating all constraints as soft constraints and using algorithm will produce a solution in which the constraints are not satisfied exactly in the presence of noise for instance pixels may not be quite square. finally an important issue in practice is that of degeneracy. this occurs when the combined constraints are not independent and results in the matrix a dropping rank. if the rank is less than the number of unknowns then a parametrized family of solutions for hence k is obtained. also if conditions are near degenerate then the solution is ill-conditioned and the particular member of the family is determined by noise these degeneracies can often be understood geometrically for example in example if the three metric planes are parallel then the three pairs of imaged more single view geometry a b c fig. for the case that image skew is zero and the aspect ratio unity the principal point is the orthocentre of an orthogonal triad of vanishing points. original image. three sets of parallel lines in the scene with each set having direction orthogonal to the others. the principal point is the orthocentre of the triangle with the vanishing points as vertices. circular points are coincident and only provide a total of two constraints instead of six. a pragmatic solution to the problem of degeneracy popularized by zhang is to image a metric plane many times in varying positions. this reduces the chances of degeneracy occurring and also provides a very over-determined solution. example calibration from three orthogonal vanishing points suppose that it is known that the camera has zero skew and that the pixels are square equivalently their aspect ratio is known. a triad of orthogonal vanishing point directions supplies three more constraints. this gives a total of constraints sufficient to compute and hence k. in outline the algorithm has the following steps in the case of square pixels has the form each pair of vanishing points vi vj generates an equation vt i vj which is linear in the elements of the constraints from the three pairs of vanishing points are stacked together to form an equation aw where a is a matrix. the vector w is obtained as the null vector of a and this determines the ma by cholesky factorization of followed trix k is obtained from by inversion. an example is shown in figure vanishing points are computed corresponding to the three perpendicular directions shown in figure the image is pixels and the calibration matrix is computed to be k determining camera calibration k from a single view image plane l v l p l n v l c p x a v x l b v fig. geometric construction of the principal point. the vanishing line back-projects to a plane with normal n. the vanishing point back-projects to a line orthogonal to the plane the normal n of the plane through the camera centre c and the principal axis define a plane which intersects the image in the line l the line is the intersection of with the image plane and is also its vanishing line. the point is the intersection of the normal with the image plane and is also its vanishing point. clearly the principal point lies on l and l and are perpendicular on the image plane. the principal point may be determined from three such constraints as the orthocentre of the triangle. p x c a a l p x b b fig. geometric construction of the focal length. consider the plane defined by the camera centre c principal point and one of the vanishing points e.g. as shown in figure the rays from c to and x are perpendicular to each other. the focal length is the distance from the camera centre to the image plane. by similar triangles dp x where du v is the distance between the points u and v. in the image a circle is drawn with diameter the line between and x. a line through p perpendicular to meets the circle in two points a and b. the focal length equals the distance dp a. the principal point and focal length may also be computed geometrically in this case. the principal point is the orthocentre of the triangle with vertices the vanishing points. figure shows that the principal point lies on the perpendicular line from one triangle side to the opposite vertex. a similar construction for the other two sides shows that the principal point is the orthocentre. an algebraic derivation of this result is left to the exercises. the focal length can also be computed geometrically as shown in figure as a cautionary note this estimation method is degenerate if one of the vanishing more single view geometry a b fig. plane rectification via partial internal parameters original image. rectification assuming the camera has square pixels and principal point at the centre of the image. the focal length is computed from the single orthogonal vanishing point pair. the aspect ratio of a window in the rectified image differs from the ground truth value by note that the two parallel planes the upper building facade and the lower shopfront are both mapped to fronto-parallel planes. points say the vertical is at infinity. in this case a drops rank to two and there is a one-parameter family of solutions for and correspondingly for k. this degeneracy can be seen geometrically from the orthocentre construction of figure if is at infinity then the principal point p lies on the line but its x position is not defined. example determining the focal length when the other internal parameters are known we consider a further example of calibration from a single view. suppose that it is known that the camera has zero skew that the pixels are square equivalently their aspect ratio is known and also that the principal point is at the image centre. then only the focal length is unknown. in this case the form of is very simple it is a diagonal matrix with only one degree of freedom. using algorithm the focal length f may be determined from one further constraint such as the one arising from two vanishing points corresponding to orthogonal directions. an example is shown in figure here the vanishing points used in the constraint are computed from the horizontal edges of the windows and pavement and the vertical edges of the windows. these vanishing points also determine the vanishing line l of the building facade. given k and the vanishing line l the camera can be synthetically rotated such that the facade is fronto-parallel by mapping the image with a homography as in example the result is shown in figure note in example it was necessary to know the aspect ratio of a rectangle on the scene plane in order to rectify the plane. here it is only necessary to know the vanishing line of the plane because the camera calibration k provides the additional information required for the homography. the geometry of the constraints although the algebraic constraints given in table appear to arise from distinct sources they are in fact all equivalent to one of two simple geometric relations two points lying on the conic or conjugacy of two points with respect to for example the zero skew constraint is an orthogonality constraint it specifies that single view reconstruction the image x and y axes are orthogonal. these axes correspond to rays with directions in the camera s euclidean coordinate frame and respectively that are imaged at vx and vy the rays are parallel to the image plane. the zero skew constraint is just another way of writing the orthogonality constraint vt vx geometrically skew zero is equivalent y to conjugacy of the points and with respect to the square pixel constraint may be interpreted in two ways. a square has the property of defining two sets of orthogonal lines adjacent edges are orthogonal and so are the two diagonals. thus the square pixel constraint may be interpreted as a pair of orthogonal line constraints. the diagonal vanishing points of a square pixel are and the resulting orthogonality constraints lead to the square pixel constraints given in table alternatively the square pixel constraint can be interpreted in terms of two known points lying on the iac. if the image plane has square pixels then it has a euclidean coordinate system and the circular points have known coordinates i it may be verified that the two square pixel equations are equivalent to i i this is the most important geometric equivalence. in essence an image plane with square pixels acts as a metric plane in the scene. a square pixel image plane is equivalent to a metric plane imaged with a homography given by the identity. indeed if the homography h in the metric plane imaged with known homography constraint of table is replaced by the identity then the square pixel constraints are immediately obtained. thus we see that all the constraints given in table are derived either from known points lying on or from pairs of points that are conjugate with respect to determining may therefore be viewed as a conic fitting problem given points on the conic and conjugate point pairs. it is well to bear in mind that conic fitting is a delicate problem often unstable if the points are not well distributed on the conic. the same observation is true of the present problem which we have seen is equivalent to conic fitting. the method given in algorithm for finding the calibration from vanishing points amounts to minimization of algebraic error and therefore does not give an optimal solution. for greater accuracy the methods of chapter for instance the sampson error method of section should be used. single view reconstruction as an application of the methods developed in this chapter we demonstrate now the reconstruction of a texture mapped piecewise planar graphical model from a single image. the camera calibration methods of section and the rectification method of example may be combined to back project image regions to texture the planes of the model. the method will be illustrated for the image of figure where the scene contains three dominant and mutually orthogonal planes the building facades on the left and right and the ground plane. the parallel line sets in three orthogonal directions de more single view geometry a b c fig. single view reconstruction. original image of the fellows quad merton college oxford. views of the model created from the single image. the vanishing line of the roof planes is computed from the repetition of the texture pattern. fine three vanishing points and together with the constraint of square pixels the camera calibration may be computed using the method described in section from the vanishing lines of the three planes likewise determined by the vanishing points together with the computed homographies may be computed to texture map the appropriate image regions onto the orthogonal planes of the model. in more detail taking the left facade as a reference plane in figure its correctly proportioned width and height are determined by the rectification. the right facade and ground planes define planes orthogonal to the reference have assumed the orthogonality of the planes in computing the camera so relative orientations are defined. scaling of the right and ground planes is computed from the points common to the planes and this completes a three orthogonal plane model. having computed the calibration the relative orientation of planes in the scene that are not orthogonal as the roof can be computed if their vanishing lines can be found using their relative positions and dimensions can be determined if the intersection of a pair of planes is visible in the image so that there are points common to both planes. relative size can be computed from the rectification of a distance between common points using the homographies of both planes. views of the model with texture mapped correctly to the planes appear in figure and the calibrating conic the calibrating conic the image of the absolute conic is an imaginary conic in an image and hence is not visible. sometimes it is useful for visualization purposes to consider a different conic that is closely related to the calibration of the camera. such a conic is the calibrating conic which is the image of a cone with apex angle and axis coinciding with the principal axis of the camera. we wish to compute a formula for this cone in terms of the calibration matrix of the camera. since the cone moves with the camera its image is clearly independent of the orientation and position of the camera. thus we may assume that the camera is located at the origin and oriented directly along the z-axis. thus let the camera matrix be p ki now any point on the cone satisfies points on this cone map to points on the conic c k t k as one easily verifies from result this conic will be referred to as the calibrating conic of the camera. for a calibrated camera with identity calibration matrix k i the calibrating conic is a unit circle centred at the origin is the principal point of the image. the conic of is simply this unit circle transformed by an affine transformation according to the conic transformation rule of result h tch thus the calibrating conic of a camera with calibration matrix k is the affine transformation of a unit circle centred on the origin by the matrix k. the calibration parameters are easily read from the calibrating conic. the principal point is the centre of the conic and the scale factors and skew are easily identified as in figure in the case of zero skew the calibrating conic has its principal axes aligned with the image coordinate axes. an example on a real image is shown in figure example suppose k diagf f which is the calibration matrix for a camera of focal length f pixels with no skew square pixels and image origin coincident with the principal point. then from the calibrating conic is c f which is a circle of radius f centred on the principal point. in particular the rays corresponding to two points x and orthogonality and the calibrating conic a formula was given in for the angle between the rays corresponding to two image points. are perpendicular when x as shown in figure this may be interpreted as the point we wish to carry out a similar analysis in terms of the calibrating conic. writing c k tdk where d we find lying on the line x which is the polar of x with respect to the iac. c tk s where s kdk however for any point x the product sx represents the reflection of more single view geometry y x x y s y x x y a b fig. reading the internal camera parameters k from the calibrating conic. skew s is zero. skew s is non-zero. the skew parameter of k is given by the x-coordinate of the highest point of the conic. l x x c fig. to construct the line perpendicular to the ray through image point x proceed as follows reflect x through the centre of c to get point x at the same distance from the centre as x. the desired line is the polar of x. the point x through the centre of the conic c that is the principal point of the camera. representing this reflected point by x one finds that x x this leads to the following geometric result result the line in an image corresponding to the plane perpendicular to a ray through image point x is the polar c x of the reflected point x with respect to the calibrating conic. this construction is illustrated in figure example the calibrating conic given three orthogonal vanishing points the calibrating conic can be drawn directly for the example of figure again assume there is no skew and square pixels then the calibrating conic is a circle. now given three mutually perpendicular vanishing points one can find the calibrating conic by direct geometric construction as shown in figure first construct the triangle with vertices the three vanishing points and the centre of c is the orthocentre of the triangle. closure calibrating conic c a v calibrating conic v c b fig. the calibrating conic computed from three orthogonal vanishing points. the geometric construction. the calibrating conic for the image of figure reflect one of the vanishing points in the centre to get the radius of c is determined by the condition that the polar of is the line passing though and closure the literature faugeras and mourrain and faugeras and papadopoulo develop the projection of lines using pl ucker coordinates. koenderink and giblin and weiss give many properties of the contour generator and apparent contour and their relation to the differential geometry of surfaces. gives an alternative calibrated treatment of vanishing points and lines and of the result that images acquired by cameras with the same centre are related by a planar homography. mundy and zisserman showed this result geometrically and gave a simple algebraic derivation based on camera projection matrices. introduced the projective camera matrix. the link between the image of the absolute conic and camera calibration was first given in the computation of panoramic mosaics is described in the ml method of computing vanishing points is given in liebowitz zisserman applications of automatic vanishing line estimation from coplanar equally spaced lines are given in and also affine measurements from a single view is described in the result that k may be computed from multiple scene planes on which metric structure as a square is known was given in algorithms for this computation are given in the advantage in using rather than when imposing the skew zero constraint was first noted in the method of internal calibration using three vanishing points for orthogonal directions was given by caprile and torre though there more single view geometry is an earlier reference to this result in the photogrammetry literature a simple formula for the focal length in this case is given in a discussion of the degeneracies that arise when combining multiple constraints is given in single view reconstruction is investigated in notes and exercises homography from a world plane. suppose h is computed from the correspondence between four or more known world points and their images and k known then the pose of the camera t may be computed from the camera matrix t where t k note that there is a two-fold ambiguity. this result follows from which gives the homography between a world plane and calibrated camera p show that the homography x between points on a world plane dt kr t. have coordinates y zt. and the image may be expressed as h kr tntd. the points on the plane line projection. the map i.e. it is projected to the line l show that any line containing the camera centre lies in the null-space of show that the line l p tx in is the ray through the image point x and the camera centre. hint start from result and show that the camera centre c lies on l. what is the geometric interpretation of the columns of p? contour generator of a quadric. the contour generator of a quadric consists of the set of points x on q for which the tangent planes contain the camera centre c. the tangent plane at a point x on q is given by qx and the condition that c is on is ct ctqx thus points x on satisfy ctqx and thus lie on the plane qc since t x ctqx this shows that the contour generator of a quadric is a plane curve and furthermore since qc that the plane of is the polar plane of the camera centre with respect to the quadric. apparent contour of an algebraic surface. show that the apparent contour of a homogeneous algebraic surface of degree n is a curve of degree nn for example if n then the surface is a quadric and the apparent contour a conic. hint write the surface as f y z w then the tangent plane contains the camera centre c if f y which is a surface of a degree n f x cx cy cz f z cw f w closure rotation axis vanishing point for h krk the homography of a conjugate rotation h krk has an eigenvector ka where a is the direction of the rotation axis since hka kra ka. the last equality follows because ra i.e. a is the unit eigenvector of r. it follows that ka is a fixed point under the homography h and from result v ka is the vanishing point of the rotation axis. synthetic rotations. suppose as in example that a homography is estimated between two images related by a pure rotation about the camera centre. then the estimated homography will be a conjugate rotation so that h kr k and r are unknown. however applied to the first image generates the image that would have been obtained by rotating the camera about the same axis through twice the angle since more generally we may write h to represent a rotation through any fractional angle to make sense of h observe that the eigenvalue decomposition of h i u and both and u may be computed from the is h u ei e estimated h. then h u ei e i u kr which is the conjugate of a rotation through angle writing instead of we may use this homography to generate synthetic images rotated through any angle the images are interpolated between the original images or extrapolated show that the imaged circular points of a perspectively imaged plane may be computed if any of the following are on the plane a square grid two rectangles arranged such that the sides of one rectangle are not parallel to the sides of the other two circles of equal radius two circles of unequal radius. show that in the case of zero skew is the conic x x y y which may be interpreted as an ellipse aligned with the axes centred on the principal point and with axes of length i x and i y in the x and y directions respectively. if the camera calibration k and the vanishing line l of a scene plane are known then the scene plane can be metric rectified by a homography corresponding to a synthetic rotation h krk that maps l to l i.e. it is required that h tl this condition arises because if the plane is rotated such that its vanishing line is l then it is fronto-parallel. show that h tl is equivalent to rn where n ktl is the normal to the scene plane. this is the condition that the scene normal is rotated to lie along the camera z axis. note the rotation is not uniquely defined since a rotation about the plane s more single view geometry normal does not affect its metric rectification. however the last row of r equals n so that r nt where n and are a triad of orthonormal vectors. show that the angle between two planes with vanishing lines and is lt lt lt cos derive hint the line l lies in the pencil defined by and so it can be expressed as l then use the relations ln nl for n to solve for and for the case of vanishing points arising from three orthogonal directions and for an image with square pixels show algebraically that the principal point is the orthocentre of the triangle with vertices the vanishing points. hint suppose the vanishing point at one vertex of the triangle is v and the line of the opposite side the other two vanishing points is l. then from v l since v and l arise from an orthogonal line and plane respectively. show that the principal point lies on the line from v to l which is perpendicular in the image to l. since this result is true for any vertex the principal point is the orthocentre of the triangle. show that the vanishing points of an orthogonal triad of directions are the ver tices of a self-polar triangle with respect to if a camera has square pixels then the apparent contour of a sphere centred on the principal axis is a circle. if the sphere is translated parallel to the image plane then the apparent contour deforms from a circle to an ellipse with the principal point on its major axis. how can this observation be used as a method of internal parameter calibration? show by a geometric argument that the aspect ratio of the ellipse does not depend on the distance of the sphere from the camera. if the sphere is now translated parallel to the principal axis the apparent contour can deform to a hyperbola but only one branch of the hyperbola is imaged. why is this? show that for a general camera the apparent contour of a sphere is related to the iac as c vvt where c is the conic outline of the imaged sphere and v is a that depends on the position of the sphere. a proof is given in note this relation places two constraints on so that in principle and hence the calibration k may be computed from three images of a sphere. however in practice this is not a well conditioned method for computing k because the deviation of the sphere s outline from a circle is small. part ii two-view geometry the birth of venus c. on canvas by sandro botticelli galleria degli uffizi florence italybridgeman art library outline this part of the book covers the geometry of two perspective views. these views may be acquired simultaneously as in a stereo rig or acquired sequentially for example by a camera moving relative to the scene. these two situations are geometrically equivalent and will not be differentiated here. each view has an associated camera matrix p indicates entities associated with the second view and a point x is imaged as x px in the first view and in the second. image points x and correspond because they are the image of the same point. there are three questions that will be addressed where correspondence geometry. given an image point x in the first view how does this constrain the position of the corresponding point camera geometry given a set of corresponding image points for the two views? scene geometry given corresponding image points x i i n what are the cameras p and what is the position of pre-image x in in the second view? and cameras p chapter describes the epipolar geometry of two views and directly answers the first question a point in one view defines an epipolar line in the other view on which the corresponding point lies. the epipolar geometry depends only on the cameras their relative position and their internal parameters. it does not depend at all on the scene structure. the epipolar geometry is represented by a matrix called the fundamental matrix f. the anatomy of the fundamental matrix is described and its computation from camera matrices p and may be computed from f up to a projective ambiguity of given. it is then shown that p and chapter describes one of the most important results in uncalibrated multiple view geometry a reconstruction of both cameras and scene structure can be computed from image point correspondences alone no other information is required. this answers both the second and third questions simultaneously. the reconstruction obtained from point correspondences alone is up to a projective ambiguity of and this ambiguity can be resolved by supplying well defined additional information on the cameras or scene. in this manner an affine or metric reconstruction may be computed from uncalibrated images. the following two chapters then fill in the details and numerical algorithms for computing this reconstruction. chapter describes methods for computing f from a set of corresponding image points i even though the structure pre-image xi of these points is unknown and the camera matrices are unknown. the cameras p and may then be determined up to a projective ambiguity from the computed f. chapter then describes the computation of scene structure by triangulation given the cameras and corresponding image points the point x in is computed as the intersection of rays backprojected from the corresponding points x and similarly the position of other geometric entities such as lines or conics may also be computed given their image correspondences. via their associated cameras p chapter covers the two-view geometry of planes. it provides an alternative answer to the first question if scene points lie on a plane then once the geometry of this plane is computed the image x of a point in one image determines the position of in the other image. the points are related by a plane projective transformation. this chapter also describes a particularly important projective transformation between views the infinite homography which is the transformation arising from the plane at infinity. are affine. this case has a number of simplifications over the general projective case and provides a very good approximation in many practical situations. chapter describes two-view geometry in the specialized case that the two cameras p and epipolar geometry and the fundamental matrix the epipolar geometry is the intrinsic projective geometry between two views. it is independent of scene structure and only depends on the cameras internal parameters and relative pose. the fundamental matrix f encapsulates this intrinsic geometry. it is a matrix of rank if a point in x is imaged as x in the first view and in the second then the image points satisfy the relation we will first describe epipolar geometry and derive the fundamental matrix. the properties of the fundamental matrix are then elucidated both for general motion of the camera between the views and for several commonly occurring special motions. it is next shown that the cameras can be retrieved from f up to a projective transformation of this result is the basis for the projective reconstruction theorem given in chapter finally if the camera internal calibration is known it is shown that the euclidean motion of the cameras between views may be computed from the fundamental matrix up to a finite number of ambiguities. the fundamental matrix is independent of scene structure. however it can be computed from correspondences of imaged scene points alone without requiring knowledge of the cameras internal parameters or relative pose. this computation is described in chapter epipolar geometry the epipolar geometry between two views is essentially the geometry of the intersection of the image planes with the pencil of planes having the baseline as axis baseline is the line joining the camera centres. this geometry is usually motivated by considering the search for corresponding points in stereo matching and we will start from that objective here. suppose a point x in is imaged in two views at x in the first and in the second. what is the relation between the corresponding image points x and as shown in figure the image points x and space point x and camera centres are coplanar. denote this plane as clearly the rays back-projected from x and intersect at x and the rays are coplanar lying in it is this latter property that is of most significance in searching for a correspondence. epipolar geometry and the fundamental matrix x epipolar plane x x x x c x c x e l e epipolar line for x a b and image planes. the camera centres point x and its images x and fig. point correspondence geometry. the two cameras are indicated by their centres c and lie in a common plane an image point x back-projects to a ray in defined by the first camera centre c and x. this ray is imaged as a line in the second view. the point x which projects to x must lie on this ray so the image of x in the second view must lie on l l e e baseline a e baseline x b e fig. epipolar geometry. the camera baseline intersects each image plane at the epipoles e and any plane containing the baseline is an epipolar plane and intersects the image planes in corresponding epipolar lines l and as the position of the point x varies the epipolar planes rotate about the baseline. this family of planes is known as an epipolar pencil. all epipolar lines intersect at the epipole. supposing now that we know only x we may ask how the corresponding point is constrained. the plane is determined by the baseline and the ray defined by x. from above we know that the ray corresponding to the point lies in hence the point of with the second image plane. this line is the image in the second view of the ray back-projected from x. it is the epipolar line corresponding to x. in terms of a stereo correspondence algorithm the benefit is that the search for the point corresponding to x need not cover the entire image plane but can be restricted to the line lies on the line of intersection the geometric entities involved in epipolar geometry are illustrated in figure the terminology is the epipole is the point of intersection of the line joining the camera centres baseline with the image plane. equivalently the epipole is the image in one view the fundamental matrix f e e a b c fig. converging cameras. epipolar geometry for converging cameras. and a pair of images with superimposed corresponding points and their epipolar lines white. the motion between the views is a translation and rotation. in each image the direction of the other camera may be inferred from the intersection of the pencil of epipolar lines. in this case both epipoles lie outside of the visible image. of the camera centre of the other view. it is also the vanishing point of the baseline direction. an epipolar plane is a plane containing the baseline. there is a one-parameter family pencil of epipolar planes. an epipolar line is the intersection of an epipolar plane with the image plane. all epipolar lines intersect at the epipole. an epipolar plane intersects the left and right image planes in epipolar lines and defines the correspondence between the lines. examples of epipolar geometry are given in figure and figure the epipolar geometry of these image pairs and indeed all the examples of this chapter is computed directly from the images as described in section the fundamental matrix f the fundamental matrix is the algebraic representation of epipolar geometry. in the following we derive the fundamental matrix from the mapping between a point and its epipolar line and then specify the properties of the matrix. there exists a corresponding epipolar line second image matching the point x must lie on the epipolar line given a pair of images it was seen in figure that to each point x in one image in the the epipolar line in the other image. any point epipolar geometry and the fundamental matrix e at infinity e at infinity a b c fig. motion parallel to the image plane. in the case of a special motion where the translation is parallel to the image plane and the rotation axis is perpendicular to the image plane the intersection of the baseline with the image plane is at infinity. consequently the epipoles are at infinity and epipolar lines are parallel. epipolar geometry for motion parallel to the image plane. and a pair of images for which the motion between views is a translation parallel to the x-axis with no rotation. four corresponding epipolar lines are superimposed in white. note that corresponding points lie on corresponding epipolar lines. is the projection in the second image of the ray from the point x through the camera centre c of the first camera. thus there is a map x from a point in one image to its corresponding epipolar line in the other image. it is the nature of this map that will now be explored. it will turn out that this mapping is a correlation that is a projective mapping from points to lines which is represented by a matrix f the fundamental matrix. geometric derivation we begin with a geometric derivation of the fundamental matrix. the mapping from a point in one image to a corresponding epipolar line in the other image may be decomposed into two steps. in the first step the point x is mapped to some point in the other image lying on the epipolar line is a potential match for the point x. in the second step the epipolar line to the epipole is obtained as the line joining this point step point transfer via a plane. refer to figure consider a plane in space not passing through either of the two camera centres. the ray through the first camera centre corresponding to the point x meets the plane in a point x. this point x is then projected to a point in the second image. this procedure is known as transfer via the plane since x lies on the ray corresponding to x the projected point must lie on the epipolar line corresponding to the image of this ray as illustrated in the fundamental matrix f x x e h l e fig. a point x in one image is transferred via the plane to a matching point image. the epipolar line through write h x and h x fx where f h is the fundamental matrix. is obtained by joining to the epipole in the second in symbols one may figure the points x and are both images of the point x lying on a plane. the set of all such points xi in the first image and the corresponding points i in the second image are projectively equivalent since they are each projectively equivalent to mapping each xi to the planar point set xi. thus there is a homography h i. step constructing the epipolar line. given the point through may be written as is defined in since the epipolar line h can be written as x we have and the epipole notation passing x fx h h where we define f the fundamental matrix. this shows result the fundamental matrix f may be written as f transfer mapping from one image to another via any plane furthermore since has rank and rank f is a matrix of rank where h h is the geometrically f represents a mapping from the projective plane of the first image to the pencil of epipolar lines through the epipole thus it represents a mapping from a onto a projective space and hence must have rank note the geometric derivation above involves a scene plane but a plane is not required in order for f to exist. the plane is simply used here as a means of defining a point map from one image to another. the connection between the fundamental matrix and transfer of points from one image to another via a plane is dealt with in some depth in chapter algebraic derivation the form of the fundamental matrix in terms of the two camera projection matrices p may be derived algebraically. the following formulation is due to xu and zhang epipolar geometry and the fundamental matrix the ray back-projected from x by p is obtained by solving px x. the one parameter family of solutions is of the form given by as x c where p is the pseudo-inverse of p i.e. pp i and c its null-vector namely the camera centre defined by pc the ray is parametrized by the scalar in particular two points on the ray are px and the first camera centre c these two points are imaged by the second camera at and respectively in the second view. the epipolar line is the line joining these two projected the point is the epipole in the second image points namely namely the projection of the first camera centre and may be denoted by thus fx where f is the matrix f this is essentially the same formula for the fundamental matrix as the one derived in in terms the previous section the homography having the explicit form h of the two camera matrices. note that this derivation breaks down in the case where the two camera centres are the same for in this case c is the common camera centre and so it follows that f defined in is the zero matrix. of both p and example suppose the camera matrices are those of a calibrated stereo rig with the world origin at the first camera p ki k p t. c then and f tt rk trrtt k trktkrtt where the various forms follow from result note that the epipoles as the image of the other camera centre are krtt rtt e p thus we may write as f tt rk trrtt k trkte the expression for the fundamental matrix can be derived in many ways and indeed will be derived again several times in this book. in particular expresses f in terms of determinants composed from rows of the camera matrices for each view. the fundamental matrix f correspondence condition up to this point we have considered the map x the most basic properties of the fundamental matrix. defined by f. we may now state result the fundamental matrix satisfies the condition that for any pair of corresponding points x in the two images correspond then this is true because if points x and lies on the epipolar line conversely fx corresponding to the point x. in other words if image points satisfy the relation then the rays defined by these points are coplanar. this is a necessary condition for points to correspond. the importance of the relation of result is that it gives a way of characterizing the fundamental matrix without reference to the camera matrices i.e. only in terms of corresponding image points. this enables f to be computed from image correspondences alone. we have seen from that f may be computed from the two camera matrices p and in particular that f is determined uniquely from the cameras up to an overall scaling. however we may now enquire how many correspondences are required to compute f from and the circumstances under which the matrix is uniquely defined by these correspondences. the details of this are postponed until chapter where it will be seen that in general at least correspondences are required to compute f. properties of the fundamental matrix definition suppose we have two images acquired by cameras with non-coincident centres then the fundamental matrix f is the unique rank homogeneous matrix which satisfies for all corresponding points x we now briefly list a number of properties of the fundamental matrix. the most important properties are also summarized in table transpose if f is the fundamental matrix of the pair of cameras then epipolar lines for any point x in the first image the corresponding epipolar represents the epipolar line corresponding fx. similarly l ft is the fundamental matrix of the pair in the opposite order line is to the epipole i.e. null-vector of f. fx contains satisfies for all x. it follows that is the left null-vector of f. similarly fe i.e. e is the right the epipole for any point x than e the epipolar line in the second image. thus p. epipolar lines fx is the epipolar line corresponding to x. l is the epipolar line corresponding to epipoles fe computation from camera matrices p general cameras epipolar geometry and the fundamental matrix f is a rank homogeneous matrix with degrees of freedom. point correspondence if x and are corresponding image points then f where p is the pseudo-inverse of p and with pc canonical cameras p m f m m te where m and e m cameras not at infinity p ki t f tt rk trktkrtt table summary of fundamental matrix properties. f has seven degrees of freedom a homogeneous matrix has eight independent ratios are nine elements and the common scaling is not significant however f also satisfies the constraint det f which removes one degree of freedom. fx which is the epipolar line of x. if l and f is a correlation a projective map taking a point to a line definition in this case a point in the first image x defines a line in the second are corresponding epipolar lines figure then any point x on l is mapped to the same line this means there is no inverse mapping and f is not of full rank. for this reason f is not a proper correlation would be invertible. the epipolar line homography the set of epipolar lines in each of the images forms a pencil of lines passing through the epipole. such a pencil of lines may be considered as a projective space. it is clear from figure that corresponding epipolar lines are perspectively related so that there is a homography between the pencil of epipolar lines centred at e in the first view and the pencil centred at in the second. a homography between two such projective spaces has degrees of freedom. for e for line through here we give an explicit formula for this mapping. the degrees of freedom of the fundamental matrix can thus be counted as follows and for the epipolar line homography which maps a line through e to a a geometric representation of this homography is given in section fundamental matrices arising from special motions l l e e p a b fig. epipolar line homography. there is a pencil of epipolar lines in each image centred on the epipole. the correspondence between epipolar lines li i is defined by the pencil of planes with axis the baseline. the corresponding lines are related by a perspectivity with centre any point p on the baseline. it follows that the correspondence between epipolar lines in the pencils is a homography. are related by are corresponding epipolar lines and k is any line not fk l. symmetrically result suppose l and passing through the epipole e then l and l proof. the expression l k l is the point of intersection of the two lines k and l and hence a point on the epipolar line l call it x. hence fk l fx is the epipolar line corresponding to the point x namely the line furthermore a convenient choice for k is the line e since kte ete so that the line e does not pass through the point e as is required. a similar argument holds for the choice of thus the epipolar line homography may be written as fe l l fundamental matrices arising from special motions a special motion arises from a particular relationship between the translation direction t and the direction of the rotation axis a. we will discuss two cases pure translation where there is no rotation and pure planar motion where t is orthogonal to a significance of the planar motion case is described in section the pure indicates that there is no change in the internal parameters. such cases are important firstly because they occur in practice for example a camera viewing an object rotating on a turntable is equivalent to planar motion for pairs of views and secondly because the fundamental matrix has a special form and thus additional properties. pure translation in considering pure translations of the camera one may consider the equivalent situation in which the camera is stationary and the world undergoes a translation t. in this situation points in move on straight lines parallel to t and the imaged intersection of these parallel lines is the vanishing point v in the direction of t. this is illustrated in figure and figure it is evident that v is the epipole for both views and the imaged parallel lines are the epipolar lines. the algebraic details are given in the following example. epipolar geometry and the fundamental matrix parallel lines e vanishing point image camera centre fig. under a pure translational camera motion points appear to slide along parallel rails. the images of these parallel lines intersect in a vanishing point corresponding to the translation direction. the epipole e is the vanishing point. c e e c a b c fig. pure translational motion. under the motion the epipole is a fixed point i.e. has the same coordinates in both images and points appear to move along lines radiating from the epipole. the epipole in this case is termed the focus of expansion and the same epipolar lines are overlaid in both cases. note the motion of the posters on the wall which slide along the epipolar line. example suppose the motion of the cameras is a pure translation with no rotation and no change in the internal parameters. one may assume that the two cameras are p ki and fundamental matrices arising from special motions ki t. then from r i and k if the camera translation is parallel to the x-axis then f kk so f the relation between corresponding points reduces to y y i.e. the epipolar lines are corresponding rasters. this is the situation that is sought by image rectification described in section indeed if the image point x is normalized as x y then from x px ki the space point s coordinates are y zt zk where z is the depth of the point x distance of x from the camera centre measured along the principal axis of the first camera. it then follows from ki tx that the mapping from an image point x to an image point is x ktz. the motion x ktz of shows that the image point starts at x and then moves along the line defined by x and the epipole e v. the extent of the motion depends on the magnitude of the translation t is not a homogeneous vector here and the inverse depth z so that points closer to the camera appear to move faster than those further away a common experience when looking out of a train window. note that in this case of pure translation f is skew-symmetric and has only degrees of freedom which correspond to the position of the epipole. the epipolar line of x is and e are collinear both images are overlaid on top of each other. this collinearity property is termed auto-epipolar and does not hold for general motion. fx x and x lies on this line since xte x i.e. x general motion. the pure translation case gives additional insight into the general motion case. given two arbitrary cameras we may rotate the camera used for the first image so that it is aligned with the second camera. this rotation may be simulated by applying a projective transformation to the first image. a further correction may be applied to the first image to account for any difference in the calibration matrices of the two images. the result of these two corrections is a projective transformation h of the first image. if one assumes these corrections to have been made then the effective relationship of the two cameras to each other is that of a pure translation. consequently the fundamental matrix corresponding to the corrected first image and satisfying f x where x hx is the the second image is of the form f corrected point in the first image. from this one deduces that hx and so the fundamental matrix corresponding to the initial point correspondences x is f h. this is illustrated in figure epipolar geometry and the fundamental matrix h c e c fig. general camera motion. the first camera the left may be rotated and corrected to simulate a pure translational motion. the fundamental matrix for the original pair is the product f h where is the fundamental matrix of the translation and h is the projective transformation corresponding to the correction of the first camera. example continuing from example assume again that the two cameras are p ki and t. then as described in section the requisite projective transformation is h h where h is the infinite homography section and f y zt zk and from x point x to an image point if the image point x is normalized as x y as in example then tx the mapping from an image h is the mapping is in two parts the first term depends on the image position alone i.e. x but not the point s depth z and takes account of the camera rotation and change of internal parameters the second term depends on the depth but not on the image position x and takes account of camera translation. in the case of pure translation i k reduces to pure planar motion in this case the rotation axis is orthogonal to the translation direction. orthogonality imposes one constraint on the motion and it is shown in the exercises at the end of this chapter that if k then fs the symmetric part of f has rank in this planar motion case for a general motion the symmetric part of f has full rank. thus the condition that det fs is an additional constraint on f and reduces the number of degrees of freedom from for a general motion to degrees of freedom for a pure planar motion. geometric representation of the fundamental matrix this section is not essential for a first reading and the reader may optionally skip to section in this section the fundamental matrix is decomposed into its symmetric and skewsymmetric parts and each part is given a geometric representation. the symmetric and geometric representation of the fundamental matrix f ft skew-symmetric parts of the fundamental matrix are fs f ft fa so that f fs fa. to motivate the decomposition consider the points x in that map to the same point in two images. these image points are fixed under the camera motion so that x clearly such points are corresponding and thus satisfy xtfx which is a necessary condition on corresponding points. now for any skew-symmetric matrix a the form xtax is identically zero. consequently only the symmetric part of f contributes to xtfx which then reduces to xtfsx as will be seen below the matrix fs may be thought of as a conic in the image plane. geometrically the conic arises as follows. the locus of all points in for which x is known as the horopter curve. generally this is a twisted cubic curve in section passing through the two camera centres the image of the horopter is the conic defined by fs. we return to the horopter in chapter symmetric part. the matrix fs is symmetric and is of rank in general. it has degrees of freedom and is identified with a point conic called the steiner conic name is explained below. the epipoles e and lie on the conic fs. to see that the epipoles lie on the conic i.e. that etfse start from fe then etfe and so etfse etfae however etfae since for any skew-symmetric matrix s xtsx thus etfse the derivation for follows in a similar manner. skew-symmetric part. the matrix fa is skew-symmetric and may be written as fa where xa is the null-vector of fa. the skew-symmetric part has degrees of freedom and is identified with the point xa. the relation between the point xa and conic fs is shown in figure the polar of xa intersects the steiner conic fs at the epipoles e and pole polar relation is described in section the proof of this result is left as an exercise. epipolar line correspondence. it is a classical theorem of projective geometry due to steiner that for two line pencils related by a homography the locus of intersections of corresponding lines is a conic. this is precisely the situation here. the pencils are the epipolar pencils one through e and the other through the epipolar lines are related by a homography as described in section the locus of intersection is the conic fs. the conic and epipoles enable epipolar lines to be determined by a geometric construction as illustrated in figure this construction is based on the fixed point property of the steiner conic fs. the epipolar line l x e in the first view defines an epipolar plane in which intersects the horopter in a point which we will call xc. the point xc is imaged in the first view at xc which is the point at which l intersects the conic fs fs is the image of the horopter. now the image of xc is also xc in the second view due to the fixed-point property of the horopter. so xc is the epipolar geometry and the fundamental matrix f s e l a x a a xc fs l e x b e fig. geometric representation of f. the conic fs represents the symmetric part of f and the point xa the skew-symmetric part. the conic fs is the locus of intersection of corresponding epipolar lines assuming both images are overlaid on top of each other. it is the image of the horopter curve. the line la is the polar of xa with respect to the conic fs. it intersects the conic at the epipoles e and the epipolar line corresponding to a point x is constructed as follows intersect the line defined by the points e and x with the conic. this intersection point is xc. then is the line defined by the points xc and image in the second view of a point on the epipolar plane of x. it follows that xc lies on the epipolar line of x and consequently may be computed as xc the conic together with two points on the conic account for the degrees of freedom of f degrees of freedom for the conic and one each to specify the two epipoles on the conic. given f then the conic fs epipoles e and skew-symmetric point xa are defined uniquely. however fs and xa do not uniquely determine f since the identity of the epipoles is not recovered i.e. the polar of xa determines the epipoles but does not determine which one is e and which one pure planar motion we return to the case of planar motion discussed above in section where fs has rank it is evident that in this case the steiner conic is degenerate and from section is equivalent to two non-coincident lines s lslt fs lhlt as depicted in figure the geometric construction of the epipolar line corresponding to a point x of section has a simple algebraic representation in this case. as in the general motion case there are three steps illustrated in figure first the line l e x joining e and x is computed second its intersection point with the conic xc ls l is determined third the epipolar line xc is the join of xc and putting these steps together we find h x x. it follows that f may be written as f the degrees of freedom of f are accounted for as degrees of freedom for each of the two epipoles and degrees of freedom for the line. retrieving the camera matrices l s e x s e l h x a image a x c l x l s l e e image b fig. geometric representation of f for planar motion. the lines ls and lh constitute the steiner conic for this motion which is degenerate. compare this figure with the conic for general corresponding to a point x is constructed as motion shown in figure follows intersect the line defined by the points e and x with the line ls. this intersection point is xc. then the epipolar line is the line defined by the points xc and the geometry of this situation can be easily visualized the horopter for this motion is a degenerate twisted cubic consisting of a circle in the plane of the motion plane orthogonal to the rotation axis and containing the camera centres and a line parallel to the rotation axis and intersecting the circle. the line is the screw axis section the motion is equivalent to a rotation about the screw axis with zero translation. under this motion points on the screw axis are fixed and consequently their images are fixed. the line ls is the image of the screw axis. the line lh is the intersection of the image with the plane of the motion. this geometry is used for autocalibration in chapter retrieving the camera matrices to this point we have examined the properties of f and of image relations for a point correspondence x we now turn to one of the most significant properties of f that the matrix may be used to determine the camera matrices of the two views. projective invariance and canonical cameras it is evident from the derivations of section that the map fx and the correspondence condition are projective relationships the derivations have involved only projective geometric relationships such as the intersection of lines and planes and in the algebraic development only the linear mapping of the projective camera between world and image points. consequently the relationships depend only on projective coordinates in the image and not for example on euclidean measurements such as the angle between rays. in other words the image relationships are projectively invariant under a projective transformation of the image coordinates x hx there is a f x with f tfh the corresponding rank fundamental corresponding map l matrix. similarly f only depends on projective properties of the cameras p the camera matrix relates measurements to image measurements and so depends on both the image coordinate frame and the choice of world coordinate frame. f does not epipolar geometry and the fundamental matrix depend on the choice of world frame for example a rotation of world coordinates changes p but not f. in fact the fundamental matrix is unchanged by a projective transformation of more precisely result if h is a matrix representing a projective transformation of then the fundamental matrices corresponding to the pairs of camera matrices and are the same. proof. observe that px and similarly for are matched points with respect to the pair of cameras corresponding to a point x then they are also matched points with respect to the pair of cameras corresponding to the point h thus although from a pair of camera matrices uniquely determine a fundamental matrix f the converse is not true. the fundamental matrix determines the pair of camera matrices at best up to right-multiplication by a projective transformation. it will be seen below that this is the full extent of the ambiguity and indeed the camera matrices are determined up to a projective transformation by the fundamental matrix. thus if x canonical form of camera matrices. given this ambiguity it is common to define a specific canonical form for the pair of camera matrices corresponding to a given fundamental matrix in which the first matrix is of the simple form where i is the identity matrix and a null to see that this is always possible let p be augmented by one row to make a non-singular matrix denoted p now letting h p one verifies that ph as desired. the following result is very frequently used result the fundamental matrix corresponding to a pair of camera matrices p and this is easily derived as a special case of m is equal to m. projective ambiguity of cameras given f it has been seen that a pair of camera matrices determines a unique fundamental matrix. this mapping is not injective however since pairs of camera matrices that differ by a projective transformation give rise to the same fundamental matrix. it will now be shown that this is the only ambiguity. we will show that a given fundamental matrix determines the pair of camera matrices up to right multiplication by a projective transformation. thus the fundamental matrix captures the projective relationship of the two cameras. theorem let f be a fundamental matrix and let be two pairs of camera matrices such that f is the fundamental matrix corresponding to each of these pairs. then there exists a non-singular matrix h such that p ph and p and p p retrieving the camera matrices and p p proof. suppose that a given fundamental matrix f corresponds to two different pairs of camera matrices as a first step we may simplify the problem by assuming that each of the two pair of camera matrices is in canonical form with p p since this may be done by applying projective transformations to each pair as necessary. thus suppose that p p and that a a a. according to result the fundamental matrix may then be written and p f a a a. we will need the following lemma lemma suppose the rank matrix f can be decomposed in two different ways avt for some non-zero as f a and f a a then a ka and a k constant k and v. k a a and so k a a avt for some v. hence a k proof. first note that atf ata a and similarly atf since f has rank it follows that a ka as required. next from a a a it follows that avt as required. a and applying this result to the two camera matrices shows that ka if they are to generate the same f. it only remains now to show p that these camera pairs are projectively related. let h be the matrix h and p k k k then one verifies that ph k k p and furthermore ah avt ka a a p so that the pairs p and p p are indeed projectively related. this can be tied precisely to a counting argument the two cameras p and each have degrees of freedom making a total of degrees of freedom. to specify a projective world frame requires degrees of freedom so once the degrees of freedom of the world frame are removed from the two cameras degrees of freedom remain which corresponds to the degrees of freedom of the fundamental matrix. canonical cameras given f we have shown that f determines the camera pair up to a projective transformation of we will now derive a specific formula for a pair of cameras with canonical form given f. we will make use of the following characterization of the fundamental matrix f corresponding to a pair of camera matrices if and only if is skew-symmetric. result a non-zero matrix f is the fundamental matrix corresponding to a pair of camera matrices p and proof. the condition that is skew-symmetric is equivalent to and x px this is equivalent to which is the for all x. setting defining equation for the fundamental matrix. epipolar geometry and the fundamental matrix one may write down a particular solution for the pairs of camera matrices in canon ical form that correspond to a fundamental matrix as follows result let f be a fundamental matrix and s any skew-symmetric matrix. define the pair of camera matrices p and is the epipole such that and assume that where so defined is a valid camera matrix rank then f is the fundamental matrix corresponding to the pair to demonstrate this we invoke result and simply verify that ftstf ftstf which is skew-symmetric. the skew-symmetric matrix s may be written in terms of its null-vector as s then f according to the following argument. has rank provided since the column space of the columns of f is perpendicular to but if then s is not perpendicular to and hence not in the column space of f. now the column space of f is spanned by the cross-products of s with the columns of f and therefore equals the plane perpendicular to s. so f has rank since is not perpendicular to s it does not lie in this plane and so f has rank as required. as suggested by luong and vi eville a good choice for s is s in this case which leads to the following useful result. for f has left submatrix result the camera matrices corresponding to a fundamental matrix f may be chosen as p and note that the camera matrix f which has rank this corresponds to a camera with centre on however there is no particular reason to avoid this situation. the proof of theorem shows that the four parameter family of camera pairs in canonical form p p avt ka have the same fundamental matrix as the canonical pair p a and that this is the most general solution. to summarize result the general formula for a pair of canonic camera matrices corresponding to a fundamental matrix f is given by p f where v is any and a non-zero scalar. the essential matrix the essential matrix the essential matrix is the specialization of the fundamental matrix to the case of normalized image coordinates below. historically the essential matrix was introduced longuet-higgins before the fundamental matrix and the fundamental matrix may be thought of as the generalization of the essential matrix in which the assumption of calibrated cameras is removed. the essential matrix has fewer degrees of freedom and additional properties compared to the fundamental matrix. these properties are described below. normalized coordinates. consider a camera matrix decomposed as p kr t and let x px be a point in the image. if the calibration matrix k is known then we may apply its inverse to the point x to obtain the point x k then x tx where x is the image point expressed in normalized coordinates. it may be thought of as the image of the point x with respect to a camera t having the identity matrix i as calibration matrix. the camera matrix k t is called a normalized camera matrix the effect of the known calibration matrix having been removed. now consider a pair of normalized camera matrices p and t. the fundamental matrix corresponding to the pair of normalized cameras is customarily called the essential matrix and according to it has the form e r r definition the defining equation for the essential matrix is x in terms of the normalized image coordinates for corresponding points x substituting for x and gives tek comparing this with the relation for the fundamental matrix it follows that the relationship between the fundamental and essential matrices is e properties of the essential matrix the essential matrix e r has only five degrees of freedom both the rotation matrix r and the translation t have three degrees of freedom but there is an overall scale ambiguity like the fundamental matrix the essential matrix is a homogeneous quantity. the reduced number of degrees of freedom translates into extra constraints that are satisfied by an essential matrix compared with a fundamental matrix. we investigate what these constraints are. result a matrix is an essential matrix if and only if two of its singular values are equal and the third is zero. epipolar geometry and the fundamental matrix proof. this is easily deduced from the decomposition of e as r sr where s is skew-symmetric. we will use the matrices and z w it may be verified that w is orthogonal and z is skew-symmetric. from result which gives a block decomposition of a general skew-symmetric matrix the skew-symmetric matrix s may be written as s kuzut where u is orthogonal. noting that up to sign z then up to scale s u and e sr u this is a singular value decomposition of e with two equal singular values as required. conversely a matrix with two equal singular values may be factored as sr in this way. since e u it may seem that e has six degrees of freedom and not five since both u and v have three degrees of freedom. however because the two singular values are equal the svd is not unique in fact there is a one-parameter family of svds for e. indeed an alternative svd is given by e for any rotation matrix r. extraction of cameras from the essential matrix the essential matrix may be computed directly from using normalized image coordinates or else computed from the fundamental matrix using of computing the fundamental matrix are deferred to chapter once the essential matrix is known the camera matrices may be retrieved from e as will be described next. in contrast with the fundamental matrix case where there is a projective ambiguity the camera matrices may be retrieved from the essential matrix up to scale and a four-fold ambiguity. that is there are four possible solutions except for overall scale which cannot be determined. we may assume that the first camera matrix is p in order to compute the second camera matrix it is necessary to factor e into the product sr of a skewsymmetric matrix and a rotation matrix. result suppose that the svd of e is u using the notation of there are signs two possible factorizations e sr as follows s uzut r uwvt or uwtvt proof. that the given factorization is valid is true by inspection. that there are no other factorizations is shown as follows. suppose e sr. the form of s is determined by the fact that its left null-space is the same as that of e. hence s uzut. the rotation r may be written as uxvt where x is some rotation matrix. then u e sr uzxvt from which one deduces that zx since x is a rotation matrix it follows that x w or x wt as required. closure the factorization determines the t part of the camera matrix up to scale from s however the frobenius norm of s uzut is which means that if s including scale then which is a convenient normalization for the baseline of the two camera matrices. since st it follows that t u the last column of u. however the sign of e and consequently t cannot be determined. thus corresponding to a given essential matrix there are four possible choices of the camera matrix based on the two possible choices of r and two possible signs of t. to summarize result for a given essential matrix e u and first camera matrix p there are four possible choices for the second camera matrix namely or or or geometrical interpretation of the four solutions it is clear that the difference between the first two solutions is simply that the direction of the translation vector from the first to the second camera is reversed. the relationship of the first and third solutions in result is a little more compli cated. however it may be verified that vwtwtvt and vwtwtvt v diag is a rotation through about the line joining the two camera centres. two solutions related in this way are known as a twisted pair the four solutions are illustrated in figure where it is shown that a reconstructed point x will be in front of both cameras in one of these four solutions only. thus testing with a single point to determine if it is in front of both cameras is sufficient to decide between the four different solutions for the camera matrix note. the point of view has been taken here that the essential matrix is a homogeneous quantity. an alternative point of view is that the essential matrix is defined exactly by the equation e r including scale and is determined only up to indeterminate scale by the equation the choice of point of view depends on which of these two equations one regards as the defining property of the essential matrix. closure the literature the essential matrix was introduced to the computer vision community by longuethiggins with a matrix analogous to e appearing in the photogrammetry literature e.g. many properties of the essential matrix have been elucidated particularly by huang and faugeras and the realization that the essential matrix could also be applied in uncalibrated situations as it represented a projective relation developed in the early part of the epipolar geometry and the fundamental matrix a b b a a b b a fig. the four possible solutions for calibrated reconstruction from e. between the left and right sides there is a baseline reversal. between the top and bottom rows camera b rotates about the baseline. note only in is the reconstructed point in front of both cameras. and was published simultaneously by faugeras and hartley et al. the special case of pure planar motion was examined by for the essential matrix. the corresponding case for the fundamental matrix is investigated by beardsley and zisserman and vi eville and lingrand where further properties are given. notes and exercises fixating cameras. suppose two cameras fixate on a point in space such that their principal axes intersect at that point. show that if the image coordinates are normalized so that the coordinate origin coincides with the principal point then the element of the fundamental matrix is zero. mirror images. suppose that a camera views an object and its reflection in a plane mirror. show that this situation is equivalent to two views of the object and that the fundamental matrix is skew-symmetric. compare the fundamental matrix for this configuration with that of a pure translation and a pure planar motion. show that the fundamental matrix is auto-epipolar is show that if the vanishing line of a plane contains the epipole then the plane is parallel to the baseline. steiner conic. show that the polar of xa intersects the steiner conic fs at the epipoles hint start from fe fse fae since e lies on the conic fs then fse is the tangent line at e and fae e xa e is a line through xa and e. closure the affine type of the steiner conic ellipse or parabola as given in section depends on the relative configuration of the two cameras. for example if the two cameras are facing each other then the steiner conic is a hyperbola. this is shown in where further results on oriented epipolar geometry are given. planar motion. it is shown by that if the rotation axis direction is orthogonal or parallel to the translation direction then the symmetric part of the essential matrix has rank we assume here that k then from f k tek and so fs k te etk k tesk it follows from detfs detk detes that the symmetric part of f is also singular. does this result hold if k camera matrices for the canonical cameras depends only on the rank property of f. any matrix f of rank is the fundamental matrix corresponding to some pair of this follows directly from result since the solution show that the points determined from one of the ambiguous reconstructions obtained from e are related to the corresponding points determined from another reconstruction by either an inversion through the second camera centre or a harmonic homology of section where the homology plane is perpendicular to the baseline and through the second camera centre and the vertex is the first camera centre. following a similar development to section derive the form of the fundamental matrix for two linear pushbroom cameras. details of this matrix are given in where it is shown that affine reconstruction is possible from a pair of images. reconstruction of cameras and structure this chapter describes how and to what extent the spatial layout of a scene and the cameras can be recovered from two views. suppose that a set of image correspondences xi i are given. it is assumed that these correspondences come from a set of points xi which are unknown. similarly the position orientation and calibration of the cameras are not known. the reconstruction task is to find the camera matrices p and as well as the points xi such that xi pxi i for all i. given too few points this task is not possible. however if there are sufficiently many point correspondences to allow the fundamental matrix to be computed uniquely then the scene may be reconstructed up to a projective ambiguity. this is a very significant result and one of the major achievements of the uncalibrated approach. the ambiguity in the reconstruction may be reduced if additional information is supplied on the cameras or scene. we describe a two-stage approach where the ambiguity is first reduced to affine and second to metric each stage requiring information of the appropriate class. we describe a method for reconstruction from two views as follows. outline of reconstruction method compute the fundamental matrix from point correspondences. compute the camera matrices from the fundamental matrix. for each point correspondence xi i compute the point in space that projects to these two image points. many variants on this method are possible. for instance if the cameras are calibrated then one will compute the essential matrix instead of the fundamental matrix. furthermore one may use information about the motion of the camera scene constraints or partial camera calibration to obtain refinements of the reconstruction. each of the steps of this reconstruction method will be discussed briefly in the following paragraphs. the method described is no more than a conceptual approach to reconstruction. the reader is warned not to implement a reconstruction method based solely on the description given in this section. for real images where measurements outline of reconstruction method x x x fig. triangulation. the image points x and is satisfied then these two rays lie in a plane and so intersect in a point x in back project to rays. if the epipolar constraint are noisy preferred methods for reconstruction based on this general outline are described in chapter and chapter computation of the fundamental matrix. given a set of correspondences xi in two images the fundamental matrix f satisfies the condition i fxi for all i. with the xi and i known this equation is linear in the entries of the matrix f. in fact each point correspondence generates one linear equation in the entries of f. given at least point correspondences it is possible to solve linearly for the entries of f up to scale non-linear solution is available for point correspondences. with more than equations a least-squares solution is found. this is the general principle of a method for computing the fundamental matrix. i recommended methods of computing the fundamental matrix from a set of point correspondences will be described later in chapter computation of the camera matrices. a pair of camera matrices p and corresponding to the fundamental matrix f are easily computed using the direct formula in result let x and triangulation. given the camera matrices p and be two points in the two images that satisfy the epipolar constraint as shown in chapter this constraint may be interpreted geometrically in terms of the rays in space corresponding to the two image points. in particular it means that lies on the epipolar line fx. in turn this means that the two rays back-projected from image points x and lie in a common epipolar plane that is a plane passing through the two camera centres. since the two rays lie in a plane they will intersect in some point. this point x projects via the two cameras to the points x and in the two images. this is illustrated in figure the only points in that cannot be determined from their images are points on the baseline between the two cameras. in this case the back-projected rays are collinear being equal to the baseline and intersect along their whole length. thus the point reconstruction of cameras and structure x cannot be uniquely determined. points on the baseline project to the epipoles in both images. of the two rays back-projected from x and numerically stable methods of actually determining the point x at the intersection will be described later in chapter reconstruction ambiguity in this section we discuss the inherent ambiguities involved in reconstruction of a scene from point correspondences. this topic will be discussed in a general context without reference to a specific method of carrying out the reconstruction. without some knowledge of a scene s placement with respect to a coordinate frame it is generally not possible to reconstruct the absolute position or orientation of a scene from a pair of views in fact from any number of views. this is true independently of any knowledge which may be available about the internal parameters of the cameras or their relative placement. for instance the exact latitude and longitude of the scene in figure any scene cannot be computed nor is it possible to determine whether the corridor runs north-south or east-west. this may be expressed by saying that the scene is determined at best up to a euclidean transformation and translation with respect to the world frame. only slightly less obvious is the fact that the overall scale of the scene cannot be determined. considering figure once more it is impossible based on the images alone to determine the width of the corridor. it may be two metres one metre. it is even possible that this is an image of a doll s house and the corridor is cm wide. our common experience leads us to expect that ceilings are approximately from the floor which allows us to perceive the real scale of the scene. this extra information is an example of subsidiary knowledge of the scene not derived from image measurements. without such knowledge therefore the scene is determined by the image only up to a similarity transformation translation and scaling. to give a mathematical basis to this observation let xi be a set of points and p be a pair of cameras projecting xi to image points xi and i. the points xi and the camera pair constitute a reconstruction of the scene from the image correspondences. now let hs t r be any similarity transformation r is a rotation t a translation and all scaling. replacing each point xi by hsxi and cameras p and respectively does not change the observed image points since pxi furthermore if p is decomposed as p krp tp then one computes represents overs and by ph s s ph s krpr for some that we do not need to compute more exactly. this result shows that multiplying by h s does not change the calibration matrix of p. consequently this ambiguity of reconstruction exists even for calibrated cameras. it was shown by longuet-higgins reconstruction ambiguity similarity projective a b fig. reconstruction ambiguity. if the cameras are calibrated then any reconstruction must respect the angle between rays measured in the image. a similarity transformation of the structure and camera positions does not change the measured angle. the angle between rays and the baseline is also unchanged. if the cameras are uncalibrated then reconstructions must only respect the image points intersection of the rays with the image plane. a projective transformation of the structure and camera positions does not change the measured points although the angle between rays is altered. the epipoles are also unchanged with baseline. that for calibrated cameras this is the only ambiguity of reconstruction. thus for calibrated cameras reconstruction is possible up to a similarity transformation. this is illustrated in figure projective ambiguity. if nothing is known of the calibration of either camera nor the placement of one camera with respect to the other then the ambiguity of reconstruction is expressed by an arbitrary projective transformation. in particular if h is any invertible matrix representing a projective transformation of then replacing points xi by hxi and matrices p and by ph and in the previous paragraph does not change the image points. this shows that the points xi and the cameras can be determined at best only up to a projective transformation. it is an important result proved in this chapter that this is the only ambiguity in the reconstruction of points from two images. thus reconstruction from uncalibrated cameras is possible up to a projective transformation. this is illustrated in figure other types of reconstruction ambiguity result from certain assumptions on the types of motion or partial knowledge of the cameras. for instance if the two cameras are related via a translational motion without change of calibration then reconstruction is possible up to an affine transformation. if the two cameras are calibrated apart from their focal lengths then reconstruc tion is still possible up to a similarity transformation. these two cases will be considered later in section and example respectively. terminology. point correspondences xi tual points xi and actual cameras p p in any reconstruction problem derived from real data consisting of i there exists a true reconstruction consisting of the acthat generated the measured observations. the reconstruction of cameras and structure reconstructed point set xi and cameras differ from the true reconstruction by a transformation belonging to a given class or group instance a similarity projective or affine transformation. one speaks of projective reconstruction affine reconstruction similarity reconstruction and so on to indicate the type of transformation involved. however the term metric reconstruction is normally used in preference to similarity reconstruction being identical in meaning. the term indicates that metric properties such as angles between lines and ratios of lengths can be measured on the reconstruction and have their veridical values these are similarity invariants. in addition the term euclidean reconstruction is frequently used in the published literature to mean the same thing as a similarity or metric reconstruction since true euclidean reconstruction determination of overall scale is not possible without extraneous information. the projective reconstruction theorem in this section the basic theorem of projective reconstruction from uncalibrated cameras is proved. informally the theorem may be stated as follows. if a set of point correspondences in two views determine the fundamental matrix uniquely then the scene and cameras may be reconstructed from these correspondences alone and any two such reconstructions from these correspondences are projectively equivalent. points lying on the line joining the two camera centres must be excluded since such points cannot be reconstructed uniquely even if the camera matrices are determined. the formal statement is theorem reconstruction theorem. suppose that xi i is a set of correspondences between points in two images and that the fundamental matrix f and is uniquely determined by the condition i. then there h and for exists a non-singular matrix h such that all i except for those i such that fxi tfxi for all i. let be two reconstructions of the correspondences xi tf i i and also to proof. since the fundamental matrix is uniquely determined by the point correspondences one deduces that f is the fundamental matrix corresponding to the camera pair according to theorem there is a projective transformation h such that and as for the points one observes that xi. on the other hand xi sop thus both and map to the same point xi under the action of the camera it follows that both and lie on the same ray through the camera centre of similarly it may be deduced that these two points lie on the same ray through the camera centre of there are two possibilities either as required or they are distinct points lying on the line joining the two camera centres. in this latter case the image points xi and i coincide with the epipoles in the two images and so fxi h as required. tf i stratified reconstruction a b fig. projective reconstruction. views of a projective reconstruction of the scene. the reconstruction requires no information about the camera matrices or information about the scene geometry. the fundamental matrix f is computed from point correspondences between the images camera matrices are retrieved from f and then points are computed by triangulation from the correspondences. the lines of the wireframe link the computed points. original image pair. this is an enormously significant result since it implies that one may compute a projective reconstruction of a scene from two views based on image correspondences alone without knowing anything about the calibration or pose of the two cameras involved. in particular the true reconstruction is within a projective transformation of the projective reconstruction. figure shows an example of structure computed as part of a projective reconstruction from two images. exei and the then the reconstructions are related by a nonprojective reconstruction is singular matrix h such that in more detail suppose the true euclidean reconstruction is pe ph e and xei hxi where h is a homography matrix which is unknown but the same for all points. for some applications projective reconstruction is all that is required. for example questions such as at what point does a line intersect a plane? what is the mapping between two views induced by particular surfaces such as a plane or quadric? can be dealt with directly from the projective reconstruction. furthermore it will be seen in the sequel that obtaining a projective reconstruction of a scene is the first step towards affine or metric reconstruction. stratified reconstruction the stratified approach to reconstruction is to begin with a projective reconstruction and then to refine it progressively to an affine and finally a metric reconstruction if reconstruction of cameras and structure possible. of course as has just been seen affine and metric reconstruction are not possible without further information either about the scene the motion or the camera calibration. the step to affine reconstruction the essence of affine reconstruction is to locate the plane at infinity by some means since this knowledge is equivalent to an affine reconstruction. this equivalence is explained in the case in section to see this equivalence for reconstruction suppose we have determined a projective reconstruction of a scene consisting of a suppose further that by some means a certain plane has been triple identified as the true plane at infinity. the plane is expressed as a in the coordinate frame of the projective reconstruction. in the true reconstruction has coordinates and we may find a projective transformation that maps to considering the way a projective transformation acts on planes we want to find h such that h t such a transformation is given by i t h it is immediately verified that and thus h t indeed as desired. the transformation h is now applied to all points and the two cameras. notice however that this formula will not work if the final coordinate of t is zero. in this case one may compute a suitable h by computing h t as a householder matrix such that h t at this point the reconstruction that one has is not necessarily the true reconstruction all one knows is that the plane at infinity is correctly placed. the present reconstruction differs from the true reconstruction by a projective transformation that fixes the plane at infinity. however according to result a projective transformation fixing the plane at infinity is an affine transformation. hence the reconstruction differs by an affine transformation from the true reconstruction it is an affine reconstruction. an affine reconstruction may well be sufficient for some applications. for example the mid-point of two points and the centroid of a set of points may now be computed and lines constructed parallel to other lines and to planes. such computations are not possible from a projective reconstruction. as has been stated the plane at infinity cannot be identified unless some extra information is given. we will now give several examples of the type of information that suffices for this identification. translational motion consider the case where the camera is known to undergo a purely translational motion. in this case it is possible to carry out affine reconstruction from two views. a simple way of seeing this is to observe that a point x on the plane at infinity will map to the same point in two images related by a translation. this is easily verified formally. it is also part of our common experience that as one moves in a straight line instance in stratified reconstruction a car on a straight road objects at a great distance as the moon do not appear to move only the nearby objects move past the field of view. this being so one may invent any number of matched points xi xi where a point in one image corresponds with the same point in the other image. note that one does not actually have to observe such a correspondence in the two images any point and the same point in the other image will do. given a projective reconstruction one may then reconstruct the point xi corresponding to the match xi xi. point xi will lie on the plane at infinity. from three such points one can get three points on the plane at infinity sufficient to determine it uniquely. although this argument gives a constructive proof that affine reconstruction is possible from a translating camera this does not mean that this is the best way to proceed numerically. in fact in this case the assumption of translational motion implies a very restricted form for the fundamental matrix it is skew-symmetric as shown in section this special form should be taken into account when solving for the fundamental matrix. result suppose the motion of the cameras is a pure translation with no rotation and no change in the internal parameters. as shown in example f and for an affine reconstruction one may choose the two cameras as p and scene constraints scene constraints or conditions may also be used to obtain an affine reconstruction. as long as three points can be identified that are known to lie on the plane at infinity then that plane may be identified and the reconstruction transformed to an affine reconstruction. parallel lines. the most obvious such condition is the knowledge that lines are in reality parallel. the intersection of the two parallel lines in space gives a point on the plane at infinity. the image of this point is the vanishing point of the line and is the point of intersection of the two imaged lines. suppose that three sets of parallel lines can be identified in the scene. each set intersects in a point on the plane at infinity. provided each set has a different direction the three points will be distinct. since three points determine a plane this information is sufficient to identify the plane the best way of actually computing the intersection of lines in space is a somewhat delicate problem since in the presence of noise lines that are intended to intersect rarely do. it is discussed in some detail in chapter correct numerical procedures for computing the plane are given in chapter an example of an affine reconstruction computed from three sets of parallel scene lines is given in figure note that it is not necessary to find the vanishing point in both images. suppose the vanishing point v is computed from imaged parallel lines in the first image and is a corresponding line in the second image. vanishing points satisfy the epipolar constraint so the corresponding vanishing point in the second image may be computed as the intersection of and the epipolar line fv of v. the construction of the reconstruction of cameras and structure a b fig. affine reconstruction. the projective reconstruction of figure may be upgraded to affine using parallel scene lines. there are sets of parallel lines in the scene each set with a different direction. these sets enable the position of the plane at infinity to be computed in the projective reconstruction. the wireframe projective reconstruction of figure is then affinely rectified using the homography shows two orthographic views of the wireframe affine reconstruction. note that parallel scene lines are parallel in the reconstruction but lines that are perpendicular in the scene are not perpendicular in the reconstruction. point x can be neatly expressed algebraically as the solution of the equations px and these equations expresses the fact that x maps to v in the first image and to a point on in the second image. distance ratios on a line. an alternative to computing vanishing points as the intersection of imaged parallel scene lines is to use knowledge of affine length ratios in the scene. for example given two intervals on a line with a known length ratio the point at infinity on the line may be determined. this means that from an image of a line on which a world distance ratio is known for example that three points are equally spaced the vanishing point may be determined. this computation and other means of computing vanishing points and vanishing lines are described in section the infinite homography once the plane at infinity has been located so that we have an affine reconstruction then we also have an image-to-image map called the infinite homography this map which is a homography is described in greater detail in chapter briefly it is the map that transfers points from the p image to the image via the plane at infinity as follows the ray corresponding to a point x is extended to meet the plane at infinity in a point x this point is projected to a point in the other image. the homography from x to having an affine reconstruction is equivalent to knowing the infinite homography as will now be shown. given two cameras p m and of an affine reconstruction the infinite homography is given by h this is because a x point x xt for points on furthermore it may be verified that in the other so on the plane at infinity maps to x m x in one image and is written as h x. stratified reconstruction this is unchanged by a affine transformation of the cameras. hence the infinite homography may be computed explicitly from an affine reconstruction and vice versa result if an affine reconstruction has been obtained in which the camera matrices are p and then the infinite homography is given by h conversely if the infinite homography h has been obtained then the cameras of an affine reconstruction may be chosen as p and the infinite homography may be computed directly from corresponding image entities rather than indirectly from an affine reconstruction. for example h can be computed from the correspondence of three vanishing points together with f or the correspondence of a vanishing line and vanishing point together with f. the correct numerical procedure for these computations is given in chapter however such direct computations are completely equivalent to determining in a projective reconstruction. one of the cameras is affine another important case in which affine reconstruction is possible is when one of the cameras is known to be an affine camera as defined in section to see that this implies that affine reconstruction is possible refer to section where it was shown that the principal plane of an affine camera is the plane at infinity. hence to convert a projective reconstruction to an affine reconstruction it is sufficient to find the principal plane of the camera supposed to be affine and map it to the plane recall that the principal plane of a camera is simply the third row of the camera matrix. for example consider a projective reconstruction with camera matrices p and for which the first camera is supposed to be affine. to map the third row of p to it is sufficient to swap the last two columns of the two camera matrices while at the same time swapping the and coordinates of each xi. this is a projective transformation corresponding to a permutation matrix h. this shows be a projective reconstruction from a set of point correresult let spondences for which p suppose in truth p is known to be an affine camera then an affine reconstruction is obtained by swapping the last two columns of p and and the last two coordinates of each xi. note that the condition that one of the cameras is affine places no restriction on the fundamental matrix since any canonical camera pair p and can be transformed to a pair in which p is affine. if both the cameras are known to be affine then it will be seen that the fundamental matrix has the restricted form given in in this case for numerical stability one must solve for the fundamental matrix enforcing this special form of the fundamental matrix. of course there is no such thing as a real affine camera the affine camera model is an approximation which is only valid when the set of points seen in the image has small depth variation compared with the distance from the camera. nevertheless an assumption of an affine camera may be useful to effect the significant restriction from projective to affine reconstruction. reconstruction of cameras and structure the step to metric reconstruction just as the key to affine reconstruction is the identification of the plane at infinity the key to metric reconstruction is the identification of the absolute conic since the absolute conic is a planar conic lying in the plane at infinity identifying the absolute conic implies identifying the plane at infinity. in a stratified approach one proceeds from projective to affine to metric reconstruction so one knows the plane at infinity before finding the absolute conic. suppose one has identified the absolute conic on the plane at infinity. in principle the next step is to apply an affine transformation to the affine reconstruction such that the identified absolute conic is mapped to the absolute conic in the standard euclidean frame will on the resulting reconstruction is then have the equation then related to the true reconstruction by a projective transformation which fixes the absolute conic. it follows from result that the projective transformation is a similarity transformation so we have achieved a metric reconstruction. in practice the easiest way to accomplish this is to consider the image of the absolute conic in one of the images. the image of the absolute conic any conic is a conic in the image. the back-projection of this conic is a cone which will meet the plane at infinity in a single conic which therefore defines the absolute conic. remember that the image of the absolute conic is a property of the image itself and like any image point line or other feature is not dependent on any particular reconstruction hence it is unchanged by transformations of the reconstruction. suppose that in the affine reconstruction the image of the absolute conic as seen by the camera with matrix p m is a conic we will show how may be used to define the homography h which transforms the affine reconstruction to a metric reconstruction result suppose that the image of the absolute conic is known in some image to be and one has an affine reconstruction in which the corresponding camera matrix is given by p m. then the affine reconstruction may be transformed to a metric reconstruction by applying a transformation of the form h a where a is obtained by cholesky factorization from the equation aat m proof. under the transformation h the camera matrix p is transformed to a matrix pm ph mm. if h is of the form h a then mm ma. however the image of the absolute conic is related to the camera matrix pm of a euclidean frame by the relationship mmmt m stratified reconstruction this is because the camera matrix may be decomposed as mm kr and from kkt. combining this with mm ma gives maatmt which a particular value of a that satisfies this may be rearranged as aat m this latter relationship is found by taking the cholesky factorization of m matrix is guaranteed to be positive-definite result otherwise no such matrix a will exist and metric reconstruction will not be possible. this approach to metric reconstruction relies on identifying the image of the absolute conic. there are various ways of doing this and these are discussed next. three sources of constraint on the image of the absolute conic are given and in practice a combination of these constraints is used. constraints arising from scene orthogonality. pairs of vanishing points and arising from orthogonal scene lines place a single linear constraint on vt similarly a vanishing point v and a vanishing line l arising from a direction and plane which are orthogonal place two constraints on l v. a common example is the vanishing point for the vertical direction and a vanishing line from the horizontal ground plane. finally an imaged scene plane containing metric information such as a square grid places two constraints on constraints arising from known internal parameters. if the calibration matrix of a camera is equal to k then the image of the absolute conic is k tk thus knowledge of the internal parameters contained in k may be used to constrain or determine the elements of in the case where k is known to have zero skew and if the pixels are square skew and x y then these first two sources of constraint are discussed in detail in section on single view calibration where examples are given of calibrating a camera solely from such information. here there is an additional source of constraints available arising from the multiple views. constraints arising from the same cameras in all images. one of the properties of the absolute conic is that its projection into an image depends only on the calibration matrix of the camera and not on the position or orientation of the camera. in the case where both cameras p and have the same calibration matrix meaning that both the images were taken with the same camera with different pose one has that that is the image of the absolute conic is the same in both images. given reconstruction of cameras and structure a b fig. metric reconstruction. the affine reconstruction of figure is upgraded to metric by computing the image of the absolute conic. the information used is the orthogonality of the directions of the parallel line sets shown in figure together with the constraint that both images have square pixels. the square pixel constraint is transferred from one image to the other using h two views of the metric reconstruction. lines which are perpendicular in the scene are perpendicular in the reconstruction and also the aspect ratio of the sides of the house is veridical. two views of a texture mapped piecewise planar model built from the wireframes. sufficiently many images one may use this property to obtain a metric reconstruction from an affine reconstruction. this method of metric reconstruction and its use for self-calibration of a camera will be treated in greater detail in chapter for now we give just the general principle. since the absolute conic lies on the plane at infinity its image may be transferred from one view to the other via the infinite homography. this implies an equation result h t h where and are images of in the two views. in forming these equations it is necessary to have an affine reconstruction already since the infinite homography must be known. if then gives a set of linear equations in the entries of in general this set of linear equations places four constraints on and since has degrees of freedom it is not completely determined. however by combining these linear equations with those above provided by scene orthogonality or known internal parameters may be determined uniquely. indeed may be used to transfer constraints on to constraints on figure shows an example of a metric reconstruction computed by combining constraints in this manner. direct reconstruction using ground truth direct metric reconstruction using the previous discussion showed how knowledge of the image of the absolute conic may be used to transform an affine to a metric reconstruction. however knowing it is possible to proceed directly to metric reconstruction given at least two views. this can be accomplished in at least two different ways. the most evident approach is to use the iac to compute calibration of each of the cameras and then carry out a calibrated reconstruction. this method relies on the connection of to the calibration matrix k namely thus one can compute k from by inverting it and then applying cholesky factorization to obtain k. if the iac is known in each image then both cameras may be calibrated in this way. next with calibrated cameras a metric reconstruction of the scene may be computed using the essential matrix as in section note that four possible solutions may result. two of these are just mirror images but the other two are different forming a twisted pair. all solutions but one may be ruled out by consideration of points lying in front of the cameras. a more conceptual approach to metric reconstruction is to use knowledge of the iac to directly determine the plane at infinity and the absolute conic. knowing the camera matrices p and in a projective frame and a conic the image of the absolute conic in each image then may be explicitly computed in this is achieved by back-projecting the conics to cones which must intersect in the absolute conic. thus and its support plane are determined exercise on page for an algebraic solution. however two cones will in general intersect in two different plane conics each lying in a different support plane. thus there are two possible solutions for the absolute conic which one can identify as belonging to the two different reconstructions constituting the twisted pair ambiguity. direct reconstruction using ground truth it is possible to jump directly from a projective reconstruction to a metric reconstruction if ground control points is points with known locations in a euclidean world frame are given. suppose we have a set of n such ground control points which are imaged at xi i. we wish to use these points to transform the projective reconstruction to metric. the location of the control points in the projective reconstruction may be computed from their image correspondences xi i. since the projective reconstruction is related by a homography to the true reconstruction we then have from the equations xei hxi i n. each point correspondence provides linearly independent equations on the elements of h and since h has degrees of freedom a linear solution is obtained provided n no four of the control points are coplanar. this computation and the proper numerical procedures are described in chapter alternatively one may bypass the computation of the xi and compute h by relating reconstruction of cameras and structure a b c fig. direct reconstruction. the projective reconstruction of figure may be upgraded to metric by specifying the position of five more world points the five points used the corresponding points on the projective reconstruction of figure the reconstruction after the five points are mapped to their world positions. the known ground control points directly to image measurements. thus as in the dlt algorithm for camera resection the equation xi ph provides two linearly independent equations in the entries of the unknown h all other quantities being known. similarly equations may be derived from the other image if i is known. it is not necessary for the ground control points to be visible in both images. note however that if both xi and i are visible for a given control point xei then because of the coplanarity constraint on x and the four equations generated in this way contain only three independent ones. once h has been computed it may be used to transform the cameras p of the projective reconstruction to their true euclidean counterparts. an example of metric structure computed by this direct method is shown in figure closure in this chapter we have overviewed the steps necessary to produce a metric reconstruction from a pair of images. this overview is summarized in algorithm and the computational procedures for these steps are described in the following chapters. as usual the general discussion has been restricted mainly to points but the ideas ambiguity stratification apply equally to other image features such as lines conics etc. it has been seen that for a metric reconstruction it is necessary to identify two entities in the projective frame these are the plane at infinity affine together with the absolute conic metric. conversely given f and a pair of calibrated cameras then and may be explicitly computed in these entities each have an image-based counterpart specification of the infinite homography h is equivalent to specifying in and specifying the image of the absolute conic in each view is equivalent to specifying and in this equivalence is summarized in table finally it is worth noting that if metric precision is not the goal then an acceptable metric reconstruction is generally obtained directly from the projective if approximately correct internal parameters are guessed. such a quasi-euclidean reconstruction is often suitable for visualization purposes. closure objective mxmi of the camgiven two uncalibrated images compute a metric reconstruction eras and scene structure i.e. a reconstruction that is within a similarity transformation of the true cameras and scene structure. algorithm compute a projective reconstruction tween the images. compute the fundamental matrix from point correspondences xi camera retrieval compute the camera matrices p triangulation for each point correspondence xi matrix. i compute the point xi from the fundamental i be in space that projects to these two image points. rectify the projective reconstruction to metric either direct method compute the homography h such that xei hxi from five or more ground control points xei with known euclidean positions. then the metric reconstruction is pm ph m xmi hxi. or stratified method affine reconstruction compute the plane at infinity as described in section and then upgrade the projective reconstruction to an affine reconstruction with the homography h i t h a metric reconstruction compute the image of the absolute conic as described in section and then upgrade the affine reconstruction to a metric reconstruction with the homography where a is obtained by cholesky factorization from the equation aat m and m is the first submatrix of the camera in the affine reconstruction for which is computed. algorithm computation of a metric reconstruction from two uncalibrated images. the literature koenderink and van doorn give a very elegant discussion of stratification for affine cameras. this was extended to perspective in with developments given by luong and vi eville the possibility of projective reconstruction given f appeared in and hartley et al. the method of computing affine reconstruction from pure translation first appeared in moons et al. combining scene and internal parameter constraints over multiple views is described in reconstruction of cameras and structure image information provided view relations and projective objects reconstruction objects ambiguity point correspondences point correspondences including vanishing points point correspondences and internal camera calibration f f h f h projective affine metric table the two-view relations image entities and their counterparts for various classes of reconstruction ambiguity. notes and exercises using only image relations without an explicit reconstruction and given the images of a line l and point x on l in two views together with h between the views compute the image of the line in parallel to l and through x. other examples of this implicit approach to computation are given in computation of the fundamental matrix f this chapter describes numerical methods for estimating the fundamental matrix given a set of point correspondences between two images. we begin by describing the equations on f generated by point correspondences in two images and their minimal solution. the following sections then give linear methods for estimating f using algebraic distance and then various geometric cost functions and solution methods including the mle gold standard algorithm and sampson distance. an algorithm is then described for automatically obtaining point correspondences so that f may be estimated directly from an image pair. we discuss the estimation of f for special camera motions. the chapter also covers a method of image rectification based on the computed f. basic equations the fundamental matrix is defined by the equation for any pair of matching points x in two images. given sufficiently many point matches xi i least equation can be used to compute the unknown matrix f. in particular writing x y and each point match gives rise to one linear equation in the unknown entries of f. the coefficients of this equation are easily written in terms of the known coordinates x and specifically the equation corresponding to a pair of points y and is y y x x denote by f the made up of the entries of f in row-major order. then x y y y can be expressed as a vector inner product y y x x x x y y y x y f from a set of n point matches we obtain a set of linear equations of the form x x af x nxn x x nyn x n y y nxn y y y nyn y n xn yn f computation of the fundamental matrix f a b fig. epipolar lines. the effect of a non-singular fundamental matrix. epipolar lines computed as fx for varying x do not meet in a common epipole. the effect of enforcing singularity using the svd method described here. this is a homogeneous set of equations and f can only be determined up to scale. for a solution to exist matrix a must have rank at most and if the rank is exactly then the solution is unique to scale and can be found by linear methods the solution is the generator of the right null-space of a. if the data is not exact because of noise in the point coordinates then the rank of a may be greater than fact equal to since a has columns. in this case one finds a least-squares solution. apart from the specific form of the equations with the problem is essentially the same as the estimation problem considered in section refer to the algorithm the least-squares solution for f is the singular vector corresponding to the smallest singular value of a that is the last column of v in the svd a udvt. the solution vector f found in this way minimizes subject to the condition the algorithm just described is the essence of a method called the algorithm for computation of the fundamental matrix. the singularity constraint an important property of the fundamental matrix is that it is singular in fact of rank furthermore the left and right null-spaces of f are generated by the vectors representing homogeneous coordinates the two epipoles in the two images. most applications of the fundamental matrix rely on the fact that it has rank for instance if the fundamental matrix is not singular then computed epipolar lines are not coincident as is demonstrated by figure the matrix f found by solving the set of linear equations will not in general have rank and we should take steps to enforce this constraint. the most convenient way to do this is to correct the matrix f found by the svd solution from a. matrix f is replaced by the matrix that minimizes the frobenius norm subject to the condition det a convenient method of the normalized algorithm doing this is to again use the svd. in particular let f udvt be the svd of f where d is a diagonal matrix d diagr s t satisfying r s t. then udiagr s minimizes the frobenius norm of f thus the algorithm for computation of the fundamental matrix may be for mulated as consisting of two steps as follows. linear solution. a solution f is obtained from the vector f corresponding to constraint enforcement. replace f by the smallest singular value of a where a is defined in the closest singular matrix to f under a frobenius norm. this correction is done using the svd. the algorithm thus stated is extremely simple and readily implemented assuming that appropriate linear algebra routines are available. as usual normalization is required and we return to this in section i the minimum case seven point correspondences the equation tfxi gives rise to a set of equations of the form af if a has rank then it is possible to solve for f up to scale. in the case where the matrix a has rank seven it is still possible to solve for the fundamental matrix by making use of the singularity constraint. the most important case is when only point correspondences are known cases are discussed in section this leads to a matrix a which generally will have rank the solution to the equations af in this case is a space of the form where is a scalar variable. the matrices and are obtained as the matrices corresponding to the generators f and f of the right null-space of a. now we use the constraint that det f this may be written as det since and are known this leads to a cubic polynomial equation in this polynomial equation may be solved to find the value of there will be either one or three real solutions complex solutions are discarded substituting back in the equation f gives one or three possible solutions for the fundamental matrix. this method of computing one or three fundamental matrices for the minimum number of points is used in the robust algorithm of section we return to the issue of the number of solutions in section the normalized algorithm the algorithm is the simplest method of computing the fundamental matrix involving no more than the construction and solution of a set of linear equations. if care is taken then it can perform extremely well. the original algorithm is due to longuet-higgins the key to success with the algorithm is proper careful normalization of the input data before constructing the equations to solve. the subject of normalization of input data has applications to many of the algorithms of this book and is treated in general terms in section in the case of the algorithm a simple transformation and computation of the fundamental matrix f objective given n image point correspondences such that algorithm tfxi i i determine the fundamental matrix f normalization transform the image coordinates according to xi txi and i are normalizing transformations consisting of a translation and i where t and find the fundamental matrix f corresponding to the matches xi i by scaling. linear solution determine f from the singular vector corresponding to the smallest singular value of a where a is composed from the matches xi as defined in i constraint enforcement replace f by f such that det f using the svd denormalization set f f section to the original data xi i. t. matrix f is the fundamental matrix corresponding algorithm the normalized algorithm for f. scaling of the points in the image before formulating the linear equations leads to an enormous improvement in the conditioning of the problem and hence in the stability of the result. the added complexity of the algorithm necessary to do this transformation is insignificant. the suggested normalization is a translation and scaling of each image so that the centroid of the reference points is at the origin of the coordinates and the rms distance of the points from the origin is equal to this is carried out for essentially the same reasons as in chapter the basic method is analogous to algorithm and is summarized in algorithm note that it is recommended that the singularity condition should be enforced before denormalization. for a justification of this refer to the algebraic minimization algorithm the normalized algorithm includes a method for enforcing the singularity constraint on the fundamental matrix. the initial estimate f is replaced by the singular that minimizes the difference this is done using the svd and has matrix the advantage of being simple and rapid. numerically however this method is not optimal since all the entries of f do not have equal importance and indeed some entries are more tightly constrained by the point-correspondence data than others. a more correct procedure would be to compute a covariance matrix from the entries of f in terms of the input data and then to find the singular matrix closest to f in terms of mahalanobis distance with respect to this covariance. unfortunately minimization of the mahalanobis distance cannot be done linearly for a general covariance matrix so this approach is unattractive. an alternative procedure is to find the desired singular matrix directly. thus just as f is computed by minimizing the norm subject to so one should aim the algebraic minimization algorithm that minimizes subject to it turns out to find the singular matrix not to be possible to do this by linear non-iterative means chiefly because det is a cubic rather than a linear constraint. nevertheless it will be seen that a simple iterative method is effective. an arbitrary singular matrix such as the fundamental matrix f may be written as a product f me where m is a non-singular matrix and is any skew-symmetric matrix with e corresponding to the epipole in the first image. suppose we wish to compute the fundamental matrix f of the form f me that minimizes the algebraic error subject to the condition let us assume for now that the epipole e is known. later we will let e vary but for now it is fixed. the equation f me can be written in terms of the vectors f and m comprising the entries of f and m as an equation f em where e is a matrix. supposing that f and m contain the entries of the corresponding matrices in row-major order then it can be verified that e has the form e since f em the minimization problem becomes minimize subject to the condition this minimization problem is solved using algorithm for the purposes of this algorithm one observes that ranke since each of its diagonal blocks has rank iterative estimation the minimization gives a way of computing an algebraic error vector af given a value for the epipole e. this mapping e af is a map from to note that the value of af is unaffected by scaling e. starting from an estimated value of e derived as the generator of the right null-space of an initial estimate of f one may iterate to find the final f that minimizes algebraic error. the initial estimate of f may be obtained from the algorithm or any other simple algorithm. the complete algorithm for computation of f is given in algorithm note the advantage of this method of computing f is that the iterative part of the algorithm consists of a very small parameter minimization problem involving the estimation of only three parameters homogeneous coordinates of e. despite this the algorithm finds the fundamental matrix that minimizes the algebraic error for all matched points. the matched points themselves do not come into the final iterative estimation. it does not do to minimize subject to the condition since a solution to this occurs when m is a unit vector in the right null-space of e. in this case em and hence computation of the fundamental matrix f objective find the fundamental matrix f that minimizes the algebraic error subject to and det f algorithm find a first approximation for the fundamental matrix using the normalized algorithm then find the right null-vector of starting with the estimate ei for the epipole compute the matrix ei according to then find the vector f i eimi that minimizes subject to this is done using algorithm compute the algebraic error af i. since f i and hence is defined only up to sign i ei for the previous two steps define a mapping mapping ei now use the levenberg marquardt algorithm to vary ei iteratively so as to minimize correct the sign of by minus if necessary so that et i this is done to ensure that varies smoothly as a function of ei. upon convergence f i represents the desired fundamental matrix. algorithm computation of f with det f by iteratively minimizing algebraic error. geometric distance this section describes three algorithms which minimize a geometric image distance. the one we recommend which is the gold standard method unfortunately requires the most effort in implementation. the other algorithms produce extremely good results and are easier to implement but are not optimal under the assumption that the image errors are gaussian. two important issues for each of the algorithms are the intitialization for the non-linear minimization and the parametrization of the cost function. the algorithms are generally initialized by one of the linear algorithms of the previous section. an alternative which is used in the automatic algorithm is to select correspondences and thus generate one or three solutions for f. various parametrizations are discussed in section in all cases we recommend that the image points be normalized by a translation and scaling. this normalization does not skew the noise characteristics so does not interfere with the optimality of the gold standard algorithm which is described next. the gold standard method the maximum likelihood estimate of the fundamental matrix depends on the assumption of an error model. we make the assumption that noise in image point measurements obeys a gaussian distribution. in that case the ml estimate is the one that minimizes the geometric distance is reprojection error dxi i i where xi correspondences that satisfy mated fundamental matrix. i i are the measured correspondences and xi and i are estimated true tf xi exactly for some matrix f the esti geometric distance objective given n image point correspondences estimate f of the fundamental matrix. the mle involves also solving for a set of subsidiary point correspondences xi that t f xi and which i determine the maximum likelihood i such i dxi i algorithm i from f. compute an initial rank estimate of f using a linear algorithm such as algorithm compute an initial estimate of the subsidiary variables xi i as follows choose camera matrices p and f where from the correspondence xi triangulation method of chapter i and f determine an estimate of using the the correspondence consistent with f is obtained as xi i over f and i n. the cost is minimized using the levenberg marquardt algorithm over variables for the n points and for the camera matrix t with f m and xi i dxi minimize the cost is obtained i i algorithm the gold standard algorithm for estimating f from image correspondences. i will satisfy i one varies this error function may be minimized in the following manner. a pair of camera matrices p and t are defined. in addition one defines points xi. now letting xi pxi and and the points xi so as to minimize the error expression. subsequently f is computed as f m. the vectors xi and tf xi minimization of the error is carried out using the levenberg marquardt algorithm described in section an initial estimate of the parameters is computed using the normalized algorithm followed by projective reconstruction as described in chapter thus estimation of the fundamental matrix using this method is effectively equivalent to projective reconstruction. the steps of the algorithm are summarized in algorithm i it may seem that this method for computing f will be expensive in computing cost. however the use of the sparse lm techniques means that it is not much more expensive than other iterative techniques and details of this are given in section parametrization of matrices the non-linear minimization of the geometric distance cost functions requires a parametrization of the fundamental matrix which enforces the rank property of the matrix. we describe three such parametrizations. computation of the fundamental matrix f over-parametrization. one way that we have already seen for parametrizing f is to write f m where m is an arbitrary matrix. this ensures that f is singular since is. this way f is parametrized by the nine entries of m and the three entries of t a total of parameters more than the minimum number of parameters which is in general this should not cause a significant problem. epipolar parametrization. an alternative way of parametrizing f is by specifying the first two columns of f along with two multipliers and such that the third column may be written as a linear combination f f f thus the fundamental matrix is parametrized as a b a b c d c d e f e f f this has a total of parameters. to achieve a minimum set of parameters one of the elements for instance f may be set to in practice whichever of a f has greatest absolute value is set to this method ensures a singular matrix f while using the minimum number of parameters. the main disadvantage is that it has a singularity it does not work when the first two columns of f are linearly dependent for then it is not possible to write column in terms of the first two columns. this problem can be significant since it will occur in the case where the right epipole lies at infinity. for then fe and the first two columns are linearly dependent. nevertheless this parametrization is widely used and works well if steps are taken to avoid this singularity. instead of using the first two columns as a basis another pair of columns can be used in which case the singularity occurs when the epipole is on one of the coordinate axes. in practice such singularities can be detected during the minimization and the parametrization switched to one of the alternative parametrizations. note that is the right epipole for this fundamental matrix the coordinates of the epipole occur explicitly in the parametrization. for best results the parametrization should be chosen so that the largest entry absolute value of the epipole is the one set to note how the complete manifold of possible fundamental matrices is not covered by a single parametrization but rather by a set of minimally parametrized patches. as a path is traced out through the manifold during a parameter minimization procedure it is necessary to switch from one patch to another as the boundary between patches is crossed. in this case there are actually different parameter patches depending on which of a f is greatest and which pair of columns are taken as the basis. both epipoles as parameters. the previous parametrization uses one of the epipoles as part of the parametrization. for symmetry one may use both the epipoles as parameters. the resulting form of f is f a c a b d b c d a a b c d b c d geometric distance as above one can set one of the two epipoles are and a b c d to to avoid singularities one must switch between different choices of the two rows and two columns to use as the basis. along with four choices of which of a b c d to set to there are a total of parameter patches used to cover the complete manifold of fundamental matrices. first-order geometric error distance the concept of sampson distance was discussed at length in section here the sampson approximation is used in the case of the variety defined by to provide a first-order approximation to the geometric error. the general formula for the sampson cost function is given in in the case of fundamental matrix estimation the formula is even simpler since there is only one equation per point correspondence also example the partialderivative matrix j has only one row and hence jjt is a scalar and becomes jjt i jjt from the definition of j and the explicit form of ai of we obtain i tfxi given in the left hand side jjt where for instance the cost function is j represents the square of the j-th entry of the vector fxi. thus i i this gives a first-order approximation to geometric error which may be expected to give good results if higher order terms are small in comparison to the first. the approximation has been used successfully in estimation algorithms by note that this approximation is undefined at the point in determined by the two epipoles as here jjt is zero. this point should be avoided in any numerical implementation. the key advantage of approximating the geometric error in this way is that the resulting cost function only involves the parameters of f. this means that to first-order the gold standard cost function is minimized without introducing a set of subsidiary variables namely the coordinates of the n space points xi. consequently a minimization problem with degrees of freedom is reduced to one with only degrees of freedom. symmetric epipolar distance. equation is similar in form to another cost function i i dxi i computation of the fundamental matrix f i which minimizes the distance of a point from its projected epipolar line computed in each of the images. however this cost function seems to give slightly inferior results to and hence is not discussed further. experimental evaluation of the algorithms three of the algorithms of the previous sections are now compared by estimating f from point correspondences for a number of image pairs. the algorithms are the normalized algorithm minimization of algebraic error whilst imposing the singularity constraint the gold standard geometric algorithm the experimental procedure was as follows. for each pair of images a number n of matched points were chosen randomly from the matches and the fundamental matrix estimated and residual error below computed. this experiment was repeated times for each value of n and each pair of images and the average residual error plotted against n. this gives an idea of how the different algorithms behave as the number of points is increased. the number of points used n ranged from up to three-quarters of the total number of matched points. residual error the error is defined as i n i dxi where dx l here is the distance pixels between a point x and a line l. the error is the squared distance between a point s epipolar line and the matching point in the other image for both points of the match averaged over all n matches. note the error is evaluated over all n matched points and not just the n matches used to compute f. the residual error corresponds to the epipolar distance defined in note that this particular error is not minimized directly by any of the algorithms evaluated here. the various algorithms were tried with different pairs of images. the images are presented in figure and show the diversity of image types and placement of the epipoles. a few of the epipolar lines are shown in the images. the intersection of the pencil of lines is the epipole. there was a wide variation in the accuracy of the matched points for the different images though mismatches were removed in a pre-processing step. results. the results of these experiments are shown and explained in figure they show that minimizing algebraic error gives essentially indistinguishable results from minimizing geometric error. experimental evaluation of the algorithms houses images statue image grenoble museum corridor scene calibration rig fig. image pairs used for the algorithm comparison. in the top two the epipoles are far from the image centres. in the middle two the epipoles are close and in the image for the calibration images the matched points are known extremely accurately. recommendations several methods of computing the fundamental matrix have been discussed in this chapter and some pointers on which method to use are perhaps desirable. briefly these are our recommendations do not use the unnormalized algorithm. for a quick method easy to implement use the normalized algorithm this often gives adequate results and is ideal as a first step in other algorithms. if more accuracy is desired use the algebraic minimization method either with or without iteration on the position of the epipole. as an alternative that gives excellent results use an iterative-minimization method that minimizes the sampson cost function this and the iterative algebraic method give similar results. to be certain of getting the best results if gaussian noise is a viable assumption implement the gold standard algorithm. computation of the fundamental matrix f r o r r e houses r o r r e statue r o r r e number of points number of points museum number of points r o r r e corridor r o r r e calibration number of points number of points fig. results of the experimental evaluation of the algorithms. in each case three methods of computing f are compared. residual error is plotted against the number of points used to compute f. in each graph the top line shows the results of the normalized algorithm. also shown are the results of minimizing geometric error dashed line and iteratively minimizing algebraic error subject to the determinant constraint dashed line. in most cases the result of iteratively minimizing algebraic error is almost indistinguishable from minimizing geometric error. both are noticeably better than the non-iterative normalized algorithm though that algorithm also gives good results. automatic computation of f this section describes an algorithm to compute the epipolar geometry between two images automatically. the input to the algorithm is simply the pair of images with no other a priori information required and the output is the estimated fundamental matrix together with a set of interest points in correspondence. the algorithm uses ransac as a search engine in a similar manner to its use in the automatic computation of a homography described in section the ideas and details of the algorithm are given there and are not repeated here. the method is summarized in algorithm with an example of its use shown in figure a few remarks on the method the ransac sample. only point correspondences are used to estimate f. this has the advantage that a rank matrix is produced and it is not necessary to coerce the matrix to rank as in the linear algorithms. a second reason for using correspondences rather than say with a linear algorithm is that the number of samples that must be tried in order to ensure a high probability of no outliers is exponential in the size of the sample set. for example from table for a confidence of no outliers drawing from a set containing outliers twice as many samples are required for correspondences as for the slight disadvantage in using correspondences is that it may result in real solutions for f and all must be tested for support. automatic computation of f objective compute the fundamental matrix between two images. algorithm interest points compute interest points in each image. putative correspondences compute a set of interest point matches based on proxim ity and similarity of their intensity neighbourhood. ransac robust estimation repeat for n samples where n is determined adap tively as in algorithm select a random sample of correspondences and compute the fundamental matrix f as described in section there will be one or three real solutions. calculate the distance d for each putative correspondence. compute the number of inliers consistent with f by the number of correspon dences for which d t pixels. if there are three real solutions for f the number of inliers is computed for each solution and the solution with most inliers retained. choose the f with the largest number of inliers. in the case of ties choose the solution that has the lowest standard deviation of inliers. non-linear estimation re-estimate f from all correspondences classified as inliers by minimizing a cost function e.g. using the levenberg marquardt algorithm of section guided matching further interest point correspondences are now determined using the estimated f to define a search strip about the epipolar line. the last two steps can be iterated until the number of correspondences is stable. algorithm algorithm to automatically estimate the fundamental matrix between two images using ransac. the distance measure. given a current estimate of f the ransac sample the distance d measures how closely a matched pair of points satisfies the epipolar geometry. there are two clear choices for d reprojection error i.e. the distance minimized in the cost function value may be obtained using the triangulation algorithm of section or the sampson approximation to reprojection error is given by if the sampson approximation is used then the sampson cost function should be used to iteratively estimate f. otherwise distances used in ransac and elsewhere in the algorithm will be inconsistent. guided matching. the current estimate of f defines a search band in the second image around the epipolar line fx of x. for each corner x a match is sought within this band. since the search area is restricted a weaker similarity threshold can be employed and it is not necessary to enforce a winner takes all scheme. implementation and run details. for the example of figure the search window was pixels. the inlier threshold was t pixels. a total of samples were required. the rms pixel error after ransac was correspondences and after mle and guided matching it was correspondences. the guided matching mle required iterations of the levenberg marquardt algorithm. computation of the fundamental matrix f a c e g b d f h fig. automatic computation of the fundamental matrix between two images using ransac. left and right images of keble college oxford. the motion between views is a translation and rotation. the images are pixels. detected corners superimposed on the images. there are approximately corners on each image. the following results are superimposed on the left image putative matches shown by the line linking corners note the clear mismatches outliers of the putative matches. inliers correspondences consistent with the estimated f final set of correspondences after guided matching and mle. there are still a few mismatches evident e.g. the long line on the left. special cases of f-computation e image fig. for a pure translation the epipole can be estimated from the image motion of two points. special cases of f-computation certain special cases of motion or partially known camera calibration allow computation of the fundamental matrix to be simplified. in each case the number of degrees of freedom of the fundamental matrix is less than the of general motion. we give three examples. pure translational motion this is the simplest possible case. the matrix can be estimated linearly whilst simultaneously imposing the constraints that the matrix must satisfy namely that it is skew-symmetric section and thus has the required rank of in this case f and has two degrees of freedom. it may be parametrized by the three entries of each point correspondence provides one linear constraint on the homogeneous parameters as is clear from figure the matrix can be computed uniquely from two point correspondences. note in the general motion case if all points are coplanar which is a structure degeneracy section the fundamental matrix cannot be determined uniquely from image correspondences. however for pure translational motion this is not a problem points are always coplanar. the only degeneracy is if the two points are coplanar with both camera centres. this special form also simplifies the gold standard estimation and correspondingly triangulation for structure recovery. the gold standard estimation of the epipole from point correspondences under pure translation is identical to the estimation of a vanishing point given the end points of a set of imaged parallel lines see section planar motion in the case of planar motion described in section we require that the symmetric part of f has rank in addition to the standard rank condition for the full matrix. it can be verified that the parametrization of namely f satisfies both these conditions. if unconstrained are used to represent ls and e then parameters are used whereas the fundamental matrix for planar motion has only degrees of freedom. as usual this over-parametrization is not a problem. computation of the fundamental matrix f an alternative parametrization with similar properties is f lslt h lhlt s with xt alh where and are scalars and the meaning of the xa ls and lh is evident from figure i the calibrated case in the case of calibrated cameras normalized image coordinates may be used and the essential matrix e computed instead of the fundamental matrix. as with the fundamental matrix the essential matrix may be computed using linear techniques from points or more since corresponding points satisfy the defining equation texi where the method differs from the computation of the fundamental matrix is in the enforcement of the constraints. for whereas the fundamental matrix satisfies det f the essential matrix satisfies the additional condition that its two singular values are equal. this constraint may be handled by the following result which is offered here without proof. result let e be a matrix with svd given by e udvt where d diaga b c with a b c. then the closest essential matrix to e in frobenius norm is given by e u dvt where d diaga if the goal is to compute the two normalized camera matrices p and as part of a reconstruction process then it is not actually necessary to compute e by multiplying out e u dvt. matrix can be computed directly from the svd according to result the choice between the four solutions for is determined by the consideration that the visible points must lie in front of the two cameras as explained in section correspondence of other entities so far in this chapter only point correspondences have been employed and the question naturally arises can f be computed from the correspondence of image entities other than points? the answer is yes but not from all types of entities. we will now discuss some common examples. lines. the correspondence of image lines between views places no constraint at all on f. here a line is an infinite line not a line segment. consider the case of corresponding image points the points in each image back-project to rays one through each camera centre and these rays intersect at the point. now in general two lines in are skew they do not intersect so the condition that the rays intersect places a constraint on the epipolar geometry. in contrast in the case of corresponding image lines the back-projection is a plane from each view. however two planes in always intersect so there is no constraint on the epipolar geometry is a constraint in the case of in the case of parallel lines the correspondence of vanishing points does provide a degeneracies x x x l l c e e c e e a b fig. epipolar tangency. for a surface for a space curve figure after porrill and pollard in the epipolar plane is tangent to the surface at x. the imaged outline is tangent to the epipolar lines at x and in the two views. the dashed curves on the surface are the contour generators. in the epipolar plane is tangent to the space curve. the corresponding epipolar lines l are tangent to the imaged curve. constraint on f. however a vanishing point has the same status as any finite point i.e. it provides one constraint. space curves and surfaces. as illustrated in figure at points at which the epipolar plane is tangent to a space curve the imaged curve is tangent to the corresponding epipolar lines. this provides a constraint on the view geometry i.e. if an epipolar line is tangent to an imaged curve in one view then the corresponding epipolar line must be tangent to the imaged curve in the other view. similarly in the case of surfaces at points at which the epipolar plane is tangent to the surface the imaged outline is tangent to the corresponding epipolar lines. epipolar tangent points act effectively as point correspondences and may be included in estimation algorithms as described by particularly important cases are those of conics and quadrics which are algebraic objects and so algebraic solutions can be developed. examples are given in the notes and exercises at the end of this chapter. degeneracies a set of correspondences i i n is geometrically degenerate with respect to f if it fails to uniquely define the epipolar geometry or equivalently if there exist linearly independent matrices fj j such that i i and i i n the subject of degeneracy is investigated in detail in chapter however a brief preview is given now for the two important cases of scene points on a ruled quadric or on a plane. provided the two camera centres are not coincident the epipolar geometry is uniquely defined. it can always be computed from the camera matrices p as in for example. what is at issue here are configurations where the epipolar geometry cannot be estimated from point correspondences. an awareness of the degeneracies of computation of the fundamental matrix f dimn unique solution no degeneracy. arises from n point correspondences in general position. if n then the point correspondences must be perfect noise-free. dimn or solutions. arises in the case of seven point correspondences and also in the case of n perfect point correspondences where the points and camera centres lie on a ruled quadric referred to as a critical surface. the quadric may be non-degenerate hyperboloid of one sheet or degenerate. dimn two-parameter family of solutions. arises if n perfect point correspondences are related by a homography rotation about the camera centre degenerate motion. all world points on a plane degenerate structure. i hxi. table degeneracies in estimating f from point correspondences classified by the dimension of the null-space n of a in estimation algorithms is important because configurations close to degenerate ones are likely to lead to a numerically ill-conditioned estimation. the degeneracies are summarized in table points on a ruled quadric it will be shown in chapter that degeneracy occurs if both camera centres and all the points lie on a quadric surface referred to as the critical surface a ruled quadric may be non-degenerate hyperboloid of one sheet a cooling tower or degenerate instance two planes cones and cylinders see section but a critical surface cannot be an ellipsoid or hyperboloid of two sheets. for a critical surface configuration there are three possible fundamental matrices. note that in the case of just point correspondences together with the two camera centres there are points in total. a general quadric has degrees of freedom and one may always construct a quadric through points. in the case where this quadric is a ruled quadric it will be a critical surface and there will be three possible solutions for f. the case where the quadric is not ruled corresponds to the case where there is only one real solution for f. points on a plane in this case all the an important degeneracy is when all the points lie in a plane. points plus the two camera centres lie on a ruled quadric surface namely the degenerate quadric consisting of two planes the plane through the points plus a plane passing through the two camera centres. two views of a planar set of points are related via a projective transformation h. thus suppose that a set of correspondences xi i hxi. any number of points xi and the corresponding points i hxi may be given. i is given for which a geometric interpretation of f-computation i i tfh the fundamental matrix corresponding to the pair of cameras satisfies the equation tfxi i this set of equations is satisfied whenever fh is skewsymmetric. thus the solution for f is any matrix of the form f sh where s is skew-symmetric. now a skew-symmetric matrix s may be written in the form s for any t. thus s has three degrees of freedom and consequently so does f. more precisely the correspondences xi i lead to a three-parameter family of possible fundamental matrices f one of the parameters accounts for scaling the matrix so there is only a two-parameter family of homogeneous matrices. the equation matrix a derived from the set of correspondences must therefore have rank no greater than from the decomposition of f sh it follows from result that the pair of camera matrices and t correspond to the fundamental matrix f. here the vector t may take on any value. if point xi yi and i hxi then one verifies that the point xi y maps to xi and i through the two cameras. thus the points xi constitute a reconstruction of the scene. no translation if the two camera centres are coincident then the epipolar geometry is not defined. in addition formulae such as result give a value of for the fundamental matrix. in this case the two images are related by a homography section if one attempts to find the fundamental matrix then as shown above there will be at least a family of solutions for f. even if the camera motion involves no translation then a method such as the algorithm used to compute the fundamental matrix will still produce a matrix f satisfying tfxi where f has the form f sh h is the homography relating the points and s is an essentially arbitrary skew-symmetric matrix. points xi and i related by h will satisfy this relationship. i i y a geometric interpretation of f-computation the estimation of f from a set of image correspondences has many similarities with the problem of estimating a conic from a set of points yi a quadric from a set of points. the equation is a single constraint in x y x and so defines a surface v of codimension in the surface is a quadric because the equation is quadratic in the coordinates x y x of there is a natural mapping from projective to the variety v that takes any point to the quadruple of the corresponding image points in the two views. the quadric form is y x evident if is rewritten as x y x y x y x y y y the case of conic fitting is a good model of f estimation. to computation of the fundamental matrix f tangent line fig. estimating a conic from point data as may be poorly conditioned. all of the conics shown have residuals within the point error distribution. however even though there is ambiguity in the estimated conic the tangent line is well defined and can be computed from the points. bring out the analogy between the two estimation problems a point yi places one constraint on the degrees of freedom of a conic as described in section i bxiyi i dxi eyi f similarly a point correspondence yi x of freedom of f as i y i places one constraint on the degrees x x x y y y it is not quite an exact analogy since the defining relationship expressed by the fundamental matrix is bilinear in the two sets of indices as is also evident from the zeros in the quadric matrix above whereas in the case of a conic section the equation is an arbitrary quadratic. also the surface defined by f must satisfy an additional constraint arising from detf and there is no such constraint in the conic fitting analogue. the problems of extrapolation when data has only been fitted to a small section of a conic are well known and similar issues arise in fitting the fundamental matrix to data. indeed there are cases where the data is sufficient to determine an accurate tangent line to the conic but insufficient to determine the conic itself see figure in the case of the fundamental matrix the tangent plane to the quadric in is the affine fundamental matrix and this approximation may be fitted when perspective effects are small. the envelope of epipolar lines one of the uses of the fundamental matrix is to determine epipolar lines in a second image corresponding to points in a first image. for instance if one is seeking matched points between two images the match of a given point x in the first image may be found by searching along the epipolar line fx in the second image. in the presence of noise of course the matching point will not lie precisely on the line fx because the fundamental matrix will be known only within certain bounds expressed by its covariance matrix. in general instead of searching along the epipolar line only it will be necessary to search in a region on either side of the line fx. we will now consider how the covariance matrix of the fundamental matrix may be used to determine the region in which to search. let x be a point and f be a fundamental matrix for which one has computed a covariance matrix f. the point x corresponds to an epipolar line l fx and one the envelope of epipolar lines may transfer the covariance matrix f to a covariance matrix l according to result also by result the mean value of the epipolar line is given by l fx. to avoid singular cases the vector l representing an epipolar line is normalized so that then the mapping x l is given by l if j is the jacobian matrix of this mapping with respect to the entries of f then j is a matrix and l j fjt. though the constraint is the most convenient constraint the following analysis applies for any constraint used to confine the vector representing the epipolar line to vary on a surface in in this case the covariance matrix l is singular having rank since no variation is allowed in the direction normal to the constraint surface. for a particular instance of l the deviation from the mean l l must be along the constraint surface and hence the linear approximation perpendicular to the null-space of l. for the remainder of this derivation l the vector representing the mean epipolar line will be denoted by m so as to avoid confusing notation. now assuming a gaussian distribution for the vectors l representing the epipolar line the set of all lines having a given likelihood is given by the equation mt where k is some constant. to analyze this further we apply an orthogonal change of coordinates such that l becomes diagonal. thus one may write l m l u lut l l is a non-singular diagonal matrix. applying the same transformation where ul. since to the lines one defines is orthogonal to the null-space of have the same third coordinate. by multiplying u by a constant as necessary one may assume that this coordinate is and thus we may write then one verifies that and for certain l l both and um and l l m mt l l l l l l l this equation expands out to which may be written as l l l l l l l l l l l computation of the fundamental matrix f or equivalently one may verify l l l finally this is equivalent to l this shows that the lines satisfying form a line conic defined by the matrix the corresponding point conic which forms the envelope of the l lines is defined by the matrix l. one may now transform back to the original coordinate system to determine the envelope of the lines in the original coordinate system. the transformed conic is c lu mmt l. n represents the probability that the value of a note that when k the conic c degenerates to mmt which represents the set of points lying on the line m. as k increases the conic becomes a hyperbola the two branches of which lie on opposite sides of the line m. suppose we want to choose k so that some fraction of the epipolar lines lie inside the region bounded by this hyperbola. the value mt l m of follows a n distribution and the cumulative chi-squared distribution n random able is less than n and fn distributions are defined in section applying this to a random line l one sees that in order to ensure that a fraction of lines lie within region bounded by the hyperbola defined by one must choose such that since the covariance matrix l has rank thus and for a value of for instance one finds that f the corresponding hyperbola given by is c mmt l. to sum up this discussion result if l is a random line obeying a gaussian distribution with mean l and covariance matrix l of rank then the plane conic c l lt l represents an equal-likelihood contour bounding some fraction of all instances of l. if represents the cumulative then a fraction of all lines lie within the region bounded by c. in other words with probability the lines lie within this region. distribution and is chosen such that f in applying this formula one must be aware that it represents only an approximation since epipolar lines are not normally distributed. we have consistently made the assumption that the distributions may be correctly transformed using the jacobian that is an assumption of linearity. this assumption will be most reasonable for distributions with small variance and close to the mean. here we are applying it to find the region in which as many as of samples fall namely almost the whole of the error the envelope of epipolar lines distribution. in this case the assumption of a gaussian distribution of errors is less tenable. verification of epipolar line covariance we now present some examples of epipolar line envelopes confirming and illustrating the theory developed above. before doing this however a direct verification of the theory will be given concerning the covariance matrix of epipolar lines. since the covariance matrix of a line is not easily understood quantitatively we consider the variance of the direction of epipolar lines. given a line l the angle representing its direction is given by arctan letting j equal the jacobian matrix of the mapping l one finds the variance of the angle to be j ljt. this result may be verified by simulation as follows. one considers a pair of images for which point correspondences have been identified. the fundamental matrix is computed from the point correspondences and the points are then corrected so as to correspond precisely under the epipolar mapping described in section a set of n of these corrected correspondences are used to compute the covariance matrix of the fundamental matrix f. then for a further set of test corrected points xi in the first image the mean and covariance of the corresponding epipolar line i fxi are computed and subsequently the mean and variance of the orientation direction of this line are computed. this gives the theoretical values of these quantities. next monte carlo simulation is done in which gaussian noise is added to the coordinates of the points used to compute f. using the computed f the epipolar lines corresponding to each of the test points are computed and subsequently their angle and the deviation of the angle from the mean. this is done many times and the standard deviation of angle is computed and finally compared with the theoretical value. the results of this are shown in figure for the statue image pair of figure epipolar envelopes for statue image. the statue image pair of figure is interesting because of the large depth variation across the image. there are close points the statue and distant points the building behind in close proximity in the images. the fundamental matrix was computed from several points. a point in the first image figure was selected and monte carlo simulation was used to compute several possible epipolar lines corresponding to a noise level of pixels in each matched point coordinate. to test the theory the mean and covariance of the epipolar line were next computed theoretically. the envelope of the epipolar lines was computed and drawn in the second image. the results are shown in figure for different numbers of points used to compute f. the envelope for n corresponds closely to the simulated envelope of the lines. the results shown in figure show the practical importance of computing the epipolar envelopes in point matching. thus suppose one is attempting to find a match for the foreground point in figure if the epipolar line is computed from just point matches then epipolar search is unlikely to succeed given the width of the computation of the fundamental matrix f a point number point number b fig. comparison of theoretical and monte carlo simulated values of orientation angle of epipolar lines for test points form the statue image pair of figure the horizontal axis represents the point number to and the vertical axis the standard deviation of angle. the results when the epipolar structure matrix is computed from points. the results when point matches are used. note the horizontal axis of these graphs represent discrete points numbered to the graphs are shown as a continuous curve only for visual clarity. envelope. even for n the width of the envelope at the level of the correct match is several tens of pixels. for n the situation is more favourable. note that this instability is inherent in the problem and not the result of any specific algorithm for computing f. an interesting point concerns the location of the narrowest point of the envelope. in this case it appears to be close to the correct match position for the background point in figure the match for the foreground point of statue lies far from the narrowest point of the envelope. though the precise location of the narrow point of the envelope is not fully understood it appears that in this case most points used to the computation of f are on the background building. this biases towards the supposition that other matched points lie close to the plane of the building. the match for a point at significantly different depth is less precisely known. matching points close to the epipole the corridor scene. in the case where the points to be matched are close to the epipole then the determination of the epipolar line is more unstable since any uncertainty in the position of the epipole results in uncertainty in the slope of the epipolar line. in addition as one approaches this unstable position the linear approximations implicit in the derivation of become less tenable. in particular the distribution of the epipolar lines deviates from a normal distribution. image rectification this section gives a method for image rectification the process of resampling pairs of stereo images taken from widely differing viewpoints in order to produce a pair of matched epipolar projections these are projections in which the epipolar lines run parallel with the x-axis and match up between views and consequently disparities between the images are in the x-direction only i.e. there is no y disparity. image rectification a b fig. the point in the first image used to compute the epipolar envelopes in the second images. note the ambiguity of which point is to be found in the second image. the marked point may represent the point on the statue s leg or the point on the building behind the statue in the second image these two points are quite separate and the epipolar line must pass through them both. computed corresponding epipolar lines computed from n point matches. the different lines correspond to different instances of injected noise in the matched points. gaussian noise of pixels in each coordinate was added to the ideal matched point positions before computing the epipolar line corresponding to the selected point. the ml estimator standard algorithm was used to compute f. this experiment shows the basic instability of the computation of the epipolar lines from small numbers of points. to find the point matching the selected point in the image at left one needs to search over the regions covered by all these epipolar lines. the method is based on the fundamental matrix. a pair of projective transformations are applied to the two images in order to match the epipolar lines. it is shown that the two transformations may be chosen in such a way that matching points have approximately the same x-coordinate as well. in this way the two images if overlaid on top of each other will correspond as far as possible and any disparities will be parallel to the x-axis. since the application of arbitrary projective transformations may distort the image substantially the method for finding the pair of transformations subjects the images to a minimal distortion. in effect transforming the two images by the appropriate projective transformations reduces the problem to the epipolar geometry produced by a pair of identical cameras placed side by side with their principal axes parallel. many stereo matching algorithms described in previous literature have assumed this geometry. after this rectification the search for matching points is vastly simplified by the simple epipolar structure and by the near-correspondence of the two images. it may be used as a preliminary step to comprehensive image matching. mapping the epipole to infinity in this section we will discuss the question of finding a projective transformation h of an image that maps the epipole to a point at infinity. in fact if epipolar lines are to be transformed to lines parallel with the x-axis then the epipole should be mapped to computation of the fundamental matrix f n n n n fig. the envelopes of epipolar lines are shown for a noise level of pixels with f being computed from n and points. in each case monte carlo simulated results agreed closely with these results not shown here. for the case n compare with figure note that for n the epipolar envelope is very wide degrees showing that one can have very little confidence in an epipolar line computed from points in this case. for n the envelope is still quite wide. for n and n the epipolar line is known with quite good precision. of course the precise shape of the envelope depends strongly on just what matched points are used to compute the epipolar structure. the particular infinite point this leaves many degrees of freedom fact four open for h and if an inappropriate h is chosen severe projective distortion of the image can take place. in order that the resampled image should look somewhat like the original image we may put closer restrictions on the choice of h. one condition that leads to good results is to insist that the transformation h should act as far as possible as a rigid transformation in the neighbourhood of a given selected point of the image. by this is meant that to first-order the neighbourhood of may undergo rotation and translation only and hence will look the same in the original and resampled images. an appropriate choice of point may be the centre of the image. for instance this would be a good choice in the context of aerial photography if the view is known not to be excessively oblique. for the present suppose is the origin and the epipole e lies on the x-axis. now consider the following transformation image rectification g this transformation takes the epipole to the point at infinity as required. a point y is mapped by g to the point x y y xf if then we may write x y y xf xf xf the jacobian is x y y yf xf plus higher order terms in x and y. now if x y then this is the identity map. in other words g is approximated first-order at the origin by the identity mapping. for an arbitrarily placed point of interest and epipole e the required mapping h is a product h grt where t is a translation taking the point to the origin r is a rotation about the origin taking the epipole to a point on the x-axis and g is the mapping just considered taking to infinity. the composite mapping is to first-order a rigid transformation in the neighbourhood of matching transformations in the previous section it was shown how the epipole in one image may be mapped to infinity. next it will be seen how a map may be applied to the other image to match the intention is to resample up the epipolar lines. we consider two images j and j these two images according to transformations h to be applied to j and to be applied to j the resampling is to be done in such a way that an epipolar line in j is matched more specifically if l and with its corresponding epipolar line in j are any pair of corresponding epipolar lines in the two images then h tl that h t is the line map corresponding to the point map h. any pair of transformations satisfying this condition will be called a matched pair of transformations. first to be some transformation that sends the epipole to infinity as described in the previous section. we then seek a matching transformation h chosen so as to minimize the sumof-squared distances our strategy in choosing a matched pair of transformations is to choose dhxi the first question to be determined is how to find a transformation matching question is answered in the following result. that i result let j and j a projective transformation of j be images with fundamental matrix f m and let a projective transformation h of j matches be if and computation of the fundamental matrix f only if h is of the form h for some vector a. proof. if x is a point in j then e x is the epipolar line in the first image and fx is the epipolar line in the second image. transformations h and are a matching pair if and only if h te x tfx. since this must hold for all x we may write equivalently h te tf m or applying result h in view of lemma this implies h as required. to prove the converse if holds then he this along with is sufficient for to hold and so h and transformations. are matching we are particularly interested in the case when is a transformation taking the to a point at infinity in this case i i is epipole of the form a b c ha which represents an affine transformation. thus a special case of result is be images with fundamental matrix f be a projective transformation of j corollary let j and j a transformation h of j matches where and ha is an affine transformation of the form m and let to the infinite point if and only if h is of the form h mapping the epipole given mapping the epipole to infinity we may use this corollary to make the choice of a matching transformation h to minimize the disparity. writing i i and xi the minimization problem is to find ha of the form such that i dha xi is minimized. in particular let xi xi yi and let these vectors may be computed from the matched points xi be minimized may be written as i since i y i x and m are known i. then the quantity to i xi b yi c x yi y since yi y is a constant this is equivalent to minimizing image rectification xi b yi c x i this is a simple linear least-squares parameter minimization problem and is easily solved using linear techniques section to find a b and c. then ha is computed from and h from note that a linear solution is possible because ha is an affine transformation. if it were simply a projective transformation this would not be a linear problem. algorithm outline the resampling algorithm will now be summarized. the input is a pair of images containing a common overlap region. the output is a pair of images resampled so that the epipolar lines in the two images are horizontal with the x-axis and such that corresponding points in the two images are as close to each other as possible. any remaining disparity between matching points will be along the the horizontal epipolar lines. a top-level outline of the algorithm is as follows. identify a seed set of image-to-image matches xi i between the two images. seven points at least are needed though more are preferable. it is possible to find such matches by automatic means. images. compute the fundamental matrix f and find the epipoles e and select a projective transformation infinity the method of section gives good results. that maps the epipole distance find the matching projective transformation h that minimizes the least-squares to the point at in the two dhxi i. i resample the first image according to the projective transformation h and the the method used is a linear method described in section second image according to the projective transformation example model house images figure shows a pair of images of some wooden block houses. edges and vertices in these two images were extracted automatically and a small number of common vertices were matched by hand. the two images were then resampled according to the methods described here. the results are shown in figure in this case because of the wide difference in viewpoint and the three-dimensional shape of the objects the two images even after resampling look quite different. however it is the case that any point in the first image will now match a point in the second image with the same ycoordinate. therefore in order to find further point matches between the images only a search is required. computation of the fundamental matrix f a b fig. image rectification. a pair of images of a house. resampled images computed from using a projective transformation computed from f. note corresponding points in match horizontally. a b fig. image rectification using affinities. a pair of original images and a detail of the images rectified using affine transformations. the average y-disparity after rectification is of the order of pixels in a image. correctly rectified images the y-disparity should be zero. affine rectification the theory discussed in this section can equally be applied to affine resampling. if the two cameras can be well approximated by affine cameras then one can rectify the images using just affine transformations. to do this one uses the affine fundamental matrix section instead of the general fundamental matrix. the above method with only minor variations can then be applied to compute a pair of matching affine transformations. figure shows a pair of images rectified using affine transformations. closure the literature the basic idea behind the computation of the fundamental matrix is given in which is well worth reading. it addresses the case of calibrated matrices only but the principles apply to the uncalibrated case as well. a good reference for the uncalibrated case is which considers most of the best methods. in addition that paper considers the uncertainty envelopes of epipolar lines following earlier work by csurka et al. a more detailed study of the algorithm in the uncalibrated case is given in weng et al. used sampson approximation for the fundamental matrix cost function. the svd method of coercing the estimated f to have rank was suggested by tsai huang there is a wealth of literature on conic fitting minimizing algebraic distance approximating geometric distance optimal fitting and fitting special forms closure notes and exercises six point correspondences constrain e and to a plane cubic in each image page the cubic also passes through the six points in each image. a sketch derivation of these results follows. given six correspondences the null-space of a in will be then the solution is f where fi denotes the matrices corresponding to the vectors spanning the null-space. the epipole satisfies fe so that since this equation has a solution it follows that which is a cubic in e. show that the image correspondence of four coplanar points and a quadric outline determines the fundamental matrix up to a two-fold ambiguity see algorithm show that the corresponding images of a conic are equivalent to two constraints on f. see for details. suppose that a stereo pair of images is acquired by a camera translating forward along its principal axis. can the geometry of image rectification described in section be applied in this case? see for an alternative rectification geometry. structure computation this chapter describes how to compute the position of a point in given its image in two views and the camera matrices of those views. it is assumed that there are errors only in the measured image coordinates not in the projection matrices p under these circumstances na ve triangulation by back-projecting rays from the measured image points will fail because the rays will not intersect in general. it is thus necessary to estimate a best solution for the point in a best solution requires the definition and minimization of a suitable cost function. this problem is especially critical in affine and projective reconstruction in which there is no meaningful metric information about the object space. it is desirable to find a triangulation method that is invariant to projective transformations of space. in the following sections we describe the estimation of x and of its covariance. an optimal estimator for the point is developed and it is shown that a solution can be obtained without requiring numerical minimization. note this is the scenario where f is given a priori and then x is determined. an alternative scenario is where f and are estimated simultaneously from the image point correspondences but this is not considered in this chapter. it may be solved using the gold standard algorithm of section using the method considered in this chapter as an initial estimate. i problem statement it is supposed that the camera matrices and hence the fundamental matrix are provided or that the fundamental matrix is provided and hence a pair of consistent camera matrices can be constructed in section in either case it is assumed that these matrices are known exactly or at least with great accuracy compared with a pair of matching points in the two images. since there are errors in the measured points x and the rays back-projected from the points are skew. this means that there will not be a point x which exactly satisfies x px and that the image points do not satisfy the epipolar constraint these statements are equivalent since the two rays corresponding to a matching pair of points x will meet in space if and only if the points satisfy the epipolar constraint. see figure problem statement x c x c l f x image e a b x f x e image fig. rays back-projected from imperfectly measured points x eral. the epipolar geometry for x the epipolar line fx is the image of the ray through x and l since the rays do not intersect are skew in in gen. the measured points do not satisfy the epipolar constraint. is the image of the ray through and x does not lie on l. does not lie on a desirable feature of the method of triangulation used is that it should be invariant under transformations of the appropriate class for the reconstruction if the camera matrices are known only up to an affine projective transformation then it is clearly desirable to use an affine projective invariant triangulation method to compute the space points. thus denote by a triangulation method used to compute a space point x from a point correspondence x and a pair of camera matrices p and we write x p the triangulation is said to be invariant under a transformation h if p ph this means that triangulation using the transformed cameras results in the transformed point. it is clear particularly for projective reconstruction that it is inappropriate to minimize errors in the projective space for instance the method that finds the midpoint of the common perpendicular to the two rays in space is not suitable for projective reconstruction since concepts such as distance and perpendicularity are not valid in the context of projective geometry. in fact in projective reconstruction this method will give different results depending on which particular projective reconstruction is considered the method is not projective-invariant. here we will give a triangulation method that is projective-invariant. the key idea projects as x structure computation is to estimate a point which exactly satisfies the supplied camera geometry so it and the aim is to estimate from the image measurements x and the point which minimizes the reprojection error the squared distances between the projections of and the measured image points. which are the projections of do not depend on the projective frame in which is defined i.e. a different projective reconstruction will minimized and the points x and as described in section the maximum likelihood estimate under gaussian noise is given by such a triangulation method is projective-invariant because only image distances are project to the same points. in the following sections simple linear triangulation methods are given. then the mle is defined and it is shown that an optimal solution can be obtained via the root of a sixth-degree polynomial thus avoiding a non-linear minimization of a cost function. linear triangulation methods in this section we describe simple linear triangulation methods. as usual the estimated point does not exactly satisfy the geometric relations and is not an optimal estimate. the linear triangulation method is the direct analogue of the dlt method described in section in each image we have a measurement x px and these equations can be combined into a form ax which is an equation linear in x. first the homogeneous scale factor is eliminated by a cross product to give three equations for each image point of which two are linearly independent. for example for the first image x and writing this out gives where pit are the rows of p. these equations are linear in the components of x. an equation of the form ax can then be composed with x y a where two equations have been included from each image giving a total of four equations in four homogeneous unknowns. this is a redundant set of equations since the solution is determined only up to scale. two ways of solving the set of equations of the form ax were discussed in section and will be considered again here. homogeneous method the method of section finds the solution as the unit singular vector corresponding to the smallest singular value of a as shown geometric error cost function in section the discussion in section on the merits of normalization and of including two or three equations from each image applies equally well here. inhomogeneous method. in section the solution of this system as a set of inhomogeneous equations is discussed. by setting x y z the set of homogeneous equations ax is reduced to a set of four inhomogeneous equations in three unknowns. the least-squares solution to these inhomogeneous equations is described in section as explained in section however difficulties arise if the true solution x has last coordinate equal or close to in this case it is not legitimate to set it to and instabilities can occur. discussion. these two methods are quite similar but in fact have quite different properties in the presence of noise. the inhomogeneous method assumes that the solution point x is not at infinity for otherwise we could not assume that x y z this is a disadvantage of this method when we are seeking to carry out a projective reconstruction where reconstructed points may lie on the plane at infinity. furthermore neither of these two linear methods is quite suitable for projective reconstruction since they are not projective-invariant. to see this suppose that camera matrices p and are replaced by ph and one sees that in this case the matrix of equations a becomes ah a point x such that ax for the original problem corresponds to a point hx satisfying for the transformed problem. thus there is a one-to-one correspondence between points x and hx giving the same error. however neither the condition for the homogeneous method nor the condition x y z for the inhomogeneous method is invariant under application of the projective transformation h. thus in general the point x solving the original problem will not correspond to a solution hx for the transformed problem. for affine transformations on the other hand the situation is different. in fact although the condition is not preserved under affine transformations the condition x y z is preserved since for an affine transformation hx y z this means that there is a one-to-one correspondence between a vector x y z such that ax y z and the vector hx such that the error is the same for corresponding points. thus the points that minimize the error correspond as well. hence the inhomogeneous method is affine-invariant whereas the homogeneous method is not. y y y z z z in the remainder of this chapter we will describe a method for triangulation that is invariant to the projective frame of the cameras and minimizes a geometric image error. this will be the recommended triangulation method. nevertheless the homogeneous linear method described above often provides acceptable results. furthermore it has the virtue that it generalizes easily to triangulation when more than two views of the point are available. geometric error cost function a typical observation consists of a noisy point correspondence x which does not in general satisfy the epipolar constraint. in reality the correct values of the cor structure computation x x x d x d c e e c satisfy the epipolar constraint unlike the measured points the corresponding image points x fig. minimization of geometric error. the estimated projects to the two images the point is chosen so that the reprojection error d at x x and responding image points should be points x x we seek the points x and subject to x mizing the reprojection error for a point which is mapped to x and where d is the euclidean distance between the points. this is equivalent to miniby projection and satisfying the epipolar constraint x exactly. lying close to the measured points that minimize the function is minimized. cx dx matrices consistent with f as illustrated in figure spondences. once method since the corresponding rays will meet precisely in space. as explained in section assuming a gaussian error distribution the points and x are maximum likelihood estimates for the true image point corre and x are found the point may be found by any triangulation this cost function could of course be minimized using a numerical minimization method such as levenberg marquardt a close approximation to the minimum may also be found using a first-order approximation to the geometric cost function namely the sampson error as described in the next section. however in section it is shown that the minimum can be obtained non-iteratively by the solution of a sixth-degree polynomial. sampson approximation geometric correction before deriving the exact polynomial solution we develop the sampson approximation which is valid when the measurement errors are small compared with the measurements. the sampson approximation to the geometric cost function in the case of the fundamental matrix has already been discussed in section here we are concerned with computing the correction to the measured points. the sampson correction x to the measured point x y x in this section x does not denote a homogeneous point is shown in section y an optimal solution l f x d x d x f x e e image of an estimated point lie on a pair of corresponding epipolar is reduced to a one-parameter search for corresponding epipolar lines so as to minimize the squared fig. the projections x and lines. the optimal x and will lie at the foot of the perpendiculars from the measured points x and parametrizing the corresponding epipolar lines as a one-parameter family the optimal estimation of image sum of perpendicular distances d to be x jtjjt and the corrected point is x x x jtjjt as shown in section in the case of the variety defined by the error and the jacobian is j x etc. then the first-order approximation where for instance to the corrected point is simply x y x y x y x y the approximation is accurate if the correction in each image is small than a pixel and is cheap to compute. note however that the corrected points will not satisfy the epipolar relation x exactly. the method of the following section computes the points x which do exactly satisfy the epipolar constraint but is more costly. an optimal solution in this section we describe a method of triangulation that finds the global minimum of the cost function using a non-iterative algorithm. if the gaussian noise model can be assumed to be correct this triangulation method is then provably optimal. reformulation of the minimization problem given a measured correspondence x and x that minimize the sum of squared distances subject to the epipolar constraint x the following discussion relates to figure any pair of points satisfying the we seek a pair of points structure computation epipolar constraint must lie on a pair of corresponding epipolar lines in the two images. thus in particular the optimum point x lies on an epipolar line l and lies on the corresponding epipolar line on the other hand any other pair of points lying on the lines l and will also satisfy the epipolar constraint. this is true in particular for the point x on l lying closest to the measured point x and the correspondingly defined of all pairs of points on the lines l and on point minimize the squared distance sum of it follows that and x x where x and are defined with respect to a pair of matching epipolar lines l and consequently we may write dx x l where dx l represents the perpendicular distance from the point x to the line l. a similar expression holds for the points x and in view of the previous paragraph we may formulate the minimization problem dif ferently as follows. we seek to minimize dx where l and then the closest point on the line l to the point x and the point range over all choices of corresponding epipolar lines. the point x is is similarly defined. our strategy for minimizing is as follows an epipolar line in the first image may be written as lt. parametrize the pencil of epipolar lines in the first image by a parameter t. thus using the fundamental matrix f compute the corresponding epipolar line express the distance function dx explicitly as a function in the second image. of t. find the value of t that minimizes this function. in this way the problem is reduced to that of finding the minimum of a function of a single variable t i.e. c dx min t c dx it will be seen that for a suitable parametrization of the pencil of epipolar lines the distance function is a rational polynomial function of t. using techniques of elementary calculus the minimization problem reduces to finding the real roots of a polynomial of degree details of the minimization if both of the image points correspond with the epipoles then the point in space lies on the line joining the camera centres. in this case it is impossible to determine the position of the point in space. if only one of the corresponding points lies at an epipole then we conclude that the point in space must coincide with the other camera centre. consequently we assume that neither of the two image points x and corresponds with an epipole. image in order to place both points x and in this case we may simplify the analysis by applying a rigid transformation to each at the origin in homogeneous an optimal solution coordinates. furthermore the epipoles may be placed on the x-axis at points f respectively. a value f equal to means that the epipole is at infinand f ity. applying these two rigid transforms has no effect on the sum-of-squares distance function in and hence does not change the minimization problem. thus in future we assume that in homogeneous coordinates x and that the two epipoles are at points f and f f f the fundamental matrix has a special form in this case since f f f b f d d f c f a c d b d f consider an epipolar line in the first image passing through the point t in homogeneous coordinates and the epipole f we denote this epipolar line by lt. the vector representing this line is given by the cross product f t so the squared distance from the line to the origin is dx using the fundamental matrix to find the corresponding epipolar line in the other image we see that t f d at b ct dt. this is the representation of the line tance of this line from the origin is equal to as a homogeneous vector. the squared dis the total squared distance is therefore given by st f our task is to find the minimum of this function. we may find the minimum using techniques of elementary calculus as follows. we compute the derivative s f bcat bct d maxima and minima of st will occur when s s over a common denominator and equating the numerator to gives a condition collecting the two terms in gt f f bct d the minima and maxima of st will occur at the roots of this polynomial. this is a structure computation objective given a measured point correspondence x corrected correspondences x epipolar constraint x algorithm define transformation matrices and a fundamental matrix f compute the that minimize the geometric error subject to the x y these are the translations that take x y and x y and t y replace f by tft the new f corresponds to translated coordinates. compute the right and left epipoles e and such that e and do to the origin. e and fe normalize by a scale e such that the same to form matrices r and e e e e and observe that r and e e replace f by the resulting f must have the form set f f a b c and d form the polynomial gt as a polynomial in t according to solve for t to get are rotation matrices and re and roots. evaluate the two lines l t and evaluate the cost function at the real part of each of the roots of gt evaluate at only the real roots of gt. also find the asymptotic value of for t namely f select the value tmin of t that gives the smallest value of the cost function. given by at tmin and find x and as the closest points on these lines to the origin. for a general line the formula for the closest point on the line to the origin is the may then be obtained by the homogeneous method of section transfer back to the original coordinates by replacing x by t x and by algorithm the optimal triangulation method. polynomial of degree which may have up to real roots corresponding to minima and maxima of the function st. the absolute minimum of the function st may be found by finding the roots of gt and evaluating the function st given by at each of the real roots. more simply one checks the value of st at the real part of each root or real of gt which saves the trouble of determining if a root is real or complex. one should also check the asymptotic value of st as t to see if the minimum distance occurs when t corresponding to an epipolar line f x in the first image. the overall method is summarized in algorithm an optimal solution a b fig. example of a cost function with three minima. this is the cost function for a perfect point match which nevertheless has two minima. local minima the fact that gt in has degree means that st may have as many as three minima. in fact this is indeed possible as the following case shows. setting f f and f gives a function st with graph as shown in figure the three minima are clearly shown. as a second example we consider the case where f f and f in this case the function st is given by st and both terms of the cost function vanish for a value of t which means that the corresponding points x and exactly satisfy the epipolar constraint. this can be verified by observing that thus the two points are exactly matched. a graph of the cost function st is shown in figure apart from the absolute minimum at t there is also a local minimum at t thus even in the case of perfect matches local minima may occur. this example shows that an algorithm that attempts to minimize the cost function in or equivalently by an iterative in this graph and also figure we make the substitution t tan and plot for in the range so as to show the whole infinite range for t. structure computation search beginning from an arbitrary initial point is in danger of finding a local minimum even in the case of perfect point matches. evaluation on real images an experiment was carried out using the calibration cube images shown in figure with the goal of determining how the triangulation method effects the accuracy of reconstruction. a euclidean model of the cubes to be used as ground truth was estimated and refined using accurate image measurements. the measured pixel locations were corrected to correspond exactly to the euclidean model requiring coordinate corrections averaging pixels. at this stage we had a model and a set of matched points corresponding exactly to the model. next a projective reconstruction of the points was computed and a projective transformation h computed that brought the projective reconstruction into agreement with the euclidean model. controlled zero-mean gaussian noise was introduced into the point coordinates and triangulation using two methods was carried out in the projective frame the transformation h applied and the error of each method was measured in the euclidean frame. figure shows the results of this experiment for the two triangulation methods. the graph shows the average reconstruction error over all points in separate runs at each chosen noise level. it clearly shows that the optimal method gives superior reconstruction results. in this pair of images the two epipoles are distant from the image. for cases where the epipoles are close to the images results on synthetic images show that the advantage of the polynomial method will be more pronounced. r o r r e n o i t c u r t s n o c e r noise fig. reconstruction error comparison of triangulation methods. the graph shows the reconstruction error obtained using two triangulation methods selection of the midpoint of the common perpendicular to the rays in the projective frame curve and the optimal polynomial method curve. on the horizontal axis is the noise on the vertical axis the reconstruction error. the units for reconstruction error are relative to a unit distance equal to the side of one of the dark squares in the calibration cube image figure even for the best method the error is large for higher noise levels because there is little movement between the images. probability distribution of the estimated point fig. uncertainty of reconstruction. the shaded region in each case illustrates the shape of the uncertainty region which depends on the angle between the rays. points are less precisely localized along the ray as the rays become more parallel. forward motion in particular can give poor reconstructions since rays are almost parallel for much of the field of view. probability distribution of the estimated point an illustration of the distribution of the reconstructed point is given in figure a good rule of thumb is that the angle between the rays determines the accuracy of reconstruction. this is a better guide than simply considering the baseline which is the more commonly used measure. more formally the probability of a particular point x depends on the probability of obtaining its image in each view. we will consider a simplified example where the objective is to estimate the probability that a point on a plane has position x yt in two line cameras. projections f and given its images x f and x respectively f see section the imaging geometry is shown in figure are expressible in terms of projection matrices and f suppose that the measured image point is at x in the first image and the measurement process is corrupted by gaussian noise with mean zero and variance then the probability of obtaining x given that the true image point is f is given by pxx exp with a similar expression for px pxx x we wish to compute the a posteriori distribution px x x assuming a uniform prior probability px and independent image measurements in the two images it follows that pxx x pxxpx px x figure shows an example of this probability density function the bias and variance of this example is discussed in appendix line reconstruction suppose a line in is projected to lines in two views as l and the line in can be reconstructed by back-projecting each line to give a plane in and intersecting the planes. structure computation c a b c fig. pdf for a triangulated point. the camera configuration. there are two line cameras with centres at and the image lines are the left and lower edge of the square. the bar indicates the range of the noise. the plots show the pdf for a triangulated point computed from the two perspective projections. a large noise variance is chosen to emphasize the effect. the pdf shown as an image with white representing a higher value. a contour plot of the pdf. note that the pdf is not a gaussian. l e c l l e c epipolar plane fig. line reconstruction. the image lines l respectively. the plane intersection determines the line l in if the line in lies on an epipolar plane then its position in cannot be determined from its images. in this case the epipoles lie on the image lines. back-project to planes the planes defined by the lines are ptl and it is often quite convenient in practice to parametrize the line in by the two planes defined by the image lines i.e. to represent the line as the matrix l ltp as described in the span representation of section then for example a point x lies on the line if lx in the case of corresponding points the pre-image the point in that projects to the image points is over-determined since there are four measurements closure on the three degrees of freedom of the point. in contrast in the case of lines the pre-image is exactly determined because a line in has four degrees of freedom and the image line provides two measurements in each view. note here we are considering the lines as infinite and not using their endpoints. degeneracy. as illustrated in figure lines in lying on epipolar planes cannot be determined from their images in two views. such lines intersect the camera baseline. in practice when there is measurement error lines which are close to intersecting the baseline can be poorly localized in a reconstruction. the degeneracy for lines is far more severe than for points in the case of points there is a one-parameter family of points on the baseline which cannot be recovered. for lines there is a three-parameter family one parameter for position on the baseline and the other two for the star of lines through each point on the baseline. intersection of more than two planes in later chapters chapter we will be considering reconstruction from three or more views. to reconstruct the line that results from the intersection of several planes it is appropriate to proceed as follows. represent each plane i by a and form an n matrix a for n planes with rows t i let a udvt be the singular value decomposition. the two columns of v corresponding to the two largest singular values span the best rank approximation to a and may be used to define the line of intersection of the planes. if the planes are defined by back-projecting image lines then the maximum likelihood estimate of the line l in is found by minimizing a geometric image distance between l projected into each image and the measured line in that image. this is discussed in section closure it is not evident how to extend the polynomial method of triangulation to or more views. however the linear method extends in an obvious manner. more interestingly the sampson method also may be extended to or more views as is described in the disadvantage is that the computational cost also coding effort increases noticeably with more views. the literature the optimal triangulation method was given by hartley sturm notes and exercises derive a method for triangulation in the case of pure translational motion of the cameras. hint see figure a closed form solution for the parameter is possible. this method was used in adapt the polynomial triangulation method to a pair of affine cameras more generally to cameras with the same principal plane. in this case the fundamental matrix has a simple form and the method reduces to a linear algorithm. structure computation d x x d x images e e fig. the epipolar geometry for pure translation. in this case corresponding epipolar lines are can identical section the epipolar line by that minimizes d be computed directly. show that the sampson method is invariant under euclidean co derive the analogue of the polynomial solution for triangulation in the case of compute ordinate changes in the images the corresponding change in f. a planar homography i.e. given a measured correspondence x points x and that minimize the function dx cx subject to h x. see where it is shown that the solution is a degree polynomial in one variable. scene planes and homographies this chapter describes the projective geometry of two cameras and a world plane. images of points on a plane are related to corresponding image points in a second view by a homography as shown in figure this is a projective relation since it depends only on the intersections of planes with lines. it is said that the plane induces a homography between the views. the homography map transfers points from one view to the other as if they were images of points on the plane. there are then two relations between the two views first through the epipolar geometry a point in one view determines a line in the other which is the image of the ray through that point and second through the homography a point in one view determines a point in the other which is the image of the intersection of the ray with a plane. this chapter ties together these two relations of geometry. two other important notions are described here the parallax with respect to a plane and the infinite homography. x h x c x c fig. the homography induced by a plane. the ray corresponding to a point x is extended to meet the plane in a point x this point is projected to a point in the other image. the map from x to is the homography induced by the plane there is a perspectivity x x between the world plane and the first image plane and a perspectivity x between the world plane and second image plane. the composition of the two perspectivities is a homography h x hx between the image planes. scene planes and homographies homographies given the plane and vice versa we start by showing that for planes in general position the homography is determined uniquely by the plane and vice versa. general position in this case means that the plane does not contain either of the camera centres. if the plane does contain one of the camera centres then the induced homography is degenerate. suppose a plane in is specified by its coordinates in the world frame. we first derive an explicit expression for the induced homography. result given the projection matrices for the two views p a and a plane defined by tx with then the homography induced by the plane is hx with h a avt. we may assume that since the plane does not pass through the centre of the first camera at note there is a three-parameter family of planes in and correspondingly a three-parameter family of homographies between two views induced by planes in these three parameters are specified by the elements of the vector v which is not a homogeneous proof. to compute h we back-project a point x in the first view and determine the intersection point x of this ray with the plane the point x is then projected into the second view. for the first view x px and so any point on the ray x projects to x where parametrizes the point on the ray. since the point x is on it satisfies tx this determines and x vtxt. the point x projects into the second view as ax a avt ax avtx x as required. example a calibrated stereo rig. suppose the camera matrices are those of a calibrated stereo rig with the world origin at the first camera pe ki e t and the world plane e has coordinates e dt so that for points on the plane d we wish to compute an expression for the homography induced by the plane. homographies given the plane and vice versa from result with v nd the homography for the cameras p t is applying the transformations k and ki t and the resulting induced homography is e to the images we obtain the cameras pe k h r tntd. r tntd h this is a three-parameter family of homographies parametrized by nd. it is defined by the plane and the camera internal and relative external parameters. homographies compatible with epipolar geometry suppose four points xi are chosen on a scene plane. then the correspondence xi i of their images between two views defines a homography h which is the homography induced by the plane. these image correspondences also obey the epipolar constraint i.e. tfxi since they arise from images of scene points. indeed the correspondence x are images of a scene point in this case the point given by intersecting the scene plane with the ray back-projected from x. the homography h is said to be consistent or compatible with f. hx obeys the epipolar constraint for any x since again x and i now suppose four arbitrary image points are chosen in the first view and four arbitrary image points chosen in the second. then a homography h may be computed which maps one set of points into the other no three are collinear in either view. however correspondences x hx may not obey the epipolar constraint. if the correspondence x hx does not obey the epipolar constraint then there does not exist a scene plane which induces h. the epipolar geometry determines the projective geometry between two views and can be used to define conditions on homographies which are induced by actual scene planes. figure illustrates several relations between epipolar geometry and scene planes which can be used to define such conditions. for example since correspondences x hx obey the epipolar constraint if h is induced by a plane then from xthtfx this is true for all x so a homography h is compatible with a fundamental matrix f if and only if the matrix htf is skew-symmetric htf fth the argument above showed that the condition was necessary. the fact that this is a sufficient condition was shown by luong and vi eville counting degrees of freedom places six homogeneous inhomogeneous constraints on the degrees of freedom of h. there are therefore degrees of freedom remaining scene planes and homographies baseline e a e l e x e l e l e e e b l e x hx e c fig. compatibility constraints. the homography induced by a plane is coupled to the epipolar geometry and satisfies constraints. the epipole is mapped by the homography as he since the epipoles are images of the point on the plane where the baseline intersects epipolar lines are mapped by the homography as e le. any point x mapped by the homography lies on its corresponding epipolar line e fx e sol for h these degrees of freedom correspond to the three-parameter family of planes in the compatibility constraint is an implicit equation in h and f. we now develop an explicit expression for a homography h induced by a plane given f which is more suitable for a computational algorithm. result given the fundamental matrix f between two views the three-parameter family of homographies induced by a world plane is h a where a f is any decomposition of the fundamental matrix. proof. result has shown that given the camera matrices for the view pair p a a plane induces a homography h a avt where however according to result for the fundamental matrix f a one can choose the two cameras to be and remark. the above derivation which is based on the projection of points on a plane ensures that the homographies are compatible with the epipolar geometry. algebraically the homography is compatible with the fundamental matrix since it obeys the necessary and sufficient condition that fth is skew-symmetric. this plane induced homographies given f and image correspondences a a follows from fth using since a is skew-symmetric. comparing with the general decomposition of the fundamental matrix as given in lemma or it is evident that they involve an identical formula for signs. in fact there is a one-to-one correspondence between decompositions of the fundamental matrix to the scale factor ambiguity k in lemma and homographies induced by world planes as stated here. corollary a transformation h is the homography between two images induced by some world plane if and only if the fundamental matrix f for the two images has a decomposition f this choice in the decomposition simply corresponds to the choice of projective world in fact h is the transformation with respect to the plane with coordinates frame. in the reconstruction with p and finding the plane that induces a given homography is a simple matter given a pair of h. camera matrices as follows. result given the cameras in the canonical form p a then the plane that induces a given homography h between the views has coordinates where v may be obtained linearly by solving the equations h a avt which are linear in the entries of v and note these equations have an exact solution only if h satisfies the compatibility constraint with f. for a homography computed numerically from noisy data this will not normally be true and the linear system is over-determined. plane induced homographies given f and image correspondences a plane in can be specified by three points or by a line and a point and so forth. in turn these elements can be specified by image correspondences. in section the homography was computed from the coordinates of the plane. in the following the homography will be computed directly from the corresponding image elements that specify the plane. this is a quite natural mechanism to use in applications. we will consider two cases three points a line and a point. in each case the corresponding elements are sufficient to determine a plane in uniquely. it will be seen that in each case the corresponding image entities have to satisfy consistency constraints with the epipolar geometry. there are degenerate configurations of the elements and cameras for which the homography is not defined. such degeneracies arise from collinearities and coplanarities of the elements and the epipolar geometry. there may also be degeneracies of the solution method but these can be avoided. the three-point case is covered in more detail. scene planes and homographies l e x x x e e e l fig. degenerate geometry for an implicit computation of the homography. the line defined by the points and lies in an epipolar plane and thus intersects the baseline. the images of and are collinear with the epipole and h cannot be computed uniquely from the correspondences xi this configuration is not degenerate for the explicit method. i i e three points we suppose that we have the images in two views of three points xi and the fundamental matrix f. the homography h induced by the plane of the points may be computed in principle in two ways first he from which h may be computed. the position of the points xi is recovered in a projective reconstruction then the plane through the points is determined and the homography computed from the plane as in result second the homography may be computed from four corresponding points the four points in this case being the images of the three points xi on the plane together with the epipole in each view. the epipole may be used as the fourth point since it is mapped between the views by the homography as shown in figure thus we have four correspondences i hxi i we thus have two alternative methods to compute h from three point correspondences the first involving an explicit reconstruction the second an implicit one where the epipole provides a point correspondence. it is natural to ask if one has an advantage over the other and the answer is that the implicit method should not be used for computation as it has significant degeneracies which are not present in the explicit method. consider the case when two of the image points are collinear with the epipole assume for the moment that the measurements are noise-free. a homography h cannot be computed from four correspondences if three of the points are collinear section so the implicit method fails in this case. similarly if the image points are close to collinear with the epipole then the implicit method will give a poorly conditioned estimate for h. the explicit method has no problems when two points are collinear or close to collinear with the epipole the corresponding image points define points in world points are on the same epipolar plane but this is not a degenerate situation and the plane and hence homography can be computed. the configuration is illustrated in figure we now develop the algebra of the explicit method in more detail. it is not neces plane induced homographies given f and image correspondences sary to actually determine the coordinates of the points xi all that is important is the constraint they place on the three-parameter family of homographies compatible with f h a parametrized by v. the problem is reduced to that of solving for v from the three point correspondences. the solution may be obtained as result given f and the three image point correspondences xi raphy induced by the plane of the points is h a i the homog where a f and b is a with components bi i i i and m is a matrix with rows xt i proof. according to result f may be decomposed as f gives h a and each correspondence xi constraint on v as a. then i generates a linear from the vectors zero i i hxi axi i and axi i forming the scalar product with the vector i are parallel so their vector product is axi gives bi i i i i i i xt i v which is linear in v. note the equation is independent of the scale of occurs the same number of times in the numerator and denominator. each correspondence generates an equation xt i v bi and collecting these together we have mv b. since note a solution cannot be obtained if mt is not of full rank. algebraically det m if the three image points xi are collinear. geometrically three collinear image points arise from collinear world points or coplanar world points where the plane contains the first camera centre. in either case a full rank homography is not defined. consistency conditions. equation is equivalent to six constraints since each point correspondence places two constraints on a homography. determining v requires only three constraints so there are three constraints remaining which must be satisfied for a valid solution. these constraints are obtained by taking the cross product of with which gives i axi fxi. scene planes and homographies objective given f and three point correspondences xi determine the homography hx induced by the plane of xi. algorithm i which are the images of points xi for each correspondence xi i compute the corrected correspondence xi i using algorithm choose a f and solve linearly for v from mv b as in result then h a algorithm the optimal estimate of the homography induced by a plane defined by three points. i fxi is a consistency constraint between xi and the equation i since it is independent of v. it is simply a epipolar constraint on the correspondence xi i and the rhs is fxi which is the epipolar line for xi in the second image i.e. the equation enforces that i lie on the epipolar line of xi and hence the correspondence is consistent with the epipolar geometry. i the lhs is the epipolar line through estimation from noisy points. the three point correspondences which determine the plane and homography must satisfy the consistency constraint arising from the epipolar geometry. generally measured correspondences xi i will not exactly satisfy this constraint. we therefore require a procedure for optimally correcting the measured points so that the estimated points xi i satisfy the epipolar constraint. fortunately such a procedure has already been given in the triangulation algorithm which can be adopted here directly. we then have a maximum likelihood estimate of h and the points under gaussian image noise assumptions. the method is summarized in algorithm a point and line in this section an expression is derived for a plane specified by a point and line correspondence. we start by considering only the line correspondence and show that this reduces the three-parameter family of homographies compatible with f to a family. it is then shown that the point correspondence uniquely determines the plane and corresponding homography. the correspondence of two image lines determines a line in and a line in lies on a one parameter family pencil of planes see figure this pencil of planes induces a pencil of homographies between the two images and any member of this family will map the corresponding lines to each other. result the homography for the pencil of planes defined by a line correspondence l is given by f provided where is a projective parameter. h plane induced homographies given f and image correspondences l l e c e c c a l e l b e c fig. image lines l and respectively. the intersection of these planes defines the line l in the line l in is contained in a one parameter family of planes this family of planes induces a one parameter family of homographies between the images. determine planes and proof. from result the line l back-projects to a plane ptl through the first camera centre and through the second see figure these two planes are the basis for a pencil of planes parametrized by as in the proof of result we may choose p back-projects to a plane ptl then the pencil of planes is l from result the induced homography is h with using the decomposition a h f f v l f we obtain f where the last equality follows from result that equivalent to up to scale. f f. this is the homography for a corresponding point and line. from the line correspondence we have that h f and now solve for using the point correspondence x result given f and a corresponding point x phy induced by the plane of the point and line is and line l the homogra h f t the derivation is analogous to that of result as in the three-point case the image point correspondence must be consistent with the epipolar geometry. this means scene planes and homographies l l e x e e l x l e image image fig. the epipolar geometry induces a homography between corresponding lines l the images of a line l in the points on l are mapped to points on and are the images of the intersection of l with the epipolar plane corresponding to le and e. which are as fx where x that the measured points must be corrected using algorithm before result is applied. there is no consistency constraint on the line and no correction is available. geometric interpretation of the point map h it is worth exploring the map h further. since h is compatible with the epipolar geometry a point x in the first view is mapped to a point h in the second view on the epipolar line fx corresponding to x. in general the position of the point h on the epipolar line varies with however if the point x lies on l that ltx then h f fx which is independent of the value of depending only on f. thus as shown in figure the epipolar geometry defines a point-to-point map for points on the line. degenerate homographies. as has already been stated if the world plane contains one of the camera centres then the induced homography is degenerate. the matrix representing the homography does not have full rank and points on one plane are mapped to a line rank h or a point rank h however an explicit expression can be obtained for a degenerate homography from the degenerate homographies in this pencil are at and these correspond to planes through the first and second camera centres respectively. figure shows the case where the plane contains the second camera centre and intersects the image plane in the line at the point where a point x in the first view is imaged on fx. fx f. this is a rank matrix. the homography is thus h computing f given the homography induced by a plane up to now it has been assumed that f is given and the objective is to compute h when various additional information is provided. we now reverse this and show that if h is given then f may be computed when additional information is provided. we start by introducing an important geometric idea that of parallax relative to a plane which will make the algebraic development straightforward. computing f given the homography induced by a plane x l x x c c c x e l x e fx c a b fig. a degenerate homography. the map induced by a plane through the second camera centre is a degenerate homography h f. the plane intersects the second image plane in the line in the second. a point x in the first view is imaged at with the epipolar line fx of x so that fx. all points in the first view are mapped to points on the intersection of x x x h l x c e e c fig. plane induced parallax. the ray through x intersects the plane at the point x the images of x and x are coincident points at x in the first view. in the second view the images are the points hx respectively. these points are not coincident x is on but both are on the epipolar line is the parallax relative to the homography induced by the plane note that if x is on the other side of the plane then will be on the other side of x of x. the vector between the points and and plane induced parallax. the homography induced by a plane generates a virtual parallax section as illustrated schematically in figure and by example in figure the important point here is that in the second view the image of the point x and hx the point mapped by the homography are on the epipolar line of x since both are images of points on the ray through x. consequently the line is an epipolar line in the second view and provides a constraint on the position of the epipole. once the epipole is determined such constraints suffice then as shown in result f h where h is the homography induced by any plane. similarly it can be shown that f h te as an application of virtual parallax it is shown in algorithm that f can be computed uniquely from the images of six points four of which are coplanar and two are off the plane. the images of the four coplanar points define the homography and the two points off the plane provide constraints sufficient to determine the epipole. the scene planes and homographies a b c fig. plane induced parallax. left and right images. the left image is superimposed on the right using the homography induced by the plane of the chinese text. the transferred and imaged planes exactly coincide. however points off the plane as the mug do not coincide. lines joining corresponding points off the plane in the superimposed image intersect at the epipole. six-point result is quite surprising since for seven points in general position there are solutions for f section objective given six point correspondences xi four points i coplanar determine the fundamental matrix f. algorithm i which are the images of xi with the first compute the homography h such that determine the epipole then f h. i hxi i as the intersection of the lines and see figure algorithm computing f given the correspondences of six points of which four are coplanar. x x x x x x c x x e x a e x x c x x e b fig. the fundamental matrix is defined uniquely by the image of six points of which four are coplanar. the parallax for one point x. the epipole determined by the intersection of two parallax lines the line joining and the join of to to computing f given the homography induced by a plane a d b e c f fig. binary space partition. left and right images. points whose correspondence is known. a triplet of points selected from this triplet defines a plane. the points in can then be classified according to their side of the plane. points on one side. points on the other side. projective depth. a world point x is imaged at x in the first view and at hx in the second. note that and hx are collinear. the scalar is the parallax relative to the homography h and may be interpreted as a depth relative to the plane if then the point x is on the plane otherwise the sign of indicates which side of the plane the point x is figure and figure these statements should be taken with care because in the absence of oriented projective geometry the sign of a homogeneous object and the side of a plane have no meaning. example binary space partition. the sign of the virtual parallax may be used to compute a partition of by the plane suppose we are given f and three space points are specified by their corresponding image points. then the plane defined by the three points can be used to partition all other correspondences into sets on either side of on the plane. figure shows an example. note the three points need not actually correspond to images of physical points so the method can be applied to virtual planes. by combining several planes a region of can be identified. two planes. suppose there are two planes in the scene which induce homographies respectively. with the idea of parallax in mind it is clear that because each plane provides off-plane information about the other the two homographies scene planes and homographies x x x hx c x c h h fig. the action of the map h h as though it were the image of the point and then map it back to the first image as though it were the image of the point points in the first view which lie on the imaged line of intersection of the two planes will be mapped to themselves so are fixed points under this action. the epipole e is also a fixed point under this map. on a point x in the first image is first to transfer it to should be sufficient to determine f. indeed f is over-determined by this configuration which means that the two homographies must satisfy consistency constraints. consider figure the homography h h is a mapping from the first image onto itself. under this mapping the epipole e is a fixed point i.e. he e so may be determined from the eigenvector of h. the fundamental matrix may then be computed from result as f hie for i or the map h has further properties which may be seen from figure the map has a line of fixed points and a fixed point not on the line section for fixed points and lines. this means that two of the eigenvalues of h are equal. in fact h is a planar homology section in turn these properties of h h define consistency constraints on and in order that their composition has these properties. hi where up to this point the results of this chapter have been entirely projective. now an affine element is introduced. the infinite homography h the plane at infinity is a particularly important plane and the homography induced by this plane is distinguished by a special name definition the infinite homography h is the homography induced by the plane at infinity the form of the homography may be derived by a limiting process starting from h k where d is the orthogonal distance of the plane from r tntd the infinite homography h h v image h image fig. the infinite homography h maps vanishing points between the images. the first camera h lim d h this means that h does not depend on the translation between views only on the rotation and camera internal parameters. alternatively from corresponding image points are related as h x where z is the depth measured from the first camera. again it can be seen that points at infinity are mapped by h note also that h is obtained if the translation t is zero in which corresponds to a rotation about the camera centre. thus h is the homography that relates image points of any depth if the camera rotates about its centre section since can be written as and comparison with shows that plays the role of thus euclidean inverse depth can be interpreted as parallax relative to h x vanishing points and lines. images of points on are mapped by h these images are vanishing points and so h maps vanishing points between images i.e. h v where and v are corresponding vanishing points. see figure consequently h can be computed from the correspondence of three vanishing points together with f using result alternatively h can be computed from the correspondence of a vanishing line and the correspondence of a vanishing point on the line together with f as described in section affine and metric reconstruction. as we have seen in chapter specifying enables a projective reconstruction to be upgraded to an affine reconstruction. not surprisingly because of its association with h arises naturally in the rectification. indeed if the camera matrices are chosen as p and then the reconstruction is affine. conversely suppose the world coordinate system is affine has its canonical position at then h may be determined directly from the camera projection matrices. suppose m respectively. are the first submatrix of p and scene planes and homographies x x e c correspondence on this segment h x c fig. reducing the search region using h points in are no further away than h captures this constraint and limits the search on the epipolar line in one direction. the baseline between the cameras partitions each epipolar plane into two. a point on one side of the epipolar line in the left image will be imaged on the corresponding side of the epipolar line in the right image by the solid line in the figure. the epipole thus bounds the search region in the other direction. then a point x on is imaged at x px mx and in the two views. consequently and so h the homography h may be used to propagate camera calibration from one view to another. the absolute conic resides on and its image is mapped between images by h according to result is specified in one view then the image of in a second view can be computed via h and the calibration for that view determined from section describes applications of h to camera auto-calibration. h t h thus if stereo correspondence. h limits the search region when searching for correspondences. the region is reduced from the entire epipolar line to a bounded line. see figure however a correct application of this constraint requires oriented projective geometry. closure this chapter has illustrated a raft of projective techniques for a plane that may be applied to many other surfaces. a plane is a simple parametrized surface with degrees of freedom. a very similar development can be given for other surfaces where the degrees of freedom are determined from images of points on the surface. for example in the case of a quadric the surface can be determined both from images of points on its surface andor extension not possible for planes from its outline in each view the ideas of surface induced transfer families of surfaces when the surface is not fully determined from its images surface induced parallax consistency constraints implicit computations degenerate geometries etc. all carry over to other surfaces. closure the literature the compatibility of epipolar geometry and induced homographies is investigated thoroughly by luong vi eville the six-point solution for f appeared in beardsley et al. and the solution for f given two planes appeared in sinclair gives many examples of configurations whose properties may be determined using only epipolar geometry and their image projections. he also catalogues their degenerate cases. notes and exercises homography induced by a plane the inverse of the homography h is given by h a i avta vta provided a exists. this is sometimes called the sherman-morrison formula. show that the homography h is degenerate if the plane contains the second camera centre. hint in this case vta and note that h ai a show that if the camera undergoes planar motion i.e. the translation is parallel to the plane and the rotation is parallel to the plane normal then the homography induced by the plane is conjugate to a planar euclidean transformation. show that the fixed points of the homography are the images of the plane s circular points. using show that if a camera undergoes a pure translation then the homography induced by the plane is a planar homology defined in section with a line of fixed points corresponding to the vanishing line of the plane. show further that if the translation is parallel to the plane then the homography is an elation defined in section coplanar is why is it not a sufficient condition? show that a necessary but not sufficient condition for two space lines to be intersections of lines and planes. verify each of the following results by sketching the configuration assuming general position. in each case determine the degenerate configurations for which the result is not valid. suppose the line l in is imaged as l and and the plane hx. then the point of intersection of in the first image and at induces the homography l with is imaged at x l tl in the second. a line seen in two images. if l and images and v t l. the infinite homography may be used to find the vanishing point of are corresponding lines in two their vanishing points in each image then v l scene planes and homographies suppose the planes and induce homographies respectively. then the image of the line of intersection of with in the first image obeys ht l l and may be determined from the real eigenvector of the planar homology ht and figure h t h t coplanarity of four points. suppose f is known and four corresponding image points xi i are supplied. how can it be determined whether their pre-images are coplanar? one possibility is to use three of the points to determine a homography via result and then measure the transfer error of the fourth point. a second possibility is to compute lines joining the image points and determine if the line intersection obeys the epipolar constraint a third possibility is to compute the cross-ratio of the four lines from the epipole to the image points if the four scene points are coplanar then this cross-ratio will be the same in both images. thus this equality is a necessary condition for co-planarity but is it a sufficient condition also? what statistical tests should be applied when there is measurement error hx induced by a plane t is given by starting from the camera matrices p m show that the epipolar geometry can be computed uniquely from the images of four coplanar lines and two points off the plane of the lines. if two of the lines are replaced by points can the epipolar geometry still be computed? homography h tvtm with t m and v tm show that the homography computed as in result is independent of the scale of f. start by choosing an arbitrary fixed scale for f so that f is no longer a homogeneous quantity but a matrix f with fixed scale. show that if h t fxi then replacing f by f simply scales h by bt with bi show that the f i given two perspective images of a conic and the fundamental matrix between the views then the plane of the conic consequently the homography induced by this plane is defined up to a two-fold ambiguity. suppose the image conics are c and with the two values of obtained from then the induced homography is h f details are given in f f. by considering the geometry show that to be compatible with the epipolar geometry the conics must satisfy the consistency constraint that epipolar tangents are corresponding epipolar lines figure now derive this result algebraically starting from h above. the algebraic expressions are not valid if the epipole lies on the conic then etce is this a degeneracy of the geometry or of the expression alone? closure fixed points of a homography induced by a plane. a planar homography h has up to three distinct fixed points corresponding to the three eigenvectors of the matrix section the fixed points are images of points on the plane for which hx x. the horopter is the locus of all points in for which x it is a twisted cubic curve passing through the two camera centres. a twisted cubic intersects a plane in three points and these are the three fixed points of the homography induced by that plane. estimation. suppose n points xi lie on a plane in and we wish to optimally estimate the homography induced by the plane given f and their image correspondences xi i. then the ml estimate of the homography estimating the plane dof and the n points dof each since they lie on independent gaussian measurement noise as usual is obtained by a plane which minimizes reprojection error for the n points. affine epipolar geometry this chapter recapitulates the developments and objectives of the previous chapters on two-view geometry but here with affine cameras replacing projective cameras. the affine camera is an extremely usable and well conditioned approximation in many practical situations. its great advantage is that because of its linearity many of the optimal algorithms can be implemented by linear algebra inverses svd etc. whereas in the projective case solutions either involve high order polynomials as for triangulation or are only possible by numerical minimization as in the gold standard estimation of f. we first describe properties of the epipolar geometry of two affine cameras and its optimal computation from point correspondences. this is followed by triangulation and affine reconstruction. finally the ambiguities in reconstruction that result from parallel projection are sketched and the non-ambiguous motion parameters are computed from the epipolar geometry. affine epipolar geometry in many respects the epipolar geometry of two affine cameras is identical to that of two perspective cameras for example a point in one view defines an epipolar line in the other view and the pencil of such epipolar lines intersect at the epipole. the difference is that because the cameras are affine their centres are at infinity and there is parallel projection from scene to image. this leads to certain simplifications in the affine epipolar geometry epipolar lines. consider two points in the first view. these points backproject to rays which are parallel in since all projection rays are parallel. in the second view an epipolar line is the image of a back-projected ray. the images of these two rays in the second view are also parallel since an affine camera maps parallel scene lines to parallel images lines. consequently all epipolar lines are parallel as are the epipolar planes. the epipoles. since epipolar lines intersect in the epipole and all epipolar lines are parallel it follows that the epipole is at infinity. the affine fundamental matrix x x x x l x x x x parallel epipolar planes x l l l centre lies at infinity a b fig. affine epipolar geometry. correspondence geometry projection rays are parallel and intersect at infinity. a point x back-projects to a ray in defined by the first camera centre infinity and x. this ray is imaged as a line in the second view. the point x which projects to x lies on this ray so the image of x in the second view lies on epipolar lines and planes are parallel. these points are illustrated schematically in figure and examples on images are shown in figure the affine fundamental matrix the affine epipolar geometry is represented algebraically by a matrix termed the affine fundamental matrix fa. it will be seen in the following that result the fundamental matrix resulting from two cameras with the affine form the third row is has the form fa a b c d e where indicates a non-zero entry. it will be convenient to write the five non-zero entries as fa note that in general fa has rank derivation geometric derivation. this derivation is the analogue of that given in section for a pair of projective cameras. the map from a point in one image to the corresponding epipolar line in the other image is decomposed into two steps as illustrated in figure on page affine epipolar geometry a c e b d f fig. affine epipolar lines. two views of a hole punch acquired under affine imaging conditions. for the points marked in the epipolar lines are superimposed on note that corresponding points lie on their epipolar lines and that all epipolar lines are parallel. the epipolar geometry is computed from point correspondences using algorithm and show the flow for selected points in the image lines link a point in one image to the point s position in the other image. this demonstrates that even though the epipolar lines are parallel the movement of imaged points between the views contains both rotational and translational components. point transfer via a plane since both cameras are affine points are mapped between an image and a scene plane by parallel projection so the map between and the images is a planar affine transformation the composition of the affine transformations between the first view and and and the second view is also an affine transformation i.e. hax. constructing the epipolar line. the epipolar line is obtained as the line hax fax so that fa ha. through and the epipole i.e. estimating fa from image point correspondences we now take note of the special forms of the affine matrix ha and the skew matrix is at infinity and so has a zero last element when fa ha where indicates a non-zero entry. this derives the affine form of f using only the geometric properties that the camera centres are on the plane at infinity. algebraic derivation. in the case that the cameras are both affine the affine form of the fundamental matrix is obtained directly from the expression for f in with c the camera terms of the pseudo-inverse namely f centre which is the null-vector of p. details are left as an exercise. an elegant derivation of fa in terms of determinants formed from rows of the affine camera matrices is given in section where properties the affine fundamental matrix is a homogeneous matrix with five non-zero elements it thus has degrees of freedom. these are accounted as one for each of the two epipoles epipoles lie on l so only their direction need be specified and two for the affine transformation mapping the pencil of epipolar lines from one view to the other. the geometric entities etc. are encoded in fa in the same manner as their encoding in f. however often the expressions are far simpler and so can be given explicitly. the epipoles. the epipole in the first view is the right null-vector of fa i.e. fae this determines e d c which is a point on l since all epipolar lines intersect the epipole this shows that all epipolar lines are parallel. epipolar lines. the epipolar line in the second view corresponding to x in the first is fax b cx dy et. again it is evident that all epipolar lines are parallel since the line orientation b is independent of y. these properties and others are summarized in table estimating fa from image point correspondences in two images. given sufficiently many point matches xi the fundamental matrix is defined by the equation for any pair of matching points x i this equation can be used to compute the unknown matrix fa. in particular writing xi yi and i each point match gives rise to one linear equation i i y i by i cxi dyi e ax in the unknown entries b c d e of fa. affine epipolar geometry fa is a rank homogeneous matrix with degrees of freedom. it has the form fa a b c d e are corresponding image points under an affine camera point correspondence if x and then for finite points ax epipolar lines by cx dy e fax b cx dy et is the epipolar line corresponding to x. l fa d ax by et is the epipolar line corresponding to epipoles from fae e d c from fa b a computation from camera matrices pa a general cameras ap ac where c is the centre of the first camera. a is the pseudo-inverse of pa and fa a where p canonical cameras pa a t is the epipole defined by c a d e b table summary of affine fundamental matrix properties. the linear algorithm in the usual manner a solution for fa may be obtained by rewriting as i y i xi yi f with f b c d et. from a set of n point matches we obtain a set of linear equations of the form af where a is a n matrix x y n y n xn yn x f a minimal solution is obtained for n point correspondences as the right nullspace of the matrix a. thus fa can be computed uniquely from only point estimating fa from image point correspondences correspondences provided the points are in general position. the conditions for general position are described in section below. if there are more than correspondences and the data is not exact then the rank of a may be greater than in this case one may find a least-squares solution subject to in essentially the same manner as that of section as the singular vector corresponding to the smallest singular value of a. refer to algorithm for details. this linear solution is the equivalent of the algorithm for the computation of a general fundamental matrix. we do not recommend this approach for estimating fa because the gold standard algorithm described below may be implemented with equal computational ease and in general will have superior performance. the singularity constraint. the form of fa ensures that the matrix has rank no greater than consequently if fa is estimated by the linear method above it is not necessary to subsequently impose a singularity constraint. this is a considerable advantage over the estimation of a general f by the linear algorithm where the estimated matrix is not guaranteed to have rank and thus must be subsequently corrected. geometric interpretation. as has been seen at several points in this book computing a two-view relation from point correspondences is equivalent to fitting a surface in in the case of the equation the relation to points x y x i cxi dyi e is linear in the coordinates and the variety vfa defined ax by the affine fundamental matrix is a hyperplane. i by y this results in two simplifications first finding the best estimate of fa may be formulated as a plane-fitting problem second the sampson error is identical to the geometric error whereas in the case of a general fundamental matrix it is only a first-order approximation. as discussed in section this latter property arises generally with affine relations because the tangent plane of the sampson approximation is equivalent to the surface. the gold standard algorithm given a set of n corresponding image points we seek the maximum likelihood estimate of fa under the assumption that the noise in the image measurements obeys an isotropic homogeneous gaussian distribution. this estimate is obtained by minimizing a cost function on geometric image distances i dxi i min xi i i i are the measured correspondences and xi and where as usual xi i are estimated true correspondences that satisfy tfa xi exactly for the estimated affine fundamental matrix. the distances are illustrated in figure the true correspondences are subsidiary variables that must also be estimated. i as discussed above and in section minimizing the cost function affine epipolar geometry n c d y y d x x epipolar line for x n a b x d x epipolar line for x x x fig. the mle of fa from a set of measured corresponding points the five parameters a b c d e together with a set of correspondences xi tfa xi there is a linear solution to this problem. i i involves estimating i which exactly satisfy y n x d x x fig. in a line is the analogue of the hyperplane defined by fa and the problem of estimating the true correspondence given a measured correspondence is the problem of determining the closest point x y on the line ax by c to a measurement point y. the normal to the line has direction b and the perpendicular distance of the point y from the line is d by c so that x yt yt d n where n b estimated points written as i is equivalent to fitting a hyperplane to set of points xi it satisfy the equation i i xi yit in the i y tfa xi which may be i where f b c d et. this is the equation of a point in on the plane f. we seek the plane f which minimizes the squared distance between the measured and estimated points and consequently which minimizes the sum of squared perpendicular distances to the points xi i xi yit. i xi y geometrically the solution is very simple and an analogue for line fitting in is it illustrated in figure the perpendicular distance of a point xi yi x from the plane f is i y i y d f ax i by i cxi dyi e then the matrix fa which minimizes is determined by minimizing the cost function d f i i by i cxi dyi i c estimating fa from image point correspondences objective given n image point correspondences likelihood estimate fa of the affine fundamental matrix. i i n determine the maximum algorithm a correspondence is represented as xi i y i xi yit. compute the centroid x compute the n matrix a with rows xt i then n b c dt is the singular vector corresponding to the smallest singular i xi and centre the vectors xi xi x. value of a and e ntx. the matrix fa has the form n algorithm the gold standard algorithm for estimating fa from image correspondences. over the parameters b c d e of f. writing n b c dt for the normal to the hyperplane then i c ntxi e this cost function can be minimized by a very simple linear algorithm equivalent to the classical problem of orthogonal regression to a plane. there are two steps the first step is to minimize c over the parameter e. we obtain c e e ntx i e n i i c nt xi and hence so the solution hyperplane passes through the data centroid x. substituting for e in the cost function reduces c to where xi xi x is the vector xi relative to the data centroid x. the second step is to minimize this reduced cost function over n. writing a for the matrix with rows xt i it is evident that c minimizing this expression is equivalent to minimizing subject to which is our usual homogeneous minimization problem solved by the svd. these steps are summarized in algorithm it is worth noting that the gold standard algorithm produces an identical estimate of fa to that obtained by the factorization algorithm for an affine reconstruction from n point correspondences. affine epipolar geometry x x x x x x h a x x fig. computing the affine epipolar line for a minimal configuration of four points. the line is computed by the virtual parallax induced by the plane compare figure objective given four image point correspondences mental matrix. i i compute the affine funda algorithm the first three points xi i define a plane see figure compute the affine transformation matrix ha such that determine the epipolar line in the second view from the epipole then for any point x the epipolar line in the second view is fax. hence i haxi i l l fa l l ha. algorithm the computation of fa for a minimal configuration of four point correspondences. the minimal configuration we return to the minimal configuration for estimating fa namely the corresponding images of four points in in general position. a geometric computation method of fa for this configuration is described in algorithm this minimal solution is useful in the case of robust estimation algorithms such as ransac and will be used here to illustrate degenerate configurations. note that for this minimal configuration an exact solution is obtained for fa and the linear algorithm of section the gold standard algorithm and the minimal algorithm give an identical result. general position. the configuration of four points shown in figure demonstrates the conditions necessary for general position of the points when computing fa. configurations for which fa cannot be computed are degenerate. these fall into two classes first degenerate configurations depending only on the structure for example if the four points are coplanar there is no parallax or if the first three points are collinear that ha can t be computed second those degeneracies which depend triangulation only on the cameras for example if the two cameras have the same viewing direction so have common centres on the plane at infinity. note once again the importance of parallax as the point approaches the plane defined by the other three points in figure the parallax vector which determines the epipolar line direction is monotonically reduced in length. consequently the accuracy of the line direction is correspondingly reduced. this result for the minimal configuration is true also of the gold standard algorithm as relief reduces to zero i.e. the point set approaches coplanarity the covariance of the estimated fa will increase. triangulation suppose we have a measured correspondence y and the affine fundamental matrix fa. we wish to determine the maximum likelihood estimate of the true correspondence x y x under the usual assumption that image measurement error is gaussian. the point may then be determined from the ml estimate correspondence. y y as we have seen earlier the mle involves determining a i.e. x y and also minimizes the image distance to the measured true correspondence which exactly obeys the affine epipolar geometry x y points in chapter x y geometrically the solution is very simple and is illustrated in in figure we seek the closest point on the hyperplane defined by fa to the measured correspondence x yt in again the sampson correction is exact in this x case. algebraically the normal to the hyperplane has direction n b c dt and the perpendicular distance of a point x to the hyperplane is given by d so that y n x d by cx dy e or in its full detail x y x y x y x y a b c d affine reconstruction suppose we have n image point correspondences xi i n which for the moment will be assumed noise-free then we may compute a reconstruction of the points and cameras. in the case of projective cameras n points the reconstruction was projective. in the affine case not surprisingly the reconstruction is affine. we will now give a simple constructive derivation of this result. an affine coordinate frame in may be specified by four finite non-coplanar basis points xi i as illustrated in figure one point is chosen as the affine epipolar geometry x e x x x a x y x z b fig. affine coordinates. four non-coplanar points in and origin define a set of axes in terms of which other points x can be assigned affine coordinates y z. each affine coordinate is defined by a ratio of lengths in parallel directions is an affine invariant. for example x may be computed by the following two operations first x is projected parallel onto the plane spanned second this projected point is projected parallel onto the axis. the value of the coordinate x is the ratio of the length from the origin of this final projected point to the length x e x e x image e x x x x x e x x image fig. reconstruction from two images. the affine coordinates of the point x with image x in two views may be computed linearly from the projection of the basis points xi and basis vectors ei of figure origin and the three other points then define basis vectors i where is the inhomogeneous corresponding to xi. the position of a point and y z are the affine coordinates of with respect to this basis. this means that x may then be specified by simple vector addition as the basis points xi have the canonical coordinates y zt given the affine projection of the four basis points in two views the affine coordinates of any other point can be directly recovered from its image as will now be demonstrated figure necker reversal and the bas-relief ambiguity projection with an affine camera may be represented as t x where x yt is the inhomogeneous corresponding to x. differences of vectors eliminate t. for example the basis vectors project as ei consequently for any point x its image in the first view is x x y z t x in the second view is y and similarly the image z i each equation and imposes two linear constraints on the unknown affine coordinates x y z of the space point x. all the other terms in the equations are known from the projection of the four basis points i thus there are four linfrom image measurements example the image basis vectors ei i are computed ear simultaneous equations in the three unknowns x y z and the solution is straightforward. this demonstrates that the affine coordinates of a point x may be computed from its image in two views. between the points with coordinates given in and their measured images. for example pa is computed from the correspondence xi i the cameras for the two views pa a may be computed from the correspondences the above development is not optimal because the basis points are treated as exact and all measurement error associated with the fifth point x. an optimal reconstruction algorithm where reprojection error is minimized over all points is very straightforward in the affine case. however its description is postponed until section because the factorization algorithm described there is applicable to any number of views. example affine reconstruction a reconstruction is computed for the hole punch images of figure by choosing four points as the affine basis and then computing the affine coordinates of each of the remaining points in turn by the linear method above. two views of the resulting reconstruction are shown in figure note however that this five-point method is not recommended. instead the optimal affine reconstruction algorithm should be used. necker reversal and the bas-relief ambiguity we have seen in the previous section that in the absence of any calibration information an affine reconstruction is obtained from point correspondences alone. in this section we show that even if the camera calibration is known there remains a family of reconstruction ambiguities which cannot be resolved in the two-view case. this situation differs from that of perspective projection where once the internal calibration is determined the camera motion is determined up to a finite number of affine epipolar geometry a b c fig. affine reconstruction. wireframe outline of the hole punch from the two images of figure the circles show the points selected as the affine basis. the lines are for visualization only. two views of the affine structure computed from the vertices of the wireframe. ambiguities the essential matrix see section for parallel projection there are two important additional ambiguities a finite reflection ambiguity reversal and a one-parameter family rotation ambiguity bas-relief ambiguity. necker reversal ambiguity. this arises because an object rotating by and its mirror image rotating by generate the same image under parallel projection see figure thus structure is only recovered up to a reflection about the frontal plane. this ambiguity is absent in the perspective case because the points have different depths in the two interpretations and so do not project to coincident image points. this is illustrated in figure the bas-relief ambiguity. imagine a set of parallel rays from one camera and consider adjusting a set of parallel rays from a second camera until each ray intersects its corresponding ray. the rays lie in a family of parallel epipolar planes and there remains the freedom to rotate one camera about the normal to these planes whilst maintaining incidence of the rays. this bas-relief depth turn ambiguity is a one-parameter family of solutions for the rotation angle and depth. the parameters of depth z and rotation sin are confounded and cannot be determined individually only their product can be computed. consequently a shallow object experiencing a large turn small z and large generates the same image as a deep object experiencing a small turn large z and small the name arises from bas-relief sculptures. fixing the depth or the angle determines the structure and the motion uniquely. extra points cannot resolve this ambiguity but an additional view three views will in general resolve it. computing the motion z z frontal plane parallel z b x x perspective a l l a a x x x c fig. motion ambiguities under parallel projection. necker reversal a rotating object generates the same image as its mirror object rotating in the opposite sense. under perspective projection the images are different. the cameras can rotate and still preserve ray intersections. this cannot happen for perspective cameras. the bas-relief ambiguity consider a rod of length l which x l sin this bas relief depth turn ambiguity is sorotates through an angle that is x named because a shallow object experiencing a large turn small l and big generates the same image as a deep object experiencing a small turn large l and small this ambiguity casts light on the stability of reconstruction from two perspective cameras as imaging conditions approach affine the rotation angle will be poorly estimated but the product of the rotation angle and depth will be stable. computing the motion in this section expressions for computing the camera motion from fa will be given for the case of two weak perspective cameras these cameras may be chosen as x y x p y where and are the first and second rows of the rotation matrix r between the views. we will assume that the aspect ratio y x is known in both cameras but that the relative scaling s x x is unknown. s for a looming object and s for one that is receding as has been seen the complete rotation r cannot be computed from two weak perspective views resulting in the bas-relief ambiguity. nevertheless affine epipolar geometry y y z z image a x image x b fig. the rotation representation. rotation by about the z-axis subsequent rotation by about a fronto parallel axis angled at to the x-axis. the has components sin axis l x i l l a i l axis x i l l l b l i fig. the camera rotates about the axis which is parallel to the image plane. the intersection of the epipolar plane with the image planes gives epipolar lines l and and the projections of in the images are orthogonal to these epipolar lines no cyclotorsion occurs the camera counter-rotates by in so the orientation of the epipolar lines changes by the remaining motion parameters can be computed from fa and their computation is straightforward. to represent the motion we will use a rotation representation introduced by koenderink and van doorn as will be seen this has the advantage that it isolates the parameter of the bas-relief ambiguity which cannot be computed from the affine epipolar geometry. in this representation the rotation r between the views is decomposed into two rotations figure r r r first there is a cyclo-rotation r in the image plane through an angle about the line of sight. this is followed by a rotation r through an angle about an axis with direction parallel to the image plane and angled at to the positive x-axis i.e. a pure rotation out of the image plane. computing the motion parallel epipolar planes axis b a fig. the scene can be sliced into parallel epipolar planes. the magnitude of has no effect on the epipolar geometry so it is indeterminate from two views. a b c d fig. the effect of scale and rotation angles on the epipolar lines for an object moving relative to a stationary camera. this also illustrates the assumed sequence of events accounting for the transition from to cyclotorsion rotation out of the plane and scaling giving solving for s and it is now shown that the scale factor the projection of the axis of rotation and the cyclo-rotation angle may be computed directly from the affine epipolar geometry. the solution is preceded by a geometric explanation of how the epipolar lines relate to the unknown motion parameters. consequently consider a camera rotating about an axis lying parallel to the image plane the epipolar plane is perpendicular to both this axis and the two images and intersects the images in the epipolar lines l and the projection of the axis of rotation is perpendicular to the epipolar lines. this relation still holds if there is additionally a cyclotorsion in the image plane the axis and intersection remain fixed in space and are simply observed at a new angle in the image maintaining the orthogonality between the epipolar lines and the projected axis. the orientations of the epipolar lines in the two images therefore differ by importantly changing the magnitude of the turn angle doesn t alter the epipolar geometry in any way this angle is therefore indeterminate from two views a consequence of the bas-relief ambiguity. affine epipolar geometry a b fig. computing motion from affine epipolar geometry. two views of a buggy rotating on a turntable. the computed rotation axis is superimposed on the image drawn to pass through the image centre. the ground truth axis is of course perpendicular to the turntable in the world. figure illustrates the effect of scale. consider a object to be sliced into parallel epipolar planes with each plane constraining how a particular slice of the object moves. altering the effective size of the object by moving closer to it simply changes the relative spacing between successive epipolar planes. in summary cyclotorsion simply rotates the epipolar lines rotation out of the plane causes foreshortening along the epipolar lines to and a scale change uniformly alters the epipolar line spacing it can be shown is left as exercise that s and can be computed directly from the affine epipolar geometry as tan b a d c and tan with s definition. note that is the angle of projection in of the axis of rotation out of the plane while is its angle of projection in example motion computed from the affine fundamental matrix figure shows two images of a buggy rotating on a turntable. the image is pixels with an aspect ratio of the affine fundamental matrix is computed using algorithm and the motion parameters computed from fa using above. the computed rotation axis is superimposed on the image. closure the literature koenderink and van doorn set the scene for affine reconstruction from two affine cameras. this paper should be read by all. the affine fundamental matrix was first defined in the computation of the motion parameters from fa is described in shapiro et al. and in particular the cases where a third view does not resolve the bas relief ambiguity. a helpful eigenvector analysis of the ambiguity is given in the three view affine motion case is treated quite elegantly in notes and exercises closure a scene plane induces an affine transformation between two affine cameras. there is a three-parameter family of such affinities defined by the threeparameter family of planes in given fa this family of affinities may be written as ha and the v parametrizes the family of planes. conversely show that given ha the homography induced by a scene plane then fa is determined up to a one-parameter ambiguity. fa where fa consider a perspective camera i.e. the matrix does not have the affine form. show that if the camera motion consists of a translation parallel to the image plane and a rotation about the principal axis then f has the affine form. this shows that a fundamental matrix with affine form does not imply that the imaging conditions are affine. are there other camera motions which generate a fundamental matrix with the affine form? two affine cameras pa a uniquely define an affine fundamental matrix fa by show that if the cameras are transformed on the right by a common affine transformation i.e. pa paha aha the transformed cameras define the original fa. this shows that the affine fundamental matrix is invariant to an affine transformation of the world coordinates. a suppose one of the cameras is affine and the other is a perspective camera. the permutation homography show that in general in this case the epipoles in both views are finite. h maps the canonical matrix of a finite projective camera p into the canonical matrix of parallel projection pa pa h show by applying this transformation to a pair of finite projective camera matrices that the results of this chapter as the properties listed in table can be generated directly from their non-affine counterparts of the previous chapters. in particular derive an expression for a pair of affine cameras pa a consistent with fa. part iii three-view geometry lord shiva c. shiva is depicted as having three eyes. the third eye in the centre of the forehead symbolizes spiritual knowledge and power. image courtesy of httpwww.healthyplanetonline.com outline this part contains two chapters on the geometry of three-views. the scene is imaged with three cameras perhaps simultaneously in a trinocular rig or sequentially from a moving camera. chapter introduces a new multiple view object the trifocal tensor. this has analogous properties to the fundamental matrix of two-view geometry it is independent of scene structure depending only on the relations between the cameras. the camera matrices may be retrieved from the trifocal tensor up to a common projective transformation of and the fundamental matrices for view-pairs may be retrieved uniquely. the new geometry compared with the two-view case is the ability to transfer from two views to a third given a point correspondence over two views the position of the point in the third view is determined and similarly given a line correspondence over two views the position of the line in the third view is determined. this transfer property is of great benefit when establishing correspondences over multiple views. if the essence of the epipolar constraint over two views is that rays back-projected from corresponding points are coplanar then the essence of the trifocal constraint over three views is the geometry of a point line line correspondence arising from the image of a point on a line in corresponding image lines in two views back-project to planes which intersect in a line in and the ray back-projected from a corresponding image point in a third view must intersect this line. chapter describes the computation of the trifocal tensor from point and line correspondences over three-views. given the tensor and thus the retrieved camera matrices a projective reconstruction may be computed from correspondences over multiple views. the reconstruction may be upgraded to similarity or metric as additional information is provided in the same manner as in the two view case. it is in reconstruction that there is another gain over two-view geometry. given the cameras in the two-view case each point correspondence provided four measurements on the three degrees of freedom position of the point in in three views there are six measurements on again three degrees of freedom. however it is for lines that there is the more significant gain. in two-views the number of measurements equals the number of degrees of freedom of the line in namely four. consequently there is no possibility of removing the effects of measurement errors. however in three views there are six measurements on four degrees of freedom so a scene line is over-determined and can be estimated by a suitable minimization over measurement errors. the trifocal tensor the trifocal tensor plays an analogous role in three views to that played by the fundamental matrix in two. it encapsulates all the geometric relations between three views that are independent of scene structure. we begin this chapter with a simple introduction to the main geometric and algebraic properties of the trifocal tensor. a formal development of the trifocal tensor and its properties involves the use of tensor notation. to start however it is convenient to use standard vector and matrix notation thus obtaining some geometric insight into the trifocal tensor without the additional burden of dealing with a unfamiliar notation. the use of tensor notation will therefore be deferred until section the three principal geometric properties of the tensor are introduced in section these are the homography between two of the views induced by a plane back-projected from a line in the other view the relations between image correspondences for points and lines which arise from incidence relations in and the retrieval of the fundamental and camera matrices from the tensor. the tensor may be used to transfer points from a correspondence in two views to the corresponding point in a third view. the tensor also applies to lines and the image of a line in one view may be computed from its corresponding images in two other views. transfer is described in section the tensor only depends on the motion between views and the internal parameters of the cameras and is defined uniquely by the camera matrices of the views. however it can be computed from image correspondences alone without requiring knowledge of the motion or calibration. this computation is described in chapter the geometric basis for the trifocal tensor there are several ways that the trifocal tensor may be approached but in this section the starting point is taken to be the incidence relationship of three corresponding lines. incidence relations for lines. suppose a line in is imaged in three views as in figure what constraints are there on the corresponding image lines? the planes back-projected from the lines in each view must all meet in a single line in space the line that projects to the matched lines in the three images. since in general three arbitrary planes in space do not meet in a single line this geometric incidence condition the trifocal tensor l l c l c l c fig. a line l in is imaged as the corresponding triplet l by their centres c first second and third images all intersect in a single line in space. in three views indicated and image planes. conversely corresponding lines back-projected from the i provides a genuine constraint on sets of corresponding lines. we will now translate this geometric constraint into an algebraic constraint on the three lines. we denote a set of corresponding lines as li i let the camera matrices for the three views be p as usual and where a and b are matrices and the vectors ai and bi are the i-th columns of the respective camera matrices for i and are the epipoles in views two and three respectively arising from the first camera. these epipoles will be denoted by throughout this chapter with where c is the first camera centre. the most part we will not be concerned with the epipoles between the second and third views. a and b are the infinite homographies from the first to the second and third cameras respectively. and as has been seen in chapter any set of three cameras is equivalent to a set with p under projective transformations of space. in this chapter we will be concerned with properties as image coordinates and incidence relations that are invariant under projective transforms so we are free to choose the cameras in this form. now each image line back-projects to a plane as shown in figure from result these three planes are l ptl at bt since the three image lines are derived from a single line in space it follows that these three planes are not independent but must meet in this common line in this intersection constraint can be expressed algebraically by the requirement that the matrix m has rank this may be seen as follows. points on the line of intersection may be represented as x with and linearly independent. such points lie on all three planes and so tx it follows that mtx consequently m has a null-space since and the geometric basis for the trifocal tensor this intersection constraint induces a relation amongst the image lines l the rank of m is there is a linear dependence between its columns mi. denoting since l bt at m the linear relation may be written then noting that the bottom left hand element of m is zero it follows that kbt for some scalar k. applying this to the top of each column shows that to a homogeneous scale factor and kat l the i-th coordinate li of l may therefore be written as i i li and introducing the notation i ti aibt i the incidence relation can be written definition the set of three matrices constitute the trifocal tensor in matrix notation. li we introduce a further denoting the ensemble of the three matrices ti by or more briefly this last relation may be written as lt i and i and is understood to represent the vector where of course there is no intrinsic difference between the three views and so by analogy with there will exist similar relations the three tensors i exist but are distinct. in fact although all three tensors may be computed from any one of them there is no very simple relationship between them. thus in fact there are three trifocal tensors existing for a given triple of views. usually one will be content to consider only one of them. however a method of computing the other trifocal tensors i given is outlined in exercise on page note that is a relationship between image coordinates only not involving coordinates. hence remarked previously although it was derived under the assumption of a canonical camera set is p the value of the matrix elements is independent of the form of the cameras. the particular simple formula for the trifocal tensor given the camera matrices holds only in the case where i and this notation is somewhat cumbersome and its meaning is not quite self-evident. it is for this reason that tensor notation is introduced in section the trifocal tensor c image l c x image x c x image fig. point transfer. a line x in the first image defines a ray in which intersects imaged as the point third views defined by its back-projected plane in the third view. thus any line in the second view back-projects to a plane in a point in the point x. this point x is then induces a homography between the first and p but a general formula for the trifocal tensor corresponding to any three cameras will be derived later. degrees of freedom. the trifocal tensor consists of three matrices and thus has elements. there are therefore independent ratios apart from the overall scaling of the matrices. however the tensor has only independent degrees of freedom. in other words once parameters are specified all elements of the tensor are determined up to a common scale. the number of degrees of freedom may be computed as follows. each of camera matrices has degrees of freedom which makes in total. however degrees of freedom must be subtracted to account for the projective world frame thus leaving degrees of freedom. the tensor therefore satisfies independent algebraic constraints. we return to this point in chapter homographies induced by a plane a fundamental geometric property encoded in the trifocal tensor is the homography between the first view and the third induced by a line in the second image. this is illustrated in figure and figure a line in the second view defines backprojection a plane in and this plane induces a homography between the first and third views. we now derive the algebraic representation of this geometry in terms of the trifocal tensor. the homography map between the first and third images defined by the plane hx and l in figure and figure may be written as respectively. notice that the three lines l in figure are a corresponding line triple the projections of the line l. therefore they satisfy the line incidence relationship li shows that of comparison of this formula and l and h with hi tt i the geometric basis for the trifocal tensor c image l l l c image c l image fig. line transfer. the action on lines of the homography defined by figure may similarly be visualized geometrically. a line l in the first image defines a plane in which intersects in the line l. this line l is then imaged as the line in the third view. thus h defined by the above formula represents the homography between views one and three specified by the line in view two. the second and third views play similar roles and the homography between the first and second views defined by a line in the third can be derived in a similar manner. these ideas are formalized in the following result. result the homography from the first to the third image induced by a line the second image figure is given by tt tt x where in similarly a line first to the second views given by in the third image defines a homography x from the once this mapping is understood the algebraic properties of the tensor are straightforward and can easily be generated. in the following section we deduce a number of incidence relations between points and lines based on and result point and line incidence relations it is easy to deduce various linear relationships between lines and points in three images involving the trifocal tensor. we have seen one such relationship already namely this relation holds only up to scale since it involves homogeneous quantities. we may eliminate the scale factor by taking the vector cross product of both sides which must be zero. this leads to the formula where we have used the matrix to denote the cross product or more briefly swapping the note the symmetry between and the trifocal tensor roles of these two lines is accounted for by transposing each ti resulting in a relation i now a point x on the line l must satisfy i xili upper indices for the point coordinates foreshadowing the consider again figure xtl use of tensor notation. since li this may be written as i and i xiti is simply a matrix. this is an incidence relation in the that first image the relationship will hold for a point line line correspondence that is whenever some line l maps to in the second and third images and to a line passing through x in the first image. an important equivalent definition of a point line line correspondence for which holds results from an incidence relation in there exists a point x mapping to x in the first image and to points on the lines in the second and third images as shown in figure in the second and third images. consider a point line point correspondence as in figure so that from result we may obtain relations involving points which is valid for any line in the second image. the homogeneous scale factor may be eliminated by the transpose of both sides by x passing through i xitt and to give and x tt tt i i a similar analysis may be undertaken with the roles of the second and third images swapped. finally for a correspondence as shown in figure there is a relation i i and so is independent of in passes through the line for some point through on and so may be written from however the relation is the relation then consequently proof. as i true for all lines follows. the various relationships between lines and points in three views are summarized in table and their properties are investigated further in section once tensor notation has been introduced. note that there are no relations listed for point line line correspondence in which the point is in the second or third view. such simple relations do not exist in terms of the trifocal tensor in which the first view is the special view. it is also worth noting that satisfying an image incidence relation does not guarantee incidence in as illustrated in figure the geometric basis for the trifocal tensor x x x c c c l x x x l x l c point line line l x c point line point l x x x c point point point c c c are any two lines through and consider a point correspondence x if fig. incidence relations. and forms a point line line correspondence corresponding to a line l. consequently holds for any choice of lines through the space point x is incident with the space line l. this defines an incidence relation x arising from the image of a space point x. between their images. the correspondence x respectively then x and through we now begin to extract the two-view geometry the epipoles and fundamental ma trix from the trifocal tensor. epipolar lines a special case of a point line line correspondence occurs when the plane projected from backis an epipolar plane with respect to the first two cameras and hence the trifocal tensor line line line correspondence point line line correspondence point line point correspondence lt or for a correspondence x i i i for a correspondence x point point line correspondence point point point correspondence for a correspondence x i table summary of trifocal tensor incidence relations using matrix notation. l x x c l c x c fig. non-incident configuration. the imaged points and lines of this configuration satisfy the point line point incidence relation of table however the space point x and line l are not incident. compare with figure back-projected from a line then the ray defined by x and c lies in this plane and passes through the camera centre c of the first camera. suppose x is a point on the plane is the epipolar line corresponding to the point x the image of x. this is shown in figure the plane in the third image will intersect the plane in a line l. further since the ray corresponding to x lies entirely in the plane it must intersect the line l. this gives a intersection between the ray and planes and back-projected from point x and lines and so they constitute a point line line correspondence satisfying i the important point now is that this is and it follows that true for any line i xiti t. the same argument holds with the roles of and reversed. to summarize the geometric basis for the trifocal tensor x x c l c e l c fig. if the plane third view gives a point line line incidence. defined by is an epipolar plane for the first two views then any line in the are the corresponding epipolar lines in the result if x is a point and second and third images then and xiti and i consequently the epipolar lines left and right null-vectors of the matrix and i corresponding to x may be computed as the i xiti. as the point x varies the corresponding epipolar lines vary but all epipolar lines in one image pass through the epipole. thus one may compute this epipole by computing the intersection of the epipolar lines for varying values of x. three convenient choices of x are the points represented by homogeneous coordinates and with i xiti equal to and respectively for these three choices of x. from this we deduce the following important result result the epipole in the second image is the common intersection of the epipolar lines represented by the left null-vectors of the matrices ti i similarly the epipole is the common intersection of lines represented by the right null-vectors of the ti. note that the epipoles involved here are the epipoles in the second and third images corresponding to the first image centre c. the usefulness of this result may not be apparent at present. however it will be seen below that it is an important step in computing the camera matrices from the trifocal tensor and in chapter in the accurate computation of the trifocal tensor. algebraic properties of the ti matrices. this section has established a number of algebraic properties of the ti matrices. we summarize these here each matrix ti has rank this is evident from since ti sum of two outer products. the right null-vector of ti is for the point x or as i or respectively. i is the i bi and is the epipolar line in the third view the trifocal tensor i for i is the common intersection of the epipolar lines is the common intersection of the epipolar lines i ai and is the epipolar line in the second view the epipole the left null-vector of ti is for the point x or as i or respectively. the epipole i for i the sum of the matrices mx of mx is the epipolar line epipolar line it s worth emphasizing again that although a particular canonical form of the camera is used in the derivation the epipolar properties of the ti matrices i xiti also has rank the right null-vector of x in the third view and its left null-vector is the of x in the second view. matrices p are independent of this choice. and extracting the fundamental matrices it is simple to compute the fundamental matrices and between the and the other views from the trifocal tensor. it was seen in section that the epipolar line corresponding to some point can be derived by transferring the point to the other view via a homography and joining the transferred point to the epipole. consider a point x in the first view. according to figure and result a line in the third view induces a homography from the first to the second view given by x. the epipolar line corresponding to x is then found by joining to the epipole this gives x from which it follows that this formula holds for any vector generate condition where since as has been seen the formula but it is important to choose to avoid the delies in the null-space of any of the ti. a good choice is is perpendicular to the right null-space of each ti. this gives a similar formula holds for tt tt retrieving the camera matrices it was remarked that the trifocal tensor since it expresses a relationship between image entities only is independent of projective transformations. conversely this implies that the camera matrices may be computed from the trifocal tensor only up to a projective ambiguity. it will now be shown how this may be done. just as in the case of reconstruction from two views because of the projective ambiguity the first camera may be chosen as p now since is known we can make use of result to derive the form of the second camera as and the camera pair then has the fundamental matrix it might be thought the fundamental matrix satisfies for corresponding points x the subscript notation refers to figure the geometric basis for the trifocal tensor given the trifocal tensor written in matrix notation as retrieve the epipoles let ui and vi be the left and right null-vectors respectively of ti i.e. ut i ti tivi then the epipoles are obtained as the null-vectors to the following matrices and retrieve the fundamental matrices and p tt tt retrieve the camera matrices normalize the epipoles to unit norm. then and itt tt tt algorithm summary of f and p retrieval from the trifocal tensor. note and are determined uniquely. however are determined only up to a common projective transformation of and tt tt is inconsistent. that the third camera could be chosen in a similar manner as but this is incorrect. this is because the two camera pairs and do not necessarily define the same projective world frame although each pair is correct by itself the triple the third camera cannot be chosen independently of the projective frame of the first two. to see this suppose the camera pair is chosen and points xi reconstructed from their image correspondences xi i. then the coordinates of xi are specified in the projective world frame defined by by and a consistent camera may be computed from the correspondences xi depends on the frame defined by however it is not necessary to explicitly reconstruct structure a consistent camera triplet can be recovered from the trifocal tensor directly. the pair of camera matrices p and are not the only ones compatible with the given fundamental matrix according to the most general form for i clearly is for some vector v and scalar a similar choice holds for matrices compatible with the trifocal tensor we need to find the correct values of to find a triple of camera and from these families so as to be compatible with the form of the trifocal tensor. because of the projective ambiguity we are free to choose is now defined and this choice fixes the projective world frame so that thus ai uniquely to scale. then substituting into that from which it follows that ti i i. since the scale may be chosen such i that the trifocal tensor we may multiply on the left by and transpose to get itt so the camera matrices from the trifocal tensor is given in algorithm tt tt a summary of the steps involved in extracting bi itt i we have seen that the trifocal tensor may be computed from the three camera matrices and that conversely the three camera matrices may be computed up to projective equivalence from the trifocal tensor. thus the trifocal tensor completely captures the three cameras up to projective equivalence. the trifocal tensor and tensor notation the style of notation that has been used up to now for the trifocal tensor is derived from the standard matrix vector notation. since a matrix has two indices only it is possible to distinguish between the two indices using the devices of matrix transposition and right or left multiplication and in dealing with matrices and vectors one can do without writing the indices explicitly. because the trifocal tensor has three indices instead of the two indices that a matrix has it becomes increasingly cumbersome to persevere with this style of matrix notation and we now turn to using standard tensor notation when dealing with the trifocal tensor. for those unfamiliar with tensor notation a gentle introduction is given in appendix this appendix should be read before proceeding with this chapter. image points and lines are represented by homogeneous column and row respectively i.e. x and l the ij-th entry of a matrix a is denoted by ai j index i being the contravariant index and j being the covariant index. we observe the convention that indices repeated in the contravariant and covariant positions imply summation over the range of the index. for example the equation jxj which may be written ai x we begin with the definition of the trifocal tensor given in using tensor ax is equivalent to x jxj. j ai notation this becomes t jk i aj i bk aj i the positions of the indices in t jk contravariant and one covariant are dictated by the positions of the indices on the right side of the equation. thus the trifocal tensor is a mixed contravariant covariant tensor. in tensor notation the basic incidence relation becomes i li l jl k i t jk note that when multiplying tensors the order of the entries does not matter in contrast with standard matrix notation. for instance the right side of the above expression is l jl k t jk i l jl k t jk i l j t jk i l k l j t jk i l k jk jk the trifocal tensor and tensor notation definition. the trifocal tensor t is a valency tensor t jk i with two contravariant and one covariant indices. it is represented by a homogeneous array elements. it has degrees of freedom. computation from camera matrices. p if the canonical camera matrices are j j then t jk i a a j i bk j i see for computation from three general camera matrices. line transfer from corresponding lines in the second and third views to the first. transfer by a homography. li l jl kt jk i point transfer from first to third view via a plane in the second the contraction l induced by a plane defined by the back-projection of the line is a homography mapping between the first and third views in the second view. i jt jk kt jk i hk i xi where hk i l x j t jk i point transfer from first to second view via a plane in the third the contraction l induced by a plane defined by the back-projection of the line is a homography mapping between the first and second views in the third view. h x j j i xi where h i l k t jk i table definition and transfer properties of the trifocal tensor. the homography maps of figure and figure may be deduced from the incidence relation in the case of the plane defined by back-projecting the line jl k t jk i l kl j t jk i li l l k hk i where hk i l j t jk i i are the elements of the homography matrix h. this homography maps points and hk between the first and third view as hk i xi. x note that the homography is obtained from the tensor by contraction with a line a summation over one contravariant index of the tensor and the covariant extracts a matrix from the tensor think of the trifocal index of the line i.e. tensor as an operator which takes a line and produces a homography matrix. table summarizes the definition and transfer properties of the trifocal tensor. a pair of particularly important tensors are and its contravariant counterpart defined in section this tensor is used to represent the vector product. for the trifocal tensor line line line correspondence point line line correspondence jl kt jk i jl kt jk i xil point line point correspondence xil point point line correspondence jx jq i xix k t pk i point point point correspondence pq xix i table summary of trifocal tensor incidence relations the trilinearities. instance the line joining two points xi and yj is equal to the cross product xiyjijk lk and the skew-symmetric matrix is written as xiirs in tensor notation. it is now relatively straightforward to write down the basic incidence results involving the trifocal tensor given in table the results are summarized in table in this table a notation such as represents an array of zeros. the form of the relations in table is more easily understood if one observes that three indices i j and k in t jk correspond to entities in the first second and third views respectively. thus for instance a partial expression such as l cannot occur because the index j belongs to the second view and hence does not belong on the line in the third view. repeated indices summation must occur once as a contravariant index and once as a covariant index. thus we cannot write x since the index j occurs twice in the upper position. think of the tensor as being used to raise or lower indices for instance by replacing j by xiijk. however this may not be done arbitrarily as pointed out in exercise on page jk t jk j i i i the trilinearities the incidence relations in table are trilinear relations or trilinearities in the coordinates of the image elements and lines. tri- since every monomial in the relation involves a coordinate from each of the three image elements involved and linear because the relations are linear in each of the algebraic entities the three arguments of the tensor. for example in the point point point relation i suppose both and satisfy the relation then so xix does x i.e. the relation is linear in its first argument. similarly the relation is linear in the second and third argument. this multi-linearity is a standard t jk property of tensors and follows directly from the form xil i which is a conjl k traction of the tensor over all three of its indices pq we will now describe the point point point trilinearities in more detail. there are transfer nine of these trilinearities arising from the three choices of r and s. geometrically these trilinearities arise from special choices of the lines in the second and third image for the point line line relation figure choosing r or corresponds to a line parallel to the image x-axis parallel to the image y-axis or through the image coordinate origin point respectively. for example choosing r and expanding x results in p x l x which is a horizontal line in the second view through third view results in the vertical line through satisfy x x l q x x x points of the form for any similarly choosing s in the and the trilinear point relation expands to pq x xi x xix t i i t i t i x t i of these nine trilinearities four are linearly independent. this means that from a basis of four trilinearities all nine can be generated by linear combinations. the four degrees of freedom may be traced back to those of the point-line-line relation t jk i and are counted as follows. there is a one-parameter family of lines xil through are two members of this family then any other line through can be obtained from a linear combination of these in the third view. if and jl k the incidence relation is linear in l jm k l jn k so that given t jk i xi t jk i xi then the incidence relation for any other line can be generated by a linear combination of these two. consequently there are only two linearly independent incidence relations for and the incidence relation is also linear in lines thus there are a total of four linearly independent incidence relations between a point in the first view and lines in the second and third. similarly there is a one-parameter family of lines through through the main virtue of the trilinearities is that they are linear otherwise their properties are often subsumed by transfer as described in the following section. transfer given three views of a scene and a pair of matched points in two views one may wish to determine the position of the point in the third view. given sufficient information about the placement of the cameras it is usually possible to determine the location of image x epipolar line from image the trifocal tensor image image a x f epipolar line from image f x f x x e b e image fig. epipolar transfer. the image of x in the first two views is the correspondence x the image of x in the third view may be computed by intersecting the epipolar lines and the configuration of the epipoles and transferred point as seen in the third image. point is computed as the intersection of epipolar lines passing through the two epipoles and however if lies on the line through the two epipoles then its position cannot be determined. points close to the line through the epipoles will be estimated with poor precision. the point in the third view without reference to image content. this is the point transfer problem. a similar transfer problem arises for lines. in principle the problem can generally be solved given the cameras for the three views. rays back-projected from corresponding points in the first and second view intersect and thus determine the point. the position of the corresponding point in the third view is computed by projecting this point onto the image. similarly lines back-projected from the first and second image intersect in the line and the projection of this line in to the third image determines its image position. point transfer using fundamental matrices the transfer problem may be solved using knowledge of the fundamental matrices only. thus suppose we know the three fundamental matrices and relating the three views and let points x and in the first two views be a matched pair. we wish to find the corresponding point in the third image. matches point x in the first image and consequently must lie on the epipolar line corresponding to x. since we know this epipolar line may be computed and is equal to by a similar argument must lie on the epipolar line taking the intersection of the epipolar lines gives the required point see figure note that the fundamental matrix is not used in this expression. the question naturally arises whether we can gain anything by knowledge of and the answer is yes. in the presence of noise the points x will not form an exact matched pair meaning that they will not satisfy the equation exactly. given one may use optimal triangulation as in algorithm to correct x and resulting in a pair x that satisfies this relation. the transferred point may then be computed as this method of point transfer using the fundamental matrices will be called epipolar transfer. x transfer image c e c image image c fig. the trifocal plane is defined by the three camera centres. the notation for the epipoles is eij picj. epipolar transfer fails for any point x on the trifocal plane. if the three camera centres are collinear then there is a one-parameter family of planes containing the three centres. though at one time used for point transfer epipolar transfer has a serious deficiency that rules it out as a practical method. this deficiency is due to the degeneracy that can be seen from figure epipolar transfer fails when the two epipolar lines in the third image are coincident becomes increasingly ill-conditioned as the lines become less transverse the degeneracy condition that and are collinear in the third image means that the camera centres c and and the point x lie in a plane through the centre of the third camera thus x lies on the trifocal plane defined by the three camera centres see figure epipolar transfer will fail for points x lying on the trifocal plane and will be inaccurate for points lying near that plane. note in the special case that the three camera centres are collinear the trifocal plane is not uniquely defined and epipolar transfer fails for all points. in this case point transfer using the trifocal tensor the degeneracy of epipolar transfer is avoided by use of the trifocal tensor. consider a correspondence x is chosen in the second view then the corresponding point may be computed by transferring the point x xil from the first to the third view using x from table it is clear from figure that this transfer is not degenerate for general points x lying on the trifocal plane. passing through the point if a line t jk j i however note from result and figure that if t jk i so the point is the epipolar line sponding to x then xil is undefined. consequently the choice of line j is important. to avoid choosing only an epipolar line one possibility for the is to use two or three different lines passing through three choices of p for each such line one computes the value of and retains the one that has the largest norm is furthest from being zero. an alternative method entirely for finding is as the least-squares solution of the system of linear equations xix i but this method is probably an overkill. the method we recommend is the following. before attempting to compute the point transferred from a pair of points x first correct the pair of points using the fundamental matrix as described above in the case of epipolar transfer. if x and pq jp x namely l the trifocal tensor e c l image b c x x image e c x image fig. degeneracy for point transfer using the trifocal tensor. the point x is defined by the intersection of the ray through x with the plane a point x on the baseline between the first and second views cannot be defined in this manner. so a point on the line cannot be transferred to the third view via a homography defined by a line in the second view. note that a point on the line projects to in the first image and in the second image. apart from the line any point can be transferred. in particular there is not a degeneracy problem for points on the baseline between views two and three or for any other point on the trifocal plane. xil j t jk chosen passing through does not depend on the are an exact match then the transferred point x line long as it is not the epipolar line. this may be verified geometrically by referring to figure a good choice is always given by the line perpendicular to x. to summarize a measured correspondence x steps is transferred by the following i compute from the trifocal tensor the method given in algorithm using algorithm to the exact correspondence x and correct x compute the line e and the transferred point is x through then xil j and perpendicular to t jk e x. i if degenerate configurations. consider transfer to the third view via a plane as shown in figure the point x is only undefined if it lies on the baseline joining the first and second camera centres. this is because rays through x and are collinear for such points and so their intersection is not defined. in such a case the points x and correspond with the epipoles in the two images. however there is no problem transferring a point lying on the baseline between views two and three or anywhere else on the trifocal plane. this is the key difference between epipolar transfer and transfer using the trifocal tensor. the former is undefined for any point on the trifocal plane. line transfer using the trifocal tensor using the trifocal tensor it is possible to transfer lines from a pair of images to a third t jk according to the line-transfer equation li l i of table this gives an explicit jl k the fundamental matrices for three views are known in the first and second views then formula for the line in the first view given lines in the other two views. note however that if the lines l and may be computed t jk by solving the set of linear equations i thereby transferring it into the third image. similarly one may transfer lines into the second image. line transfer is not possible using only the fundamental matrices. jl k degeneracies. consider the geometry of figure the line l in is defined by the intersection of the planes through l and namely and respectively. this line is clearly undefined when the planes and are coincident i.e. in the case of epipolar planes. consequently lines cannot be transferred between the first and third image if both l and are corresponding epipolar lines for the first and second views. t jk i and the equation algebraically the line-transfer equation gives li l t jk used to solve for becomes zero. it is quite common for lines to matrix j be near epipolar and their transfer is then inaccurate so this condition should always be checked for. there is an equivalent degeneracy for line transfer between views one and two defined by a line in view three. again it occurs if the lines in views one and three are corresponding epipolar lines for these two views. jl k i in general the epipolar geometries between views one and two and one and three will differ for instance the epipole arising in the first view from view two will not coincide with the epipole arising in the first view from view three. thus an epipolar line in the first view for views one and two will not coincide with an epipolar line for views one and three. consequently when line transfer into the third view is degenerate line transfer into the second view will not in general be degenerate. however for lines in the trifocal plane transfer is degenerate undefined always. the fundamental matrices for three views the three fundamental matrices are not independent but satisfy three relations et et these relations are easily seen from figure for example et follows from the observation that and are matching points corresponding to the centre of camera number et projectively the three-camera configuration has degrees of freedom counting for each camera less for an overall projective ambiguity. alternatively this may be accounted for as for the degrees of freedom of the fundamental matrices less for the relations. the trifocal tensor also has degrees of freedom and fundamental matrices computed from the trifocal tensor will automatically satisfy the three relations. the counting argument implies that the three relations of are sufficient to ensure consistency of three fundamental matrices. the counting argument alone is not a convincing proof of this however so a proof is given below. definition three fundamental matrices and are said to be compatible if they satisfy the conditions the trifocal tensor in most cases these conditions are sufficient to ensure that the three fundamental matrices correspond to some geometric configuration of cameras. theorem let a set of three fundamental matrices and be given satisfying the conditions assume also that and then there exist three camera matrices such that fij is the fundamental matrix corresponding to the pair pj. eik in this theorem ensure that the three cameras are non-collinear. for this reason they will be referred to here as the non-collinearity conditions. one may show by example to the reader that these conditions are necessary for the truth of the theorem. note that the conditions eij proof. in this proof the indices i j and k are intended to be distinct. we begin by choosing three points xi i consistent with the three fundamental matrices. in other words we require that xt fijxj for all pairs j. this is easily done i by choosing first and to satisfy xt and then defining to be the intersection of the two epipolar lines and in a similar manner we choose a second set of points yi i satisfying yt fijyj this is done in such a way that the four points xi yi eij eik in each i image i are in general position that is no three are collinear. this is possible by the assumption that the two epipoles in each image are distinct. next we choose five world points x y in general position. for example one could take the usual projective basis. we may now define the three camera matrices. let the i-th camera matrix pi satisfy the conditions pici picj eij pick eik pix xi piy yi. in other words the i-th camera has centre at ci and maps the four other world points cj ck x y to the four image points eij eik xi yi. this uniquely determines the camera matrix since the points are in general position. to see this recall that the camera matrix defines a homography between the image and the rays through the camera centre projective space. the images of four points specify this homography completely. let fij be the fundamental matrix defined by the pair of camera matrices pi and pj. the proof is completed by proving that fij fij for all i j. the epipoles of fij and fij are the same by the way that pi and pj are constructed. consider the pencil of epipolar lines through eij in image i. this pencil forms a projective space of lines and the fundamental matrix fij induces a oneto-one correspondence fact a homography between this pencil and the pencil of lines through eji in image j. the fundamental matrix fij also induces a homography between the same pencils. the two fundamental matrices are the same if the homographies they induce are the same. two homographies are the same if they agree on three points in this case epipolar lines. the relation xt fijxj means that the epipolar lines through i xi in image i and xj in image j correspond under the homography induced by fij. by construction xi fijxj as well since xi and xj are the projections of the point x in the fundamental matrices for three views the two images. thus both homographies agree on this pair of epipolar lines. in the same way the homographies induced by fij and fij agree on the epipolar lines corresponding to the pairs yi yj and eik ejk. the two homographies therefore agree on three lines in the pencil and hence are equal so are the corresponding fundamental matrices. are grateful to frederik schaffalitzky for this proof. uniqueness of camera matrices given three fundamental matrices the proof just given shows that there is at least one set of cameras corresponding to three compatible fundamental matrices they satisfying the non-collinearity condition. it is important to know that the three fundamental matrices determine the configuration of the three cameras uniquely at least up to the unavoidable projective ambiguity. this will be shown next. the first two camera matrices p and may be determined from the fundamental matrix by two-view techniques it remains to determine the third camera matrix in the same projective frame. in principle this may be done as follows. select a set of matching points xi i in the first two images satisfying and use triangulation to determine the corresponding points use epipolar transfer to determine the corresponding points i in the third im i xi. solve for the camera matrix age using the fundamental matrices and xi i from the set of correspondences the second step in this algorithm will fail in the case where the point xi lies in the trifocal plane. such a point xi is easily detected and discarded since it projects into the first image as a point xi lying on the line joining the two epipoles and since there are infinitely many possible matched points we can compute sufficiently many such points to compute the only situation in which this method will fail is when all space points xi lie in a trifocal plane. this can occur only in the degenerate situation in which the three camera centres are collinear in which case the trifocal plane is not uniquely determined. thus we see that unless the three camera centres are collinear the three camera matrices may be determined from the fundamental matrices. on the other hand if the three cameras are collinear then there is no way to determine the relative spacings of the cameras along the line of their centres. this is because the length of the baseline cannot be determined from the fundamental matrices and the three baselines between the camera centres may be arbitrarily chosen and remain consistent with the fundamental matrices. thus we have demonstrated the following fact result given three compatible fundamental matrices and satisfying and the non-collinearity condition the three corresponding camera matrices p are unique up to the choice of a projective coordinate frame. the trifocal tensor computation of camera matrices from three fundamental matrices given three compatible fundamental matrices there exists a simple method for computing a corresponding set of three camera matrices. from the fundamental matrix one can compute a corresponding pair of camera matrices using result next according to result the third camera matrix must satisfy the condition that and be skew-symmetric. each of these matrices gives rise to linear equations in the entries of a total of equations in the entries of may be computed linearly. from these if the three fundamental matrices are compatible in the sense of definition and the non-collinearity condition of theorem holds then there will exist a solution and it will be unique. if however the three fundamental matrices are computed independently from point correspondences then they will not satisfy the compatibility conditions exactly. in this case it will be necessary to compute a least-squares solution to find the error being minimized is not geometrically based. it is best to use this algorithm only when the fundamental matrices are known to be compatible. one can think of doing three-view reconstruction by estimating the three fundamental matrices using pairwise point correspondences then using the above algorithm to estimate the three camera matrices. this is not a very good strategy for the following reasons. the method for computing the three camera matrices from the fundamental matrices assumes that the fundamental matrices are compatible. otherwise a least-squares problem involving a non-geometrically justified cost function is involved. although result shows that three fundamental matrices may determine the camera geometry and hence the trifocal tensor this is only true when the cameras are not collinear. as they approach collinearity the estimate of the relative camera placement becomes unstable. the trifocal tensor is preferable to a triple of compatible fundamental matrices as a means of determining the geometry of three views. this is because the difficulty with the views being collinear is not an issue with the trifocal tensor. it is well defined and uniquely determines the geometry even for collinear cameras. the difference is that the fundamental matrices do not contain a direct constraint on the relative displacements between the three cameras whereas this is built into the trifocal tensor. since the projective structure of the three cameras may be computed explicitly from the trifocal tensor it follows that all three fundamental matrices for the three view pairs are determined by the trifocal tensor. in fact simple formulae given in algorithm exist for the two fundamental matrices and the fundamental matrices determined from the trifocal tensor will satisfy the compatibility conditions camera matrices compatible with two fundamental matrices suppose we are given only two fundamental matrices and to what extent do these fix the geometry of the three cameras? it will be shown here that there are four closure compatible with the pair of fundamental matrices. from one may compute a pair of camera matrices and from the pair in both cases we may choose p resulting in a triple of camera matrices degrees of freedom in the solution for the camera matrices beyond the usual projective ambiguity. however the choice of the three camera matrices is not unique since for any matrices and representing projective transforms the pairs and are also compatible with the same fundamental matrices. in order to preserve the condition that p is equal to in each case the form of hi must be restricted to hi i vt i ki and we may now fix on a particular choice of the first two camera matrices compatible with this is equivalent to fixing on a specific projective coordinate frame. the general solution for the camera matrices is then where is of the form given above and the two pairs are compatible with the two fundamental matrices. allowing also for the overall projective ambiguity the most general solution is which gives a total of degrees of freedom for the projective transformation h and for the degrees of freedom of the same number of degrees of freedom may be found using a counting argument as follows two fundamental matrices have degrees of freedom each for a total of three arbitrary camera matrices on the other hand have degrees of freedom. the constraints imposed by the two fundamental matrices leave remaining degrees of freedom for the three camera matrices. closure the development of three-view geometry proceeds in an analogous manner to that of two-view geometry covered in part ii of this book. the trifocal tensor may be computed from image correspondences over three views and a projective reconstruction of the cameras and scene then follows. this computation is described in chapter the projective ambiguity may be reduced to affine or metric by supplying additional information on the scene or cameras in the same manner as that of chapter a similar development to that of chapter may be given for the relations between homographies induced by scene planes and the trifocal tensor. the literature with hindsight the discovery of the trifocal tensor may be traced to and where it was used for scene reconstruction from lines in the case of calibrated cameras. it was later shown in to be equally applicable to projective scene reconstruction in the uncalibrated case. at this stage matrix notation was used but used tensor notation for this problem. the trifocal tensor meanwhile in independent work shashua introduced trilinearity conditions relating the coordinates of corresponding points in three views with uncalibrated cameras then showed that shashua s relation for points and scene reconstruction from lines both arise from a common tensor and the trifocal tensor was explicitly identified. in subsequent work properties of the tensor have been investigated e.g. in particular described the mixed covariant contravariant behaviour of the indices and described the geometry of the homographies encoded by the tensor. faugeras and mourrain gave enlightening new derivations of the trifocal tensor equations and considered the trifocal tensor in the context of general linear constraints involving multiple views. this approach will be discussed in chapter further geometric properties of the tensor were given in faugeras papadopoulo epipolar point transfer was described by and its deficien cies pointed out by amongst others. the trifocal tensor has been used for various applications including establishing correspondences in image sequences independent motion detection and camera self-calibration notes and exercises the trifocal tensor is invariant to projective transforms. verify explicitly that if is a transform preserving the first camera matrix p then the tensor defined by is unchanged. in this chapter the starting point for the trifocal tensor derivation was the incidence property of three corresponding lines. show that alternatively the starting point may be the homography induced by a plane. here is a sketch derivation choose the camera matrices to be a canonical set p and start from the homography between the first and third views induced by a plane from result this homography may be written as b where in this case the plane is defined by a line show that result follows. homographies involving the first view are simply expressed in terms of the trifocal tensor t jk as given by result investigate whether a simple formula exists for the homography from the second to the third view induced by a line l in the first image. is a matrix. show that this may be interpreted as a correlation definition mapping between the second and third views induced by the line which is the back-projection of the point x in the first view. the contraction xit jk in the second view as i i plane plus parallax over three views. there is a rich geometry associated with the plane plus two points configuration figure over three views suppose the points off the plane are x and y. project the closure and similarly project the point y to the triangle y point x onto the reference plane from each of the three camera centres to form a triangle x then the two triangles form a desargues s configuration and are related by a planar homology section a simple sketch shows that the lines joining corresponding triangle vertices y are concurrent and their intersection is the point at which the line joining x and y pierces the reference plane. similarly the intersection points of corresponding triangle sides are collinear and the line so formed is the intersection of the trifocal plane of the cameras with the reference plane. further details are given in in the case where two of the three cameras have the same camera centre the trifocal tensor may be related to simpler entities. there are two cases. the second and third camera have the same centre then if t jk i frihk s where fri is the fundamental matrix for the first two views and h is the homography from the second to the third view induced by the fact that they have the same centre. i hj where h is the homography from the first to the second view and is the epipole in the third image. if the first and the second views have the same centre then t jk i prove these relationships using the approach of chapter consider the case of a small baseline between the cameras and derive a differ ential form of the trifocal tensor see there are actually three different trifocal tensors relating three views depending on which of the three cameras corresponds to the covariant index. given one such tensor verify that the tensor i may be computed in several steps as follows extract the three camera matrices p from the trifocal tensor. find a projective transformation h such that and apply it to each of p and compute the tensor as well. i by applying and investigate the form and properties rank of the matrices ti of the trifocal tensor for the special motions translation planar motion described in section for the fundamental matrix. comparison of the incidence relationships of table indicates that one may replace a line l r and proceed similarly with k. also one gets a three-view line equation by replacing xi by can both l of these operations be carried out at once to obtain an equation j by the expression why or why not? t st r vw? the trifocal tensor affine trifocal tensor. if the three cameras p and are all affine then the corresponding tensor ta is the affine trifocal tensor. this affine specialization of the tensor has degrees of freedom and non-zero entries. the affine trifocal tensor was first defined in and has been studied in it shares with the affine fundamental matrix very stable numerical estimation behaviour. it has been shown to perform very well in tracking applications where the object of interest example a car has small relief compared to the depth of the scene computation of the trifocal tensor t this chapter describes numerical methods for estimating the trifocal tensor given a set of point and line correspondences across three views. the development will be very similar to that for the fundamental matrix using much the same techniques as those of chapter in particular five methods will be discussed a linear method based on direct solution of a set of linear equations ap propriate data normalization an iterative method that minimizes the algebraic error while satisfying all appropriate constraints on the tensor an iterative method that minimizes geometric error gold standard method an iterative method that minimizes the sampson approximation to geometric error robust estimation based on ransac basic equations a complete set of the equations involving the trifocal tensor is given in table all of these equations are linear in the entries of the trifocal tensor t correspondence three points two points one line one point two lines xix xix three lines lpl ql i relation qr r qr rt qr xil ql r qr i i i number of equations table trilinear relations between point and line coordinates in three views. the final column denotes the number of linearly independent equations. the notation means a tensor with all zero entries. thus the first line in this table corresponds to a set of equations one for each choice of s and t. however among this set of equations only are linearly independent. computation of the trifocal tensor t given several point or line correspondences between three images the complete set of equations generated is of the form at where t is the made up of the entries of the trifocal tensor. from these equations one may solve for the entries of the tensor. note that equations involving points may be combined with those involving lines in general all available equations from table may be used simultaneously. since t has entries equations are needed to solve for t up to scale. with more than equations a least-squares solution is computed. as with the fundamental matrix one minimizes subject to the constraint using algorithm this gives a bare outline of a linear algorithm for computing the trifocal tensor. however in order to build a practical algorithm out of this several issues such as normalization need to be addressed. in particular the tensor that is estimated must obey various constraints and we consider these next. the internal constraints the most notable difference between the fundamental matrix and the trifocal tensor is the greater number of constraints that apply to the trifocal tensor. the fundamental matrix has a single constraint namely detf leaving degrees of freedom discounting the arbitrary scale factor. the trifocal tensor on the other hand has entries but parameters only are required to specify the equivalent camera configuration up to projectivity. the elements of the tensor therefore satisfy independent algebraic constraints. this condition is conveniently stated as follows. definition a trifocal tensor t jk internal constraints if there exist three camera matrices p t jk corresponds to the three camera matrices according to is said to be geometrically valid or satisfy all such that i i and just as with the fundamental matrix it is important to enforce these constraints in some way so as to arrive at a geometrically valid trifocal tensor. if the tensor does not satisfy the constraints there are consequences similar to a fundamental matrix which is not of rank where epipolar lines computed as fx for varying x do not intersect in a single point figure for example if the tensor does not satisfy the internal constraints and is used to transfer a point to a third view given a correspondence over two views as described in section then the position of the transferred point will vary depending on which set of equations from table is used. in the following the objective is always to estimate a geometrically valid tensor. the constraints satisfied by the trifocal tensor elements are not so simply expressed det and some have thought this an impediment to accurate computation of the trifocal tensor. however in reality in order to work with or compute the trifocal tensor it is not necessary to express these constraints explicitly rather they are implicitly enforced by an appropriate parametrization of the trifocal tensor and rarely cause any trouble. we will return to the issue of parametrization in section and section the normalized linear algorithm the minimum case point correspondences a geometrically valid trifocal tensor may be computed from images of a point configuration provided the scene points are in general position. there are one or three real solutions. the tensor is computed from the three camera matrices which are obtained using algorithm as described in section this minimal six point solution is used in the robust algorithm of section the normalized linear algorithm in forming the matrix equation at from the equations on t in table it is not necessary to use the complete set of equations derived from each correspondence since not all of these equations are linearly independent. for instance in the case of a point point point correspondence row of table all choices of s and t lead to a set of equations but only of these equations are linearly independent and these may be obtained by choosing two values for each of s and t for instance and this point is discussed in more detail in section the reader may verify that the three points equation obtained from table for a given choice of s and t may be expanded as jl il x x jm k k xkx k x when i j s and l m t. equation collapses for i j or l m and swapping i and j l and m simply changes the sign of the equation. one choice of the four independent equations is obtained by setting j m and letting i and l range may be set to to obtain a relationship between freely. the coordinates x the observed image coordinates. equation then becomes k and x im xkx k x k x k t il k the four different choices of i l give four different equations in terms of the observed image coordinates. how to represent lines the three lines correspondence equation of table may be written in the form li l jl k t jk i where as usual with homogeneous entities the equality is up to scale. in the presence of noise this relationship will only be approximately satisfied by the measured lines l that are close to the measured lines. but will be satisfied exactly for three lines l l and l and the question is whether two sets of homogeneous coordinates that differ by a small amount represent lines that are close to each other in some geometric sense. consider the two vectors and clearly as vectors they are not very different and in fact is small. on the other hand represents the line x and represents the line y thus in a geometric sense these lines are totally different. note that this problem is alleviated by scaling. if coordinates are computation of the trifocal tensor t objective given n image point correspondences across images or at least line correspondences or a mixture of point and line correspondences compute the trifocal tensor. algorithm and to apply to the three images. i lj. points and lines in the second and third image transform in the same way. find transformation matrices h jxj and lines according to li li transform points according to xi xi hi compute the trifocal tensor t linearly in terms of the transformed points and lines using the equations in table by solving a set of equation of the form at using algorithm t t st i hr r compute the trifocal tensor corresponding to the original data according to t jk i algorithm the normalized linear algorithm for computation of t scaled by a factor of then the coordinates for the lines become and which are quite different. nevertheless this observation indicates that care is needed when representing lines. suppose one is given a correspondence between three lines l two points and lying on l are selected. each of these points provides a correspondence xs for s between the three views in the sense that there exists a line that maps to in the second and third images and to a line l t jk passing through xs in the first image. two equations of the form xi i for sl s result from these correspondences. in this way one avoids the use of lines in the first image though not the other images. often lines in images are defined naturally by a pair of points possibly the two endpoints of the lines. even lines that are defined as the best fit to a set of edge points in an image may be treated as if they were defined by just two points as will be described in section and and jl k normalization as in all algorithms of this type it is necessary to carry out prenormalization of the input data before forming and solving the linear equation system. subsequently it is necessary to correct for this normalization to find the trifocal tensor for the original data. the recommended normalization is much the same as that given for the computation of the fundamental matrix. a translation is applied to each image such that the centroid of the points is at the origin and then a scaling is applied so that the average distance of the points from the origin is in the case of lines the transformation should be defined by considering each line s two endpoints some representative line points visible in the image. the transformation rule for the trifocal tensor under these normalizing transformations is given in section the normalized linear algorithm for computing t is summarized in algorithm this algorithm does not consider the constraints discussed in section that should be applied to t these constraints ought to be enforced before the denormal the algebraic minimization algorithm ization step step in the above algorithm. methods of enforcing these constraints will be considered next. the algebraic minimization algorithm the linear algorithm will give a tensor not necessarily corresponding to any geometric configuration as discussed in section the next task is to correct the tensor to satisfy all required constraints. our task will be to compute a geometrically valid trifocal tensor t jk from a set of image correspondences. the tensor computed will minimize the algebraic error associated with the input data. that is we minimize subject to where t is the vector of entries of a geometrically valid trifocal tensor. the algorithm is quite similar to the algebraic algorithm for computation of the fundamental matrix. just as with the fundamental matrix the first step is the computation of the epipoles. i retrieving the epipoles let and be the epipoles in the second and third images corresponding to is being images of the first camera centre. recall from result that the two epipoles and are the common perpendicular to the left right null-vectors of the three ti. in principle then the epipoles may be computed from the trifocal tensor using the algorithm outlined in algorithm however in the presence of noise this translates easily into an algorithm for computing the epipoles based on four applications of algorithm for each i find the unit vector vi that minimizes where compute the epipole as the unit vector that minimizes i form the matrix v the i-th row of which is vt i ti t the epipole is computed similarly using tt i instead of ti. and bk algebraic minimization having computed the epipoles the next step is to determine the remaining elements of the camera matrices from which the trifocal tensor can be calculated. this step is linear. from the form of the trifocal tensor it may be seen that once the epipoles aj are known the trifocal tensor may be expressed linearly in terms of the remaining entries of the matrices aj i this relationship may be written linearly as t ea where a is the vector of the remaining entries ai j t is the vector of entries of the trifocal tensor and e is the linear relationship expressed by we wish to minimize the algebraic error over all choices of a constrained such that that is this minimization problem is solved by algorithm the solution t ea represents a trifocal tensor satisfying all constraints and minimizing the algebraic error subject to the given choice of epipoles. i and bk j and bi objective computation of the trifocal tensor t given a set of point and line correspondences in three views compute the trifocal tensor. algorithm i and i i from the set of point and line correspondences compute the set of equations of the form at from the relations given in table trifocal tensor t jk from t jk a is the vector representing entries of a solve these equations using algorithm to find an initial estimate of the find the two epipoles as the common perpendicular to the left right null-vectors of the three ti. construct the matrix e such that t ea where t is the vector of entries of t jk i and where e expresses the linear relationship t jk solve the minimization problem minimize subject to using algorithm compute the error vector aea. is a mapping from to iterate on the iteration the mapping last two steps with varying and using the levenberg marquardt algorithm to find the optimal hence find the optimal t ea containing the entries of t jk e i i a j i e j i and bk i algorithm computing the trifocal tensor minimizing algebraic error. the computation should be carried out on data normalized in the manner of algorithm normalization and denormalization steps are omitted here for simplicity. this algorithm finds the geometrically valid trifocal tensor that minimizes algebraic error. at the cost of a slightly inferior solution the last iteration step may be omitted providing a fast non-iterative algorithm. iterative method the two epipoles used to compute a geometrically valid tensor t jk are determined using the estimate of t jk obtained from the linear algorithm. analogous to the case aea is a mapping of the fundamental matrix the mapping an application of the levenberg marquardt algorithm to optimize the choice of the epipoles will result in an optimal terms of algebraic error estimate of the trifocal tensor. note that the iteration problem is of modest size since only parameters the homogeneous coordinates of the epipoles are involved in the iteration problem. i i this contrasts with an iterative estimation of the optimal trifocal tensor in terms of geometric error considered later. this latter problem requires estimating the parameters of the three cameras plus the coordinates of all the points a large estimation problem. the complete algebraic method for estimating the trifocal tensor is summarized in algorithm geometric distance the gold standard method for the trifocal tensor as with the computation of the fundamental matrix best results may be expected from the maximum likelihood gold standard solution. since this has been adequately described for the case of the fundamental matrix computation little needs to be added for the three-view case. geometric distance objective given n image point correspondences likelihood estimate of the trifocal tensor. the mle involves also solving for a set of subsidiary point correspondences xi which exactly satisfy the trilinear relations of the estimated tensor and which minimize i i determine the maximum i i dxi i i i i algorithm i algorithm and i compute an initial geometrically valid estimate of t using a linear algorithm such as compute an initial estimate of the subsidiary variables xi i as follows i from t i and p i retrieve the camera matrices from the correspondence xi the correspondence consistent with t is obtained as estimate of using the triangulation method of chapter xi minimize the cost over t and i n. the cost is minimized using the levenberg marquardt algorithm over variables for the n points and for the elements dxi determine an i i i i of the camera matrices algorithm the gold standard algorithm for estimating t from image correspondences. given a set of point correspondences function to be minimized i i in three views the cost dxi i i i i i where the points xi i satisfy a trifocal constraint in table exactly for the estimated trifocal tensor. as in the case of the fundamental matrix one needs to introduce further variables corresponding to points xi and parametrize the trifocal tensor by the entries of the matrices below. the cost function is then minimized over the position of the points xi and the two camera matrices and i essentially one is carrying out bundle adjustment over three views. the sparse matrix techniques of section should be used. and i and with xi a good way to find an initial estimate is the algebraic algorithm though the final iterative step can be omitted. this algorithm gives a direct estimate of the entries of the initial estimate of the points xi may be obtained using the linear triangulation method of section the steps of the algorithm are summarized in algorithm and computation of the trifocal tensor t the technique can be extended to include line correspondences. to do this one needs to find a representation of a line convenient for computation. given a line correspondence l the lines being perhaps defined by their endpoints in each image a very convenient way to represent the line during the lm parameter minimization is by its projections l in the second and third views. given a candidate trifocal tensor one can easily compute the projection of the line into the first view using the line transfer equation li l then one minimizes the j and l l k sum-of-squares line t jk i dli i l i l i i for some appropriate interpretation of the distance i l between the measured and estimated line. if the measured line is specified by its endpoints then the obvious distance metric to use is the distance of the estimated line from the measured endpoints. in general a mahalanobis distance may be used. parametrization of the trifocal tensor if the tensor is parametrized simply by its entries then the estimated tensor will not satisfy the internal constraints. a parametrization which ensures that the tensor does satisfy its constraints and so is geometrically valid is termed consistent. since from definition a tensor is geometrically valid if it is generated from three camera matrices p by it follows that the three camera matrices give a consistent parametrization. note that this is an overparametrization since it requires parameters to be specified namely the entries each of the ma there is no need to attempt to define a minimal trices set of parameters which is a difficult task. any choice of cameras is a consistent parametrization the particular projective reconstruction has no effect on the tensor. and another consistent parametrization is obtained by computing the tensor from six point correspondences across three views as in section then the position of the points in each image is the parametrization a total of x y parameters. however only a subset of the points need be varied during the minimization or the movement of the points can be restricted to be perpendicular to the variety of trifocal tensors. first-order geometric error distance the trifocal tensor may be computed using a geometric cost function based on the sampson approximation in a manner entirely analogous to the sampson method used to compute the fundamental matrix again the advantage is that it is not necessary to introduce a set of subsidiary variables as this first-order geometric error requires a minimization only over the parametrization of the tensor only parameters if is used as above. the minimization can be carried out with a simple iterative levenberg marquardt algorithm and the method initialized by the iterative algebraic algorithm experimental evaluation of the algorithms the sampson cost function is a little more complex computationally than the corresponding cost function for the fundamental matrix because each point correspondence gives four equations instead of just one for the fundamental matrix. the more general case was discussed in section the error function in the present case is i i i i where is the algebraic error vector ait corresponding to a single correspondence in the case of equations per point and j is the matrix of partial derivatives of with respect to the coordinates of each of the corresponding points xi i as in the programming hint given in exercise on page the computation of the partial derivative matrix j may be simplified by observing that the cost function is multilinear in the coordinates of the points xi i i the sampson error method has various advantages it gives a good approximation to actual geometric error optimum using a relatively simple iterative algorithm. as in the case of actual geometric error non-isotropic and unequal error distributions may be specified for each of the points without significantly complicating the algorithm. see exercises in chapter experimental evaluation of the algorithms a brief comparison is now given of the results of the algebraic algorithm along with the gold standard algorithm for computing the trifocal tensor. the algorithms are run on synthetic data with controlled levels of noise. this allows a comparison with the theoretically optimal ml results and a determination of how well these algorithms are able to approximate the theoretical lower bound on residual error achieved by an optimal ml algorithm. computer-generated data sets of and points were used to test the algorithm and the cameras were placed at random angles around the cloud of points. the camera parameters were chosen to approximate a standard camera and the scale was chosen so that the size of the image was pixels. for a given level of added gaussian noise in the image measurement one may compute the expected residual achieved by an ml algorithm according to result in this case if n is the number of points then the number of measurements is n and the number of degrees of freedom in the fitting is d where represents the number of degrees of freedom of the three cameras less to account for projective ambiguity and represents the number of degrees of freedom of n points in space. hence the ml residual is dn n computation of the trifocal tensor t points r o r r e points r o r r e noise r o r r e points noise noise fig. comparison of trifocal tensor estimation algorithms. the residual error rms-averaged over runs is plotted against the noise level for computation of the trifocal tensor using and points. each graph contains three curves. the top curve is the result of the algebraic error minimization whereas the lower two curves actually indistinguishable in the graphs represent the theoretical minimum error and the error obtained by the gold standard algorithm using the algebraic minimization as a starting point. note that the residual errors are almost exactly proportional to added noise as they should be. results and recommendations the results are shown in figure we learn two things from these results. minimization of the algebraic error achieves residual errors within about of the optimal and using this estimate as a starting point for minimizing geometric error achieves a virtually optimal estimate. all the algorithms developed above except the linear method of section enforce the internal constraints on the tensor. the linear method is not recommended for use on its own but is necessary for initialization in most of the other methods. as in the case of estimating the fundamental matrix our recommendations are to use the iterative algebraic algorithm or the sampson geometric approximation of section both give excellent results. again to be certain of getting the best results if gaussian noise is a viable assumption implement the gold standard algorithm automatic computation of t this section describes an algorithm to compute the trifocal geometry between three images automatically. the input to the algorithm is simply the triplet of images with no other a priori information required and the output is the estimated trifocal tensor together with a set of interest points in correspondence across the three images. the fact that the trifocal tensor may be used to determine the exact image position of a point in a third view given its image position in the other two views means that there are fewer mismatches over three views than there are over two. in the two view case there is only the weaker geometric constraint of an epipolar line against which to verify a possible match. the three-view algorithm uses ransac as a search engine in a similar manner to its use in the automatic computation of a homography described in section the ideas and details of the algorithm are given there and are not repeated here. the method is summarized in algorithm with an example of its use shown automatic computation of t objective compute the trifocal tensor between three images. algorithm interest points compute interest points in each image. two-view correspondences compute interest point correspondences f between views and using algorithm putative three-view correspondences compute a set of interest point correspon dences over three views by joining the two-view match sets. ransac robust estimation repeat for n samples where n is determined adap tively as in algorithm select a random sample of correspondences and compute the trifocal tensor using algorithm there will be one or three real solutions. ety described by t as in section dences for which d t. calculate the distance d in from each putative correspondence to the varic compute the number of inliers consistent with t by the number of correspond if there are three real solutions for t the number of inliers is computed for each choose the t with the largest number of inliers. in the case of ties choose the solution that has the lowest standard deviation of inliers. optimal estimation re-estimate t from all correspondences classified as inliers us solution and the solution with most inliers retained. guided matching further interest point correspondences are now determined using ing the gold standard algorithm or the sampson approximation to this. the estimated t as described in the text. the last two steps can be iterated until the number of correspondences is stable. algorithm algorithm to automatically estimate the trifocal tensor over three images using ransac. in figure and additional explanation of the steps given below. figure shows a second example which includes automatically computed line matches. the distance measure reprojection error. given the match x and the current estimate of t we need to determine the minimum of the reprojection error x are consistent a point with t as usual the consistent images points may be obtained from the projection of by determining the point which minimizes the image distance between the measured are extracted from t the distance is then obtained x where the image points x where the camera matrices points x and the projected points. another way of obtaining this distance is to use the sampson error which is a first-order approximation to the geometric error. however in practice it is quicker to estimate the error directly by non-linear least-squares iteration small levenberg marquardt problem. starting from an initial estimate of one iterates varying the coordinates of to minimize the reprojection error. computation of the trifocal tensor t a d b e c f g i h j fig. automatic computation of the trifocal tensor between three images using ransac. c raw images of keble college oxford. the motion between views consists of a translation and rotation. the images are pixels. f detected corners superimposed on the images. there are approximately corners on each image. the following results are superimposed on the image putative matches shown by the line linking corners note the clear mismatches outliers of the putative matches. inliers correspondences consistent with the estimated t final set of correspondences after guided matching and mle. there are no mismatches. guided matching. we have an initial estimate of t and wish to use this to generate and assess additional point correspondences across the three-views. the first step is to extract the fundamental matrix between views from t then two-view automatic computation of t a b fig. image triplet matching. the trifocal tensor is computed automatically from interest points using algorithm and subsequently used to match line features across views. three images of a corridor sequence. automatically matched line segments. the matching algorithm is described in guided matches are computed using loose thresholds on matching. each two-view match is corrected using to give points x which are consistent with these corrected two-view matches with t define a small search window in the third view in which the corresponding point is sought. any three-view point correspondence is assessed by computing d as described above. the match accepted if d is less than the threshold t. note the same threshold is used for inlier detection within the ransac stage and guided matching. in practice it is found that the stage of guided matching is more significant here in that it generates additional correspondences than in the case of homography estimation. implementation and run details. for the example of figure the search window was pixels. the inlier threshold was t pixels. a total of samples were required. the rms pixel error after ransac was correspondences after mle it was correspondences and after mle and guided matching it was correspondences. the mle required iterations of the levenberg marquardt algorithm. note ransac has to do far less work than in algorithm to estimate f and correspondences because the two-view algorithm has already removed many outliers before the putative correspondences over three views are generated. computation of the trifocal tensor t special cases of t i from a plane plus parallax computing t jk we describe here the computation of t jk from the image of a special configuration consisting of a world plane which a homography between views can be computed and two points off the plane. of course it is not necessary for the plane to actually be present. it may be virtual or the homography may simply be specified by the images of four coplanar points or four coplanar lines. the method is the analogue of algorithm for the fundamental matrix. i the solution is obtained by constructing the three camera matrices to a common projective transformation of and then computing the trifocal tensor from these matrices according to the homography induced by the world plane between the first and second view is and between the first and third views is as shown in section the epipole may be computed directly from the two point correspondences off the plane for the first and second views and the camera matrices chosen as p where is a scalar. note the scale of both and is considered fixed here so they are no longer homogeneous quantities. similarly may be determined from the two point correspondences for views one and three and the camera matrices chosen as p where is a scalar. it is then easily verified that a consistent set of cameras for the three views the discussion on consistent camera triplets on page is given by p where has been set to unity. the value of is determined from one of the point correspondences over three views and this is left as an exercise. for more on planeplus-parallax reconstruction see section note that the estimation of the trifocal tensor for this configuration is overdetermined. in the case of the fundamental matrix over two views the homographies determine all but degrees of freedom epipole and each of the point correspondence provides one constraint so that the number of constraints equals the number of degrees of freedom of the matrix. in the case of the trifocal tensor the homography determines all but degrees of freedom two epipoles and their relative scaling. however each point correspondence provides three constraints are six coordinate measurements less three for the point s position in so that there are six constraints on degrees of freedom. since there are more measurements than degrees of freedom in this case the tensor should be estimated by minimizing a cost function based on geometric error. lines specified by several points in describing the reconstruction algorithm from lines we have considered the case where lines are specified by their two endpoints. another common way that lines may special cases of t be specified in an image is as the best line fit to several points. it will be shown now how that case may easily be reduced to the case of a line defined by two endpoints. consider a set of points xi in an image normalized to have third component equal to let l be a line which we suppose is normalized such that in this case the distance from a point xi to the line l is equal to xt l. the squared distance i may be written as ltxixt i l and the sum-of-squares of all distances is ltxixt l lt xixt i i i i xixt the matrix e lemma matrix is positive-semidefinite where j is the matrix and is the smallest solution to the equation dete i is positive-definite and symmetric. i proof. we start by computing the vector x that minimizes xtex subject to the condition using the method of lagrange multipliers this comes down to finding the extrema of xtex where denotes the lagrange coefficient. taking the derivative with respect to x and setting it to zero we find that this may be written as jx it follows that is a root of the equation dete j and x is the generator of the null-space of e j. since xtex xtjx it follows that to minimize xtex one must choose to be the minimum root of the equation dete j in this case one has for the minimizing vector for any other vector x not necessarily xt the minimizing vector one has xtex then xte xtex and so e is positive-semidefinite. since the matrix e is symmetric it may be written in the form e vdiagr s where v is an orthogonal matrix and r and s are positive. it follows that e vdiagr t where vi is the i-th column of v. therefore e line l satisfying we have then for any i ltel i rvt svt thus we have replaced the sum-of-squares of several points by a constant value which is not capable of being minimized plus the weighted sum-of-squares of the distances to two points and to summarize when forming the trifocal tensor equations involving a line defined by points xi formulate two point equations expressed in terms of the points and with weights r and s respectively. computation of the trifocal tensor t orthogonal regression. in the proof of lemma above it was shown that the line l that minimizes the sum of squared distances to the set of all points xi yi is obtained as follows. xixt i i and j define matrices e let be the minimum root of the equation dete j the required line l is the right null-vector of the matrix e this gives a least-squares best fit of a line to a set of points. this process is known as orthogonal regression and it extends in an obvious way to higher-dimensional fitting of a hyperplane to a set of points in a way that minimizes the sum of squared distances to the points. closure the literature a linear method for computing the trifocal tensor was first given in where further experimental results of estimation using both point and line correspondences on real data are reported. an iterative algebraic method for estimating a consistent tensor was given in torr and zisserman developed an automatic algorithm for estimating a consistent tensor t from three images. this paper also compared several parametrizations of the iterative minimization. several methods of representing and imposing the constraints on the tensor are given by faugeras and papadopoulo gives minimal solutions for reconstruction for the two cases of four points and three lines in three views and two points and six lines in three views notes and exercises consider the problem of estimating the point x which minimizes reprojection error from measured image points x given the trifocal tensor. this is the analogue of the triangulation problem of chapter show that for general motion the one parameter family parametrization of epipolar lines developed in chapter does not extend from two views to three. however in the case that the three camera centres are collinear the two-view parametrization can be extended to three and a minimum determined by solving a polynomial in one variable. what is the degree of this polynomial? an affine trifocal tensor may be computed from a minimal configuration of points in general position. the computation is similar to that of algorithm and the resulting tensor satisfies the internal constraints for an affine trifocal tensor. how many constraints are there in the affine case? if more than point correspondences are used in the estimation then a geometrically valid tensor is estimated using the factorization algorithm of section the transformation rule for tensors is t jk i ar i sc t t st r this may be computed easily as closure binv b.inverse cinv c.inverse for i for j for k tijk for r for s for t tijk ari binvjs cinvkt t_hatrst how many multiplications and loop iterations does this involve? find a better way of computing this transformation. in the computation of tensor using plane plus parallax show that if is the projective depth of one of the points off the plane see then the scalar in may be computed from the equation the trifocal part iv n-view geometry untitled on sackcloth by asger jorn artists rights society new york copy-dan copenhagen outline this part is partly a recapitulation and partly new material. chapter is the recapitulation. we return to two- and three-view geometry but now within a more general framework which naturally extends to four- and n-views. the fundamental projective relations over multiple views arise from the intersection of lines from points and planes from lines. these intersection properties are represented by the vanishing of determinants formed from the camera matrices of the views. the fundamental matrix the trifocal tensor and a new tensor for four views the quadrifocal tensor arise naturally from these determinants as the multiple view tensors for two three and four views respectively. the tensors are what remains when the structure and non-essential part of the camera matrices are eliminated. the tensors stop at four views. these tensors are unique for each set of views and generate relationships which are multi-linear in the coordinates of the image measurements. the tensors can be computed from sets of image correspondences and subsequently a camera matrix for each view can be computed from the tensor. finally the structure can be computed from the retrieved cameras and image correspondences. chapter covers the computation of a reconstruction from multiple views. in particular the important factorization algorithm is given for reconstruction from affine views. it is important because the algorithm is optimal but is also non-iterative. chapter describes the auto-calibration of a camera. these are a set of methods for computing the internal parameters of a camera based on constraints over multiple images. in contrast to the traditional approach to calibration described in chapter no explicit scene calibration object is used but simply constraints such as that the internal parameters are common across the images or that the camera rotates about its centre and does not change aspect ratio. chapter emphasises the duality between points and cameras and how this links various configurations and algorithms that have been given throughout this book. this chapter contains an algorithm for computing a reconstruction of six points imaged in chapter investigates the issue of whether points are in front of or behind one or more cameras. this is an issue that goes beyond the homogeneous representation used throughout the book which does not distinguish the direction of a ray. chapter covers the important topic of those configurations for which the estimation algorithms described in this book will fail. an example is for resectioning where the camera matrix cannot be computed if all the points and the camera centre lie on a twisted cubic. n and multiple view tensors this chapter introduces the quadrifocal tensor qijkl between four views which is the analogue of the fundamental matrix for two and the trifocal tensor for three views. the quadrifocal tensor encapsulates the relationships between imaged points and lines seen in four views. it is shown that multiple view relations may be derived directly and uniformly from the intersection properties of back-projected lines and points. from this analysis the fundamental matrix f trifocal tensor t jk and quadrifocal tensor qijkl appear in a common framework involving matrix determinants. specific formulae are given for each of these tensors in terms of the camera matrices. i we also develop general counting arguments for the degrees of freedom of the tensors and the number of point and line correspondences required for tensor computation. these are given for configurations in general position and for the important special case where four or more of the elements are coplanar. bilinear relations we consider first the relationship that holds between the coordinates of a point seen in two separate views. thus let x be a pair of corresponding points which are the images of the same point x in space as seen in the two separate views. it will be convenient for clarity of notation to represent the two camera matrices by a and b instead of the usual notation p and the projection from space to image can now be expressed as kx ax and k are two undetermined constants. this pair of equations may be written down as one equation bx where k and k a x b x k k and it may easily be verified that this is equivalent to the two equations. this can be written in a more detailed form by denoting the i-th row of the matrix a by ai and similarly the i-th row of the matrix b by bi. we also write x and x x the set of equations is now n-linearities and multiple view tensors x x x x k k now this is a set of equations which by hypothesis has a non-zero solution the vector k k it follows that the matrix of coefficients in must have zero determinant. it will be seen that this condition leads to a bilinear relationship between the entries of the vectors x and expressed by the fundamental matrix f. we will now look specifically at the form of this relationship. consider the matrix appearing in denote it by x. the determinant of x may notice that the entries appear in only two columns of x. this implies that the determinant of x may in fact since all the the determinant of x is a bilinear expression. the be written as an expression in terms of the quantities xi and x xi and x be expressed as a quadratic expression in terms of the xi and x entries xi appear in the same column there can be no terms of the form xixj or x briefly in terms of the xi and x fact that the determinant is zero may be written as an equation x where f is a matrix the fundamental matrix. we may compute a specific formula for the entries of the matrix f as follows. the in the expansion of the determinant entry fij of f is the coefficient of the term x of x. in order to find this coefficient we must eliminate the rows and columns of the and xj take the determinant of the resulting matrix and multiply matrix containing x by as appropriate. for instance the coefficient of x is obtained by eliminating two rows and the last two columns of the matrix x. the remaining matrix is x x is equal to the determinant of this matrix. in general and the coefficient of x we may write ai bj fji det in this expression the notation ai has been used to denote the matrix obtained from a by omitting the row ai. thus the symbol may be read as omit and ai represents two rows of a. the determinant appearing on the right side of is therefore a determinant. a different way of writing the expression for fji makes use of the tensor bilinear relations in section as fji det ap aq br bs to see this note that fji is defined in in terms of a sum of determinants over all values of p q r and s. however for a given value of i the tensor is zero unless p and q are different from i and from each other. this leaves only two remaining choices of p and q example if i then we may choose p q or p q similarly there are only two different choices of r and s giving rise to non-zero terms. thus the sum consists of four non-zero terms only. furthermore the determinants appearing in these four terms consist of the same four rows of the matrices a and b and hence have equal values except for sign. however the value of is such that the four terms all have the same sign and are equal. thus the sum is equal to the single term appearing in epipoles as tensors the expression for the fundamental matrix involves determinants of matrices containing two rows from each of a and b. if we consider instead the determinants of matrices containing all three rows from one matrix and one row from the other matrix the resulting determinants represent the epipoles. specifically we have ei det det e a bj ai b where e and are the epipoles in the two images. to see this note that the epipole is defined by ei the formula is now obtained by expanding the determinant by cofactors along the first row a similar manner to the derivation of is the centre of the second camera defined by where affine specialization in the case where both the cameras are affine cameras the fundamental matrix has a particularly simple form. recall that an affine camera matrix is one for which the final row is now note from that if neither i nor j is equal to then the third rows of both a and b are present in this expression for fij. the determinant has two equal rows and hence equals zero. thus f is of the form fa a b c d e of course the factor is inessential since f is defined only up to scale. it is included here just to show the relationship to n-linearities and multiple view tensors with all other entries being zero. thus the affine fundamental matrix has just nonzero entries and hence degrees of freedom. its properties are described in section note that this argument relies solely on the fact that both cameras have the same third row. since the third row of a camera matrix represents the principal plane of the camera section it follows that the fundamental matrix for two cameras sharing the same principal plane is of the above form. trilinear relations the determinant method of deriving the fundamental matrix can be used to derive relationships between the coordinates of points seen in three views. this analysis results in a formula for the trifocal tensor. unlike the fundamental matrix the trifocal tensor relates both lines and points in the three images. we begin by describing the relationships for corresponding points. trifocal point relations consider a point correspondence across three views x let the third camera matrix be c and let ci be its i-th row. analogous to we can write an equation describing the projection of a point x into the three images as a x b c x k k k this matrix which as before we will call x has rows and columns. from the existence of a solution to this set of equations we deduce that its rank must be at most hence any minor has zero determinant. this fact gives rise to the trilinear relationships that hold between the coordinates of the points x there are essentially two different types of minors of x. in choosing rows of x we may choose either and three rows from each of two camera matrices and one row from the third or three rows from one camera matrix and two rows from each of the two others. let us consider the first type. a typical such minor of x is of the form expanding note that this matrix contains only one entry in the last column namely x the determinant by cofactors down this last column reveals that the determinant is equal to a x b ci x det x a x b trilinear relations this just leads to the bilinear relationship expressed by the apart from the factor x fundamental matrix as discussed in section the other sort of minor is of more interest. an example of such a determinant is of the form det x x a x bj bl ck cm x x by the same sort of argument as with the bilinear relations it is seen that setting the determinant to zero leads to a trilinear relation of the form f by expanding this determinant down the column containing xi we can find a specific formula as follows. am bq cr al where u and v are free indices corresponding to the rows omitted from the matrices b and c to produce we introduce the tensor det xuv xix det al am bq cr t qr i det the trilinear relationship may then be written qr xix i i the tensor t qr is the trifocal tensor and is a trilinear relation such as those discussed in section the indices u and v are free indices and each choice of u and v leads to a different trilinear relation. just as in the case of the fundamental matrix one may write the formula for the tensor t qr in a slightly different way i t qr i det ai bq cr as in section the expression ai means the matrix a with row i omitted. note that we omit row i from the first camera matrix but include rows q and r from the other two camera matrices. in the often-considered case where the first camera matrix a has the canonical form the expression for the trifocal tensor may be written simply as t qr i bq i cr bq i n-linearities and multiple view tensors note that there are in fact possible trilinear relations that may be formed in this way to specifically note that each relation arises from taking all three rows from one camera matrix along with two rows from each of the other two matrices. this gives the following computation. ways to choose the first camera matrix from which to take all three rows. ways to choose the row to omit from the second camera matrix. ways to choose the row to omit from the third camera matrix. this gives a total of trilinear relations. however among the ways of choosing two rows from the second and third camera matrices only are linearly independent return to this in section this means that there are a total of linearly independent trilinear relations. it is important to distinguish between the number of trilinear relations however and the number of different trifocal tensors. as is shown by several different trilinear relations may be expressed in terms of just one trifocal tensor. in each distinct choice of the free indices u and v gives rise to a different trilinear relation all of which are expressible in terms of the same trifocal tensor t qr on the other hand in the definition of the trifocal tensor given in the camera matrix a is treated differently from the other two in that a contributes two rows omitting row i to the determinant defining any given entry of t qr whereas the other two camera matrices contribute just one row. this means that there are in fact three different trifocal tensors corresponding to the choice of which of the three camera matrices contributes two rows. i i trifocal line relations a line in an image is represented by a covariant vector li and the condition for a point x to lie on the line is that lixi let xj represent a point x in space and ai j represent a camera matrix a. the point xj is mapped to the image point as xi ai j xj. it follows that the condition for the point xj to project to a point on the line li is that j represents a plane consisting of liai all points that project onto the line li. j xj another way of looking at this is that liai consider the situation where a point xj maps to a point xi in one image and to some q and l r in two other images. this may be expressed by equations point on lines l xi kai j xj qbq l j xj r cr l j xj these may be written as a single matrix equation of the form a x bq l q cr l r x k since this set of equations has a solution it follows that det x where x is the matrix on the left of the equation. expanding this determinant down the last column gives det x xiilm det trilinear relations al am bq l q cr l r al am bq cr ql r det xil t qr ql r i xil this shows the connection of the trifocal tensor with sets of lines. the two lines l q and l r back-project to planes meeting in a line in space. the image of this line in the first image is a line which may be represented by li. for any point xi on that line the relation holds. it follows that l is the representation of the line li. thus we see that for three corresponding lines in the three images t qr ql r i ql r t qr p lp l where of course the two sides are equal only up to a scale factor. since the two sides of the relation are vectors this may be interpreted as meaning that the vector product of the two sides vanishes. expressing this vector product using the tensor we arrive at an equation r qr ql i lpl in an analogous manner to the derivation of and we may derive a relationship between corresponding points in two images and a line in a third image. in the first two images in particular if a point xj in space maps to points xi and x and to some point on a line l r in the third image then the relation is r qr xix i in this relation the index u is free and there is one such relation for each choice of u of which two are linearly independent. we summarize the results of this section in table where the final column denotes the number of linearly independent equations. correspondence three points two points one line one point two lines xix i relation xix qr r qr rt qr xil ql r qr i i i ql number of equations three lines lpl table trilinear relations also table note how the different equation sets are related to each other. for instance the r and second line of the table is derived from the first by replacing x deleting the free index v. by the line l n-linearities and multiple view tensors relations between two views and the trifocal tensor and x and x qr to this point we have considered correspondences across three views and the trifocal tensor. here we describe the constraints that arise if the correspondence is only across two views. from the two view case where point correspondences constrain the fundamental matrix we would expect some constraint on t in the second and third images. consider the case of corresponding points x the point this means that there is a point x in space mapping to the points x x also maps to some point xi in the first image but xi is not known. nevertheless there exists a relationship xix i between these points. for each choice of u and v denote aiuv x the entries of aiuv are linear expressions in the entries of t qr that may be determined explicitly in terms of the known points x there exists a point x such that xiaiuv for each choice of u v we may and x consider aiuv as being a indexed by i and for the different choices of u and v there are linearly independent such expressions. thus a may be considered as a matrix and the condition that xiaiuv means that aiuv has rank this means that every subdeterminant of a is zero which leads to cubic constraints on the elements of the trifocal tensor. for geometric reasons it appears that the equations xiaiuv are not algebraically independent for the four choices of u and v. consequently we obtain a single cubic constraint on t jk from a two-view point correspondence. details are left to the reader. qr i i i in the case where the point correspondence is between the first and second third views the analysis is slightly different. however the result in each case is that although a point correspondence across two views leads to a constraint on the trifocal tensor this constraint is not a linear constraint as it is in the case of correspondences across three views. affine trifocal tensor is zero. this is the case for elements t in the case where all three cameras are affine the trifocal tensor satisfies certain constraints. a camera matrix is affine if the last row is it follows that if two of the rows in the matrix in are of this form then the corresponding element of t jk a total of i elements. thus the trifocal tensor contains non-zero entries defined up to scale. as in the case of the affine fundamental matrix this analysis is equally valid for the case of cameras sharing the same principal plane. and t quadrilinear relations similar arguments work in the case of four views. once more consider a point correspondence across views x with camera matrices a b c and d quadrilinear relations the projection equations may be written as a x b c d x k k k k since this equation has a solution the matrix x on the left has rank at most and so all determinants are zero. as in the trilinear case any determinant containing only one row from one of the camera matrices gives rise to a trilinear or bilinear relation between the remaining views. a different case occurs when we consider determinants containing two rows from each of the camera matrices. such a determinant leads to a new quadrilinear relationship of the form xix where each choice of the free variables w x y and z gives a different equation and the quadrifocal tensor qpqrs is defined by qpqrs det ap bq cr ds note that the four indices of the four-view tensor are contravariant and there is no distinguished view as there is in the case of the trifocal tensor. there is only one four-view tensor corresponding to four given views and this one tensor gives rise to different quadrilinear relationships of which are linearly independent section as in the case of the trifocal tensor there are also relations between lines and points in the case of the four-view tensor. equations relating points are really just special cases of the relationship for lines. in the case of a correspondence however something different happens as will now be explained. the relationship between a set of four lines and the quadrifocal tensor is given by the formula lpl ql r l for any set of corresponding lines lp l s however the derivation shows that q l this condition will hold as long as there is a single point in space that projects onto the four image lines. it is not necessary that the four image lines correspond the sense that they are the image of a common line in space. this configuration is illustrated in figure s qpqrs r and l now consider the case where three of the lines instance l s correspond by deriving from a single line now let lp be any arbitrary line in the first image. the back-projection of this line is a plane which will meet the line in a single point x and the conditions are present for to hold. since this is true for any arbitrary line lp it must follow that l s qpqrs this gives three linearly ql independent equations involving l r and l s however given a set of corresponding r and l q l q l r l n-linearities and multiple view tensors l l c c l c l l c l x l x l c a c b c c fig. four line correspondence the four lines l satisfy the quadrilinear relation since their back-projections intersect in a common point x. no three planes intersect in a common line. the three lines are the image of the same line l in lines in four images as above we may choose a subset of three lines and for each linetriplet obtain three equations in this way. since there are four choices of line-triplets the total number of equations is thus however only of these equations are independent and this may be seen as follows. suppose that l this is equivalent to the general situation since by applying projective transformations to each of the four images we can form an arbitrary line correspondence to this case. now the equation l s qpqrs means that any element applying this argument to all four triplets of three views we find that qpqrs whenever at least three of the indices are there are a total of such elements. since the set of equations generated by the line correspondence is equivalent to setting each of these elements to zero among the total of equations there are just independent ones. ql r l the four-view relations are summarized in table no equation is given here for the case of three lines and one point since this gives no more restrictions on the tensor than just the three-line correspondence. intersections of four planes relation number of equations correspondence four points three points one line two points two lines xix xix xix s r l s three lines four lines ql lpl ql r qpqrs lpl r qpqrs ql s qpqrs lpl table quadrilinear relations. intersections of four planes the multi-view tensors may be given a different derivation which sheds a little more light on their meaning. in this interpretation the basic geometric property is the intersection of four planes. four planes in space will generally not meet in a common point. a necessary and sufficient condition for them to do so is that the determinant of the matrix formed from the vectors representing the planes should vanish. in this section only we shall represent the determinant of a matrix notation. with rows a b c and d by a b c d. in a more general context the symbol represents the meet intersection operator in the double algebra literature section of this chapter. however for the present purposes the reader need only consider it as a shorthand for the determinant. we start with the quadrifocal tensor for which the derivation is easiest. consider four lines l in images formed from four cameras with camera matrices a b c and d. the back projection of a line l through camera a is written as the plane liai with notation as in the condition that these four planes are coincident may be written as and q bq r cr s ds however since the determinant is linear in each row this may be written as lpl ql s bq cr ds def lpl ql r l r l s qpqrs. this corresponds to the definition and line relation for the quadrifocal tensor. the basic geometric property is the intersection of the four planes in space. tensor derivation. l trifocal consider now a point line line relationship xi l p and q be two lines in the first image that pass j through the image point x. the planes back-projected from the four lines meet in a point figure so we can write k for three views and let r am bq cr ql l ml n-linearities and multiple view tensors l x c l c l c fig. a point line line correspondence x involving three images may be interpreted as follows. two arbitrary lines are chosen to pass through the point x in the first image. the four lines then back-project to planes that meet in a point in space. al am bq cr the next step is an algebraic trick to multiply this equation by the this is a scalar value fact equal to the number of permutations of the result after regrouping is l milm l ql r l milm is simply the cross-product of the two lines ll and lm in now the expression other words their intersection point xi. thus finally we can write ql r am bq cr xil def xil ql r t qr i which are the definition and basic incidence relation for the trifocal tensor. fundamental matrix. we can derive the fundamental matrix in the same manner. given a correspondence x q passing through x and the back-projected planes all meet in a point so we r and l l write s passing through select pairs of lines p and r l s aq br bs p q l multiplying by and proceeding as before leads to the coplanarity constraint xix aq br bs def xix which can be compared with counting arguments in this section we specify the number of points or lines required to carry out reconstruction from several views. this analysis is related to counting the number of degrees of freedom of the associated tensors. however in doing this it is necessary to distinguish between the number of degrees of freedom of the tensor viewed as an unconstrained counting arguments algebraic object and the number of degrees of freedom that arises from a configuration of cameras and their camera matrices. for instance consider the fundamental matrix. at one level the fundamental matrix may be considered as a homogeneous matrix and hence has degrees of freedom minus for the indeterminate scale. on the other hand the fundamental matrix arising from a pair of camera matrices according to must satisfy the additional constraint det f hence such a fundamental matrix has just degrees of freedom. since the camera matrices may be determined up to a projectivity from the fundamental matrix vice versa we may count the number of degrees of freedom of a fundamental matrix by counting the degrees of freedom of the camera matrices. two camera matrices have a total of degrees of freedom homogeneous matrices. a homography is represented by a homogeneous matrix and so has degrees of freedom. this gives a total of degrees of freedom for the configuration of the two cameras modulo a projective transformation. this agrees with the degrees of freedom of the fundamental matrix providing a check on the previous calculation. similarly the trifocal tensor encodes the projective structure of three camera matrices and hence has degrees of freedom. in the same way the quadrifocal tensor has degrees of freedom. generally for m cameras we have dof since the trifocal and quadrifocal tensors considered just as homogeneous algebraic arrays have and degrees of freedom respectively they must satisfy an additional set of constraints dictated by the camera geometry constraints for the trifocal tensor and constraints for the quadrifocal tensor. in computing geometric structure we may use linear algebraic methods based on estimating the multifocal tensor by solving the constraints from the multi-linearities. the number of correspondences required is determined from the number of equations generated by each point or line correspondence. this linear method takes no account of the constraints imposed on the tensors by their geometry. on the other hand the number of correspondences required may be determined by counting the number of geometric constraints given by each correspondence and comparing with the total number of degrees of freedom of the system. consider a configuration of n points in m views. the total number of degrees of freedom of this system is since each of the n points has degrees of freedom. to estimate the projective structure the available data are the images of the n points in m images a total of measurements point having two coordinates. thus for reconstruction to be possible we require or thus the required number of points is n m one may also think of this by observing that each point correspondence contributes n-linearities and multiple view tensors views tensor elems dof linear points lines non-linear points lines f t q table projective degrees of freedom and constraints. the linear column indicates the minimum number of correspondences across all views required to solve linearly for the tensor to scale. the non-linear is the minimum number of correspondences required. a star indicates multiple solutions and a question-mark indicates that no practical reconstruction method is known. constraints on the cameras that is for the coordinates of the points in each view less for the added degree of freedom of the point. an analogous argument applies for line correspondences. a line has four degrees of freedom in and its image line is described by degrees of freedom so that each line correspondence provides constraints and the number of lines l required is l in either of these cases if the number of constraints is equal to the number of degrees of freedom of the cameras and points or lines configuration then we can in general expect multiple solutions except in the linear case. however if there are more equations than unknowns the system is over-determined and in the generic case there will exist a single solution. table summarizes the number of correspondences required for reconstruction. a star indicates that multiple solutions are expected. for the case of non-linear solutions actual methods of solution are not always known other than by brute-force generation and solution of a set of simultaneous polynomial equations. situations where no simple method is known are marked with a question-mark. note that not much is known about non-linear solutions for lines. specific non-linear algorithms are points in views see section three solutions are possible. points in views see section three solutions are possible. this is the dual chapter of the previous problem. points in views. solve using points in views then use the camera resection dlt algorithm to find the fourth view and eliminate all but one solution. however unlike the previous two cases the case of points in views is overdetermined and this solution is only valid for perfect data. the estimation for noisy data is discussed in chapter counting arguments views tensor non-zero elements dof linear points lines non-linear points lines fa ta qa table affine degrees of freedom and constraints. the camera for each view is affine. see caption of table for details. affine cameras for affine cameras the reconstruction problem requires fewer correspondences. the plane at infinity may be identified in a reconstruction being the principal plane of all of the cameras and the reconstruction ambiguity is affine not projective. the number of degrees of freedom for m affine cameras is dof each view adds degrees of freedom for the new affine camera matrix and we subtract for the degrees of freedom of a affine transformation. as in the projective case a point correspondence imposes constraints and a line correspondence constraints. as before the number of required points may be computed as i.e. n for lines the result is l m as for linear methods the number of elements in the tensor is in the affine case the tensor is as always only defined up to scale but additionally many of the elements are zero as seen in section and section this cuts down on the required number of correspondences. counting results are given in table note that for point correspondences the linear algorithms apply with the minimum number of correspondences given by the above equation. hence the non-linear algorithms are the same as the linear ones. knowing four coplanar points plane plus parallax the previous counting arguments were for the case of points and lines in general position. here we consider the important case that four or more of the points are coplanar. it will be see that the computation of the tensors and consequently projective structure is significantly simplified. this discussion is given in terms of knowing n-linearities and multiple view tensors views tensor dof points points constraints lines lines constraints f t q table number of additional correspondences required to compute projective structure given homographies between the views induced by a plane. the homographies may be computed from four or more point matches derived from coplanar points or by any other means. points used to compute the homographies are not counted in this table. four coplanar points in the images. however all that is really important here is that inter-image homographies induced by a plane should be known. computation of the fundamental matrix knowing four coplanar points was considered in section algorithm and for the trifocal tensor in section now we consider the four-view case. from the correspondence of more points derived from points in a plane we can compute the homographies from the first view to the second third and fourth views respectively induced by the plane. in a projective reconstruction we choose the plane containing the points as the plane at infinity in which case are the infinite homographies. assuming further that the first image is at the origin the four camera matrices may now be written as and and a b d may be determined only up to a common scale. c the vectors since the left hand blocks of the camera matrices are now known it is easily seen from that the entries of qpqrs are linear in the remaining entries and of the camera matrices. using we can write down an expression for the entries of qpqrs in terms of the entries of in fact we may write this explicitly as q mt where m is an matrix and q and t are vectors representing the entries of q and thus the quadrifocal tensor may be linearly parametrized in terms of homogeneous coordinates and hence has degrees of freedom. and now given a set of equations eq derived from correspondences as in table they may be rewritten in terms of the minimal parameter set t by substituting q mt arriving at emt this allows a linear solution for t and hence the camera matrices and desired the tensor q mt. note the important advantage here that the tensor so obtained automatically corresponds to a set of camera matrices and so satisfies all geometric constraints the troublesome constraints that must be satisfied by the quadrifocal tensor disappear into thin air. the above analysis was for the computation of the quadrifocal tensor but it applies equally well to the fundamental matrix and trifocal tensor as well. counting arguments counting argument. we return to the general case of m views and consider the situation from a geometric point of view. the number of degrees of freedom parametrizing the tensor is equal to the number of geometric degrees of freedom remaining in the camera matrices namely where m is the number of views. this arises from for the last column of each camera matrix apart from the first less one for the common scaling. counting the number of constraints imposed by a point or a line correspondence is a little tricky however and shows that one must always be careful with counting arguments not to neglect hidden dependencies. first consider a line correspondence l across three views the argument will hold in general for m views. the question to be resolved is just how much information can be derived from the measurement of the image lines. surprisingly knowledge of the plane homographies between the images reduces the amount of information that a line correspondence provides. for simplicity of argument we may assume that planar homographies have been applied to the images so that the four coplanar reference points map to the same point in each image. as a result any further point in the reference plane will map to the same point in each image. now the line l from which the line correspondence is derived must meet the reference plane in a point x. since it lies on the reference plane x projects to the same point x in all images and x must lie on all three image lines l thus corresponding lines in the three views cannot be arbitrary they must all pass through a common image point. in the general case the number of degrees of freedom of the measurements of the lines in m views is m to specify the point x requires degrees of freedom and each line through the point then has one remaining degree of freedom orientation. subtracting for the four added degrees of freedom of the line in space we see each line correspondence across m views generates m constraints on the remaining degrees of freedom of the cameras. note how the condition that the image lines must meet in a point restricts the number of equations generated by the line correspondence. without observing this condition one would expect constraints from each line. however with perfect data the set of equations will have rank only m with noisy data the image lines will not be exactly coincident and the system may have full rank but this will be entirely due to noise and the smallest singular values of the system will be essentially random. one should however include all available equations in solving the system since this will diminish the noise effects. for point correspondences the argument is similar. the line through any two image points is the image of a line in space. the projections of this line are constrained as discussed in the preceding discussion and this imposes constraints on the matching points. the measurements have degrees of freedom for the intersection point of the line with the plane and in each view one for the line orientation and two corresponding to the position of each of the two points on the line. subtracting for the degrees of freedom of the two points in the result is n-linearities and multiple view tensors two point correspondences across m views generate constraints on the remaining degrees of freedom of the cameras. since this is the same as the number of degrees of freedom of the cameras points are sufficient to compute structure. since the number of geometric constraints on the cameras is the same as the number of degrees of freedom of the tensor there is no distinction between constraints on the tensor and constraints on the geometry. thus point and line correspondences may be used to generate linear constraints on the tensor. there is no need for non-linear methods. the number of required correspondences is summarized in table number of independent equations it was asserted in table that each four-view point correspondence gives rise to linearly independent equations in the entries of the quadrifocal tensor. we now examine this point more closely. given sufficiently many point matches across four views one may solve for the tensor qpqrs. once q is known it is possible to solve for the camera matrices and hence compute projective structure. this was shown in but is not discussed further in this book. a curious phenomenon occurs however when one counts the number of point matches necessary to do this. as indicated above it appears to be the case that each point match gives linearly independent equations in the entries of the tensor qpqrs and it seems unlikely that the equations derived from two totally unrelated sets of point correspondences could have any dependencies. it would therefore appear that from five point correspondences one obtains equations which is enough to solve for the entries of qpqrs up to scale. from this argument it would seem that it is possible to solve for the tensor from only five point matches across four views and thence one may solve for the camera matrices up to the usual projective ambiguity. this conclusion however is contradicted by the following remark. it is not possible to determine the positions of four any number of cameras from the images of five points. this follows from the counting arguments of section obviously there is some error in our counting of equations. the truth is contained in the following. result the full set of linear equations derived from a single point correspondence x across four views contains independent constraints on qpqrs. furthermore let the equations be written as aq where a is an matrix and q is a vector containing the entries of qpqrs. then the non-zero singular values of a are all equal. what this result is saying is that indeed as expected one obtains linearly independent equations from one point correspondence and in fact it is possible to reduce this set of equations by an orthogonal transformation of the equation matrix a on the left by an orthogonal matrix u to a set of orthogonal equations. the proof number of independent equations is postponed until the end of this section. the surprising fact however is that the equation sets corresponding to two unrelated point correspondences have a dependency as stated in the following result. result the set of equations derived from a set of n general point correspondences across four views has rank nn the notation thus for points there are only independent equations not enough to solve for qpqrs. for n points and we have enough equations to solve for the entries of qpqrs. means the number of choices of among n specifically for n we now prove the two results above. the key point in the proof of result con cerns the singular values of a skew-symmetric matrix result result a skew-symmetric matrix has two equal non-zero singular values. the rest of the proof of result is quite straightforward as long as one does not get lost in notation. proof. the full set of equations derived from a single point a total of equations dence is of the form xiipwx are generated by varying w x y z over the range thus the equation matrix a may be written as awxyzpqrs xiipwx where the indices index the row and index the column of a. we will consider a set of indices such as in this case as a single index for the row or column of a matrix. this situation will be indicated by enclosing the indices in parentheses as here and referring to them as a combined index. we consider now the expression xiipw. this may be considered as a matrix indexed by the free indices p and w. furthermore since xiipw xiiwp we see that it is a skew-symmetric matrix and hence has equal singular values. we denote this matrix by swp. writing result using tensor notation we have uw a swpvp e kdae where the diagonal matrix d is as in result the matrix a in may be written as awxyzpqrs zs. consequently applying we may write dcgddh. yr xq awxyzpqrsvp e h kk k k v f c d g uw a b now writing uwxyz uw a and k kk k k b c d vpqrs gh vp e v f g h dabcdef gh daedbf dcgddh we see that may be written as uwxyz awxyzpqrs vpqrs gh k dabcdef gh. as a matrix dabcdef gh is diagonal with non-zero diagonal entries all equal to n-linearities and multiple view tensors unity. to show that is the svd of the matrix awxyzpqrs and hence to complete the proof it remains only to show that uwxyz gh are orthogonal matrices. it is necessary only to show that the columns are orthonormal. this is straightforward and is left as an exercise. and vpqrs y x y x and yi y proof. we consider two point correspondences across four views namely xi x these give rise to two sets of equations axq and ayq of the form each of these matrices has rank and if the rows of ax are independent of the rows of ay then the rank of the combined set of equations is however if there is a linear dependence between the rows of ax and those of ay then their combined rank is at most we define a vector sx with combined index by spqrs sy is similarly defined. we will demonstrate that st y ax st rows of ax and ay are linearly dependent. expanding st a vector xpx x ay which means that the y ax gives x y st ax y ax swxyz st x ay. y and this demonstrates that the rows of ax and ay are dependent and their combined rank is at most we now consider the possibility that the combined rank is less than in such a case all subdeterminants of the matrix aytt must vanish. these subdeterminants may be expressed as polynomial expressions in the coefficients of the points x these coefficients together generate a space. thus there is a function f irn for some n to the number of such subdeterminants such that the equation matrix has rank less than only on the set of zeros of the function f. any arbitrarily chosen example may be used to show that the function f is not identically zero. it follows that the set of point correspondences for which the set of equations has rank less than is a variety in and hence is nowhere dense. thus the set of equations generated by a general pair of point correspondences across four views has rank we now turn to the general case of n point correspondences across all four views. note that the linear relationship that holds for two point correspondences is non-generic but depends on the pair of correspondences. in general therefore given n point correspondences there will be such relationships. this reduces the dimension of the space spanned by the set of equations to as required. the three-view case. similar arguments hold in the three-view case. it can be proved in the same manner that the nine equations arising from a point match contain four independent equations. this is left to an exercise page choosing equations choosing equations in section a proof was given that the singular values of the full set of equations derived from four point equations are all equal. the proof may easily be adapted to the three-view case as well exercise page the key point in the argument is that the two non-zero singular values of a skew-symmetric matrix are equal. this proof may clearly be extended to apply to any of the other sets of equations derived from line or point correspondences given in sections and we consider still the four-view case. the results on singular values show that it is in general advisable to include all equations derived from this correspondence rather than selecting just independent equations. this will avoid difficulties with near singular situations. this conclusion is supported by experimental observation. indeed numerical examples show that the condition of a set of equations derived from several point correspondences is substantially better when all equations are included for each point correspondence. in this context the condition of the equation set is given by the ratio of the first to the n-th singular value where n is the number of linearly independent equations. including all equations rather than just means that the set of equations is larger leading to increased complexity of solution. this can be remedied as follows. the basis for the equality of the singular values is that swp xiipw and the other similarly defined terms are skew symmetric matrices and hence have equal singular values. the same effect can be achieved by any other matrix s with equal singular values. we require only that the columns of s should represent lines passing through the point x otherwise stated swpxw matrix s will have equal singular values if its columns are orthonormal. these conditions may be achieved with s being a matrix. if this is done for the point in each view the total number of equations will be reduced from to and the equations will be orthogonal. a convenient way of choosing s is to use a householder matrix section as shown below. this discussion also applies to the trifocal tensor allowing us to reduce the number of equations from to while retaining equal singular values. summarizing this discussion for the trifocal tensor case given a point correspondence x of the form across three views generate equations xi l qx l ry t qr i for x y are two lines through where l and l similarly l qx and l ry. a convenient way to find l ry is as follows. qx and x ry such that x qx and h find householder matrices h represented by orthonormal vectors ry for x y set l qx h qx and l ry h ry. it is evident that essentially this method will work for all the types of equations summarized in table and table n-linearities and multiple view tensors ql r this chapter suggests that the most basic relations are the point line line correspont qr dence equation xil i in the three-view case and the line-correspondence equation lpl s qpqrs for four views. indeed numerical robustness may be enhanced by reducing other correspondences to this type of correspondence for carefully selected lines. ql r l closure the literature although using a slightly different approach this chapter summarizes previous results of and faugeras and mourrain on the derivation of multilinear relationships between corresponding image coordinates. the formulae for relations between mixed point and line correspondences are extensions of the results of the enumeration of the complete set of multilinear relations given in table and table formulae for the multifocal tensors and the analysis of the number of independent equations derived from point correspondences are adapted from a similar analysis of the multifocal tensors has also appeared in the quadrifocal tensor was probably first discovered by the quadrilinear constraints and their associated tensor have been described in several papers the double grassmann cayley algebra was introduced into the computer vision literature in see also for further applications. an algorithm for computing the quadrifocal tensor and an algorithm for reconstructing it based on the reduced tensor was given in a later paper refined this algorithm. notes and exercises determine the properties of the affine quadrifocal tensor i.e. the quadrifocal tensor computed from affine camera matrices. in particular using the determinant definition of the tensor verify the number of non-zero elements given in table show that the linear equations derived from a single point correspondence x across three views contains linearly independent equations. furthermore let the equations be written as at where a is a matrix. then the non-zero singular values of a are equal. unlike the four-view case the equations resulting from different point matches are linearly independent so n point matches produce independent equations. if a canonical affine basis is chosen for the image coordinates such that three corresponding points have coordinates in each view then the resulting tensors have a simpler form. these reduced tensors have a greater number of zero elements than the general form of the tensors. for example in closure the case of the reduced fundamental matrix the diagonal elements are zero and the reduced trifocal tensor has only nonzero entries. also the tensors are specified by fewer parameters e.g. four in the case of the reduced fundamental matrix as effectively the basis points specify the other parameters. further details are given in show that if the four camera centres are coplanar then the quadrifocal tensor has geometric degrees of freedom. n computational methods this chapter describes computational methods for estimating a projective or affine reconstruction from a set of images in particular where the number of views is large. we start with the most general case which is that of bundle adjustment for a projective reconstruction. this is then specialized to affine cameras and the important factorization algorithm introduced. a generalization of this algorithm to non-rigid scenes is given. a second specialization of bundle adjustment is then described for the case of scenes containing planes. finally we discuss methods for obtaining point correspondences throughout an image sequence and a projective reconstruction from these correspondences. projective reconstruction bundle adjustment consider a situation in which a set of points xj is viewed by a set of cameras with matrices pi. denote by xi j the coordinates of the j-th point as seen by the i-th camera. we wish to solve the following reconstruction problem given the set of image coordinates xi j find the set of camera matrices pi and the points xj such that pixj xi j. without further restriction on the pi or xj such a reconstruction is a projective reconstruction because the points xj may differ by an arbitrary projective transformation from the true reconstruction. bundle adjustment. if the image measurements are noisy then the equations xi j pixj will not be satisfied exactly. in this case we seek the maximum likelihood solution assuming that the measurement noise is gaussian we wish to estimate projection matrices pi and points which project exactly to image points j and also minimize the image distance between the reprojected point j for every view in which the point appears j as xi xi and detected image points xi i.e. ij min p i d xi where dx y is the geometric image distance between the homogeneous points x and y. this estimation involving minimizing the reprojection error is known as bundle adjustment it involves adjusting the bundle of rays between each camera centre and projective reconstruction bundle adjustment the set of points equivalently between each point and the set of camera centres. bundle adjustment should generally be used as a final step of any reconstruction algorithm. this method has the advantages of being tolerant of missing data while providing a true ml estimate. at the same time it allows assignment of individual covariances more general pdfs to each measurement and may also be extended to include estimates of priors and constraints on camera parameters or point positions. in short it would seem to be an ideal algorithm except for the fact that it requires a good initialization to be provided and it can become an extremely large minimization problem because of the number of parameters involved. we will discuss briefly these two points. iterative minimization. since each camera has degrees of freedom and each point degrees of freedom a reconstruction involving n points over m views requires minimization over parameters. in fact since entities are often overparametrized using parameters for the homogeneous p matrix this may be a lower bound. if the levenberg marquardt algorithm is used to minimize then matrices of dimension must be factored sometimes inverted. as m and n increase this becomes extremely costly and eventually impossible. there are several solutions to this problem reduce n andor m. do not include all the views or all the points and fill these in later by resectioning or triangulation respectively or partition the data into several sets bundle adjust each set separately and then merge. such strategies are discussed further in section interleave. alternate minimizing reprojection error by varying the cameras with minimizing reprojection error by varying the points. since each point is estimated independently given fixed cameras and similarly each camera is estimated independently from fixed points the largest matrix that must be inverted is the matrix used to estimate one camera. interleaving minimizes the same cost function as bundle adjustment so the same solution should be obtained there is a unique minimum but it may take longer to converge. interleaving is compared with bundle adjustment in sparse methods. these are described in appendix initial solution. several methods for initialization are described in the following sections. if the problem is restricted to affine cameras then factorization gives a closed form optimal solution provided points are imaged in every view. even with projective cameras there is an factorization method available provided points are imaged in every view. if there is more information available on the data for example that it is partly coplanar then again a closed form solution is possible finally hierarchical methods can be used as described in section for the case where points are not visible in every view. n-view computational methods affine reconstruction the factorization algorithm in this section we describe reconstruction from a set of image point correspondences for images acquired by affine cameras. as described in section the reconstruction in this case is affine. the factorization algorithm of tomasi and kanade to be presented be low and summarized in algorithm has the following property under an assumption of isotropic mean-zero gaussian noise independent and equal for each measured point factorization achieves a maximum likelihood affine reconstruction. this fact was first pointed out by reid and murray however the method requires a measurement of each point in all views. this is a limitation in practice since matched points may be absent in some views. an affine camera may be characterized by having its last row equal to in this section however we will denote it somewhat differently separating out the translation and the pure linear transformation part of the camera map. thus we write x y m t x y z where m is a matrix and t a from here on for ease of readability x represents an inhomogeneous image point x yt and x an inhomogeneous world point x y zt. our goal is to find a reconstruction to minimize geometric error in image coordinate measurements. that is we wish to estimate cameras ti and points such that the distance between the estimated image points xi j mixj ti and measured image points xi j is minimized j xi j min mitixj ij min mitixj ij j ti as is common in such minimization problems the translation vector ti can be eliminated in advance by choosing the centroid of the points as the origin of the coordinate system. this is a consequence of the geometric fact that an affine camera maps the centroid of a set of points to the centroid of their projections. thus if the coordinate origin is chosen as the centroid of the points and of each set of image points then it follows that ti this step requires that the same n points be imaged in all views i.e. that there are no views in which the image coordinates of any point are unknown. an analytical derivation of this result goes like this. the minimization with respect to ti requires that j kj ti tk which after a brief calculation reduces to ti m where the centroids are affine reconstruction the factorization algorithm objective given n image point correspondences over m views xi j j n i m determine affine camera matrices ti and points such that the reprojection error j ti is minimized over ti xj with mi a matrix xj a and xi ti are j j yi jt and ij algorithm computation of translations. each translation ti is computed as the centroid of points in image i namely centre the data. centre the points in each image by expressing their coordinates with respect to the centroid j ti n xi j. j xi xi j henceforth work with these centred coordinates. construct the n measurement matrix w from the centred data as defined then the matrices mi are obtained from the first three columns of u multiplied by the in and compute its svd w udvt. singular values mm the vectors ti are as computed in step and the structure is read from the first three columns of v xn algorithm the factorization algorithm to determine the mle for an affine reconstruction from n image correspondences over m views gaussian image noise. chosen to coincide with the centroid in which case and j and xj. the origin of the frame is arbitrary so may be xi n n j j ti it follows that if we measure the image coordinates with respect to a coordinate origin based at the centroid of the projected points then ti thus we replace each henceforth we will assume that this has been done and work with xi j by xi the centred coordinates. with respect to these new coordinates ti and so reduces to j j min mixj ij xi j j mixj min mixj ij n-view computational methods the minimization problem now has a very simple form when written as a matrix. the measurement matrix w is the n matrix composed of the centred coordinates of the measured image points since each xi j mixj the complete set of equations may be written as xm n n xm n w xn w mm xm in the presence of noise this equation will not be satisfied exactly so instead we seek a matrix w as close as possible to w in frobenius norm such that w may be decomposed as w xm w n n xm n in this case it may be verified that wij wij xm f ij j mm ij xn j ij xi j mixj comparing this with we find that minimizing the required geometric error is equivalent to finding such a w as close as possible to w in frobenius norm. note that a matrix w satisfying is the product of a motion matrix m and a n structure matrix x consequently w m x has rank in other words we seek a rank matrix which is closest to w in frobenius norm. such a matrix may be determined by the svd of w truncated to rank in more detail if the svd of w udvt then w n is the rank matrix which is closest to w in the frobenius norm where consists of the first columns of u vt n consists of the first rows of vt and is the diagonal matrix containing the first singular values diag note that the choice of m and x is not unique. for example m may be chosen as n since in either case n or as m x m and x vt w m x n. affine ambiguity. in fact for any such choice there is an additional ambiguity since an arbitrary rank matrix a may be inserted in the decomposition as w maa x maa x. this means that the camera matrices mi which are obtained from m and affine reconstruction the factorization algorithm the points xj which are obtained from x are determined up to multiplication by a common matrix a. in other words the mle reconstruction is affine. this affine reconstruction may be upgraded to a metric reconstruction by supplying metric information on the scene as described in section or by using autocalibration methods as described in chapter or a combination of the two. note that in the case of affine cameras only three internal parameters need be specified to five for projective cameras and the auto-calibration task is correspondingly simpler. affine multiple view tensors the factorization algorithm provides an optimal method for computing the affine multiview tensors from image point correspondences. these tensors are the affine fundamental matrix affine trifocal tensor and affine quadrifocal tensor. in each case the algorithm determines the camera matrices up to an overall affine ambiguity. the tensors may then be computed directly from the camera matrices for instance in chapter the affine ambiguity of is irrelevant when computing the tensors since they are unaffected by affine transformations of in fact it is not necessary to compute the full svd of w since only the u part of the decomposition is required. if the number of points n is large compared with the number of views then very great savings can be made in the computation of the svd by not determining v table an alternative to using the svd is to use the eigenvalue decomposition of wwt since wwt in the case of three views of the trifocal tensor the matrix wwt has dimension only thus this approach can mean significant savings. however it is numerically inferior since forming wwt causes the condition number of the matrix to be squared the discussion of svd in since we need just the three largest eigenvectors that may not be such a problem in this case. however the savings of this approach will not be so great given an implementation of the svd that avoids computing v. the factorization method may be used to compute any of the multiple-view affine tensors. for the affine fundamental matrix however algorithm described in chapter is more direct. the results of both the methods are identical. triangulation and reprojection using subspaces the factorization algorithm also provides an optimal method for computing the images of new points or of points not observed in all views. again the affine ambiguity of is irrelevant. a column of w is the set of all corresponding image points for the point xj and is referred to as a point s trajectory. the rank decomposition of w as w m x shows that all trajectories lie in a dimensional subspace. in particular the trajectory all image projections of a new point x may be obtained as mx. this is simply a linear weighting of the three columns of m. suppose we have observed a new point x in some all views and wish to predict its projection in the other views. this is carried out in two steps first triangulation to find the pre-image x and then reprojection as mx to generate its image in n-view computational methods all views. note that the projected points will not coincide exactly with the measured points. in the triangulation step we wish to find the point x that minimizes reprojection error and this corresponds to finding the point in the linear subspace spanned by the columns of m closest to the trajectory. this closest point is found by projecting the trajectory onto the subspace a similar manner to algorithm in more detail suppose we have computed a set of affine cameras ti then the triangulation problem may be solved linearly for any number of views. the image points xi mix ti give a pair of linear equations mix xi ti in the entries of x. given sufficiently many such equations from known values of xi one can find the linear least-squares solution for x using algorithm the pseudoinverse result or algorithm note that if the data xi is centred using the same transformation applied in step of algorithm then the translation vectors ti in the affine triangulation method may be taken to be zero. in practice triangulation and reprojection provides a method of filling in points that are missed during tracking or multiple view matching. affine reconstruction by alternation suppose a set of image coordinates xi j are given as in algorithm and we wish to perform affine reconstruction. we have seen that affine triangulation may be carried out linearly. thus if the affine camera matrices represented by ti are known then the optimal point positions xj may be computed by a linear least-squares method such as the normal equations method of algorithm conversely if the points xj are known then the equations xi j mixj ti are linear in mi and ti. so it is once again possible simply to solve for ti by linear leastsquares. this suggests a method of affine reconstruction in which linear least-squares methods are used to solve alternately for the points xj and the cameras ti. this method of alternation is not to be recommended as a general method for reconstruction or for solving optimization problems in general. in the case of affine reconstruction however it can be proven to converge rapidly to the optimal solution starting from a random starting point. this method of affine reconstruction has the advantage of working with missing data or with covariance-weighted data which algorithm will not though in the missing data or covariance-weighted case global optimal convergence is not guaranteed in all cases. non-rigid factorization throughout the book it has been assumed that we are viewing a rigid scene and that only the relative motion between the camera and scene is to be modelled. in this section we relax this assumption and consider the problem of recovering a reconstruction for a deforming object. it will be shown that if the deformation is modelled as a linear combination over basis shapes then the reconstruction and the basis shapes may be recovered with a simple modification of the factorization algorithm of section an example where this type of situation arises is in a sequence of images of a per non-rigid factorization fig. shape basis. a face template is represented by n equally spaced points n the central face of the seven is the mean shape and the faces to the left or right are generated by adding or subtracting respectively the basis shape that accounts for the maximum variation in the training set. in this case the basis spans expressions from surprised to disgruntled. facial expressions are learnt by tracking the face of an actor with the template whilst he changes expression but does not vary his head pose. each frame of the training sequence generates a set of n points and the coordinates of these are rewritten as a a f matrix is then composed from these vectors where f is the number of training frames and the basis shapes are computed from the singular vectors of this matrix. figure courtesy of richard bowden. son s head which moves and also changes expression. the motion of the head may be modelled as a rigid rotation and the change of expression relative to the fixed head may be modelled as a linear combination over basis sets. for example the mouth outline may be represented by a set of points. suppose the set of n scene points xj may be represented as a linear combination of l basis shapes bk so that at a particular time i xi xi xi n bnk j and the basis points bjk are inhomogeneous points where here both the scene points xi represented by and bk is a n matrix. typically the number of basis shapes l is much smaller than the number of points n. the coefficients i k may be different at each time i and the resulting differing combination of basis shapes generates the deformation. an example is shown in figure in the forward model of image generation each view i is acquired by an affine camera and gives the image points xi j mi i k bjk ti. k it will again be assumed that image point matches are available for all views. our goal is to estimate cameras ti and structure i k bjk from the measured image points j such that the distance between the estimated image points xi k i k mi j bjk ti and measured image points is minimized xi bjk ti j j j i k min miti i kbjk ij min miti i kbjk ij k as in affine factorization the translation may be eliminated by centring the measured image points and it will be assumed from here on that this has been done. then the i k i k bk k n-view computational methods problem reduces to min mi i kbjk j ij xi j j ij k mi i k bjk min mi i kbjk k i k the complete set of equations xi j mi bjk may be written w bl bl l l m m l bl this rearrangement shows that the n matrix w may be decomposed as a product of a motion matrix m and n structure matrix b and consequently w has maximum rank l l mm mm m mm m m l mm m bl as in rigid factorization a rank decomposition may be obtained from the measurement matrix w by truncating the svd of w to rank also as in rigid factorization the decomposition w m b is not uniquely defined since an arbitrary rank matrix a may be inserted in the decomposition as w maa b maa b. in the rigid case this resulted in a straightforward affine ambiguity in the reconstruction. however in the non-rigid case there is the additional requirement that the motion matrix has the replicated block structure of and we return to this below. this block structure is not required for determining a point s image motion as will now be discussed. subspaces and tensors in the case of rigid factorization as discussed in section the trajectories lie in a dimensional subspace and any trajectory may be generated as a linear combination of the columns of m motion matrix. similarly in the case of non-rigid factorization the trajectories lie in a dimensional subspace and any trajectory may be generated as a linear combination of the columns of m motion matrix. suppose we observe a new point in a subset of the views how many images are required before its position can be predicted in all the other views? this is simply a question of triangulation in rigid factorization a point has degrees of freedom and must be observed in two views to obtain the necessary measurements. in non-rigid factorization we need to specify degrees of freedom number of rows in the b matrix and this requires images. for example if l the subspace is six dimensional columns of the b matrix are and given the image position in three views the image position in all views is then determined by an analogue of affine triangulation even though the object is deforming. independently moving objects. low-rank factorization methods also arise when there are independently moving objects in the scene. for instance suppose the scene is divided into two objects each moving independently of the other and viewed by non-rigid factorization a b fig. non-rigid motion sequence. top row alternate frames from a sequence in which a giraffe gracefully walks and flexes its neck whilst the camera pans to match its speed. bottom row point tracks showing the motion over the previous and the forthcoming frames. these tracks are computed using non-rigid factorization and lie in a six dimensional subspace. note the very different trajectories of the background from the foreground. yet these are all spanned by the six basis vectors of the motion matrix. the rank can be accounted for as follows the sequence motion is effectively that of two planes of points moving independently relative to the camera. the background is a rigid object represented by a plane and contributes to the rank. the giraffe in the foreground is represented as a non-rigid object by a set of l planar basis shapes and contributes to the rank. figures courtesy of andrew fitzgibbon and aeron morgan. a moving affine camera. in this case the columns of the measurement matrix corresponding to points on one object will have rank and those corresponding to the other object will also have rank the total rank of the measurement matrix will be in degenerate configurations in which one object s points all lie in a plane its contribution to the rank will be only this multibody factorization problem has been studied in some depth in an example of point tracks residing in a low dimensional subspace is shown in figure the existence of the analogue of the fundamental matrix and trifocal tensor depends on the dimension of the subspace. for example suppose the subspace has odd dimension l so it is dimensional then given point measurements in views views the corresponding point in any other view is constrained to a line the analogue of an epipolar line since there is one fewer measurement than degrees of freedom of the subspace. however if the dimension is even l so it is dimensional then given point measurements in views views the corresponding point in any other view is completely determined. multi-view tensors can be built for n-view computational methods the non-rigid l subspaces using methods similar to those developed in chapter for l points. recovering the camera motion in rigid-factorization the camera matrices are obtained relatively easily from the motion matrix m all that is required is to remove a global affine ambiguity specified by a matrix a as described on page in the non-rigid case the analogous problem is not so straightforward. it is a simple matter to obtain the motion matrix construct the n measurement matrix w from the centred data as defined in and compute its svd w udvt. then the motion matrix m is obtained from the first columns of u multiplied by the singular values as m but the matrix obtained by this route will not in general have the block structure of as in the case of rigid-factorization the motion matix is determined up to post-multiplication by a matrix a which here is the task is then to determine a such that ma has the required block structure of and also to remove the usual affine ambiguity such that each block conforms to any available constraints on the camera calibration example identical internal parameters over all views. various methods for determining a have been investigated but these do not impose the full block structure and currently there is not a satisfactory solution to this problem. once an initial solution has been obtained by some means then the correct form can be imposed by bundle adjustment of projective factorization the affine factorization method does not apply directly to projective reconstruction. it was observed in however that if one knows the projective depth of each of the points then the structure and camera parameters may be estimated by a simple factorization algorithm similar in style to the affine factorization algorithm. consider a set of image points xi j pixj. this equation representing the projective mapping is to be interpreted as true only up to a constant factor. writing these constant xi j pixj. in this equation and henceforth in the defactors explicitly we have i j scription of the projective factorization algorithm the notation xi j means the j representing an image point. thus the third coordinate is equal to unity j yi and xi j are the actual measured image coordinates. provided that each point is j and yi visible in every view so that xi j is known for all i j the complete set of equations may be written as a single matrix equation as follows xm m xm m n n m n n xm m n n pm xn projective factorization objective given a set of n image points seen in m views xi j i m j n compute a projective reconstruction. algorithm normalize the image data using isotropic scaling as in section start with an initial estimate of the projective depths i j. this may be obtained by techniques such as an initial projective reconstruction or else by setting all i j normalize the depths i j by multiplying rows and columns by constant factors. one method is to do a pass setting the norms of all rows to then a similar pass on columns. form the n measurement matrix on the left of find its nearest approximation using the svd and decompose to find the camera matrices and points. optional iteration. reproject the points into each image to obtain new estimates of the depths and repeat from step algorithm projective reconstruction through factorization. this equation is true only if the correct weighting factors i j are applied to each of the measured points xi j. for the present let us assume that these depths are known. as with the affine factorization algorithm we would like the matrix on the left denote it by w to have rank since it is the product of two matrices with columns and rows respectively. the actual measurement matrix can be corrected to have rank by using the svd. thus if w udvt all but the first four diagonal entries of d are set to zero resulting in d. the corrected measurement matrix is w u dvt. the camera matrices are retrieved from mt u d and the points from xn vt. note that this factorization is not unique and in fact we may interpose an arbitrary projective transformation h and its inverse between the two matrices on the right of reflecting the fact that reconstruction has a projective ambiguity. t pt the steps of the projective factorization method are summarized in algorithm choosing the depths the weighting factors i j are called the projective depths of the points. the justification of this terminology is the relation of these i j to the actual depths if camera matrices are known in a euclidean frame. refer to section and in particular figure the main difficulty with this projective factorization algorithm is that we need to know these projective depths up front but we do not have this knowledge. there are various techniques to estimate the depths. start with an initial projective reconstruction obtained by other means such as j by reprojecting the those discussed in section below. then compute i points. start with initial depths all equal to compute the reconstruction and reproject to obtain a new estimate of the depths. this step may be repeated to obtain n-view computational methods improved estimates. however there is no guarantee that the procedure will converge to a global minimum. the original paper gives a method of computing the depths by stringing together pairwise estimates of the depth obtained from the fundamental matrix or the trifocal tensor. this method is quite similar to obtaining an initial projective reconstruction by stringing together triples of images section whilst ensuring that the scale factors are consistent for a common projective reconstruction. ij i j xi j what is being minimized? in the case of noise or incorrect values for i j the equations are not satisfied exactly. we determine a corrected measurement matrix w that is closest to w in frobenius norm subject to having rank denoting the entries of this matrix as i j then the computed solution minimizes the expression jxi j i because of the last term at a minimum i j. assuming they are is the geomet xi xi equal reduces to ric distance between the measured and estimated points what is being minimized is a weighted sum-of-squares geometric distance where each point is being weighted by j are close to equal then the factorization method j. if all the geometric depths i i minimizes an approximation to geometric distance scaled by the common value of i j. j must be close to i noting that i j xi i jyi j i j xi i j yi j ij i j i j ij i j xi j j j normalizing the depths projective depths as defined here are not unique. indeed suppose that i j we replace pi by ipi and xj by jxj then we find that xi j pixj. if i j i jxi j ipi jxj in other words the projective depths i j may be replaced by multiplying the i-th row of by a factor i and the j-th column by a factor j. in the light of the previous paragraph the closer all i j are to unity the more exactly the error expression represents geometric distance. therefore it is advantageous to renormalize the values of the i j so that they are as close to unity as possible by multiplying rows and columns of the measurement matrix by constant values i and j. a simple heuristic manner of doing this is to multiply each row by a factor i so that it has unit norm followed by a similar pass normalizing the columns. the row and column passes may be iterated. normalizing the image coordinates as with most numerical algorithms involving homogeneous representations of image coordinates described in this book it is important to normalize the image coordinates. a reasonable scheme is the isotropic normalization method described in section one can see the necessity of normalization quite clearly in this case. consider two image points x and x obviously these points projective reconstruction using planes are very far apart in a geometric sense. however the error expression measures not geometric error but the distance between homogeneous vectors x choosing and the error is which is proportionally quite small. on the other hand the distance between points x and x which are much closer geometrically can not be made so small by choice of and for small values. the reader may observe that if the points are scaled down by a factor of then this anomalous situation no longer occurs. in short with normalized coordinates the error is a closer approximation to geometric error. jxi j yi when is the assumption i j reasonable? if camera matrices are normalized such that according to result and points are normalized to have last coordinate t then j pixj are the true depths of the points from the camera ij defined by i in a euclidean frame. if all points are equidistant from the cameras throughout a sequence then we may reasonably assume that each i j for will have at least the solution where pi and xj are the true cameras and points normalized in the manner just stated. more generally suppose that points are located at different depths but each point xj remains at approximately the same depth dj from the cameras through the whole sequence. in this case a solution will exist with all i j in which the com j yj zj similarly by allowing multiplication of the camera puted xj d matrices by a factor we find if the ratios of true depths of the different points xj remain approximately constant during a sequence then the assumption i j is a good first approximation to projective depth. this is for instance the case of an aerial image camera pointing straight down from constant altitude. projective reconstruction using planes it was seen in section that if four points visible in each view are known to be coplanar then the computation of the multifocal tensors relating the image points becomes significantly more simple. a major advantage is that a tensor satisfying all its constraints may be computed using a linear algorithm. we now continue with that particular line of investigation and show that the use of linear techniques extends to estimation of motion and structure for any number of views. the condition that four of the image correspondences are derived from coplanar points is equivalent to knowing the homographies between the images induced by a plane in space since a homography may be computed from the four points. it is only the homographies that are important in the following approach. these homographies may be computed from four or more point correspondences or line correspondences or estimated directly from the images by direct correlation methods. n-view computational methods what do the plane-plane homographies tell us? the key to projective reconstruction using planes is the observation that knowledge of homographies between the images means we know the first part of the camera matrices m p hence it remains only to compute their last columns namely the vectors t. since we are interested at this point only in obtaining a projective reconstruction of the scene we may suppose that the plane inducing the homographies is the plane at infinity with points xj yj zj camera matrices may be written in the form pi where m is a matrix and ti is a column vector. a reasonable assumption is that the camera centres do not lie on the plane inducing the homographies otherwise the homographies will be degenerate. this means that the matrix m is non-singular. for simplicity the first camera may be assumed to have the form where i is the identity matrix. now if xi j is the point in image i corresponding to the point xj yj zj lying on the homography-inducing plane then whereas j yj zj yj zjt j mixj yj zjt xi j thus mi represents the homography from the first image to the i-th image induced by the plane. conversely if mi is the known plane-induced homography that maps a point in the first image to its matching point in the i-th image then the set of camera matrices can be assumed to have the form pi where the mi are known and their scale is fixed but the final columns ti are not. known camera orientation. we have just shown that knowledge of homographies implies the knowledge of the left-hand submatrix of each camera matrix. the same will hold if we know the orientation calibration of all the cameras. for instance a reasonable approach to reconstruction knowing the calibration of each camera is to estimate the orientation of each camera separately from the translation example from two or more scene vanishing points. once the orientation and calibration of each camera is known the left-hand block of each camera matrix is kiri. direct solution for structure and translation we describe two separate methods for computation of the projective structure given plane-induced homographies between images. the first method solves for the points and the camera motion simultaneously by solving a single linear system. suppose point x y z is not on the plane at infinity that is the plane inducing the homographies. projective reconstruction using planes where the scale factor has been explicitly written. more precisely we may write the equation for point projection is x px x mt i is the i-th row of the matrix m. mt mt y where mt mt mt mt the unknown scale factor may be eliminated by taking the vector product of the two sides of this equation resulting in mt mt this provides two independent equations y mt x x y mt mt xmt ymt xmt ymt which are linear in the unknowns y zt and t the equations may be written as thus each measured point xi j pixj generates a pair of equations and with m views involving n points a set of equations in unknowns is generated in this way. these equations may be solved by linear or linear least-squares techniques to obtain the structure and motion. a few remarks about this method are offered. in contrast to factorization methods we do not need all points to be visible in all views. only equations corresponding to the measured points are used. since it is assumed that points have final coordinate equal to one it is necessary to exclude points that lie on the plane at infinity plane inducing the homography which have final coordinate equal to zero. a test to detect points lying on or close to the plane is necessary. both points and cameras are computed at once. for a large number of points and cameras this may be a very large estimation problem. however if the point tracks have a banded form then sparse solution techniques may be used to solve the equation set efficiently as in section n-view computational methods this method and its implementation are discussed in depth in the details given here are different from those given in where the structure and motion computation is carried out in a specific projective frame related to the matched points on the plane involving a coordinate change in the images. direct motion estimation the second method for planar reconstruction knowing homographies solves for the camera matrices first and subsequently computes the point positions. we start from the set of camera matrices which again can be assumed to have the form pi where the hi are known and their scale is fixed but the final columns ti are not. we may assume that so that the set of all remaining ti have degrees of freedom since the ti are defined only up to a common scale. now assume that several point or line correspondences across two or more views are known views are required for lines. these correspondences must derive from points or lines that do not lie in the reference plane to compute the hi. each point correspondence across two views leads to a linear equation in the entries of the fundamental matrix. similarly correspondences of points or lines across three or four views lead to linear equations in the entries of the trifocal or quadrifocal tensor. the key point explained in section is that we may express the entries of the fundamental matrix trifocal or quadrifocal tensor linearly in the entries of the vectors ti. therefore each linear relation induced by a point or line correspondence may be related back to a linear relationship in terms of the entries of the ti. thus for example a correspondence across views i j and k gives rise to a set of linear equations in the entries of the three vectors ti tj and tk. a set of correspondences across many views can be broken down into correspondences across sets of consecutive views. thus for example a single point correspondence across m views will give a set of equations of the form where each row represents a set of equations derived from a quadrifocal tensor relationship. each black square represents a block with columns corresponding to one of the vectors ti. in the diagram above we choose to wrap the equations around from the last to the first view to add greater rigidity. otherwise the values of the ti can drift from the first to the last view. other schemes for selecting groups of views are possible and it is not necessary to restrict to consecutive views. linear relations may be generated between any subset of sufficiently many images or depending on which tensor is used to generate the equations. one must trade off the added stability of the solution against the added computational cost of adding more equations. a mixture of bifocal trifocal and quadrifocal constraints may be used projective reconstruction using planes in generating the set of all equations and it is not necessary that all points be visible in all views. numbers of equations generated. let the total number of views be m. consider a subset of s views or and let n point correspondences be given between these views. we briefly consider the problem of reconstruction from this subset of s views in isolation. from these point correspondences we can generate a set of equations between the entries of the s views and thence estimate the values of the entries of in doing this we can assume that the first view has t and the vectors t from the remaining s views are only determined up to a common scale. thus the a occurring in the equation set has a right null-space of dimension at least corresponding to the degrees of freedom of the solution. in general then result ignoring the effects of noisy data the total rank of the set of equations generated from n point correspondences in s views is this is independent of the number of point line correspondences used to generate them. to be exact the argument above showed that the rank was at most for and correspondences this is equal to or respectively. however as long as there are two correspondences the maximum rank is achieved. this is because two points are sufficient for reconstruction from s or views as shown by the counting arguments of section now consider the total set of m views. the total number of retrievable parameters of all the ti is therefore for a solution to be possible the number of equations must exceed which gives the following result. result if s subsets of sk views are chosen from among m views then in order to solve for all the vectors ti representing final columns of the camera matrices it is necessary that one can verify that if correspondences are to be used tions derived from the fundamental matrix constraints ficient to use just pairs of consecutive views involving equais not sufin a configuration such as then it for in this case the total number of equations generated is whereas the total number of equations required is thus for m there are not enough equations. this is related to the fact that the fundamental matrices between consecutive views are not sufficient to define the structure of the sequence of views. it is necessary to add additional constraints from non-consecutive views such as n-view computational methods note though that the discussion of section suggests that it is preferable to use trifocal or quadrifocal constraints over triplets or quadruplets of views. implementation details for this method are given in reconstruction from sequences in this final section we bring together several ideas from earlier in the book. the objective here is to compute a reconstruction from a sequence of frames provided by a video. there are three stages to this problem compute corresponding features throughout the sequence compute an initial reconstruction which may be used as a starting point for bundle adjustment described in section here the features we will consider are interest points though others such as lines could equally well be used. the correspondence problem is exacerbated because an interest point feature will generally not appear in all of the images and often will be missing from consecutive images. bundle adjustment however is not hindered by missing correspondences. there are several advantages of a video sequence over an arbitrary set of images there is an ordering on the images the distance between camera centres baseline for successive frames is small. the small baseline is important because it enables possible feature matches between successive images to be obtained and assessed more easily. matches are more easily obtained because the image points do not move far between views so a proximity search region can be employed matches are more easily assessed to whether they arise from the same point in because nearby images are similar in appearance. the disadvantage of a small baseline is that the structure is estimated poorly. however this disadvantage is mitigated by tracking over many views in the sequence so that the effective baseline is large. an overview of the method is given in algorithm there are several strategies that may be used to obtain the initial reconstruction though this area is still to some extent a black art. three possibilities are extending the baseline. suppose a reasonable number of scene points are visible throughout the sequence. correspondences may be carried through from the first to the last frame using the pairwise matches f or the triplet matched points t indeed if the baseline between consecutive frames is small to the structure depth then pairwise matches may be obtained using homography computation this provides a stronger matching constraint to point than f to line. a trifocal tensor can then be estimated from corresponding points in the first middle and end frames of the sequence. this tensor determines a projective reconstruc reconstruction from sequences objective given a sequence of frames in a video compute correspondences and a reconstruction of the scene structure and the camera for each frame. algorithm interest points compute interest points in each image. view correspondences compute interest point correspondences and f between consecutive frames using algorithm may be omitted if the baseline motion is too small. view correspondences compute interest point correspondences and t between all consecutive image triplets using algorithm initial reconstruction see text. bundle adjust the cameras and structure for the complete sequence. auto-calibration see chapter algorithm overview of reconstruction from a sequence of images. tion for those points and frames. the cameras for the intermediate frames may then be estimated by resectioning and the scene points not visible throughout the sequence estimated by triangulation. hierarchical merging of sub-sequences. the idea here is to partition the sequence into manageable sub-sequences can be several hierarchical layers of partitioning. a projective reconstruction is then computed for each sub-sequence and these reconstructions are zipped together. consider the problem of merging two triplets which overlap by two views. it is a simple matter to extend the correspondences over the views a correspondence which exists across the triplet and also across the triplet may be extended to the frames since the pair overlaps for the triplets. the camera matrices and structure are then computed for the frames for example by first resectioning and then bundle adjustment. this process is extended by merging neighbouring groups of frames until camera matrices and correspondences are established throughout the sequence. in this manner error can be distributed evenly over the sequence. incremental bundle adjustment. a fresh bundle adjustment is carried out as the correspondences from each new frame are added. the disadvantage of this method is the computational expense and also the possibility that error systematically accumulates. of course these three methods may be combined together. for example the sequence can be partitioned into a sub-sequence where common points are visible and a reconstruction built for the sub-sequence using the extended baseline method. these sub-sequences may then be combined hierarchically. in this manner structure and cameras may be computed automatically for sequences consisting of hundreds of frames. these reconstructions may form the basis for such tasks as navigation the cameraego-position and virtual model genera n-view computational methods a c b d fig. corridor sequence. a three dimensional reconstruction of points and lines in the scene and cameras by their image planes computed automatically from the images. a texture mapped triangulated graphical model is then automatically constructed as described in a rendering of the scene from a novel viewpoint different from any in the sequence. vrml model of the scene with the cameras represented by their image planes mapped with the original images from the sequence. tion. often it is necessary first to compute a metric reconstruction from the projective one using the methods described in chapter and chapter metric reconstruction and virtual model generation is illustrated in the following examples. example corridor sequence a camera is mounted on a mobile vehicle for this sequence. the vehicle moves along the floor turning to the left. the forward translation in this sequence makes structure recovery difficult due to the small baseline for triangulation. in this situation the benefit of using all frames in the sequence is significant. figure shows the recovered structure. reconstruction from sequences fig. wilshire points and cameras for frames of a helicopter shot. cameras are shown for just the start and end frames for clarity with the camera path plotted between. example wilshire sequence this is a helicopter shot of wilshire boulevard los angeles. in this case reconstruction is hampered by the repeated structure in the scene many of the feature points example those on the skyscraper windows have very similar intensity neighbourhoods so correlation-based tracking produces many false candidates. however the robust geometry-guided matching successfully rejects the incorrect correspondences. figure shows the structure. n-view computational methods closure it is probably fair to say that no fully satisfactory technique for reconstruction from a sequence of projective images is known and many ad-hoc techniques have been used with reasonable success. four views is the limit for the closed-form solutions based on multiview tensors. for larger numbers of views there is no such neat mathematical formulation of the problem. one exception to this is the m-view technique based on duality chapter but this techniques is limited to six to eight points depending on which dual tensor matrix trifocal tensor or quadrifocal tensor is used. most sequences will contain many more matched points than this. literature the tomasi kanade algorithm was first proposed for orthographic projection but was later extended to paraperspective it has been extended to lines and conics e.g. but the mle property no longer applies and it is unclear what is being minimized in the affine reconstruction. others have investigated subspace methods for multiple affine views in the case of planes and the case of multiple objects moving independently non-rigid factorization was formulated by though the elements of the idea are present in affine reconstruction with uncertainty data has been discussed by irani and anandan the method of affine reconstruction by alternating triangulation and camera estimation is mentioned in under the name powerfactorization. the extension of factorization to projective cameras is due to sturm and triggs methods of iteration using this approach have been proposed by a method of computing multiple cameras based on a plane homography was em ployed in initializing the ti vectors using planar auto-calibration. methods for obtaining an initial projective reconstruction from a sequence are described in and more recently discuss the important problem of scene and motion degeneracies that may be encounted in sequence reconstruction. notes and exercises the affine factorization algorithm can be applied to obtain a reconstruction in situations where a set of cameras have a common third row even though the cameras are not affine. the third row is the principal plane of the camera section and the condition of a common third row is equivalent to coplanar principal planes. for example if a camera translates in a direction perpendicular to its principal axis then all the camera centres will lie on a plane and the principal planes are coplanar. the affine factorization algorithm can be applied in this case because the set of cameras can be transformed as to closure the affine form by a homography h satisfying where is the last row of pi. more generally if the camera centres are restricted to a plane then the images may be synthetically rotated such that the cameras effectively have coplanar principal planes. for example in the case of planar motion or single axis rotation if all the images are rotated such that the principal axis is parallel to the rotation axis applying a homography to each image which maps the horizon to infinity in the case of a vertical rotation axis then the principal planes of all the cameras are parallel. however if the cameras are not actually affine then the algorithm will not give the ml estimate of the reconstruction. auto-calibration auto-calibration is the process of determining internal camera parameters directly from multiple uncalibrated images. once this is done it is possible to compute a metric reconstruction from the images. auto-calibration avoids the onerous task of calibrating cameras using special calibration objects. this gives great flexibility since for example a camera can be calibrated directly from an image sequence despite unknown motion and changes in some of the internal parameters. the root of the method is that a camera moves rigidly so the absolute conic is fixed under the motion. conversely then if a unique fixed conic in can be determined in some way from the images this identifies as we have seen in earlier chapters once is identified the metric geometry can be computed. an array of auto-calibration methods are available for this task of identifying this chapter has four main parts. first we lay out the algebraic structure of the autocalibration problem and show how the auto-calibration equations are generated from constraints on the internal or external parameters. second we describe several direct methods for auto-calibration which involve computing the absolute conic or its image. these include estimating the absolute dual quadric over many views or the kruppa equations from view pairs. third are stratified methods for auto-calibration which involve two steps first solving for the plane at infinity then using this to solve for the absolute conic. the fourth part covers a number of special configurations including a camera rotating about its centre a camera undergoing planar motion and the motion of a stereo rig. introduction auto- self- calibration is the computation of metric properties of the cameras andor the scene from a set of uncalibrated images. this differs from conventional calibration where the camera calibration matrix k is determined from the image of a known calibration grid or properties of the scene such as vanishing points of orthogonal directions instead in auto-calibration the metric properties are determined directly from constraints on the internal andor external parameters. for example suppose we have a set of images acquired by a camera with fixed internal parameters and that a projective reconstruction is computed from point cor algebraic framework and problem statement respondences across the image set. the reconstruction computes a projective camera matrix pi for each view. our constraint is that for the actual cameras the internal parameter matrix k is the same unknown for each view. now each camera pi of the projective reconstruction may be decomposed as pi kiri ti but in general the calibration matrix ki will differ for each view. thus the constraint will not be satisfied by the projective reconstruction. however we have the freedom to vary our projective reconstruction by transforming the camera matrices by a homography h. since the actual cameras have fixed internal parameters there will exist a homography a family of homographies such that the transformed cameras pih do decompose as pih krii ti with the same calibration matrix for each camera so the reconstruction is consistent with the constraint. provided there are sufficiently many views and the motion between the views is general later then this consistency constrains h to the extent that the reconstruction transformed by h is within a similarity transformation of the actual cameras and scene i.e. we achieve a metric reconstruction. although the particular constraints used to achieve a metric reconstruction may dif fer this example illustrates the general approach obtain a projective reconstruction xj. determine a rectifying homography h from auto-calibration constraints and transform to a metric reconstruction h various flavours of auto-calibration will be covered in the following sections. they differ in the constraints used and the methods whereby the homography h is determined. the methods may be divided into two classes those that directly determine h and those that are stratified determining first the projective and then the affine components of h. the advantage of the latter approach is that once an affine reconstruction is achieved i.e. is known the solution for a metric reconstruction is linear. if camera calibration rather than metric scene reconstruction is the goal then it is not always necessary to compute an explicit projective reconstruction and sometimes the camera calibration may be computed more directly than via a rectifying transformation. this is the case for instance if a camera rotates about its centre without translation as is discussed in section algebraic framework and problem statement suppose we have a projective reconstruction xj then based on constraints on the cameras internal parameters or motion we wish to determine a rectifying homography h such that h is a metric reconstruction. we start from the true metric situation with calibrated cameras and structure represented in a euclidean world frame. thus in actuality there are m cameras pi m which project a point xm to an image point xi pi mxm in each view where the subscript m indicates that the cameras are calibrated and the world frame is euclidean. the cameras may be written as pi m kiri ti for i m. auto-calibration in a projective reconstruction we obtain cameras pi which are related to pi m by pi m pih i m where h is an unknown homography of our goal is to determine h. to be precise we are not concerned with the absolute rotation translation and scale of the reconstruction and we will now factor out this similarity component. we choose the world frame to coincide with the first camera so that i and then ri ti specifies the euclidean transformation between the i-th camera and the first and m similarly in the projective reconstruction we choose the usual canonical camera for the first view so that then writing h as m from becomes which implies that the condition a and t in addition since h is non-singular k must be non-zero so we may assume k fixes the scale of the reconstruction. this shows that h is of the form h t a vt k h vt this has factored out the similarity component. the vector v together with specifies the plane at infinity in the projective recon struction since the coordinates of are h t t tv tv we will write so that p shown result a projective reconstruction xj in which can be transformed to a metric reconstruction h by a matrix h of the form tv. to summarize so far we have h k ptk where k is an upper triangular matrix. furthermore k is the calibration matrix of the first camera. the coordinates of the plane at infinity in the projective reconstruction are given by conversely if the plane at infinity in the projective frame and the calibration matrix of the first camera are known then the transformation h that converts the projective to a metric reconstruction is given by algebraic framework and problem statement from this result it follows that to transform a projective to a metric reconstruction it is sufficient to specify parameters the three entries of p and five entries of this agrees with a geometric counting argument. finding metric structure is equivalent to specifying the plane at infinity and the absolute conic and five degrees of freedom respectively. in a metric reconstruction the calibration ki of each camera its rotation ri relative to the first camera and its translation ti relative to the first camera up to a single common scaling i.e. ti sti are all determined. we now develop the basic auto-calibration equations. we denote the cameras of the projective reconstruction as pi ai. multiplying out using gives kiri ai aipt which may be rearranged as ri rotation ri may be eliminated using rrt i leaving ai aipt ai aipt ai aipt for i m i m. finally the kikit note now that kikit making this substitution gives the basic equations for auto-calibration the dual image of the absolute conic diac see ai aipt ai aipt t ai aipt ai aipt i i the second equation being simply the inverse of the first with the image of the absolute conic iac. these equations relate the unknown entries of i or i i m and unknown parameters p with the known entries of the projective cameras ai ai. the art of auto-calibration is to use constraints on the ki such as that one of the elements of ki is zero to generate equations on the eight parameters of p and from all auto-calibration methods are variations on solving these equations and in the following sections we describe several of these methods. generally methods proceed by computing i or i first and extracting the values of the calibration matrices ki from these though iterative methods as bundle adjustment may be parametrized by ki directly. the equations have a geometric interpretation as mappings on the absolute conic and we will return to this in section and section we start with a simple example to illustrate how equations on the eight parameters are generated from example auto-calibration equations for identical ki suppose that all the cameras have the same internal parameters so ki k then becomes kkt ai aipt kkt ai aipt i m. each view i m provides an equation and we can develop a counting argument auto-calibration for the number of views required principle in order to be able to determine the unknowns. each view other than the first imposes constraints since each side is a symmetric matrix independent elements and the equation is homogeneous. assuming these constraints are independent for each view a solution is determined provided consequently provided m a solution is obtained at least in principle. clearly if m is much larger than the unknowns k and p are very over-determined. one could imagine using as a basis for a direct estimation of the rectifying transformation h. this may be framed as a parametrized minimization problem in which the eight parameters of are allowed to vary with the purpose of minimizing a cost function on how well the equations are satisfied or measuring closeness to metric structure. of course a method of obtaining an initial solution would also be required. in essence these two steps initial solution and iterative minimization are what will be investigated in the following sections though under constraints less restrictive than identical internal parameters. calibration using the absolute dual quadric the absolute dual quadric q a homogeneous matrix of rank its importance here is that q and in a very concise fashion for instance is the null-vector of q has an algebraically simple image projection pq is a degenerate dual plane quadric represented by encodes both and it pt the idea of auto-calibration based on q to a constraint on q which is simply the projection of a quadric. in words q the dual image of the absolute conic representing q on ki as will be seen below. indeed q for auto-calibration in is to use to transfer a constraint on via the camera matrix pi. in this manner the matrix may be determined in the projective reconstruction from constraints was introduced as a convenient representation projects to kkt. has been determined then the rectifying homography h that we seek is also determined as shown below. thus we have a general framework for autocalibration based on specifying constraints on ki to determine q determining h. this general approach is summarized in algorithm in section we will concentrate on the second step of this algorithm estimation of q we first fill in some details. and then from q once q simple properties of the absolute dual quadric. section gives a full description of q for the purposes of auto-calibration particularly important properties are summarized here. in a euclidean frame q has the canonical form i calibration using the absolute dual quadric objective given a set of matched points across several views and constraints on the calibration matrices ki compute a metric reconstruction of the points and cameras. algorithm pi and points xj. q compute a projective reconstruction from a set of views resulting in camera matrices use along with constraints on the form of the i arising from ki to estimate decompose q apply h to the points and h to the cameras to get a metric reconstruction. use iterative least-squares minimization to improve the solution section as h iht where i is the the matrix alternatively the calibration matrix of each camera may be computed directly compute i for all i using compute the calibration matrix ki from the equation kkt by cholesky factoriza tion. algorithm auto-calibration based on q has the form q in a projective coordinate frame q h iht where i is the matrix in this follows from the projective transformation rule for dual quadrics q result in an arbitrary projective frame the dual absolute quadric is represented by a symmetric matrix with the following properties. hq ht. consequently it is singular of rank since q its null space is the vector representing the plane at infinity since q it is positive semi-definite negative depending on the homogeneous scale. is a degenerate conic. in its canonical form in a euclidean frame and these properties are immediate for q easily extend to an arbitrary frame. extracting the rectifying homography from q in a projective coordinate frame we wish to determine the homography h. extracting h is a simple matter of decomposing the expression as follows. h iht notation above then h is a result if q homography that takes the projective coordinate frame to a euclidean frame. given an estimated q is decomposed as q note that a camera is transformed by the inverse of the transformation applied to points so h is the correct matrix to apply to a camera to give pm ph. thus h is the rectifying transformation to apply to cameras. a decomposition of q as h iht may be easily computed from its eigenvalue decomposition section for jacobi s algorithm for this. equivalence to auto-calibration equations. equations which describe the image projection of q are simply a geometric representation of the auto-calibration equations as will now be demonstrated. auto-calibration the forms of and kkt for a camera with calibration matrix k as in are x s y s y y and x y s y s y y x y y x y y y if the skew is zero i.e. s then the expressions simplify to x y and x y y x x y table the image of the absolute conic and dual image of the absolute conic terms of the camera internal parameters. written in we have seen that in a projective frame q has the form h iht. the projective recon struction is related to the metric reconstruction by so in detail pit q h iht pt pt ai aipt on applying with pi ai we obtain once again the auto-calibration equations i piq is a fixed quadric under the euclidean ai aipt this is a geometric interpretation of q motion of the camera and the diac i is the image of q linear solutions for q the objective here is to estimate q in a projective reconstruction directly from constraints on the internal parameters. we will start by describing three cases for which a linear solution may be obtained. it is convenient at this point to summarize the forms of the diac and also the iac. refer to table specifying linear constraints on q may be obtained if the principal point is known. assume that this point is known then we may change linear constraints on q from a set of images in each view. calibration using the absolute dual quadric the image coordinate system so that the origin coincides with the principal point. then and from table the diac becomes x s y s y y the linear equations on q applying the projection equation two equations are then generated from the zero entries in by pt to each view i. for example the pq and i follow immediately from i if there are additional constraints on ki which result in further relationship between the entries of then these may provide additional linear equations. for instance an assumption that skew is zero means that the of vanish which provides one more linear equation on the entries of q similar to known aspect ratio provides a further constraint. table summarizes the possible constraints that may be used. condition constraint type constraints zero skew principal point at origin zero skew at origin fixed aspect ratio skew and p.p. at origin i i j j known aspect ratio r y x skew and p.p. at origin quadratic linear linear quadratic m m m linear m table auto-calibration constraints derived from the diac. the number of constraints column gives the total number of constraints over m views assuming the constraint is true for each view. each additional item of information generates additional equations. for example if the principal point is known and skew is zero then there are constraints per view. linear solution. since it is symmetric q may be parametrized linearly by homogeneous parameters namely the diagonal and above-diagonal entries. these entries may be represented by a x. in the usual manner the linear equations on q may be assembled into a matrix equation of the form ax and a least-squares solution for x obtained via the svd. for example the two equations provide two rows of the matrix from each view. from five images a total of equations are obtained only that principal point is known and a linear solution is possible. from four images eight equations are generated. in the same way as with the auto-calibration computation of the fundamental matrix from seven points there is a family of solutions. the condition det q gives a fourth-degree equation and so up to four solutions for q example linear solution for variable focal length suppose the camera is calibrated apart from the focal length the principal point is known the aspect ratio is unity it is not the equations can be transformed so that it is unity from the known value and skew is zero the focal length is unknown and may vary between views. in this case from table there are four linear constraints on q available from each view. in the case of two views there are eight linear constraints and if m a unique up to four solutions are obtained using the condition det q linear solution exists. more will be said about determination of focal lengths in this minimal case in example non-linear solutions for q we now describe various non-linear equations that can be obtained from the form of it has been seen that each element of i piq pit is expressible as a linear expression in terms of the parameters of q it follows that any relationship between the entries of the various i translates into an equation involving the entries of q in particular linear or quadratic relationships between entries of generate respectively linear or quadratic relationships between entries of q given sufficiently many such equations we may solve for q constant internal parameters. if the internal parameters of all cameras are the same then i j for all i and j which expands to piq pj t. however since these are homogeneous quantities the equality holds only up to an unknown scale. a set of five equations are generated i pit pjq i j i j i j j i j i j this gives a set of quadratic equations in the entries of q of equations result which may be solved to find q given three views a total calibration assuming zero skew. under the assumption of zero skew in each of the cameras the form of the diac is simplified as given in in particular we obtain the following constraints between the entries of in the zero-skew case this gives a single quadratic equation in the entries of q obtain m quadratics. however there is also one extra equation det q the fact that the absolute dual quadric is degenerate. since q linear parameters it may be computed least in principle from views. these different calibration constraints are also summarized in table from a set of m views we derived from has homogeneous calibration using the absolute dual quadric iterative methods as we have seen on many occasions throughout this book there is a choice between minimizing an algebraic or geometric error. in this case a suitable algebraic error is provided by in previous cases such as the unknown scale factor has been eliminated by forming a cross product. here the scale factor can be eliminated by using a matrix norm. the cost function is piq f i where is the frobenius norm of m and kikit and piq pit are both normalized to have unit frobenius norm. the cost function is parametrized by the most eight and the unknown elements of each i kikit. it is possible unknown elements of q to use the expansion to parametrize the absolute dual quadric. for example in the case of example where the focal length is the only unknown per view would be minimized over parameters. these are the focal length f i of each view and the three components of p. note that this parametrization ensures that q has rank throughout the minimization. since the above cost function has no particular geometric meaning it is advisable to follow this up with a complete bundle adjustment. in fact given a good initial linear estimate one can proceed directly to bundle adjustment. there is no difficulty in incorporating assumptions on calibration parameters into a full bundle adjustment as described in section example metric reconstruction for general motion figure shows views of an indian temple acquired by a hand held camera. a projective reconstruction is computed from image point correspondences as described in section and a metric reconstruction obtained using algorithm under the constraint of constant camera parameters with known principal point. the computed cameras and point cloud are shown in figure and a counting argument the constraints we have seen have been of two types a parameter has a known value or a parameter is fixed across views but its value is unknown. the actual constraints that apply depend on the physical circumstances of the image production from acquisition by the camera through digitization and cropping to the final image. for example for an image sequence in which the lens is zoomed it might be the case that the skew and aspect ratio are fixed unknown but that the focal length and principal point vary through the sequence. often it is the case that the pixels are square or have a known aspect ratio so that both the skew is zero and aspect ratio are known. we will now consider the number of constraints that are required to determine a metric reconstruction fully. the number of parameters that must be computed to perform calibration is this is equal to the number of essential parameters of the absolute dual quadric including the scale ambiguity and constraint. consider m views and suppose that k of the auto-calibration a b c d e f g fig. metric reconstruction for general motion. views acquired by a hand held camera. and two views of a metric reconstruction computed from interest points matches over the five views. the cameras are represented by pyramids with apex at the computed camera centre. and two views of a texture mapped model computed from the original images and reconstructed cameras using an area based stereo algorithm. figures courtesy of marc pollefeys reinhard koch and luc van gool. internal parameters are known in all views and f are fixed over the views but unknown k f a fixed and known calibration parameter provides one constraint per view via the condition i piq pit for a total of mk constraints. a fixed but unknown calibration parameter provides one fewer constraint since just the value of the unknown parameter is missing. thus f fixed parameters provide a total of f constraints. the requirement for calibration is then that mk table gives values for m for several combinations of constraints. it is important to remember that degenerate configurations are of course possible in which some of the constraints are dependent. this will increase the number of required views. limitations of the absolute quadric approach to calibration the following considerations apply to calibration using this method. limitations of least-squares algebraic solution. since the least-squares solution of ax in the linear solution for the minimizes but does not enforce constraints the solution obtained will not precisely satisfy the required conditions. this observation holds in over-constrained cases. for instance in the case of estimating focal lengths in example the entries i will not be in the required and i the kruppa equations condition fixed known views constant internal parameters aspect ratio and skew known focal length and principal point vary aspect ratio and skew constant focal length and principal point vary skew zero all other parameters vary p.p. known all other parameters vary p.p. known skew zero p.p. skew and aspect ratio known f k m table the number of views m required under various conditions in order for there to be enough constraints for auto-calibration. for those cases marked with an asterisk there may be multiple solutions even for general motion between views. ratio nor will the off-diagonal entries be precisely zero. this means that the ki will not be precisely of the desired form. the absolute dual quadric computed by linear means will not have rank in general since this is not enforced by the linear equations. a rank matrix for q can be obtained by setting the smallest eigenvalue to zero in its eigenvalue decomposition a similar manner to using the svd to obtain a rank matrix for f in the algorithm in section this rank matrix may then be directly decomposed to obtain the rectifying homography using result alternatively the rank matrix can provide the starting point for an iterative minimization as described in section the positive-definiteness condition. the most troublesome failing of this method is the difficulty in enforcing the condition that q is positive semi-definite negative semi-definite if the sign is reversed. this is related to the condition that pt should be positive-definite. if is not positive-definite then it can not be decomposed using cholesky factorization to compute the calibration matrix. this is a recurring problem with auto-calibration methods based on estimation of the iac or diac. if the data is noisy then this problem may occur indicating that the data are not consistent with metric reconstruction. it is not appropriate if this occurs to seek the closest positive-definite solution since this will generally be a boundary case leading to a spurious calibration. pq the kruppa equations a different method of auto-calibration involves the use of the kruppa equations which were originally introduced into computer vision by faugeras luong and maybank and historically are seen as the first auto-calibration method. they auto-calibration c w x x c e o c x e c x l l e l e x l c fig. epipolar tangency for a conic. a conic cw on a world plane is imaged as corresponding conics c in two views. the imaged conics are consistent with the epipolar geometry of the view pair. upper an epipolar plane tangent to the world conic cw defines corresponding epipolar lines which are tangent to the imaged conics. lower epipolar lines tangent to the imaged conic in the first view correspond to the epipolar lines respectively tangent to the imaged conic in the second. are two-view constraints that require only f to be known and consist of two independent quadratic equations in the elements of the kruppa equations are an algebraic representation of the correspondence of epipolar lines tangent to a conic. the geometry of this correspondence is illustrated in figure suppose the conics c and are the images of a conic cw on a world plane in the first and second views respectively and that c are their duals. in the first view the two epipolar tangent lines and may be combined into a single degenerate point conic example as ct c may be verified that any point x on the lines and satisfies xtctx similarly in the second view c t the corresponding epipolar lines the epipolar tangent lines correspond under the homography h induced by any world plane t h tcth since ct is a point conic it transforms according to result and the correspondence of the lines requires that may be written as and and c c h te c h fc ft the last equality following from f h te page note this equation does not enforce the condition that the epipolar tangent lines map individually to their corresponding lines only that their symmetric product maps to their symmetric product. the development to this point applies to any conic. however in the case of interest here the world conic is the absolute conic on the plane at infinity so that c h h and specializes to the kruppa equations f c if the internal parameters are constant over the views then and so f ft which are the kruppa equations in a form originally given by vi eville on eliminating the homogeneous scale factor one obtains equations quadratic in the elements of although concisely expresses the kruppa equations it is not in a form that can be easily applied. a succinct and easily usable form of the kruppa equations is now given. we show that the null-space of which is common to both sides of can be eliminated leaving an equation between two result the kruppa equations are equivalent to ut ut ut vt vt where ui vi and i are the columns and singular values of the svd of f. this provides three quadratic equations in the elements of which two are independent. ij of proof. the fundamental matrix has rank and thus has an svd expansion vt f udvt u where the null-vectors are and this means that the epipoles are e and substituting this expansion into we obtain we now use the property that u is an orthogonal matrix. on pre-multiplying by ut and post-multiplying by u the lhs becomes ut u ut ut udvt vdut. ut vt v vt vt and the rhs of becomes dvt vd auto-calibration it is evident that both sides have reduced to symmetric matrices each with three independent elements. these three elements may be represented by a homogeneous on each side xt lhs xt rhs ut vt ut ut vt the two sides are only equal up to a scale factor. however equalities are obtained in the usual way using a vector cross-product xlhs xrhs an alternative derivation is given in note the kruppa equations involve the diac rather than the iac since they arise from tangent line constraints and line constraints are more simply expressed using a dual conic. we now discuss the solution of the kruppa equations beginning with a simple example where all the internal parameters are known apart from the focal length. an alternative method for solving this problem using the absolute dual quadric was given in example example focal lengths for a view pair suppose two cameras have zero skew and known principal point and aspect ratio but unknown and different focal lengths in example then from by a suitable change of coordinates their diacs may be written as diag diag are the unknown focal lengths of the first and second view respectively. where writing the kruppa equations as ut ut vt it is evident that each numerator is linear in terms of in cross-multiplying provides two simple quadratic equations in and are easily solved. the values of and if the internal parameters are the same for the two views is equation of result provides a quadratic in the single unknown ut vt and each denominator linear which are found by taking the square roots. note then each extending the kruppa equations to multiple views. in the absence of knowledge of the internal parameters other than that the parameters are constant across views the kruppa equations provide two independent constraints on the five unknown parameters. thus given three views with f known between each pair there are in principle six quadratic constraints which is sufficient to determine using any five of these equations results in five quadratics in five unknowns a total of possible solutions. solving this set of equations is not a particularly promising approach although solutions have been obtained by homotopy continuation and by minimizing algebraic residuals using every view pair for a sequence of images a stratified solution ambiguities. vide no constraint on translation reduces to if there is no rotation between views then the kruppa equations pro. this may be seen from which in the case of pure since f the kruppa equations are closely related to the calibration constraint provided by the transfer of the iac under the infinite homography as discussed later in section it will follow from that discussion that the constraint placed on by the kruppa equations for a pair of views is weaker than that placed by the infinite homography constraint consequently ambiguities of imposed by the kruppa equations are a superset of those imposed by the application of the kruppa equations to three or more views provides weaker constraints than those obtained by other methods such as the modulus constraint or the absolute dual quadric this is because the kruppa constraints are a view-pair constraint for conics obtained as a projection of a quadric. they do not enforce that the quadric is degenerate or equivalently do not enforce a common support plane for over the multiple views. consequently there are additional ambiguous solutions as described in although the application of the kruppa equations to auto-calibration is chronologically the first example in the literature the difficulty of their solution and the problem with ambiguities has seen them losing favour in the face of more tractable methods such as the dual quadric formulation. however if only two views are given then the kruppa equations are the constraint available on a stratified solution determining a metric reconstruction involves simultaneously obtaining both the camera calibration k and the plane at infinity an alternative approach is first to obtain by some means or equivalently an affine reconstruction. the subsequent determination of k is then relatively simple because there exists a linear solution. this approach will now be described starting with methods of determining and hence h and followed by methods of computing k given h affine reconstruction determining for general motion and constant internal parameters can be rearranged into providing a constraint only on known as the modulus constraint. this allows the coordinates p of to be solved for directly and is described below. the modulus constraint the modulus constraint is a polynomial equation in the coordinates of assume the internal parameters are constant then from with ki k a apt krk where the scale factor is explicitly included and for clarity the superscripts are omitted. since krk is conjugate to a rotation it has eigenvalues ei e i consequently the eigenvalues of apt are ei e i and thus have equal moduli. this is the modulus constraint on the coordinates of the plane at infinity p. auto-calibration to develop this constraint further consider the characteristic polynomial of a apt which is det i a apt where i are the three eigenvalues and cos cos eliminating the scalar and angle we obtain f looking more closely at the characteristic polynomial we observe that p appears only as part of the term apt. this means that the elements of p appear only linearly in the determinant det i a apt and hence linearly in each of hence the modulus constraint may be written as a quartic polynomial in the three elements pi of p. this polynomial equation is only a necessary condition for the eigenvalues to have equal moduli not sufficient. each view pair generates a quartic equation in the coordinates of thus in principle three views determine but only as the intersection of three quartics in three variables a possible solutions. however for three views an additional cubic equation is available from the modulus constraint and this equation can be used to eliminate many of the spurious solutions. this cubic equation is developed in the modulus constraint may also be combined with scene information. for example if a corresponding vanishing line is available in two views then is determined up to a one-parameter ambiguity. applying the modulus constraint resolves this ambiguity and results in a quartic equation in one variable. kruppa equations are equations on ulus constraint is an equation on which does not involve is known the other can subsequently be determined. the modulus constraint may be considered the cousin of the kruppa equations the which do not involve conversely the modor once one of other methods of finding because of the problem with solving sets of simultaneous quartic equations the modulus constraint is not very satisfactory as a practical means of finding the plane at infinity. in fact finding the plane at infinity is the hardest part of auto-calibration and the place where one is most likely to run into difficulties. the plane at infinity may be identified by various other methods. several of these are described in chapter one straightforward method is outside the province of pure auto-calibration is to use properties of the scene geometry. for example the correspondence of a vanishing point between two views determines a point on and three such correspondences determine in a projective reconstruction. indeed a stratified solution a good approximation for may well be obtained from the correspondence of three points that are distant in the scene. a second method is to employ a pure translation between two views i.e. the camera translates but does not rotate or change internal parameters is determined uniquely by such a motion. as seen in result the plane at infinity may also be computed from the absolute dual quadric and this method is quite attractive if the principal point is known. methods of bounding the position of using cheiral inequalities will be described in chapter these use information about which points are in front of the cameras to get a quasi-affine reconstruction which is close to an affine reconstruction. a method for finding the plane at infinity by iterative search from this initial quasi-affine reconstruction is described in more recently the bounds imposed by cheirality have been used to define a rectangular region of parameter space inside which the vector p representing the plane at infinity must lie. then an exhaustive search is undertaken to find the elusive plane at infinity inside this region. affine to metric conversion determining k given once the plane at infinity has been determined an affine reconstruction is effectively known. the remaining step is to transform from affine to metric. it turns out that this is a far easier step than the step from projective to affine. in fact a linear algorithm is available based on the transformation of the iac or its dual. the infinite homography. the infinite homography h is the plane projective transformation between two images induced by the plane at infinity chapter if the plane at infinity and camera matrices ai are known in any projective coordinate frame an explicit formula for the infinite homography can be derived from result hi ai aipt where hi represents the homography from a camera to the camera ai. so hi may be computed from a projective reconstruction once the plane at infinity is known. if the first camera is not in the canonical form then one can still compute the homography hi from the first image to the i-th by writing ai aipt hi this is not strictly necessary however since one can invent a new view that does have camera matrix in the canonical form and express the infinite homographies with respect to this view. in the following discussion we write k and superscripts to refer either to this reference view or to the first view if it is in canonical form. the absolute conic lies on so its image is mapped between views by h under the point transformation xi hi x where hi is the infinite homography between the reference view and view i the transformation rules for a dual conic auto-calibration and a point conic lead to the relations i hi hi t and i t where i is the iac in the i-th view. it may be verified that these equations are precisely the auto-calibration equations and this is another geometric interpretation of those equations. these are among the most important relationships for auto-calibration. they are the basis for obtaining metric reconstruction from affine reconstruction and also for calibrating a non-translating camera as will be seen later in section the significance of this relation for auto-calibration is that if hi is known then these are linear relations between i and similarly for this means that constraints placed on i in one view can easily be transferred to another and in this manner sufficient constraints may be assembled to determine by linear means. once is determined then k follows by the cholesky decomposition. we will illustrate this approach for the example of fixed internal parameters. sketch solution for identical internal parameters. constant over m views then ki k and i equation of becomes if the internal parameters are for i m and the hi hi t. a very important point here relates to the scale factors in the equation although is a relationship between homogeneous quantities the scale factor in the homogeneous equation can be chosen as unity provided hi is normalized as det hi this results in six equations for the independent elements of the symmetric matrix then can be written in a homogeneous linear form ac where a is a matrix composed from the elements of hi and c is the conic written as a as discussed below c is not uniquely determined by one such equation since a has at most rank however if linear equations from m view pairs are combined so that a is now a matrix and provided the rotations between the views are about different axes then in general c is determined uniquely. related to the issue of uniqueness is the issue of numerical stability. under a single motion the linear computation of k from h is extremely sensitive to the accuracy of h if h is inaccurate it is not always possible to obtain a positive-definite matrix and thus to apply the cholesky decomposition to obtain k. this sensitivity is reduced if further motions are made and obtained from the combined constraints of a number of h s. a stratified solution in an analogous manner to the linear solution for advantage of using the iac. a linear solution may be obtained for starting from in fact using the equations involving the iac is attractive for the following reason. in the zero-skew case the form of for the iac is simpler and more clearly reflects the role of each calibration parameter than does the corresponding formula for the diac. in order to obtain linear equations using the diac equations it is necessary to assume that the principal point is known. this is not necessary for equations deriving from the iac. an assumption of zero skew is quite natural and is a safe assumption for most imaging conditions. however an assumption of known principal point is much less tenable. for this reason it is usually preferable to use the iac constraints of for auto-calibration rather than using the diac constraints. other calibration constraints. the algorithm just described was for constant but arbitrary internal parameters. if more is known about k such as the value of the aspect ratio or that the skew is zero the corresponding constraints may be simply added to the set of equations on and imposed as soft constraints. the possible constraints are shown in table for the diac same constraints that are used to compute q in section and table for the iac. as mentioned above the constraints derived from the iac are generally linear whereas the constraints derived from the diac are linear only under the assumption that the principal point is known at the origin. just as with the absolute dual quadric method it is possible to allow varying internal parameters for the cameras as long as sufficiently many constraints are imposed. the constraint of constant internal parameters for the cameras imposed a total of constraints on the calibration parameters of the m views. we can make do with fewer constraints letting certain parameters vary. the method of calibration with varying internal parameters is quite analogous to that used in the case of the absolute dual quadric. each entry of i is expressible as a linear expression in the entries of according to a linear constraint on some entry of i therefore maps back to a linear constraint on the entries of note to avoid treating the first image differently any constraints imposed on the first camera such as has zero skew should be treated by adding this equation to the complete equation set rather than by decreasing the number of parameters used to describe the latter method would cause the zero-skew constraint to be enforced exactly in the first image hard constraint but it would be a soft constraint in the other images. algorithm summarizes the stratified method for both constant and varying parameters. one could imagine implementing this algorithm directly for a camera mounted on a robot the camera is first moved by a pure translation in order to determine and in subsequent motions the camera may both translate and rotate until sufficient rotations have accumulated to determine k uniquely. auto-calibration condition zero skew constraint principal point at origin known aspect ratio r y x zero skew fixed aspect ratio zero skew i i j j type linear linear linear constraints m m quadratic m table auto-calibration constraints derived from the iac. these constraints are derived directly from the form of and the number of constraints column gives the total number of constraints over m views assuming the constraint is true for each view. using hard constraints. algorithm comes down to solving a homogeneous set of equations of the form ac where c represents arranged as a generally the supplied information on k such as that the skew is zero will not be satisfied exactly. as discussed in section known information can be imposed as a hard constraint by parametrizing i in each view to satisfy this constraint. for instance if the camera is known to have square pixels then the remaining parameters for the iac of each view can be represented by a homogeneous linear equations for the unknown parameters in each view may again be obtained from a homogeneous set of equations of the form ac may then be assembled where c now represents the unknown parameters of i over all views and a solution which minimizes obtained in the usual manner via the svd. an alternative is to include all the parameters in each view and use algorithm to minimize while satisfying constraints cc exactly. the ambiguities in using the infinite homography relation in this section we describe the ambiguities in determining the internal parameters from that occur if only a single rotation axis is used. it will be assumed that the internal parameters are unknown but fixed. a rotation matrix r has an eigenvector dr with unit eigenvalue rdr where dr is the direction of the axis of the rotation. consequently the matrix hi krik also has an eigenvector with unit eigenvalue hi is normalized as det hi this eigenvector is vr kdr and the image point vr corresponds to the vanishing point of the rotation axis direction. suppose then it may be verified that if true satisfies with hi krik then so does the one-parameter family of conics true is the true true vrvt r where parametrizes the family. in a similar manner there is a one parameter family of solutions for the iac equation of this argument indicates that a stratified solution objective given a projective reconstruction xj where pi ai determine a metric reconstruction via an intermediate affine reconstruction. algorithm affine rectification determine the vector p that defines using one of the methods described in section at this point an affine reconstruction may be obtained as h p xj with infinite homography compute the infinite homography between the reference view and the others as compute normalize the matrix so that det hi in constant case of the calibration equations t i m as ac with a a matrix and c the elements of the conic arranged as a or for variable calibration parameters use the equation i t to express linear constraints on entries of i zero skew as linear equations in the entries of rewrite the obtain a least-squares solution to ac via svd. metric rectification determine the camera matrix k from the cholesky decomposition then a metric reconstruction is obtained as with hp i pt hi ai aipt ha k use iterative least-squares minimization to improve the solution section algorithm stratified auto-calibration algorithm using iac constraints. although the infinite homography constraint seemingly provides six constraints on the five degrees of freedom of only four of these constraints are linearly independent. removing the ambiguity. the one-parameter ambiguity may be resolved in several ways. first if there is another view available related by a rotation around an axis with a direction different to dr then the combination of both sets of constraints will not have this ambiguity. a linear solution is easily obtained in the manner of thus with a minimum of three views more than one rotation a unique solution can generally be obtained. a second method of resolving the ambiguity is to make assumptions on the internal parameters of the cameras for instance an assumption of zero skew table the equations enforcing zero skew may be added as hard constraints to the set of equations being solved. an alternative equivalent method enforces the constraints a posteriori in the following manner. an ambiguity in solving for c from the linear equation system ac occurs when a has a greater right null-space. in this case in solving for there would be a family of solutions of the form auto-calibration here and are known from the null-space generators and must be determined. it remains simply to find the value of that leads to a solution satisfying the chosen constraint condition in table this is solved linearly. one could do the same thing solving for the diac but then the constraint condition would be quadratic table and one of the solutions would be spurious. in certain cases these additional constraints do not resolve the ambiguity. for example skew-zero does not resolve the ambiguity if the rotation is about the image x- or y-axes. such exceptions are described in more detail in and we give a few commonly occurring examples now. typical ambiguities. the one-parameter family of solutions given in for corresponds to a one-parameter family of calibration matrices obtained from as k for simplicity we will assume that the true camera k is a member of this family has skew zero so k has four unknown parameters. if the rotation axis is parallel to the camera x-axis then dr and vr kdr from the form of with no skew the family is true vrvt r y note that the entire family has skew-zero and in this case only the element is varying. this means that the principal point and y are unambiguously determined since they may be read-off from elements which are unaffected by the ambiguity. however it is apparent that x cannot be determined because it only appears in the varying element if k is computed from the infinite homography relation assuming a zeroskew camera then for some motions there remains one undetermined calibration parameter. for rotation about various axes this ambiguity is as follows. to summarize this and two other canonical cases x-axis x is undetermined y-axis y is undetermined z-axis axis x and y are undetermined but their ratio y x is determined. geometric note. these ambiguities are not limited to calibration from a pair of views but apply to complete sequences. for instance if the set of rotations in a camera motion are all about the x-axis of the camera then there will be a reconstruction ambiguity and calibration from rotating cameras the same is true for y-axis rotations. one can see this geometrically as follows. consider a metric reconstruction of a scene from a sequence of images with only y-axis rotations of the camera. one can define a coordinate system in which the world y-axis is aligned with the direction of the camera s y-axis. now consider squashing the whole reconstruction and camera positions so that their y coordinate is multiplied by some factor k. from the imaging geometry it is easy to see that this will have the effect of multiplying the y image coordinate of any imaged point by the same factor k but not affecting the x-coordinate. however this effect can be undone by multiplying the thereby leaving scale factor y of coordinates in the image by the inverse factor k image coordinates unchanged. this shows that y is not unambiguously determined in fact it is unconstrained. in summary there is a one-parameter ambiguity parallel to the rotation axis in the metric reconstruction and a corresponding one-parameter ambiguity in the internal parameters. this argument shows that the problem of ambiguity is intrinsic to the motion and not to any particular auto-calibration algorithm. relationship to the kruppa equations. writing for two views as h ht and multiplying before and after by the matrix leads to f ft h ht since f h this is simply the kruppa equations which shows that they follow immediately from the infinite homography constraint. since is not invertible one can not go the other direction and derive the infinite homography constraint from the kruppa equations. thus the kruppa equations are a weaker constraint. however the difference is that to apply one needs to know the plane at infinity hence affine structure since it is true only for the infinite homography and not for an arbitrary h. the kruppa equations on the other hand do not involve any knowledge of affine structure of the scene. nevertheless this relationship shows that for a sequence of images any calibration ambiguity under the infinite homography relation is also an ambiguity of the kruppa equations. calibration from rotating cameras in this section we begin consideration of calibration under special imaging conditions. the situation considered here is the one in which the camera rotates about its centre but does not translate. we will consider both the case of fixed internal parameters and the case of some parameters known and fixed whilst others are unknown and varying. this situation is one that occurs frequently. examples include pan tilt and zoom surveillance cameras cameras used for broadcasts of sporting events which are almost invariably fixed in location but free to rotate and zoom and hand-held camcorders which are very often panned from a single viewpoint. even though the rotation is not exactly about the centre in practice the translation is generally negligible compared to the distance of scene points and a fixed centre is an excellent approximation. the calibration problem from rotating cameras is mathematically identical with the affine-to-metric calibration step in stratified reconstruction as given in section auto-calibration objective given m views acquired by a camera rotating about its centre with fixed or varying internal parameters compute the parameters of each camera. it is assumed that the rotations are not all about the same axis. algorithm inter-image homographies compute the homography hi between each view i and a reference view such that xi hix using for example algorithm normalize the matrices such that det hi compute in the case of constant calibration equations t i m as ac where a is a matrix and c the elements of the conic arranged as a or for variable calibration parameters use the equation i t to express linear constraints on entries of i in table unit aspect ratio as linear equations in the entries of rewrite the compute k determine the cholesky decomposition of as uut and thence k u t. iterative improvement refine the linear estimate of k by minimizing dxi j krik over k and ri where xj xi j are the position of the j-th point measured in the first and i-th images respectively. initial estimates for the minimization are obtained from k and ri k algorithm calibration for a camera rotating about its centre. from a non-translating camera it is impossible to achieve an affine any reconstruction because there is no way to resolve depth. nevertheless we may compute the infinite homography between the images which is all that is needed to determine the camera calibration. as has been shown earlier the images of two cameras with a common centre are related by a plane projective transformation. indeed if xi and x are corresponding image points then they are related by xi hix where hi kirik and ri is the rotation between view i and the reference view. furthermore since this map is independent of the depth of the points imaged at x it applies also to points at infinity so as shown in section hi hi kirik thus we have a convenient means of measuring h directly from images. given h a solution for the calibration matrices ki of all the images in the set acquired by the rotating camera may be obtained as described in section the method may be applied to either fixed or variable internal parameters and is summarized in algorithm we will illustrate this by a number of examples. calibration from rotating cameras fig. calibrating a camera rotating about its centre. five images of the us capitol acquired by approximately rotating the camera about its centre. a mosaic image constructed from the five images example the mosaic image shows very clearly the distortion effect of the infinite homography between the images. analysis of this distortion provides the basis for the auto-calibration algorithm. the calibration is computed as described in algorithm example rotation about centre with fixed internal parameters the images in figure were obtained using a camera with ordinary black and white film to produce negatives. the camera was hand-held and no particular care was taken to ensure that the camera centre remained stationary. prints enlarged from these negatives were digitized using a flat-bed scanner. the enlargement process can lead to a non-zero value of s and unequal values of x and y if the negative and print paper are not precisely parallel. the resulting image size was pixels. the constraint applied here is that the internal parameters are constant. the camera auto-calibration focal length linear non linear frame pan linear non linear s l e x i p h t g n e l l a c o f g e d n a p a c principal point linear non linear u_o b tilt linear non linear s l e x i p o v g e d t l i t frame frame d fig. rotation for varying internal parameters assuming square pixels. these are for the panned sequence of figure focal length. principal point. pan angle. tilt angle. figures courtesy of lourdes de agapito vicente. matrix computed as described in algorithm is klinear kiterative there is little difference between the linear and iterative estimates and the computed aspect ratio unity and principal point are very reasonable. example rotation about centre with varying internal parameters the images in figure were acquired by panning a camcorder approximately about its centre. the camera was not zoomed but due to auto-focus there might be slight variations in the focal length and principal point. in this example the constraint used is that the pixels are square i.e. that the skew is zero and the aspect ratio unity but the focal length and principal point are unknown and not fixed. then from table we have two linear constraints on from each view. from zero skew these constraints are assembled to give a linear system of equations on as described in algorithm and from unit aspect ratio t hi t hi t hi the internal parameters of the computed camera matrix for each view are shown it is evident that the recovered focal length and principal point are in figure quite constant though this was not imposed and the pan and tilt angles are very reasonable for this hand-held sequence. auto-calibration from planes auto-calibration from planes for a set of images of a planar scene the two-step approach of estimating a projective reconstruction followed by computation of a rectifying transformation to take it to metric does not work. this is because it is not possible to determine the cameras without depth relief. as seen in section a minimum of two points not lying on the plane are required. nevertheless auto-calibration from scene planes is possible. this was shown by who gave a solution in the case of constant internal parameters. the method is especially interesting from the point of view of potential applications. scenes consisting of planes are extremely common in man-made environments e.g. the ground plane. furthermore in aerial images acquired by a highflying aircraft or a satellite the depth-relief of the scene is small compared with the extent of the image and the scene may be accurately approximated as a plane and the auto-calibration method will apply. the starting point of the algorithm is a set of image to image homographies induced by the world plane. these can all be related back to the first image providing a set of homographies hi. geometrically auto-calibration from planes is then a marriage of two ideas. first the circular points on the plane which are the intersection of the absolute conic with the plane are mapped from image to image via the homographies. second as we have seen in example the calibration matrix k may be determined from the imaged circular points of a plane two constraints provided by each image. thus suppose the images of the circular points dof are determined in the first image some means then they may be transferred to the other views by the known hi. in each view then there are two constraints on since the two imaged circular points lie on in detail if we denote the this stage unknown imaged circular points in the first view by cj j then the auto-calibration equations are ihicj i m j where i. in solving these equations the unknowns are the coordinates of the circular points in the first image and some number of unknown calibration parameters. although the circular points are complex points they are complex conjugates of each other so parameters suffice to describe them. if in addition there are a total of v unknowns in the internal parameters ki of all m views then a solution is possible provided v since each view provides two equations. restrictions on the internal parameters of the cameras lead to further algebraic constraints according to table and these are used to supplement the constraints imposed by various cases are considered in table in most cases calibration from a plane is a non-linear problem and nothing more will be said here about computational aspects of how to find the solution. iterative methods are necessary minimizing some cost function. see for more details of minimization methods. implementation. a considerable implementational advantage of this method is that it only requires the homography between planes and not the point correspondences auto-calibration condition unknown but constant internal parameters constant known skew and aspect ratio. constant unknown principal point and focal length all internal parameters known except varying focal length varying focal length all other internal parameters fixed but unknown dofv views m m table the number of views required for calibration from a plane under various conditions. calibration is principle possible if v arising from points that are generally required to estimate multiple view tensors such as the fundamental matrix. the matching transformation between planes is a much simpler stabler and accurate computation because of the constrained nature of the inter-image transformation which is point-to-point. the method of algorithm may be used to estimate this transformation between two images. alternatively correlation-based methods that estimate the parametrized homography directly from image intensity may be used. including additional information. if additional information is available on the plane or the motion then the complexity of auto-calibration using scene planes may be reduced. for example if the vanishing line of the imaged plane can be determined then only two parameters are required to specify the circular points since the imaged circular points lie on the vanishing line. indeed if the plane provides sufficient information to estimate its imaged circular points directly as a square grid then the problem reduces to that of calibration from scene constraints discussed in section similarly constraints on the motion may be used to simplify the problem. one particular example is where the rotation axis describing the camera motion is parallel to the scene plane normal. in this case the imaged circular points may be computed directly from the fixed points of the homography and two linear constraints placed on this situation is discussed further in note at the end of the chapter. an example of such a motion is planar motion which is discussed in detail in the following section. planar motion a case of some practical importance is that of a camera moving in a plane and rotating about an axis perpendicular to that plane. this is the case for a roaming vehicle moving on a ground plane with a camera fixed with respect to the vehicle body. in this case the camera must move in a plane parallel to the ground and as the vehicle turns the camera will rotate about a vertical axis. it is not assumed that the camera is pointing horizontally or is in any other particular orientation with respect to the vehicle. however we assume constant internal calibration for the camera. the constrained nature of the motion makes the calibration task significantly simpler. planar motion it will be shown that given three or more images from a sequence of planar motions an affine reconstruction may be computed. to do this we need to determine the plane at infinity. this will be done by identifying three points on the plane at infinity thereby defining the plane. these points will be identified as being fixed points in the sequence of images. fixed image points under planar motion. according to section any rigid motion instance the camera motion can be interpreted as a rotation about screw axis along with a translation along the direction of the axis. for a planar motion the rotation axis is perpendicular to the plane of motion and the translational part of the screw motion is zero. think of the vehicle as being swung horizontally around the screw axis. the position of the screw axis with respect to the camera remains fixed and so it will constitute a line of fixed points in the image. if a second motion takes place about a different axis then the image of the second axis will be fixed in the second pair of images. the images of the two axes will in general be different but will intersect in the image of the point where the two screw axes meet. since the two axes are vertical they are perforce parallel and so will meet at their common direction on the plane at infinity. this direction projects into the images at the intersection of the images of the screw axes which is the vanishing point of the screw axes direction. this image point is called the apex. we now have one fixed point over the views and this will be used to determine one point on the plane at infinity in a projective reconstruction. as we have seen the image of the screw axis is a line of fixed points for an image pair. there is also a fixed line which is identifiable from a pair of images as follows. because the plane of motion of the camera will be called the ground plane is fixed the set of points in the plane is mapped to the same line in all the images. this line is called the horizon line and is the vanishing line of the ground plane. since each of the cameras lie on the ground plane their epipoles must all lie on the horizon line. unlike the image of the screw axis the horizon line is a fixed line but not a line of fixed points. although the horizon line is not fixed pointwise it contains two points that are fixed in the image pair namely the image of the two circular points on the ground plane. these circular points are the intersection of the absolute conic with the ground plane. since the image of the absolute conic is fixed under rigid motion and the image of the ground plane is fixed the images of two circular points must be fixed. in fact they will be fixed in all images from the planar motion sequence. this is illustrated in figure so far we have described the fixed points of the motion sequence. computing these fixed points is equivalent to affine reconstruction since we can back-project from the fixed image points to find the corresponding points on the plane at infinity. although the apex may be computed from two views it requires three views to compute the imaged circular points. computing the fixed points. the set of points in space that map to the same image point in two images is called the horopter. in general the horopter is a twisted cubic auto-calibration v image of screw axis c i e e a horizon c j image v b imaged screw axes horizon image fig. fixed image entities for planar motion. for two views the imaged screw axis is a line of fixed points in the image under the motion. the horizon is a fixed line under the motion. the epipoles e and imaged circular points of the ground plane ci cj lie on the horizon. the relation between the fixed lines obtained pairwise for three images under planar motion. the image horizon lines for each pair are coincident and the imaged screw axes for each pair intersect in the apex v. all the epipoles lie on the horizon line. but in the case of planar motion it degenerates to a line screw axis and a conic on the ground plane. the image of the horopter is the conic defined by f ft where f is the fundamental matrix section in the case of planar motion this will be a degenerate conic consisting of two lines the image of the screw axis and the horizon line figure by decomposing the conic these two lines are determined. from three images we can compute the image of the horopter for each of three pairs and thereby obtain three sets of horizon lines and imaged axes. the horizon line will be a common component of these sets and the other components images of the screw axes will intersect in the image at the apex. now we turn to computing the circular points. it is useful to understand the geometry of a pair of horopters corresponding to two pairs of images. let be a conic representing the portion of the horopter for images and lying in the ground plane. this conic will pass through the two circular points the two camera centres and the intersection of the screw axis with the ground plane. since the conic contains the circular points it is a circle. let be the corresponding circle defined from images and the two circular points and the centre of the second camera will lie on both circles. since two conics intersect in general in four points there must be a further intersection point. however this can be discarded since the points of interest are the two complex intersection points namely the circular points on the ground plane. in implementations authors have chosen different ways of finding the two circular points. in the method is based on finding fixed lines in three views through the apex using the trifocal tensor. in the method involves computing the trifocal tensor of a camera applied to imaging the ground plane to a image. in both cases the positions of the circular points on the horizon are obtained as the solution of a cubic in one variable. the main steps of this affine calibration method are summarized in algorithm planar motion objective given three more images acquired by a camera with constant internal parameters undergoing planar motion compute an affine reconstruction. algorithm the trifocal tensor may be computed by e.g. algorithm compute a projective reconstruction. from the trifocal tensor t for the three views. compute pairwise fundamental matrices from t see algorithm decompose the symmetric part of each fundamental matrix into two lines a horizon and the image of the screw axes. see section compute the apex. intersect the three imaged screw axes to determine the apex v. compute the horizon for the triplet. obtain the six epipoles from the three fundamental matrices and determine the horizon by an orthogonal regression fit to these epipoles. compute the imaged circular points. compute the position of the imaged circular compute the plane at infinity. triangulate points on the plane at infinity from the for each of v ci cj. this determines points on the horizon text ci cj. corresponding image points x three points on and hence determines the plane. with x compute an affine reconstruction. rectify the projective reconstruction using the computed as in algorithm algorithm affine calibration for planar motion. metric reconstruction. once the apex and two circular points are found the plane at infinity is computed and the infinite homographies between the images can be computed. calibration and metric reconstruction now proceeds in the usual way. however it must be noted that the constrained nature of the motion means that there is a one-parameter family of solutions for the calibration because all the camera rotations are about the same axis. we have the sort of calibration ambiguity considered in section it is necessary to make an assumption about internal calibration in order to find a unique result. if the y-axis of the camera is parallel with the rotation axis may be true in a practical situation then we have seen that the zero-skew constraint is not sufficient. the best plan is to enforce a zero-skew and known aspect ratio constraint if the pixels are square. example metric reconstruction for planar motion. figure shows four of seven images of a planar motion sequence. for this sequence the elevation angle of the camera is approximately the computed imaged screw axes and horizon lines using all possible pairs are shown in figure with the resulting estimated apex and horizon line. the positions of the imaged circular points were estimated as x y assuming an aspect ratio of the internal parameters of the calibration matrix k were computed as x y the accuracy of the metric reconstruction was assessed by measuring metric invariants. typical results are shown in figure auto-calibration a s l e x i p b c fig. planar motion sequence. four images seven used acquired from a camera mounted on a vehicle moving on a plane. the computed epipoles horizon lines solid and imaged screw axes dashed for all image pairs. euclidean invariants measured in the metric reconstruction the right angle is measured as the ratio of the non-parallel lengths is measured as to the approximate veridical value of single axis rotation turntable motion in this section we discuss auto-calibration of single axis motions where the relative motion between scene and cameras is equivalent to a rotation about a single fixed axis. this is a specialization of the planar motion case of section where here the screw axes for each motion are coincident. this situation occurs for example in the case of a static camera viewing an object rotating on a turntable. a second example is that of a camera rotating about a fixed axis from its centre. a third example is that of a camera viewing a rotating mirror. we will consider here turntable motion and for ease of discussion assume that the axis is vertical so that the motion occurs in a horizontal plane. again it is not assumed that the camera is pointing horizontally or is in any other particular orientation with respect to the axis. it is assumed that the internal calibration of the camera is constant. the fixed image points under a sequence of single axis rotation are those of planar motion described in section and shown in figure with the addition that the imaged screw axis is a line of fixed points. the constraint of figure is not available here as all the imaged screw axes are coincident. the consequence is that it is not possible to determine the apex v directly and only the two circular points on may be recovered from imaged fixed points. this means that the reconstruction in the absence of constraints on the internal parameters is not affine but a particular single axis rotation turntable motion parametrized projective transformation. metric structure is known in the horizontal planes the circular points of these planes is known but there is a projective transformation in the vertical direction. the resulting ambiguity is the transformation xp hxe where h and and are scalars which determine the intersection of the z axis with and the relative scaling between the horizontal and vertical directions. an example of the projective transformations represented by family of mappings is shown in figure computing the fixed points. one way to proceed is to determine the imaged circular points directly. as is evident from figure the point tracks are ellipses which are images of circles. in these circles lie in parallel horizontal planes and intersect in the circular points on in the image ellipses may be fitted to these tracks and the common intersection points of the image conics are the conjugate imaged circular points. the circular points may then be determined by triangulation from two or more views. this is the approach taken by an alternative more algebraic way to proceed is to model the camera matrices as pi i t where cos i sin i pi sin i cos i t with hk the columns of this division of the internal and external parameters means that and t are fixed over the sequence and only the angle of rotation i about the z axis varies for each camera pi. given this parametrization the estimation problem can then be precisely stated as determining the common matrix and the angles i in order to estimate the set of cameras pi for the sequence. thus a total of m parameters must be estimated for m views where is the number of degrees of freedom of the homography this is a considerable saving over the that would be required for a projective reconstruction of a general motion sequence. for single axis motion the fundamental matrix has the special form described in section and writing the matrix in terms of the camera matrices gives f which means that the columns of are partially determined once the fundamental matrix is computed. this is the approach taken by where a fundamental matrix of the special form is fitted to point correspondences section it may be shown that from or more views the first two columns of auto-calibration a b e m a r f c fig. dinosaur sequence and tracking six frames from a sequence of of a dinosaur rotating on a turntable sequence courtesy of the university of hannover a subset of the point tracks only the tracks which survived for longer than successive views are shown. track lifetimes each vertical bar corresponds to a single point track extending from the first to last frame in which that point was seen. the horizontal ordering is according to where the point first appeared in the sequence. the measurement matrix is relatively sparse and few points survive longer than frames. and the angle i can be fully determined but is only determined up to the two-parameter family corresponding to the ambiguity of metric reconstruction. the two parameter ambiguity in the reconstruction given by can be resolved by providing additional information on the internal parameters for example that the pixels are square. however if the camera is horizontal with image y axis parallel to the rotation axis then square pixels only provides one additional constraint the aspect ratio as the skew zero constraint does not provide an additional constraint. in this case further information on the camera is required the y coordinate of the principal point or the aspect ratio of the scene may be used. example reconstruction from a turntable sequence figure shows frames from a sequence of a model dinosaur rotating on a turntable and the resulting image point tracks. feature extraction is performed on the luminance component of the colour signal. the projective geometry of the turntable motion is de auto-calibration of a stereo rig a b fig. dinosaur scene points and camera positions for the dinosaur sequence. the automatic computation of a graphical model for this sequence is described in termined from these tracks no other information and the resulting reconstruction of cameras and points is shown in figure effectively the camera circumnavigates the object. a texture mapped graphical model may then be computed in principle by back-projecting cones defined by the dinosaur silhouette in each frame and intersecting the set of cones to determine the visual hull of the object. auto-calibration of a stereo rig in this section we describe a stratified method for calibrating a fixed two-camera stereo rig. fixed here means that the relative orientation of the cameras on the rig is unchanged during the motion and the internal parameters of each camera are also auto-calibration unchanged. it will be shown that from a single motion of the rig the plane at infinity is determined uniquely. suppose a fixed stereo rig undergoes a general motion. the projective structure of the scene can be obtained before and after are two projective reconstructions of the same scene they are related by a projective transformation hp as the motion. since x and hpx. however the actual motion of the rig is euclidean and it follows below that the homography hp is conjugate to the euclidean transformation representing the motion. conjugacy is the key result because under a conjugacy relation fixed entities are mapped to fixed entities. consequently the fixed entities of the euclidean motion particular the plane at infinity can be accessed from the fixed entities of the projective motion represented by hp. conjugacy relation. suppose xe represents a point in in a euclidean coordinate frame attached to the rig and e represents the same point after the motion of the rig. then the points are related as e hexe where he is a non-singular euclidean transformation matrix that represents the rotation and translation of the rig. suppose also that the point is represented in a projective coordinate frame attached to the rig which is obtained by a projective reconstruction then xe hepx e where hep is a non-singular matrix that relates projective to metric structure. an essential point to note here is that the two projective reconstructions before and after the camera must be in the same projective coordinate frame in other words the same pair of cameras matrices must be used before and after. from and if follows that hp h ep he hep so that hp is conjugate to a euclidean transformation. there are two important properties of this conjugacy relation hp and he have the same eigenvalues. if e is an eigenvector of he then the corresponding eigenvector of hp with the same eigenvalue is ep e i.e. the eigenvectors of he are mapped to the eigenvectors of hp by the point transformation this follows from for if hee e then hephph ep gives the desired result. ep e e and pre-multiplying by h auto-calibration of a stereo rig fixed points of a euclidean transformation. consider the euclidean transformation represented by the matrix he t r cos sin cos sin this is a rotation by about the z-axis together with a unit translation along the zaxis is a general screw motion. the eigenvectors of he are the fixed points under the transformation to section in this case the eigenvalues are e i and the corresponding eigenvectors of he are i i all the eigenvectors lie on this means that is fixed as a set but is not a plane of fixed points. the eigenvectors and are the circular points for planes perpendicular to the z axis. the other two eigenvectors and are the direction of the rotation axis. e e e the eigenvectors of h t computing if the point transformation matrix is he then from the plane transformation matrix is h t are the fixed planes under the motion. the matrix h t also has two equal unit eigenvalues and a single eigenvector corresponding to these which is the plane as may easily be verified. the eigenvectors of h t p in the same manner as the mapping of eigenvectors of he to those of hp described above. consequently in the projective reconstruction is the eigenvector corresponding to the real eigenvalue of h t p thus may be computed uniquely as the real eigenvector of h t more simply as the real eigenvector of ht p are mapped to those of h t p or equivalently and e we observe here that although the real eigenvalue has algebraic multiplicity of two its geometric multiplicity the case of non-planar motions is one. this is what enables us to find the plane at infinity. the procedure for affine calibration is summarized in algorithm metric calibration and ambiguities. once is identified the metric calibration may proceed as described in the stratified algorithm since the rig is fixed the parameters of the left camera are unchanged during the motion similarly for the right camera. from a single motion the internal parameters of each camera are determined up to the one-parameter family resulting from a single rotation as described in section as usual the ambiguity from a single motion is removed by additional motions or objective auto-calibration given two more stereo pairs of images acquired by a fixed stereo rig undergoing general motions both r and t are non-zero and t not perpendicular to the axis of r compute an affine reconstruction. algorithm compute an initial projective reconstruction x using the first stereo pair compute a projective reconstruction prxj as described in chapter this involves computing the fundamental matrix f and point correspondences between the images of the first pair xl j xr j e.g. use algorithm compute a projective reconstruction after the motion compute correspondences j x between the images of the second stereo pair x j since both the internal and relative external parameters of the cameras are fixed the second stereo pair has the same fundamental matrix f as the first. the same camera matrices pl pr are used for triangulating points in the second stereo pair. j in from the computed correspondences x j x j compute correspondences between j x the left images of the two stereo pairs xl j again use algorithm this establishes correspondences between the space points xj j. the homography hp may be estimated linearly from five or more of these point correspondences and then the estimate refined by minimizing a suitable cost function over hp. for example minimizes the distance between the dxr minimizing measured and reprojected image points. j j jdxl compute the matrix hp which relates x to affine reconstruction compute from the real eigenvector of ht p and thence an affine reconstruction. algorithm affine calibration of a fixed stereo rig. by supplying additional constraints such as that the pixels are square. if there are additional motions then an improved estimate of may also be computed. the outcome of metric calibration is the complete calibration of the rig the relative external orientation of the cameras and their internal parameters. planar motion. in the special case of orthogonal motion where the translation is orthogonal to the rotation axis direction the space of eigenvectors corresponding to the repeated eigenvalue is two-dimensional. consequently is determined only up to a one-parameter family. we are therefore unable to find the plane at infinity uniquely is examined in detail in example the ambiguity may be resolved by a second orthogonal motion about an axis with a different direction from the first. example auto-calibration from two stereo pairs figure shows the two stereo pairs used for the affine calibration of the stereo rig following the procedure of algorithm the accuracy of the calibration is assessed by computing a vanishing point in the right image in two ways first as the intersection of imaged parallel lines second by determining the corresponding vanishing point in the left image images of the same parallel lines and mapping this vanishing point to the right image using the infinite homography computed from closure a b c d e fig. auto-calibration of a stereo rig. the input stereo pairs before and after the motion of the rig. the stereo rig moves left by about cm pans by about and changes elevation by about the accuracy of the computed h is assessed on another stereo pair acquired by the same rig as follows in the left image a stereo pair a vanishing point is computed by intersecting the imaged sides of the table are parallel in the scene. in the right image a stereo pair the corresponding vanishing point is computed. the white square the line intersection is the vanishing point from the left image mapped to the right using the computed h in the absence of error the points should be identical. following metric calibration the computed angle between the desk sides in white from the reconstruction is in very good agreement with the veridical value. the eigenvector of ht p the discrepancy between the vanishing points is a measure of the accuracy of the computed h the metric calibration uses the zero skew constraint to resolve the one-parameter ambiguity. angles in the resulting metric reconstruction are accurate to within closure research in the area of auto-calibration is still quite active and better methods than those described in this chapter may yet be developed. there is still a lack of closed form solutions from multiview tensors and of algorithms to automatically detect critical motion sequences below. critical motion sequences. it has been seen in this chapter that for certain classes of motion it is not possible to completely determine the rectifying homography h. the resulting reconstruction is then at some level between metric and projective. for example for constant internal parameters in the case of planar motion there is a oneparameter scaling ambiguity parallel to the rotation axis and for pure translation under constant internal parameters the reconstruction is affine. sequences of camera motions for which such ambiguities arise are termed critical motion sequences and have been systematically classified by sturm in the case of constant internal parameters. this classification has been extended to more general calibration constraints such as varying focal lengths for recent work see auto-calibration recommendations. it may seem that auto-calibration offers a complete solution to metric reconstruction. calibrated cameras are not necessary and we can do with constraints as weak as the zero-skew constraint on the camera. unfortunately one must be wary of putting complete trust in auto-calibration. auto-calibration can work well in the right circumstances but used recklessly it will fail. several specific recommendations can be made. take care to avoid ambiguous motion sequences. it has been seen that calibration degeneracies occur if the motion is too restricted such as being about a single axis. the motion should not be too small or cover too small a field of view. auto-calibration often comes down to estimating the infinite homography the effects of which are not apparent on small fields of view. use as much information as you have. although it is possible to calibrate from minimal information such as zero skew this should be avoided if other information is available. for instance the known aspect ratio constraint should be used if it is valid as should the knowledge of the principal point. even if the values are known only imprecisely this information can be incorporated into a linear auto-calibration method by including an equation but with low weight. this recommendation relates to bundle adjustment as well. generally it is best to finish off with a bundle adjustment. in doing this it is recommended that the internal parameters of the camera not be left to float unbounded. for instance even if the principal point is not known exactly it is usually known within some reasonable bounds is not close to infinity for instance. similarly aspect ratio normally lies between and this knowledge should be incorporated in a bundle adjustment by adding further constraints to the cost function with small weights deviations if necessary. this can give an enormous improvement in results where auto-calibration is poorly conditioned hence unstable by preventing the solution from wandering off into remote regions of parameter space in quest of a minor and insignificant improvement in the cost function. methods that use restricted motions usually are more reliable than those that allow general motion. for instance the methods that involve a rotating but nontranslating camera are generally much more reliable than general motion methods. the same is true of affine reconstruction from a translational motion. the literature the idea of auto calibrating a camera originated in faugeras et al. where the kruppa equations were used. the early papers considered the case of constant internal parameters. investigated bundle-adjustment like methods for more than two views. and mohr et al. the affine reconstruction solution for the case of pure translation was given by moons et al. and was extended to a combination of pure translation followed by rotation for a full metric reconstruction by armstrong et al. the case of auto-calibration for a camera rotating about its centre closure was given by the modulus constraint was first published by pollefeys et al. the original method for auto-calibration of a stereo rig was given by zisserman with alternative parametrizations given in devernay and et al. faugeras and horaud and csurka the special case of planar motion of a stereo rig is covered in for planar motion of a monocular camera the original method was published by armstrong et al. and an alternative numerical solution was given in faugeras et al. in more recent papers less restrictive constraints than constant internal parameters have been investigated. a number of existence proofs have been given heyden and astr om showed that metric reconstruction is possible knowing only skew and aspect ratio and showed that skew-zero alone was sufficient. triggs introduced the absolute quadric as a numerical device for formulating auto-calibration problems and applied both linear methods and sequentialquadratic programming to solve for q pollefeys et al. showed that computations based on q could be used to compute metric reconstructions for varying focal length under general motion for real image sequences. for the case of a rotating camera de agapito et al. gave a nonlinear solution for varying internal parameters based on the use of the diac. this was modified in to an iac-based linear method. notes and exercises first gave a solution for the extraction of focal lengths from the fundamental matrix but the algorithm given there is unwieldy. a simple elegant formula is given in if are the principal points in the where i is the matrix and p and two images. unit aspect ratio and zero skew are assumed. the formula for is given by reversing the roles of the two images transposing f. note that the final step of the algorithm is to take a square root. it is assured as computed by are positive given good data and a that and good guess of the principal point. however in practice this does not always pertain and negative values can result. this is the same problem as mentioned previously in section in addition as flagged in the method has an intrinsic degeneracy when the principal rays of the two cameras meet in space in which case it is impossible to compute the focal lengths independently. this occurs when both cameras are trained on the same point quite a common occurrence. a further degeneracy occurs when the plane defined by the baseline and the auto-calibration principal ray of one camera is perpendicular to the plane defined by the baseline and principal ray of the other camera. generally speaking our opinion is that this method is of doubtful value as a means of computing focal lengths. show that if the internal parameters are constant then the constraints on q obtained from two views are equivalent to the kruppa equations hint from the cameras may be chosen as f show from that in the case of a camera translating with constant internal parameters and without rotating then the plane at infinity may be computed directly from a projective reconstruction. the infinite homography relation may be derived in two lines in section this may simply from the definition hij kirijkj be rearranged as hij kj kirij. eliminating the rotation using orthogonality as rijrij t i gives hij thij t under he points on with are mapped to points on by the homography x rx under this point transformation a conic on maps according to result c r tcr rcrt. the absolute conic is fixed since rirt i. now denote by a the direction of the rotation axis so that ra the point conic aat is also fixed. it follows that there is a pencil of fixed conics c aat under the mapping since r aatrt rirt raatrt aat. the scalar parametrizes the pencil. this shows that under a particular similarity there is a one-parameter family of fixed conics on however it is the case that is the only conic fixed under any similarity. a further calibration ambiguity exists for a common type of robot head namely a pan-tilt alt-azimuth head. in it was shown that since the camera may rotate about its x or y axes its set of orientations form only a family rather than a family of general rotations. this limitation causes an ambiguity in the aspect ratio x of the camera and consequently of as well. the method of auto-calibration from planes is generally non-linear. however for special motions linear constraints on can be obtained. suppose we have two images of a plane that induces a planar homography h between views and imagine that the motion of the camera relative to the plane is a general screw motion but with the screw axis parallel to the plane normal. consider the action of this screw motion on the plane. since this action rotation about the plane s normal and a translation does not change the plane s orientation its line of intersection with the plane at infinity is unchanged a set. the absolute conic is fixed a set under euclidean motion. consequently the plane s intersection with the absolute conic which defines the circular points for the plane is also unchanged under the motion. closure consider now applying the action to the camera viewing the plane. since the two circular points are fixed points they have the same image before and after the motion. as the homography h maps points on the plane between images the imaged circular points must correspond to two of its fixed points section and can thus be determined directly from the homography. each circular points places a linear constraint on further details of this method are given in duality it has been known since the work of carlsson and weinshall et al. that there is a dualization principle that allows one to interchange the role of points being viewed by several cameras and the camera centres themselves. in principle this implies the possibility of dualizing projective reconstruction algorithms to obtain new algorithms. in this chapter this theme is developed to outline an explicit method for dualizing any projective reconstruction algorithm. at the practical implementation level however it is shown that there are difficulties which need to be overcome in order to allow application of this dualization method to produce working algorithms. carlsson weinshall duality let and form part of a projective basis for similarly let and be a projective basis for the projective image plane now consider a camera with matrix p. we assume that the camera centre c does not sit on any of the axial planes that is none of the four coordinates of c is zero. in this case no three of the points pei for i are collinear in the image. consequently one may apply a projective transformation h to the image so that ei hpei. we assume that this has been done and henceforth denote hp simply by p. since pei ei the form of the matrix p is a p b d d c d definition a camera matrix p is called a reduced camera matrix if it maps ei to ei for each i in other words ei pei. carlsson weinshall duality now for any point x y z tt one verifies that a p a b d d c d y z t x x b d d c d x y z t notice the symmetry in this equation between the entries of the camera matrix and the coordinates of the point. they may be interchanged as follows ax dt by dt cz dt a b c d y t t z t the interchange of the roles of cameras and points may be interpreted as a form of duality which will be referred to as carlsson weinshall duality or more briefly carlsson duality. the consequences of this duality will be explored in the rest of this chapter. dual algorithms first of all we will use it for deriving a dual algorithm from a given projective reconstruction algorithm. specifically it will be shown that if one has an algorithm for doing projective reconstruction from n views of m points then there is an algorithm for doing projective reconstruction from m views of n points. this result observed by carlsson will be made specific by explicitly describing the steps of the dual algorithm. we consider a projective reconstruction problem which will be referred to as pm n. it is the problem of doing reconstruction from m views of n points. we denote image points by xi j which represents the image of the j-th object space point in the i-th view. thus the upper index indicates the view number and the lower index represents the point number. such a set of points is called realizable if there are a set of camera matrices pi and a set of points xj such that xi j pixj. the projective reconstruction problem pm n is that of finding such camera matrices pi and points for m views of n points. the set of camera matrices and xj given a realizable set points together are called a realization projective realization of the set of point correspondences. let an m represent an algorithm for solving the projective reconstruction problem pn m an algorithm will now be exhibited for solving the projective reconstruction pm n this algorithm will be denoted a n the dual of the algorithm an m initially the steps of the algorithm will be given without proof. in addition difficulties will be glossed over so as to give the general idea without getting bogged down in details. in the description of this algorithm it is important to keep track of the range of the indices and whether they index the cameras or the points. thus the following may help to keep track. j j duality views m xi j n n n xm xm xm n m m m m points points views m x i j x x x x x n x n n x m x m x m n ti tm fig. left input to algorithm a n right input data after transformation. upper indices represent the view number. lower indices represent the point number. i ranges from to m. j ranges from to n. k ranges from to the dual algorithm given an algorithm an m the goal is to exhibit a dual algorithm a n input the input to the algorithm a in m views. this set of points can be arranged in a table as in figure n consists of a realizable set of n points seen in this table the points xi receive special treatment. nk are separated from the other points xi j since they will step transform the first step is to compute for each i a transformation ti that maps the points xi nk k in the i-th view to the points ek of a canonical basis for projective the transformation ti is applied also to each of the points xi j to produce transformed points j. the result is the transformed point array shown in figure a different transformation ti is computed and applied to each column of the array as indicated. j tixi carlsson weinshall duality points m views n x j i m m x j i x i j xn xn xn m points views n x j i m m m xn xn xn m fig. left transposed data. right transposed data extended by addition of extra points. step transpose the last four rows of the array are dropped and the remaining block of the array is i transposed. one defines xj j at the same time one does a mental switch of points and views. thus the point xj i is now conceived as being the image of the i-th point in the j-th view whereas the point j was the image of the j-th point in the i-th view. what is happening here effectively is that the roles of points and cameras are being swapped the basic concept behind carlsson duality expressed by the resulting transposed array is shown in figure step extend the array of points is now extended by the addition of four extra rows containing points ek in all positions of the k-th row of the array as shown in figure the purpose of this extension will be explained in section step solve the array of points resulting from the last step has m rows and n columns and may be regarded as the positions of m points seen in n views. as such it is a candidate for solution by the algorithm an m which we have assumed is given. essential here is that the points in the array form a realizable set of point correspondences. jusof cameras pj and points such that xj i in addition corresponding to the last tification of this is deferred for now. the result of the algorithm an m is a set four rows of the array there are points such that ek for all j. step transformation since the reconstruction obtained in the last step is a projective reconstruction one may transform it choose a projective coordinate frame such that the points are the four points ek of a partial canonical basis for the only requirement is that the points obtained in the projective reconstruction are not coplanar. this at this point one sees that ek pjek. from this it follows that pj has assumption is validated later. duality the special form pj aj bj dj dj cj dj step dualize let yi zi tit and pj be as given in now define points xj bj cj djt and cameras xi yi ti ti zi ti then one verifies that tidj yibj tidj zicj tidjt xj i j if in addition one defines xnk ek for k then ek. it is then evident that the cameras and points xj and xnk form a projective realization of the transformed data array obtained in step of this algorithm. step reverse transformation and with the points xj and xnk obtained in the finally defining pi previous step one has a projective realization of the original data. indeed one verifies pixj j xi j this completes the description of the algorithm. one can see that it takes place in various stages. in step the data is transformed into canonical image reference frames based in steps and the problem is mapped into the dual domain resulting in a dual on the selection of four distinguished points. problem pn m the dual problem is solved in steps and step maps the solution back into the original domain. step undoes the effects of the initial transformation. carlsson weinshall duality justification of the algorithm to justify this algorithm one needs to be sure that at step there indeed exists a solution to the transformed problem. before considering this it is necessary to explain the purpose of step which extends the data by the addition of rows of image points ek and step which transforms the arbitrary projective solution to one in which four points are equal to the basis points ek. the purpose of these steps is to ensure that one obtains a solution to the dual reconstruction problem in which pj has the special form given by in which the camera matrix is parametrized by only values. the dual algorithm is described in this manner so that it will work with any algorithm an m whatever. however both steps and may be eliminated if the known algorithm an m has the capability of enforcing this constraint on the camera matrices directly. algorithms based on the fundamental matrix trifocal or quadrifocal tensors may easily be modified in this way as will be seen. in the mean time since pj of the form is called a reduced camera matrix we call any reconstruction of a set of image correspondences in which each camera matrix is of this form a reduced reconstruction. not all sets of realizable point correspondences allow a reduced realization however. the following result characterizes sets of point correspondences that do have this property. result a set of image points i m j n admits a reduced realization if and only if it may be augmented with supplementary correspondences xi nk ek for k such that j the total set of image correspondences is realizable and the reconstructed points xnk corresponding to the supplementary image cor respondences are non-coplanar. proof. the proof is straightforward enough. suppose the set permits a reduced realization and let pi be the set of reduced camera matrices. let points xnk ek for k be projected into the m images. the projections are xi nk pixnk piek ek for all i. conversely suppose the augmented set of points is realizable and the points xnk are non-coplanar. in this case a projective basis may be chosen such that xnk ek. then for each view one has ek piek for all k. from this it follows that each pi has the desired form one other remark must be made before proving the correctness of the algorithm. result if a set of image points reduced realization then so does the transposed set xj where xj j for all i and j. i xi j i m j n permits a j n i m i this is the basic duality property effectively proved by the construction given in step of the algorithm above. now it is possible to prove the correctness of the algorithm. result let xi correspondences and suppose j and xi duality nk as in figure be a set of realizable image point for each i the four points xi nk do not include three collinear points. the four points xnk in a projective reconstruction are non-coplanar. then the algorithm of section will succeed. proof. because of the first condition transformations ti exist for each i transforming the input data to the form shown in figure this transformed data is also realizable since the transformed data differs only by a projective transformation of the image. now according to result applied to figure the correspondences j admit a reduced realization. by result the transposed data figure also admits a reduced realization. applying result once more shows that the extended data figure is realizable. furthermore the points are non-coplanar and so step is valid. the subsequent steps and go forward without problems. the first condition may be checked from the image correspondences xi j. it may be thought that to check the second condition requires reconstruction to be carried out. it is however possible to check whether the reconstructed points will be coplanar without carrying out the reconstruction. this is left as an exercise for the reader reduced reconstruction in this section we concentrate on and reevaluate steps of the algorithm described in the preceding section. to recapitulate the purpose of these steps is to obtain a reduced reconstruction from a set of image correspondences. thus the input is a set of image correspondences xj i admitting a reduced realization figure the i for all output is a set of reduced camera matrices pj and points such that xj i j. as we have seen one way to do this in steps of the given algorithm is to augment the points by the addition of four extra synthetic point correspondences xj mk carrying out projective reconstruction and then applying a homography so that the points are mapped to the points ek of a projective basis for the problem with this is that in the presence of noise the projective reconstruction is not exact. thus the camera matrices obtained by this method will map points ek to points close to but not identical with ek. this means that the camera matrices are not exactly in reduced form. therefore we now consider methods of computing a realization of the point correspondences in which the cameras are exactly reduced. the reduced fundamental matrix the most evident applications of these dual methods are to dualize the reconstruction algorithms involving the fundamental matrix and trifocal tensor. these will lead to reconstruction algorithms for or points across n views. in this section we consider reconstruction from points. the dual of a reconstruction problem reduced reconstruction pn is a problem n namely reconstruction from n points in views. the method of chapter involving the fundamental matrix is a standard way of solving such a problem. to this end we define a reduced fundamental matrix definition a fundamental matrix f is called a reduced fundamental matrix if it satisfies the condition et i fei for i it is evident that since a reduced fundamental matrix already satisfies constraints derived from four point correspondences it may be computed from a small number of additional points in fact linearly from four points or non-linearly from three points. computation of the reduced fundamental matrix for a reduced fundamental matrix the condition et fei for i implies i that the diagonal entries of f are zero. the requirement that gives the additional condition that the sum of entries of f is zero. thus one may write f in the form f q r s t q r s t p thereby parametrizing a fundamental matrix satisfying all the linear constraints not the condition det f now a further point correspondence x satisfying fx is easily seen to provide a linear equation in the parameters p t of f. given at least four such correspondences one may solve for these parameters up to an inconsequential scale. given only three such correspondences the extra constraint det f may be used to provide the extra constraint necessary to determine f. there may be one or three solutions. this computation is analogous to the method used in section to compute the fundamental matrix from seven point correspondences. with four correspondences xi i or more one finds a least-squares solution. retrieving reduced camera matrices computing a pair of reduced camera matrices that correspond to a reduced fundamental matrix is surprisingly tricky. one can not assume that the first camera is as in the usual projective camera case since this is non-generic the camera centre corresponding with the basis point however we may instead assume that the pair of cameras are of the form p and a b d d c d since the centre of the first camera is which is a generic point with respect to the basis points further if d then we may assume that d but we prefer not to do this. duality the reduced fundamental matrix corresponding to this pair of cameras is f bd c cd b cd a ad c ad b bd a which the reader may verify satisfies the four linear constraints as well as the zerodeterminant condition. the task at hand is to retrieve the values of b c d given the fundamental matrix. this seemingly requires a solution of simultaneous quadratic equations but there is a linear method as follows. the ratio a b c may be found by solving the set of homogeneous linear equations a b c where fij is the ij-th entry of f. the matrix appearing here clearly has the same rank as f so there is a unique solution to scale to this equation set. the solution a b c a b c provides a set of homogeneous equations in a b and c namely ba ab ca ac and cb bc of which two are linearly independent. similarly one may find the ratio d a d b d c by solving a d b d c f once again the solution is unique. this provides two more linear equations in the values of a b c d. from the set of equations one may solve for b c d up to scale and hence reconstruct the second camera matrix according to solving for six points in three views the minimal case involving the computation of the reduced fundamental matrix involves three point in which case there may be three solutions. by dualization this leads to a solution to the reconstruction problem for six points in three views. its use in outlier detection using the trifocal tensor has been described in algorithm because of its intrinsic interest as a minimum-case solution and because of its practical use the algorithm is given explicitly as algorithm the algorithm consists essentially of putting together what has been described previously. however there are a few minor variations. in algorithm the final estimation of the camera matrices takes place in the domain of the original point measurements. as an alternative one could apply a dlt algorithm in the dual domain as in the basic algorithm of section however the present method seems simpler. it has the advantage of avoiding the need for applying the inverse transformations t more significantly the final computation of the camera matrices is carried out using the original data. this is important because the transformations can severely skew the noise characteristics of the data. the basis for this algorithm and the n-view case to follow is the dual fundamental reduced reconstruction objective given a set of six point correspondences xj pute a reconstruction from these points consisting of the three camera matrices p and the six points algorithm j j across three views comand select a set of four points no three of which are collinear in any of the three views. let these be the correspondences t to the other two points and resulting in points and for the first view find a projective transformation t that maps each to ek. apply from the dual correspondence derive an equation in the entries p q r s t of the reduced fundamental matrix f as in the equation is derived from the relationship xt for k f in the same way as in the last two steps form two more equations from the points in the other two views. this results in a set of three homogeneous equations in five unknowns. there will be a two-parameter family of solutions for the reduced fundamental matrix generated by two independent solutions and the general solution is f from the requirement det f one derives a homogeneous cubic equation in which one may solve to find and hence f. there will be or real solutions. further steps are applied to each solution in turn. use the method of section to extract the parameters b c dt of the second reduced camera matrix p defined in we complete the reconstruction in the original measurement domain. the dual of defined by b c d is the point b c dt. thus the six points are era p b c dt and ek for k this gives the structure of the reconstructed scene. one may then compute the three camera matrices using the dlt algorithm for camera calibration described in section since we require the camera matrices defined with respect to the original camera coordinates here we use the original coordinates to solve for p such that pxj xj etc. since the solution will be exact the dlt solution will be sufficient. and algorithm algorithm for computing a projective reconstruction from six points in three views. matrix f. note how the dual fundamental matrix expresses a relationship between points in the same image. indeed the equations used to solve for f are constructed from points in the same image. this contrasts with the standard fundamental matrix where the relationships being encoded are between points seen in separate images. six points in n views the method for six points in three views can be applied with little modification to the case of six points in many views. the main difference is that the reduced fundamental matrix f will be uniquely determined by the data. specifically at step of the algorithm of section each view will contribute one equation. with four views or more this will be sufficient to determine f. in this redundant-data case one must be careful with the effects of noise. for this reason it appears preferable to carry out the last step of the algorithm as shown with original untransformed points. this mitigates the effect of noise distortion that would result from working with transformed points. duality seven points in n views the problem of seven points in n views is dual to the case of three views of points and is solved by computing the reduced trifocal tensor from n point correspondences. definition a trifocal tensor t is called a reduced trifocal tensor if it satisfies the linear constraints imposed by synthetic point correspondences ek k for i k the general method for reconstruction from points is similar to the method for six points in n views except that the reduced trifocal tensor is used instead of the reduced fundamental matrix. there are however some minor differences. in computing the reduced trifocal tensor the constraints corresponding to the synthetic correspondences ej ej ej should be satisfied exactly whereas the other correspondences used to compute the tensor are subject to noise and will only be satisfied approximately. otherwise the computed tensor will not be exactly in reduced form. in the case of the reduced fundamental matrix this was handled by giving a specific parametrization of the reduced fundamental matrix. that is it was parametrized in such a way that the constraints generated by the synthetic correspondences were automatically satisfied in the case of the trifocal tensor it is not obvious that such a convenient parametrization is possible. the synthetic constraints are of the form eiepeqjprkqst jk i which is rather more complicated than the linear constraints on the reduced fundamental matrix. instead one may proceed in the following manner. in the usual linear method of computing the trifocal tensor one must solve a set of linear equations of the form at or more precisely find the vector t that minimizes subject to in solving for the reduced trifocal tensor the matrix a may be divided into two parts corresponding to those constraints from the synthetic correspondences which should be satisfied exactly and the constraints from real correspondences which must be satisfied in a least-squares sense. the first set of constraints are of the form ct and the second set may be written as at the problem becomes find t that minimizes subject to and ct an algorithm for solving this problem is given as algorithm for the problem of extracting the three camera matrices from the reduced tensor no simple method seems to be available similar to that described in section for the fundamental matrix. instead one may use the method described in steps and of the general dual algorithm page the minimal configuration of this type is seven points in two views. in this case the problem is best solved directly by the method of section rather than by dualization to the case of three points in six views. performance issues dual reconstruction algorithms based on the reduced fundamental matrix and trifocal tensor have been implemented and tested. the results of these tests were contained closure in a student report presented in august by gilles debunne. since this report is effectively unavailable the results are summarized here. the most serious difficulty is the distortion of the noise distribution by the application of projective transformations ti to the images. application of projective transformations to the image data has the effect of distorting any noise distribution that may apply to the data. the problem is related to the need to choose four points that are noncollinear in any of the images. if the points are close to collinear in any of the images then the projective transformation applied to the image in step of the algorithm may entail extreme distortion of the image. this sort of distortion can degrade performance of the algorithm severely. without special attention being paid to the noise-distortion performance of the algorithms was generally unsatisfactory despite great care being taken to minimize errors due to noise in steps of the algorithm f when the inverse projective transformations are applied in step the average error became very large. some points retained quite small error whereas in those images where distortion was significant quite large errors resulted. normalization in the sense of section is also a problem. it has been shown to be essential for performance of the linear reconstruction algorithms to apply data normalization. however what sort of normalization should be applied to the transformed data of figure which is geometrically unrelated to actual image measurements is a mystery. to get good results it would seem that one would need to propagate assumed error distributions forward in step of the algorithm to get assumed error distributions for the transformed data figure and then during reconstruction to minimize residual error relative to this propagated error distribution. equivalently cost functions being minimized during reconstruction must be related back to measurement error in the original image points. recent work reported in has shown that this indeed gives significantly improved results. closure the literature the idea behind carlsson weinshall duality was first described in a pair of papers appearing simultaneously and weinshall and subsequently in a joint paper the treatment given here for the general method of dualizing an algorithm was given in derived from these earlier papers. details of methods for handling with noise propagation were given in building on earlier implementations contained in an unavailable report by gilles debunne the problem of reconstruction from six points in three views was perhaps first treated in a technical report published as where the existence of up to eight solutions was shown. the problem was given a complete solution in where it was shown that only three solutions are possible. this was also pointed out in the paper established that this problem is duality dual to the two-view seven point problem for which a solution was known. this enabled the formulation of the method given in this chapter. the minimum six point configuration was used in for robust estimation of the trifocal tensor. an alternative method for computing a reconstruction from six points in n views is given in this method does not require that images are first projectively transformed to a canonical basis. notes and exercises in the dual algorithm of section it was noted that the method will only work if the four points used to define the image transformations are noncoplanar. however note that in this case the algorithm of section will compute a projective reconstruction linearly. if the four chosen points are coplanar then the homographies ti will map the plane to a common coordinate system. the transformed points j will then satisfy the condition of section namely the lines joining any pair of points k and k fixed and a different line for each i will meet in a common point. the duality in the case is described in still in the case of the four chosen points being coplanar after applying the ti any point on the plane of the four points will map to the same point in all images. thus the fundamental matrix consistent with the point correspondences will be skew-symmetric. j and cheirality when a projective reconstruction of a scene is carried out from a set of point correspondences an important piece of information is typically ignored if the points are visible in the images then they must have been in front of the camera. in general a projective reconstruction of a scene will not bear a close resemblance to the real scene when interpreted as if the coordinate frame were euclidean. the scene is often split across the plane at infinity as is illustrated in two dimensions by figure it is possible to come much closer to at least an affine reconstruction of the scene by taking this simple constraint into account. the resulting reconstruction is called quasi-affine in that it lies part way between a projective and affine reconstruction. scene objects are no longer split across the plane at infinity though they may still suffer projective distortion. converting a projective reconstruction to quasi-affine is extremely simple if one neglects the cameras and requires only that the scene be of the correct quasi-affine form in fact it can be accomplished in about two lines of programming corollary to handle the cameras as well requires the solution of a linear programming problem. quasi-affine transformations a subset b of irn is called convex if the line segment joining any two points in b also lies entirely within b. the convex hull of b denoted b is the smallest convex set containing b. our main concern will be with point sets so n we view as being a subset of consisting of all non-infinite points. the infinite points constitute the plane at infinity denoted thus a subset of will be called convex if and only if it is contained in and is convex in hence according to this definition a convex set does not contain any infinite points. definition consider a point set a projective mapping h is said to preserve the convex hull of the points if hxi is a finite point for all i and h maps the convex hull of points bijectively onto the convex hull of the points cheirality a b fig. an image of a comb and the result of applying a projective transformation to the image. the projective transformation does not however preserve the convex hull of the set of points constituting the comb. in the original image the convex hull of the comb is a finite set contained within the extent of the visible image. however some of the points in this convex hull are mapped to infinity by the transformation. an example shown in figure may help in understanding this definition. the example deals with point sets but the principle is the same. the figure shows an image of a comb and the image resampled according to a projective mapping. the projective mapping does not however preserve the convex hull of the comb. most people will agree that the resampled image is unlike any view of a comb seen by camera or human eye. the last coordinate is equal to the property of preserving the convex hull of a set of points may be characterized in various different ways as is shown by the theorem to be given shortly. in order to state this theorem we introduce a new notation. notation. the symbol denotes a homogeneous representation of a point x in which thus for instance if h is a projective transformation we may write t mean that the transformation takes point to point commonly in this chapter we will be interested in the exact equalities equalities up to scale between vectors representing homogeneous quantities such as points in to is but that the scale factor t required to make this equality exact. now for the theorem. theorem consider a projective transformation h and a set of points let be the plane mapped to infinity by h. the following statements are equivalent. h preserves the convex hull of the points x for any point x in the convex hull of the points t let h be a matrix representing the transformation h and suppose that i. then the constants t i all have the same sign. i quasi-affine transformations t y z is equal to zero. this means that h x x proof. this will be proved by showing that if h preserves the convex hull of the points then h x is a finite point for any point x in the convex hull of the xi. so x consider the chord joining two points xi and xj and suppose that t i and i is a continuous function j in part of the theorem have opposite signs. since t t of the coordinates of xi there must be a point x lying on the chord from xi to xj for since x is in the which t convex hull of the points this contradicts we assume that there exist constants t t i i all of the same sign such that i. let s be the subset of irn consisting of all points x satisfying the condition i. the set s contains it if xi and xj are points in s with corresponding j. to see this consider a point j then any intermediate point x between xi and xj must have t ht ht ht i t will be shown that s is convex. constants t value intermediate between t where this point lies between xi and xj. denote by ht then has the same sign as the t the last row of h. i and t such that t i and t t j must have the j as claimed. consequently the value of t i and t j and so x lies in s also. this shows that s is convex. which lies between t same sign as t i and t now let s be a convex subset of s. it will be shown that h s is also convex. this is easily seen to be true since h maps a line segment in s to a line segment that does not cross the plane at infinity. thus h maps any convex set s such that s s to however if h satisfies condition then a convex set s it is easily seen that h does also. from this it follows that the above correspondence is bijective. since the convex hull of between convex sets s and s i respectively is the intersection of all such convex sets it follows that h preserves the convex hull of the points. s such that s i the projective transformations that preserve the convex hull of a given set of points form an important class and will be called quasi-affine transformations. definition let b be a subset of irn and let h be a projectivity of ipn. the projectivity h is said to be quasi-affine with respect to the set b if h preserves the convex hull of the set b. is quasi-affine it may be verified that if h is quasi-affine with respect to b then h with respect to hb. furthermore if h is quasi-affine with respect to b and g is quasi-affine with respect to hb then g h is quasi-affine with respect to b. thus quasi-affine projectivities may be composed in this fashion. strictly speaking however quasi-affine projectivities with respect to a given fixed set of points do not form a group. cheirality we will be considering sets of points and that correspond via a projectivity. when we speak of the projectivity being quasi-affine we will mean with respect to the set two-dimensional quasi-affine mappings two-dimensional quasi-affine mappings arise as transformations between planar point sets in and their image under a projective camera mapping as stated formally below. i theorem if b is a point set in a plane object plane in and b lies entirely in front of a projective camera then the mapping from the object plane to the image plane defined by the camera is quasi-affine with respect to b. proof. that there is a projectivity h mapping the object plane to the image plane is well known. what is to be proved is that the projectivity is quasi-affine with respect to b. let l be the line in which the principal plane of the camera meets the object plane. since b lies entirely in front of the camera l does not meet the convex hull of b. however by definition of the principal plane hl l where l is the line at infinity in the image plane. thus one deduces that hb l and hence by theorem the transformation is quasi-affine with respect to b. note that if points xi are visible in an image then the corresponding object points must lie in front of the camera. applying theorem to a sequence of imaging operations instance a picture of a picture of a picture etc. it follows that the original and final images in the sequence are connected by a planar projectivity which is quasi-affine with respect to any point set in the object plane visible in the final image. similarly if two images are taken of a set of points in a plane and i being corresponding points in the two images then there is a quasi-affine mapping respect to the xi mapping each xi to i and so theorem applies yielding the following result if and are corresponding points in two views of a set of object points lying in a plane then there is a matrix h representing a planar projectivity such that h xi wi i and all wi have the same sign. i front and back of a camera the depth of a point x y z tt with respect to a camera was shown in to be given by signdet mw depthx p where m is the left hand block of p is the third row of m and px w x. this expression is not dependent on the particular homogeneous representation of x or m that is it is unchanged by multiplication by non-zero scale factors. this definition of depth is used to determine whether a point is in front of a camera or not. result the point x lies in front of the camera p if and only if depthx p three-dimensional point sets in fact depth is positive for points in front of the camera negative for points behind the camera infinite on the plane at infinity and zero on the principal plane of the camera. if the camera centre or the point x is at infinity then depth is not defined. usually in this section we will only be concerned with the sign of depth and not its magnitude. we may then write depthx p wt det m where the symbol indicates equality of sign. the quantity signdepthx p will be referred to as the cheirality of the point x with respect to the camera p. the cheirality of a point is said to be reversed by a transformation if it is swapped from to or vice versa. three-dimensional point sets in this section the connection between cheirality of points with respect to a camera and convex hulls of point sets will be explained. the main result is stated now. theorem let pe and be two cameras xe cameras and xi and euclidean. i a set of points lying in front of both i the corresponding image points. superscript e stands for be any projective reconstruction from the image correspondences xi i has the same if each xi is a finite point and wi xi with wi having the same sign for all sign for all i. i and let pxi wi xi and w i i. then wiw let i then there exists a quasi-affine transformation h taking each xi to xe i note that the condition that each wiw of course the existence of a projective transformation taking each xi to xe i is guaranteed by theorem the current theorem gives the extra information that the transformation is quasi-affine and hence one has a quasi-affine reconstruction. i have the same sign is unaffected by multiplying p or any of the points xi by a scale factor and hence is invariant of the choice of homogeneous representative for any of these quantities. in particular if p is multiplied by a negative constant then so is wi for all i. thus the sign of wiw i is inverted for each i but they still all have the same sign. similarly if one point xi is multiplied by a ative constant then both wi and w i is unchanged. in the same way the condition that each wi part of the theorem have the same sign for all i is unaffected if the camera matrix is multiplied by a negative of course positive constant. i change signs and so the sign of wiw proof. the points xe depth with respect to these cameras. according to i lie in front of the cameras pe and and hence have positive hence detmewite multiplying these expressions together and cancelling te i for all i. similarly for the second camera i i because it appears twice ite detmewite i depthxe i pe cheirality i has i and hence wiw i i det me det since det me det is constant this shows that wiw gives wiw constant sign. this was shown in terms of the true configuration. note however that for any h one has wi xi pexe i has the same sign for the projective since any projective reconstruction is of this reconstruction form for homogeneous scale factors and the condition that wiw i has the same i pe and it sign is independent of choice of homogeneous representatives of xe follows that in any projective reconstruction wiw i has the same sign for all i. this to show the second part suppose in the projective reconstruction wi xi all the wi proves the first part of the theorem. tion represented by h such that i have the same sign. since this is a projective reconstruction there exists a transformai and ph for some constants i and i then and so wi xi i i i i xi for all i. however since depthxe i pe one has detmewi i for all i. since detme is constant and by hypothesis wi has the same sign for all i it follows that i i is a quasi-affine has the same sign for all i. thus the mapping h such that i map with respect to the points according to theorem one of the cameras only. however defining w note that the condition that wi have the same sign for all i needs to be checked for i i according to part of the i has the same sign for all i. thus if all wi have the same sign then so do theorem wiw all w i. according to theorem any projective reconstruction in which wi xi and obtaining a quasi-affine reconstruction wi has the same sign for all i is a quasi-affine reconstruction. the advantage of a quasi-affine reconstruction is that it gives a closer approximation to the true shape of the object than does an arbitrary projective transformation. it may be used as a stepping stone on the way to a metric reconstruction of the scene as in in addition one may retrieve the convex hull of the object or determine such questions as whether two points lie on the same side of a plane. it turns out that quasi-affine reconstruction is extremely simple given a projective reconstruction as shown in the following theorem. theorem any projective reconstruction in which one of the cameras is an affine camera is a quasi-affine reconstruction. proof. recall that an affine camera is one for which the last row is of the form in this case writing wi xi one immediately verifies that wi for all i and in particular they all have the same sign. according to theorem this effect of transformations on cheirality means that the reconstruction differs by a quasi-affine transformation from the truth. the following result follows immediately. corollary let p then by swapping the last two columns of p and of two coordinates of each xi one obtains a quasi-affine reconstruction of the scene. be a projective reconstruction of a scene in which as well as the last this is similar to result in which it was shown that if the camera p is known in reality to be an affine camera then the above procedure provides an affine reconstruction. effect of transformations on cheirality at this point it is desirable to derive a slightly different form of the formula for depth defined in let p be a camera matrix. the centre of p is the unique point c such that pc one can write an explicit formula for c as follows. definition given a camera matrix p we define ct where p to be the vector ci det pi and pi is the matrix obtained by removing the i-th column of p. we denote by the matrix made up of a camera matrix p augmented with an final row vt. definition leads to a simple formula for detpvt. cofactor expansion of the determinant along the last row gives detpvt vtcp for any row vector vt. as a special case if pt i is the i-th row of p then pt i cp detppt i where the last equality is true because the matrix has a repeated row. since this is true for all i it follows that pcp and so cp is the camera centre as claimed. note that submatrix is the same as matrix m in the decomposition p v and so det m this allows us to reformulate as follows. wet xet cp depthx p x we now consider a projective transformation represented by matrix h. if where et is the vector it is significant to note here that is the vector representing the plane at infinity a point x lies on the plane at infinity if and only if et ph and hx then the image correspondences are preserved by this transformation. when speaking of a projective transformation being applied to a set of points and to a camera it is meant that a point x is transformed to hx and the camera matrix is transformed to ph in this section we will consider such projective transformations and their effect on the cheirality of points with respect to a camera. first we wish to determine what happens to cp when p is transformed to ph to answer that question consider an arbitrary v. we see that cheirality vth detph detpvt det h vtcp det h since this is true for all vectors v it follows that h cp det h or cph hcp det h at one level this formula is saying that the transformation h takes the camera centre c cp to the new location cph hc. however we are interested in the exact coordinates of cph especially the sign of the last coordinate which appears in thus the factor det h is significant. now applying to gives wet wet depthhx ph hxet hxet cph hcp deth one may interpret the expression et h as being the plane mapped to infinity by h. this is because a point x lies on if and only if the last coordinate of hx is zero that is on the other hand x lies on if and only if t x finally denoting the fourth row of the transformation matrix h by ht and signdet h by we obtain result if is the plane mapped to infinity by a projective transformation h and signdet h then depthhx ph w t x t cp this equation will be used extensively. it may be considered to be a generalization of it will be seen in the next section that signdet h is an indicator of whether h is an orientation-reversing or orientation-preserving transformation. thus the effect on cheirality of applying a transformation h is determined only by the position of the plane mapped to infinity and whether h preserves or reverses orientation. we now consider the effect of different transformations on the cheirality of points with respect to a camera. the effect of an affine transformation is considered first. result an affine transformation with positive determinant preserves the cheirality of any point with respect to a camera. an affine transformation with negative determinant reverses cheirality. proof. an affine transformation preserves the plane at infinity hence the result then follows by comparing and result we now determine how an arbitrary projective transformation affects cheirality. result let h represent a projective transformation with positive determinant and let be the plane in space mapped to infinity by h. the cheirality of a point x is preserved by h if and only if x lies on the same side of the plane as the camera centre. orientation proof. since det h we see from and result that depthx p depthhx ph if and only if t x t c c. suppose the point x and the camera p are located at finite points so that the cheirality is well defined and let them be scaled so that both x and c have final coordinate equal to in this case c and we see that cheirality is preserved if and only if t x t c t c. this condition may be interpreted as meaning that the points c and x both lie on the same side of the plane hence the cheirality of a point x is preserved by a transformation h if and only if it lies on the same side of the plane as the camera centre. xet or otherwise expressed t x xet orientation we now consider the question of image orientation. a mapping h from irn to itself is called orientation-preserving at points x where the jacobian of h determinant of the matrix of partial derivatives is positive and orientation-reversing at points where the jacobian is negative. reflection of points of irn with respect to a hyperplane is mirror imaging is an example of an orientation-reversing mapping. a projectivity h from pn to itself restricts to a mapping from irn to irn where is the hyperplane plane mapped to infinity by h. consider the case n and let h be a matrix representing the projectivity h. we wish to determine at which points x mathematica that if in irn the map h is orientation-preserving. it may be verified easily using and j is the jacobian matrix of h evaluated at x then detj this gives the following result. result a projectivity h of represented by a matrix h is orientation-preserving at any point in if and only if deth of course the concept of orientability may be extended to the whole of and it may be shown that h is orientation-preserving on the whole of if and only if deth the essential feature here is that as a topological manifold is orientable. two sets of points and that correspond via a quasi-affine transformation are said to be oppositely oriented if the transformation is orientation-reversing. as an example consider the transformation given by a diagonal matrix h this transformation has negative determinant and hence is orientation-reversing. on the other hand it is affine and hence quasi-affine. therefore it is possible always to construct oppositely oriented quasi-affine reconstructions of a scene. it may appear therefore that the orientation of a scene may not be determined from a pair of images. although this is sometimes true it is sometimes possible to rule out one of the oppositely oriented quasi-affine reconstructions of a scene and hence determine the true orientation of the scene. common experience provides some clues here. in particular a stereo pair may be viewed by presenting one image to one eye and the other image to the other eye. if this is done correctly then the brain perceives a reconstruction of the scene if however the two images are swapped and presented to the opposite eyes then the perspective will be reversed hills become valleys and vice versa. in effect the brain is able to compute two oppositely oriented reconstructions of the image pair. it seems therefore cheirality fig. stereo pairs of images that may be viewed by cross-fusing eyes are crossed so that the left eye sees the right image and vice versa. the two bottom images are the same as the top pair except that they are swapped. in the top pair of images one sees an l-shaped region raised above a planar background. in the bottom pair of images the l-shaped region appears as an indentation. the two reconstructions differ by reflection in the background plane. this demonstrates that the same pair of images may give rise to two differently oriented projective reconstructions. that in certain circumstances two oppositely oriented realizations of an image pair exist. this is illustrated in figure it may be surprising to discover that this is not always the case as is shown in the following theorem. as used in this theorem and elsewhere in this chapter a projective realization of a set of point correspondences is known as a strong realization if the reconstructed points xi are in front of all the cameras. be a strong realization of a uniquely realizable set of theorem let point correspondences. there exists a different oppositely oriented strong realization if and only if there exists a plane in such that the perspective centres p of both cameras p and lie on one side of the plane and the points xi lie on the other side. proof. consider one strong realization of the configuration. by definition all the points lie in front of both cameras. suppose that there exists a plane separating the points from the two camera centres. let g be a projective transformation mapping the given plane to infinity and let a be an affine transformation. suppose further that the cheiral inequalities det g and det a let h be the composition h ag. according to result the transformation g is cheirality-reversing for the points since the points are on the opposite side of the plane from the camera centres. according to result a is also cheirality-reversing since det a the composition h must therefore be cheiralitypreserving and it transforms the strong configuration to a different strong configuration. since h has negative determinant however it is orientation-reversing so the two strong realizations have opposite orientations. conversely suppose that two strong oppositely oriented realizations exist and let h be the transformation taking one to the other. since h is orientation-reversing det h the mapping h is by definition cheirality-preserving on all points with respect to both cameras. if is the plane mapped to infinity by h then according to result the points x must lie on the opposite side of the plane from both camera centres. the cheiral inequalities in section a very simple method was given for obtaining a quasi-affine reconstruction of a scene directly from a projective reconstruction. however the reconstruction obtained there did not respect the condition that the points must lie in front of all cameras. in fact the first camera in this construction is an affine camera for which front and back are not well defined. by taking full advantage of the fact that visible points must lie in front of the camera it is possible to constrain the reconstruction more tightly leading to a closer approximation to a true affine reconstruction of the scene. the method will be given for the case of a reconstruction derived from several images. one is given a set of image points i is the projection of the i-th point in the j-th image. not all points are visible in each image so for some j the point xj i is not given in which case it is not known whether the i-th point lies in front of the j-th camera or not. on the other hand the existence of an image point xj i implies that the point lies in front of the camera. where xj i we start from an assumed projective reconstruction of the scene consisting of a set pjxi. writing the implied scalar of points xi and cameras pj such that xj i constant explicitly in this equation gives wj i xj i pjxi. in this equation pj and xi are arbitrarily chosen homogeneous representatives of the respective matrix or vector. related to theorem one may state for several views result consider a set of points xe defined for some indices j such that point xe be a projective reconstruction from xj xi xi such that for each j for which xj i be i lies in front of camera pje. let xi i then there are camera matrices pj pj and i and cameras pje and let xj i is defined one has i pjexe i with wj briefly stated one can always adjust a projective reconstruction multiplying camera matrices and points by if necessary so that wj i is positive whenever image point xj exists. the simple proof is omitted. to find the matrices pj and points xi one may assume that one of the cameras for otherwise all points and cameras may be multiplied by the condition xi i determines whether to i with i i pj xi wj i xj i cheirality choose xi xi or xi for all i such that i is defined. each known xi determines pj i is defined. continuing in this way one easily finds the factor for all j such that xj to apply to each pj and xj to find pj and xi. we assume that this has been done and replace each pj by pj and xi by xi. in future we drop the tildes and continue to work with the corrected pj and xi. we now know that wj i is given. i whenever image point xj now we seek a transformation h that will transform the projective reconstruction to a quasi-affine reconstruction for which all points lie in front of the cameras as appropriate. denoting by v the plane mapped to infinity by h this condition may be written as result depthxi pj where signdet h. this condition holds for all pairs j where xj since we are free to multiply v by if necessary we may assume that for the centre of the camera the following inequalities now follow easily i is given. xt i v for all i cj tv for all j. these equations may be called the cheiral inequalities. since the values of each xi c and are known they form a set of inequalities in the entries of v. the value of is not known a priori and so it is necessary to seek a solution for each of the two cases and to find the required transformation h first of all we solve the cheiral inequalities to find a value of v either for or the required matrix h is any matrix having vt as its last row and satisfying the condition det h if the last component of v is non-zero then h can be chosen to have the simple form in which the first three rows are of the form if a euclidean reconstruction more specifically a quasi-affine reconstruction is possible then there must be a solution either for or in some cases there will exist solutions of the cheiral inequalities for both and this will mean that two oppositely oriented strong realizations exist. the conditions under which this may occur were discussed in section solving the cheiral inequalities naturally the cheiral inequalities may be solved using techniques of linear programming. as they stand however if v is a solution then so is v for any positive factor in order to restrict the solution domain to be bounded one may add additional inequalities. for instance if v then the inequalities vi serve to restrict the solution domain to be a bounded polyhedron. to achieve a unique solution we need to specify some goal function to be linearized. an appropriate strategy is to seek to maximize the extent to which each of the inequalities is satisfied. to do this we introduce one further variable d. each of the inequalities atv of the form for appropriate a is replaced by an inequality atv d. we seek the cheiral inequalities to maximize d while satisfying all the inequalities. this is a standard linear programming problem for which many methods of solution exist such as the simplex method if a solution is found for which d then this will be a desired solution. summary of the algorithm now we give the complete algorithm for computing a quasi-affine reconstruction of a scene using the cheiral inequalities. the algorithm as outlined above was discussed for the case of two views. in the present case it will be presented for an arbitrary number of views. the extension to more views is straightforward. objective given a set of points xi and camera matrices pj constituting a projective reconstruction from a set of image points compute a projective transformation h transforming the projective to a quasi-affine reconstruction. algorithm for each pair j such that point xj replace some cameras pj by pj and some points xi by xi as required to ensure i is given let pjxi w j i xj i that each w j i form the cheiral inequalities where cj cpj is defined by definition for each of the values choose a solution it exists to the set of cheiral inequalities. let the solution be v a solution must exist for at least one value of sometimes for both values of define a matrix h having last row equal to v and such that deth the matrix h is the required transformation matrix. if both h and h exist then they lead to two oppositely oriented quasi-affine reconstructions. algorithm computing a quasi-affine reconstruction. bounding the plane at infinity a quasi-affine reconstruction is of course not unique being defined only up to a quasiaffine transformation with respect to the points and camera centres. however once one has been found it is possible to set bounds on the coordinates of the plane at infinity. thus let pj and xi constitute a quasi-affine reconstruction of a scene. one may choose the sign of pj and xi such that the last coordinates of xi and the determinants of each mj are positive. one may apply a translation to the points and cameras so that the coordinate origin lies inside the convex hull of the points and camera centres. for simplicity the centroid of these points may be placed at the origin. it is possible to apply a further quasi-affine transformation h to obtain an alternative reconstruction. let be the plane mapped to infinity by h. we confine our interest to orientation-preserving transforms and wish to find constraints on the coordinates of such that h is quasi-affine. a plane has this property if and only if it lies entirely outside the convex hull of the points and camera centres. since the plane the simplex algorithm given in is not suitable for use as stands since it makes the unnecessary assumption that all variables are non-negative. it needs to be modified to be used for this problem. cheirality cannot cross the convex hull it cannot pass through the origin. representing by the vector v this says that the last coordinate of v is non-zero. one may then write v since the origin lies on the same side of the plane as all the points the cheiral inequalities become xt v for all i i cj tv for all j for v one may find upper and lower bounds for each vi by solving the linear programming problem to maximize vi or vi subject to these constraints. none of the vi can be unbounded since otherwise the plane represented by the vector v could lie arbitrarily close to the origin. before solving for this system good practice is to apply an affine transformation to normalize the set of points and camera centres so that their centroid is at the origin and their principal moments are all equal to the complete algorithm for computing the bounds on the position of the plane at infinity is given in algorithm objective given a quasi-affine reconstruction of a scene establish bounds on the coordinates of the plane at infinity. algorithm so that det mj normalize the points xi yi zi tit so that ti and cameras pj tj further normalize by replacing xi by h and pj by pjh where h is an affine transformation moving the centroid to the origin and scaling in the principal axis directions so that is has equal principal axes. letting v form cheiral inequalities any orientationpreserving transformation h mapping the reconstruction to an affine reconstruction of the image must have the form h i for a vector v satisfying these inequalities. upper and lower bounds for each vi may be found by running a linear programming problem six times. the coordinates of a desired transformation h must lie inside the box defined by these bounds. algorithm establishing bounds on the plane at infinity. which points are visible in a third view consider a scene reconstructed from two views. we consider now the question of determining which points are visible in a third view. such a question arises when one is given two uncalibrated views of a scene and one seeks to synthesize a third view. this can be done by carrying out a projective reconstruction of the scene from the which points are visible in a third view x fig. the point set x is in front of all three cameras as shown. however if an orientationpreserving projective transformation h is applied taking the plane to infinity then the point set will subsequently lie in front of the cameras and but behind the camera thus suppose the point set x is reconstructed from images captured by cameras and and let be any other camera matrix. if a plane exists separating the centre of camera from the other camera centres and not meeting the convex hull of the point set x then it cannot be determined whether the points lie in front of first two views and then projecting into the third view. in this case it is important to determine if a point lies in front of the third camera and is hence visible or not. if the third view is given simply by specifying the camera matrix with respect to the frame of reference of some given reconstruction then it may be impossible to determine whether points are in front of the third camera or behind it in the true scene. the basic ambiguity is illustrated in figure knowledge of a single point known to be visible in the third view serves to break the ambiguity however as the following result shows. by applying theorem to the first and third views one obtains the following criterion. result let points be a realization of a set of correspondences j xi pixj j has the same sign for all points xj visible in the third i let be the camera matrix of a third view and suppose that wi i for i then view. j in practice it will usually be the case that one knows at least one point visible in and any other point xj will be in the third view. this serves to define the sign front of the camera if and only if j j as an example once a projective reconstruction has been carried out using two views the camera matrix of the third camera may be determined from the images of six or more points known to be in front of it by solving directly for the matrix given the correspondences i where points xi are the reconstructed points. then one can determine unambiguously which other points are in front of cheirality fig. as shown the point is closer to the camera than however if an orientation-reversing projectivity is applied taking to infinity then both and remain in front of the camera but is closer to the camera than which points are in front of which when we are attempting to synthesize a new view of a scene that has been reconstructed from two or more uncalibrated views it is sometimes necessary to consider the possibility of points being obscured by other points. this leads to the question given two points that project to the same point in the new view which one is closer to the camera and hence obscures the other? in the case where the possibility exists of oppositely oriented quasi-affine reconstructions it may once again be impossible to determine which of a pair of points is closer to the new camera. this is illustrated in figure if a plane exists separating the camera centres from the point set then two oppositely oriented reconstructions exist and one cannot determine which points are in front of which. the sort of ambiguity shown in figure can only occur in the case where there exists a plane that separates the camera centres from the set of all visible points. if this is not the case then one can compute a quasi-affine reconstruction and the problem is easily solved. to avoid the effort of computing a quasi-affine reconstruction however we would like to solve this problem using only a projective reconstruction of the scene. how this may be done is explained next. p p. this inverse depth function is infinite on the principal plane of the camera zero on the plane at infinity positive for points in front of the camera and negative for points behind the camera. for notational simplicity we write p instead of depth one may invert to get an expression for depth p. for points x lying on a ray through the camera centre the value of p decreases monotonically along this ray from zero at the camera centre decreasing through positive values to zero at the plane at infinity thence continuing to decrease through negative values to at the camera centre. a point lies closer to the front of the camera than if and only if this is illustrated in figure defined by now if the configuration undergoes an orientation-preserving transformation h taking the plane to infinity then the parameter will be replaced by a new parameter must also vary monotonically along the ray. since h is orientation-preserving points just in front of the camera centre will remain in front of the camera after the transformation because of result ph the value of closure fig. the parameter thus both and and are two points on the line then decrease monotonically in the same direction along the ray. if if and only if in the case where the projective transformation has negative determinant then the front and back of the camera are reversed locally. in this case the direction of increase if and only if of the parameter will be reversed. consequently in the case where the projective transformation transforms the scene to the true scene of two points that project to the same point in the image the one with the higher value of is closer to the camera. this leads to the following result that allows us to determine from an arbitrary projective reconstruction which of two points is closer to the front of the camera. result suppose that and are two points that map to the same point in an image. consider a projective reconstruction of the scene and let the parameter be defined formula in the frame of the projective reconstruction. if the projective reconstruction has the same orientation as the true scene then the point that lies closer to the front of the camera in the true scene is the one that has the greater value of on the other hand if the projective transformation has the opposite orientation then the point with smaller value of will lie closer to the front of the camera in the true scene. as remarked previously unless there exists a plane separating the point set from the cameras used for the reconstruction the orientation of the scene is uniquely determined and one can determine whether the projective transformation of result has positive or negative determinant. however to do this may require one to compute a strong realization of the configuration by the linear programming method as described in section if differently oriented strong realizations exist then as illustrated by figure there is an essential ambiguity. however this ambiguity may be resolved by knowledge of the relative distance from the camera of a single pair of points. closure the literature the topic of this chapter belongs to oriented projective geometry which is treated in a standard and readable text laveau and faugeras apply the ideas of cheirality oriented projective geometry in the concepts of front and back of the camera were also used in to compute convex hulls in projective reconstructions. this chapter derives from the paper which also treats such topics of invariants for quasi-affine mappings and conditions under which arbitrary correspondences allow quasi-affine reconstructions. cheirality and specifically the cheirality inequalities have been useful in determining quasi-affine reconstructions as an intermediate step towards affine and metric reconstruction in more recently werner and pajdla in have used oriented projective geometry to eliminate spurious line correspondences and to constrain correspondences of five points over two views. degenerate configurations in past chapters we have given algorithms for the estimation of various quantities associated with multiple images the projection matrix the fundamental matrix and the trifocal tensor. in each of these cases linear and iterative algorithms were given but little consideration was given to the possibility that these algorithms could fail. we now consider under what conditions this might happen. typically if sufficiently many point correspondences are given in some sort of general position then the quantities in question will be uniquely determined and the algorithms we have given will succeed. however if there are too few point correspondences given or else all the points lie in certain critical configurations then there will not be a unique solution. sometimes there will be a finite number of different solutions and sometimes a complete family of solutions. this chapter will concentrate on three of the main estimation problems that we have encountered in this book camera resectioning reconstruction from two views and reconstruction from three views. some of the results given here are classical particularly the camera resectioning and two-view critical surface problems. others are more recent results. we consider the different estimation problems in turn. camera resectioning we begin by considering the problem of computing the camera projection matrix given a set of points in space and the corresponding set of points in the image. thus one is given a set of points xi in space that are mapped to points xi in the image by a camera with projection matrix p. the coordinates of the points in space and the image are known and the matrix p is to be computed. this problem was considered in chapter before considering the critical configurations for this problem we will digress to look at an abstraction of the camera projection. cameras as points suppose the existence of a set of correspondences xi xi. let us suppose that there is a unique camera matrix p such that xi pxi. now let h be a matrix representing a projective transformation of the image and let i hxi be the set of transformed image coordinates. then it is clear that there is a unique camera matrix such that degenerate configurations i namely the camera matrix hp. conversely if there exists more than one camera matrix p mapping xi to xi then there exists more than one camera matrix mapping xi to i. thus the existence or not of a unique solution to the problem of determining the projection matrix p is dependent on the image points xi only up to a projective transformation h of the image. next observe that applying a projective transformation h to a camera matrix p does not change the camera centre. specifically the point c is the camera centre if and only if pc however pc if and only if hpc thus the camera centre is preserved by a projective transformation of the image. next we show that this is essentially the only property of the camera that is preserved. result let p and be two camera matrices with the same centre. then there exists a projective image transformation represented by a non-singular matrix h such that hp. proof. if the centre c is not at infinity then the camera matrices are of the form p mc and where c is the inhomogeneous representing the a projective transformation g such that gc is a finite point say in this case the camera centre. then clearly if c is a point at infinity then one chooses two camera matrices pg and both have the same centre namely it follows that hpg for some h. cancelling g gives hp. this result may be interpreted as saying that an image is determined up to projectivity by the camera centre alone. thus we see that in considering the problem of uniqueness of the camera matrix one may ignore all the parameters of the camera except the camera centre since this alone determines the projectivity type of the image and hence the uniqueness or not of a solution. images as equivalence classes of rays to gain insight into the critical configurations of camera resectioning we turn first to consider cameras mapping to consider a camera centre c and a set of points xi in space. the rays cxi intersect an image line l at a set of points xi thus points xi are the images of the points xi. the projection of the points xi to points xi in the image may be described by a projection matrix as described in section as shown in chapter the projective equivalence type of the set of rays cxi is the same as that of the image points xi. this is illustrated in figure thus instead of considering an image as being the set of points on the image line the image may be thought of as the projective equivalence class of the set of rays from the camera centre through each of the image points. in the case of just image points the cross ratio of the points xi equivalently the rays characterizes their projective equivalence class. to give a specific notation we denote by i the projective equivalence class of the set of rays cxi. the same remarks are valid for projections of points into a image. one may also extend the above notation by writing to represent the camera resectioning l x x x x x x x c fig. projection of points in the plane using a camera. a image is formed by the intersection of the rays li cxi with the image line l. the set of image points xi is projectively equivalent to the set of rays for four points the projective equivalence class of the image is determined by the cross ratio of the points. projective equivalence class of all the rays cxi. as in the case this is an abstraction of the projection of the points xi relative to a camera with centre at c. we will be considering configurations of camera centres and points which will be denoted by cm xn or variations thereof. implicit is that the symbols appearing before the semicolon are camera centres and those that come after are points. in order to make the statements of derived results simple the concept of image equivalence is defined. definition two configurations cm xn and are called image-equivalent if m. n n m i for all i the concept of image equivalence is distinct from projective equivalence of the sets of points and camera centres involved. indeed the relevance of this to reconstruction ambiguity is that if a configuration cm xn allows another imageequivalent set which is not projective equivalent then this amounts to an ambiguity of the projective reconstruction problem since the projective structure of the points and cameras is not uniquely defined by the set of images. in this case we say that the configuration cm xn allows an alternative reconstruction. ambiguity in chasles theorem before considering the usual cameras we discuss the simpler case of cameras. the analysis of the uniqueness of camera projections involves planar conics. ambiguity in determining the camera centre from the projection of a set of known points xi means that the projection of the points is the same from two different camera centres c and the question is for what configurations of the points this may occur. the answer to this question is given by chasles theorem. degenerate configurations xn c c fig. the points xn project in equivalent ways to the two camera centres c and theorem chasles theorem. let xi be a set of n points and c and centres all lying in a plane. then two camera if and only if one of the following conditions holds the points c all points lie on the union of two lines degenerate conic both camera centres and all xi all lie on a non-degenerate conic or lying on the same line. note that as a simple corollary of this theorem if these two configurations are shown in figure is any other camera centre lying on the same component of a conic or non-degenerate as c and the xi then the projection of the points to the centre is equivalent to their projection to the original camera centres. furthermore any number of extra points xj may be added without breaking the ambiguity as long as they lie on the same conic. ambiguity for cameras we now address the problem of ambiguity of camera resection in the case of full cameras. twisted cubics in section play an analogous role in the case to that played by conics in the case of cameras. the degenerate form of a twisted cubic consisting of a conic plus a line intersecting the conic arises in this context so does the degenerate cubic consisting of three lines. as in the case when ambiguity arises from points lying on a degenerate cubic the camera centres must both lie on the same component. a complete classification of the point and camera configurations leading to ambiguous camera resectioning is given in figure and also in the following definition. for the present we describe the geometric configurations. the exact relevance to ambiguous camera configurations will be given afterwards. definition a critical set for camera resectioning consists of two parts an algebraic curve c containing the camera centres plus any number of the camera resectioning points. this curve may be a non-degenerate twisted cubic a planar conic a straight line or a single point a union of linear subspaces l or planes containing any number of points. the curve c and the linear subspaces satisfy three conditions each of the linear subspaces must meet the curve c. the sum of the degree of the curve c and the dimensions of the linear subspaces except in the case where c is a single point the cameras do not lie at the inter is at most section point of c and the linear subspaces. the various possibilities are shown in figure and it is easily verified that these completely enumerate all configurations in accordance with definition result the different possible critical sets for camera resectioning are first line. a non-degenerate twisted cubic c a plane conic c plus a line that meets the conic. a line c plus up to two other lines dimension that meet the a line c plus a plane a point c and up to three lines passing through the point divi a point c and a line and a plane both passing through this point. the exact relationship of these critical sets to ambiguous camera resectioning is mension given by the following result. result let p and be two different camera matrices with camera centres and then the two camera centres and the points xi that satisfy pxi all lie on a critical set as given by definition furthermore if p p has rank then the camera centre of the camera defined by p lies on the component c of the critical set containing the two original camera centres and and p x px for any point x in the critical set. conversely let p be a camera matrix with centre let and a set of points xi lie in a critical set for camera resectioning. let be any other point lying on the component c of the critical set with unless c consists of a single point. then there exists a camera matrix from p with camera centre such that pxi for all points xi. we include the case p degenerate configurations fig. the different critical configurations for camera resectioning from a single view. the open circles represent centres of projection and the filled circles represent points. each case consists of an algebraic curve single point c containing the camera centres plus a set of linear subspaces or planes. proof. an outline of the proof will be given with details left for the reader to fill in. we temporarily need to distinguish between equality of homogeneous quantities up to a scale factor will be denoted by and absolute equality is denoted by suppose that x maps to the same image point with respect to cameras p and one can write px taking account of the scale factor this can be written as px for some constant from this it follows that for some it follows that px conversely suppose that and so px thus the critical set is the set of points x in the right null-space of p define p p the rest of the proof involves finding the set of all points x satisfying p x as runs over all values. if p is a camera matrix rank then such an x is the centre of the camera p if however p is rank-deficient for some value x is a linear space. the total critical set of i then the set of points x such that p i therefore consists of two parts for some degeneracies in two views the locus of the camera centre of p over all values for which p has full rank is rank this is a curve c containing the two camera centres and a linear space or plane corresponding to each value of for which p has rank or less. if p has rank the points such that p x form a line and if it has rank then they form a plane. is the matrix p with the i-th column removed. since each pi let the c be defined by c where ci det pi is a and pi matrix and the entries of p are linear in we see that each ci det pi is a cubic polynomial in according to the discussion following definition p c hence if c then it is the camera centre of p and as varies the point c traces out the curve c. since the coordinates of c are cubic polynomials this is in general a twisted cubic. if however the four components of c have a simultaneous root i then the degree of the curve c is diminished. in this case p i is rank-deficient x thus the linear subspace and there exists a linear space of points x such that p i components of the critical set correspond to values of where c vanishes. clearly there can be at most three such values. further details are left to the reader. the last part of the theorem provides a converse result namely that if the points and one camera centre lie in a critical configuration then there exist alternative resection solutions with the camera placed at any location in c. the exact form of the camera matrix p is not important here only its camera centre as has been observed above. for most of the configurations in figure it is clear enough geometrically that the image of the critical set is unchanged to projectivity by moving the camera along the locus c. in the case where c is a planar conic this follows fairly easily from the camera case the exception is the twisted cubic case. it is illustrated graphically in figure we leave this proof for now and come back to it later degeneracies in two views notation. for the rest of this chapter the camera matrices are represented by p and q points by p and q. thus cameras and points are distinguished only by their typeface. this may appear to be a little confusing but the alternative of using subscripts or primes proved to be much more confusing. in the context of ambiguous reconstructions from image coordinates we distinguish the two reconstructions by using p and p for one and q and q for the other. now we turn to the case of two views of an object. given sufficiently many points placed in general position one may determine the placement of the two cameras and reconstruct the point set up to a projective transformation. this may be done using one of the projective reconstruction algorithms discussed in chapter we now wish to determine under what conditions this technique may fail. thus we consider a set of image correspondences xi set of correspondences consists of a pair of camera matrices p and points pi such that xi ppi and i for all i. two realizations i. a realization of this and a set of pi degenerate configurations fig. separate views of a set of points on the twisted cubic t as viewed from a centre of projection. the visible points are viewed from the points with t with the image suitably magnified to prevent the point set from becoming too small. as is plausible from the image the sets of points differ by a projective transformation. from a viewpoint on a twisted cubic the twisted cubic has the appearance of a conic in this particular case a parabola. and represented by a matrix h such that q ph qi are projectively equivalent if there is a projective transformation and qi hpi for all i. because of a technicality this definition of equivalence is not quite appropriate to the present discussion. recall from the projective reconstruction theorem theorem that one cannot determine the position of a point lying on the line joining the two camera centres. hence non-projectively-equivalent reconstructions will always exist if some points lie on the line of camera centres the two reconstructions differing only by the position of the points pi and qi on this line. this type of reconstruction ambiguity is not of great interest and so we will modify the notion of equivalence by defining two reconstructions to be equivalent if h exists such that q ph and as in the proof of the projective reconstruction theorem such an h will also map qi to pi except possibly for reconstructed points qi lying on the line of the camera centres. according to theorem this condition is also equivalent to the condition that where and are the fundamental matrices corresponding to the camera pairs accordingly we make the following definition. definition two configurations of cameras and points are said to be conjugate configurations provided pi and and qi ppi qqi and for all i. the fundamental matrices and corresponding to the two camera matrix pairs and are different. a configuration pi that allows a conjugate configuration is called critical. an important remark is that being a critical configuration depends only on the camera degeneracies in two views respectively then p p pi is a critical configuration and p and p centres and the points and not on the particular cameras. result if the same centres as p and well. proof. this is easily seen as follows. since pi is a critical configuration there exists an alternative configuration qi such that ppi qqi and for all i. however since p and p have the same camera centre p hp according to result and similarly p are two cameras with pi is a critical configuration as therefore ppi hppi hqqi and pi p it follows that fore critical. qi is an alternative configuration to p p pi which is there the goal of this section is to determine under what conditions non-equivalent realizations of a set of point correspondences may occur. this question is completely resolved by the following theorem which will be proved incrementally. ri. conjugate configurations of cameras and points generically pi has two conjugates qi and pi is a critical configuration then all the points pi and the two cam theorem come in triples. thus a critical configuration if conversely suppose that the camera centres of p and a set of points pi lie on a ruled quadric the quadrics and in result then era centres cp and lie on a ruled quadric surface sp. pi is a critical configuration. by the words ruled quadric in this context is meant any quadric surface that contains a straight line. this includes various degenerate quadrics as will be seen. a general discussion and classification of quadric surfaces has been given in section a quadric is usually defined to be the set of points x such that xtsx where s is a symmetric matrix. however if s is any matrix not necessarily symmetric then one sees that for any point x one has xtsx where ssym is the symmetric part of s. thus xtsx if and only if xtssymx and so s defines the same quadric surface as ssym. in investigating reconstruction ambiguity it will often be convenient to use non-symmetric matrices s to represent quadrics. proof. we begin by proving the first part of the theorem. let f and be two distinct fundamental matrices satisfying the relation for all correspondences tf xi however f is a fundamental matrix only if det f now det f is generally a polynomial of degree in this polynomial has roots and corresponding to f and xi. define f f one easily verifies that tfxi i i i i degenerate configurations respectively. the third root corresponds to a third fundamental matrix and hence a third non-equivalent reconstruction. in special cases det f has degree in and there are only two conjugate configurations. the second part of the theorem is concluded by proving the following lemma. lemma consider two pairs of cameras with corresponding different fundamental matrices and define quadrics sp and sq and the quadric sp contains the camera centres of p and the camera centres of q and similarly sq contains sp is a ruled quadric. if p and q are points such that pp qq and then p lies on the conversely if p is a point lying on the quadric sp then there exists a point q quadric sp and q lies on sq. lying on sq such that pp qq and proof. recall that according to result the matrix f is the fundamental matrix corresponding to a pair of cameras if and only if is skewsymmetric. since however the matrices sp and sq defined here are not skew-symmetric and hence represent non-trivial quadrics. we adopt a convention that a camera represented by a matrix such as p or centre denoted by cp or has camera the camera centre of p satisfies pcp then p ct p spcp ct ct p since pcp so cp lies on the quadric sp. in a similar manner lies on sp. let eq be the epipole defined by and consider the ray passing through cp consisting of all points such that eq px. then for any such point one verifies that spx thus the ray lies on sp and so sp is a ruled quadric. under the given conditions one sees that ptspp let p lie on sp and define x pp and since is skew-symmetric. thus p lies on the quadric sp. by a similar argument q lies on sq. then from ptspp we deduce and so x are a corresponding pair of points with respect to therefore there exists a point q such that qq x pp and from part of this lemma q must lie on sq. degeneracies in two views this lemma completely describes the sets of points giving rise to ambiguous image correspondences. note that any two arbitrarily chosen camera pairs can give rise to ambiguous image correspondences provided that the world points lie on the given quadrics. examples of ambiguity at this point it remains to prove the converse of theorem this needs to be done for all types of ruled quadrics and any placement of the two camera centres on the quadric. the different types of ruled quadrics including degenerate cases are section a hyperboloid of one sheet a cone two planes a single plane a single line. a complete enumeration of the types of placement of two camera centres on a ruled quadric is given in the following result. result the possible configurations of two distinct points camera centres on a ruled quadric surface are as enumerated hyperboloid of one sheet two points not on the same generator hyperboloid of one sheet two points on the same generator cone one point at the vertex and one not cone two points on different generators neither one at the vertex cone two points on the same generator neither one at the vertex pair of planes two points on the intersection of the two planes pair of planes one point at the intersection and one not pair of planes neither point at the intersection but points on different planes pair of planes neither point on the intersection both points on the same plane single plane with two points single line with two points any two quadricpoint-pairs in the same class are projectively equivalent. it is clear by enumeration of cases that this list is complete. the only case in which it is not immediately obvious that any two configurations in the same category are projectively equivalent is in the non-degenerate case of the hyperboloid of one sheet. the proof of this fact is left as exercise at the end of the chapter now consider an example of a critical configuration on a quadric sp also containing the two camera centres. the quadric and two camera centres belong to one of the categories given in result in which all pi lie and a set of points lie on a quadric is a critical configuration let the centres of two new cameras p p since the points lie on sp it follows that sp. suppose that sp and the two camera centres lie in the same category as the given example. since two configurations in the same category are projectively equivalent we may assume that sp sp and the centres of p and p are the same as are the centres of and p and hence by result so is p p this shows that to demonstrate the converse section of theorem it is sufficient merely to demonstrate an example of a critical configuration belonging to each of the categories given in result for cases and examples will be given degenerate configurations for several of the categories though not all. the fact that cases and are not critical is not shown here. the remaining cases are left to the motivated reader. examples of critical configurations consider the case p q and in this case one sees that sp consequently i tt spsym ft ft tt i tt given the fundamental matrix of rank and the camera matrix q one may easily find the other camera matrix this is done by using the formula of result we now consider several examples of critical configurations belonging to different categories of result example hyperboloid of one sheet two centres not on the same generator. we choose find that and then tt ssym and we this is the quadric with equation or this is a hyperboloid of one sheet. note that in this case the camera centres are cp cq inhomogeneous coordinates. the camera centre we note that the line from cp to does not lie on the quadric surface. the camera centre is not uniquely determined by the information already given since the fundamental matrix does not uniquely determine the two cameras. however the epipole e such that is e since e we see that k in inhomogeneous coordinates for any k. we verify that the complete line from cp to lies on the quadric but may lie anywhere along this line. example hyperboloid of one sheet both centres on the same generator. we choose the same as in the previous example and and then tt and we find that ssym this is the quadric with equation which is once again degeneracies in two views a hyperboloid of one sheet. it may be verified that the line y z lies entirely on the quadric and contains the two camera centres and example cone one centre at the vertex of the cone. we choose to be the same as in the previous example but in this case we see that tt and so ssym this is an example of a cone. the camera centre of both p and q is at the vertex of the cone namely the point cp example cone neither centre at the vertex of the cone. we choose and in this case we see that ssym this is the quadric with equation or which is a cylinder parallel with the z-axis thus projectively equivalent to the cone with vertex at the infinite point neither of the camera centres lies at the vertex. example two planes. we choose and in this case we see that sp ssym which so that tt represents a pair of planes. in this case the camera centres are on the intersection of the two planes and example single plane. we choose then ssym which represents a single plane x example single line. we choose and in this case we see that ssym which represents a single line the z-axis. all the points and the two camera centres lie on this single line. apart for the impossible cases and this gives examples of all possible degenerate configurations except for cases and in result these remaining cases are left for the reader. minimal case seven points as seen in section seven is the minimum number of points in general position from which one can do projective reconstruction. the method comes down to solving a cubic equation for which either one or three real solutions exist. looked at from the point of view of critical surfaces the seven points and two camera centres in one configuration must lie on a quadric surface points lie on a quadric. if this quadric is ruled then there will be three conjugate solutions. on the other hand if it is not a ruled quadric instance an ellipsoid then there will be only one solution. this shows that the distinction between the cases where the cubic equation has one or three solutions arises from the difference between the degenerate configurations points and camera centres lying on a ruled or unruled quadric a pleasing connection between the algebra and geometry. carlsson weinshall duality the duality explored in chapter between cameras and points may be exploited so as to dualize degeneracy results as will be explained in this section. we give a more formal treatment of carlsson weinshall duality here. the basis of carlsson weinshall duality is the equation t t z t d d c d y b x a x y z t a b c d camera matrix b the on to we are interested in describing cameras d a camera with centre in terms of their camera centres. as this shows in swapping camera centres with points one must invert the coordinates of the camera centre and point. for instance the point y z tt is dual to a camera with camera centre corresponds y z t c left the we denote the reduced camera matrix a p b d d d c z y with centre c b c dt by pc. d c pcx pxc and c t b now defining the points x one immediately verifies that thus this transformation interchanges the results of points and camera centres. thus a camera with centre c acting on x gives the same result as camera with centre x acting on c. this observation leads to the following definition definition the mapping of to itself given by y z tt ztx txy xyzt will be called the carlsson weinshall map and will be denoted by we denote the image of a point x under by x. the image of an object under is sometimes referred to as the dual object. the carlsson weinshall map is an example of a cremona transformation. for more information on cremona transformations the reader is referred to semple and kneebone note. if none of the coordinates of x is zero then we may divide x by xyzt. then is equivalent to y z tt this is the form of the mapping y z t carlsson weinshall duality that we will usually use. in the case where one of the coordinates of x is zero then the mapping will be interpreted as in the definition. note that any point y z tt is mapped to the point by provided none of the other coordinates is zero. thus the mapping is not one-to-one. if two of the coordinates of x are zero then x which is an undefined point. thus is not defined at all points. in fact there is no way to extend continuously to such points. define the reference tetrahedron to be the tetrahedron with vertices and as we have just seen is one-to-one other than on the faces of the reference tetrahedron. it maps a face of the reference tetrahedron to the opposite vertex and is undefined on the edges of the reference tetrahedron. next we investigate the way in which acts on other geometric objects. theorem the carlsson weinshall map acts in the following manner it maps a line passing through two general points and to the twisted cubic passing through and the four reference vertices it maps a line passing through any of the points ei to a line passing through the same ei. we exclude the lines lying on the face of the reference tetrahedron since such lines will be mapped to a single point. it maps a quadric s passing through the four points ei i to a if s is a ruled quadric s passing through the same four points. quadric then so is s. if s is degenerate then so is s. proof. a line has parametric equation a b c d and a point on this line is taken by the carlsson weinshall map to the point t b c d a b c thus the entries of the vector are cubic functions of and the curve is a twisted cubic. now setting the term a vanishes and the corresponding dual t the first entry is the point is b c d only one that does not contain a and hence the only one that does not vanish. this shows that the reference vertex is on the twisted cubic. by similar arguments the other points lie on the twisted cubic also. note that a twisted cubic is defined by six points and this twisted cubic is defined by the given six points ei that lie on it where and are any two points defining the line. we prove this for lines passing through the point an analogous proof holds for the other points ei. choose another point x y z tt on the line such that x does not lie on any face of the reference tetrahedron. thus x has no zero coordinate. points on a line passing through and x y z tt are all of the form y z tt for varying values of these points are mapped by this represents a line passing through the z the transformation to z two points and x t y y t degenerate configurations since the quadric s passes through all the points ei the diagonal entries of s must all be zero. this means that there are no terms involving a squared coordinate as in the equation for the quadric. hence the equation for the quadric contains only mixed terms as xy yz or xt. therefore the quadric s may be defined by an equation axy bxz cxt dyz eyt f zt dividing this equation by xyzt cy we obtain az this is a quadratic equation in the entries of x. thus since x maps quadric to quadric. specifically suppose s is represented by the matrix by z t y f x dx ex a b then s f s e f e d b c f e c a d b a c a d e b d f c and xtsx implies xt sx if s is ruled then it contains two generators passing through any point and in particular through each ei. by part these are mapped to straight lines which must lie on s. thus s is a ruled quadric. one may further verify that det s det s which implies that if s is a non-degenerate quadric is det s then so is s. in this non-degenerate case if s is a hyperboloid of one sheet then det s from which it follows that det s thus s is also a hyperboloid of one sheet. the action of on other geometric entities is investigated in exercises we wish to interpret duality equation in a coordinate-free manner. the matrix pc has by definition the form given in and maps ei to ei for i the image pcx is may be thought of as a representation of the projection of x relative to the projective basis ei in the image. alternatively pcx represents the projective equivalence class of the set of the five rays cx. thus pcx if and only if the set of rays from c to x and the four vertices of the reference tetrahedron is projectively equivalent to the set of rays from and the four reference vertices. in terms of the notation introduced earlier we may write in a different form as to the duality principle the basis of duality is which states that pcx pxc with notation as in the notation pcx represents the coordinates of the projection of point x with respect to the canonical image coordinate frame defined by the projections of the corners of the reference tetrahedron. equivalently pc may be considered as representing the projective equivalence class of the five projected points pcei and pcx. in the notation of this chapter this is thus the duality relation may be written as where the bar represents the carlsson weinshall map. although pc was defined in terms of the canonical projective basis there is nothing special about the four points used as vertices of the reference tetrahedron carlsson weinshall duality other than the fact that they are non-coplanar. given any four non-coplanar points one may define a projective coordinate system in which these four points are the points ei forming part of a projective basis. the carlsson weinshall map may then be defined with respect to this coordinate frame. the resulting map is called the carlsson weinshall map with respect to the given reference tetrahedron. to be more precise it should be observed that five points four define a projective coordinate frame in in fact there is more than one projective frame fact a family for which four non-coplanar points have coordinates ei. thus the carlsson weinshall map with respect to a given reference tetrahedron is not unique. however the mapping given by definition with respect to any such coordinate frame may be used. given a statement or theorem concerning projections of sets of points with respect to one or more projection centres one may derive a dual statement. one requires that among the four points being projected there are four non-coplanar points that may form a reference tetrahedron. under a general duality mapping with respect to the reference tetrahedron points than those belonging to the reference tetrahedron are mapped to centres of projection. centres of projection are mapped to points. straight lines are mapped to twisted cubics. ruled quadrics containing the reference tetrahedron are mapped to ruled quadrics containing the reference tetrahedron. if the original quadric is nondegenerate so is its image under the duality mapping. points lying on an edge of the reference tetrahedron should be avoided since the carlsson weinshall mapping is undefined for such points. using this as a sort of translation table one may dualize existing theorems about point projection giving new theorems for which a separate proof is not needed. note. it is important to observe that only those points not belonging to the reference tetrahedron are mapped to camera centres by duality. the vertices of the reference tetrahedron remain points. in practice in applying the duality principle one may select any four points to form the reference tetrahedron as long as they are non-coplanar. in general in the results stated in the next section there will be an assumption always stated explicitly that point sets considered contain four non-coplanar points which may be taken as the reference tetrahedron. single view ambiguity it will be shown in this section how various ambiguous reconstruction results may be derived simply from known or obvious geometric statements by applying duality. camera resectioning from five points five point correspondences are not sufficient for camera resectioning for projective cameras. it is interesting to know what one can determine from five point correspondences however. degenerate configurations c x x c fig. left any point on the line passing through c and x is projected to the same point from projection centre c. right the dual statement from any centre of projection c lying on a twisted cubic passing through x and the vertices of the reference tetrahedron the five points are projected in the same way to projective equivalence. thus a camera is constrained to lie on a twisted cubic by its image of five known points. as a simple example of what can be deduced using carlsson duality consider the following simple question when do two points project to the same point in an image? the answer is obviously when the two points lie on the same ray line through the camera centre. dualizing this simple observation figure shows that the centre of the camera constrained by five point correspondences must lie on a twisted cubic passing through the five points. the horopter in a similar manner one may compute the form of the horopter determined by two cameras. the horopter is the set of space points that map to the same point in two images. the argument is illustrated in figure and begins with a simple observation concerning straight lines. result given points x and the locus of camera centres c such that is the straight line passing through x and this is illustrated in figure the dual of this statement determines the horopter for a pair of cameras figure result given projection centres c and non-collinear with the four points ei of a reference tetrahedron the set of points x such that is a twisted cubic passing through and the two projection centres c and ambiguity of camera resection finally we consider ambiguity of resection. this is very closely related to the horopter. to visualize this the reader may refer again to figure though it is not exactly pertinent in this situation. result consider a set of camera centres cm and a point all lying on carlsson weinshall duality c c x x x x c c lying on the line passing through x and fig. left from any centre of projection c are projected to the same ray. that is ei ei for all c on the the points x and line. right the dual statement all points on the twisted cubic passing through c and and the vertices of the reference tetrahedron are projected in the same way relative to the two projection centres. that is ei ei for all x on the twisted cubic. this curve is called the horopter for the two centres of projection. a single straight line and let ei i be the vertices of a reference tetrahedron. let x be another point. then the two configurations cm x and cm are image-equivalent configurations if and only if x lies on the same straight line as and the cameras. in passing to the dual statement according to theorem the straight line becomes a twisted cubic through the four vertices of the reference tetrahedron. thus the dual statement to result is result consider a set of points xi and a camera centre all lying on a single twisted cubic also passing through four reference vertices ei. let c be any other camera centre. then the configurations xm and xm are image-equivalent if and only if c lies on the same twisted cubic. since the points ei may be any four non-coplanar points and a twisted cubic cannot contain coplanar points one may state this last result in the following form result let xm be a set of points and a camera centre all lying on a twisted cubic. then for any other camera centre c the configurations xm and xm are image-equivalent if and only if c lies on the same twisted cubic. this is illustrated in figure it shows that camera pose cannot be uniquely determined whenever all points and a camera centre lie on a twisted cubic. this gives an independent proof of result covering the case that was left unfinished previously. using similar methods one can show that this is one of only two possible ambiguous situations. the other case in which ambiguity occurs is when all points and the two degenerate configurations camera centres lie in the union of a plane and a line. this arises as the dual of the case when the straight line through the camera centres meets one of the vertices of the reference tetrahedron. in this case the dual of this line is also a straight line through the same reference vertex theorem and all points must lie on this line or the opposite face of the reference tetrahedron. note in both these examples how the use of duality has taken intuitively obvious statements concerning projections of collinear points and derived a result somewhat less obvious about points lying on a twisted cubic. two-view ambiguity the basic result theorem about critical surfaces from two views may be stated as follows. theorem a configuration xn of two camera centres and n points allows an alternative reconstruction if and only if both camera centres and all the points xj lie on a ruled quadric surface. if the quadric is non-degenerate hyperboloid of one sheet then there will always exist a third distinct reconstruction. one may write down the dual statement straight away as follows. theorem a configuration cn of any number of cameras and six points allows an alternative reconstruction if and only if all camera centres cn and all the points lie on a ruled quadric if the quadric is non-degenerate hyperboloid of one sheet then there will always exist a third distinct reconstruction. this result was originally proved in just to emphasize how a duality proof works a proof for theorem will be given. proof. consider the configuration cn one renumbers the points so that the configuration is denoted by cn where are four non-collinear points taken to be the vertices of a reference tetrahedron. if this configuration has an alternative reconstruction then there exists another configuration such that for all i n and n j one has dualizing this using yields i for all j and i n. j i j now theorem applies and one deduces that the two camera centres xj the reference vertices and the points ci all lie on a ruled quadric surface s. applying the reverse dualization using theorem one sees that the points and the camera centres ci all lie on the quadric surface s. this proves the forward implication of the theorem. the reverse implication is handled in a similar manner. in this statement it is assumed that the set of points includes four non-coplanar points forming a reference tetrahedron and that none of the other two xj nor any of the camera centres ci lies on a face of this tetrahedron. whether or not this condition is essential is not resolved. three-view critical configurations the existence of a third distinct solution follows from the fact that the dual of a nondegenerate quadric is non-degenerate. the minimum interesting case of theorem is when n as studied in section in this case there are nine points in total cameras and six points. one can construct a quadric surface passing through these nine points quadric is defined by nine points. if the quadric is a ruled quadric hyperboloid of one sheet in the non-degenerate case then there are three possible distinct reconstructions. otherwise the reconstruction is unique. as with reconstruction from seven points in two views algorithm for six points in three views requires the solution of a cubic equation. as with seven points the distinction between cases where the cubic has one or three real solutions is explained as the difference between whether the quadric is ruled or not. three-view critical configurations we now turn to consider the ambiguous configurations that may arise in the three-view case. in this section to distinguish the three cameras we use superscripts instead of primes. thus let be three cameras and be a set of points. we ask under what circumstances there exists another configuration consisting of three other camera matrices and and points such that pjpi qjqi for all i and j. we require that the two configurations be projectively inequivalent. various special ambiguous configurations exist. points in a plane if all the points lie in a plane and pi qi for all i then any of the cameras may be moved without changing the projective equivalence class of the projected points. it is possible to choose pj and qj with centres at any two preassigned locations in such a way that pjpi qjqi. points on a twisted cubic a similar ambiguous situation arises when all the points plus one of the cameras say lie on a twisted cubic. in this case we may choose and and the points qi pi for all i. then according to the ambiguity of camera resectioning for points on a twisted cubic for any point q on the twisted cubic a camera matrix may be chosen with centre at q such that for all i. these examples of ambiguity are not very interesting since they are no more than extensions of the one-view camera resectioning ambiguity. in the above examples the points pi and qi are the same in each case and the ambiguity lies only in the placement of the cameras with respect to the points. more interesting ambiguities may also occur as we consider next. degenerate configurations general three-view ambiguity suppose that the camera matrices and are fixed and we wish to find the set of all points such that pip qiq for i note that we are trying here to copy the two-view case in which both sets of camera matrices are chosen in advance. later we will turn to the less restricted case in which just one set of cameras is chosen in advance. a simple observation is that a critical configuration for three views is also a critical set for each of the pairs of views. thus one is led naturally to assume that the set of points for which pi is a critical configuration is simply the intersection of the point sets for which each of pi pi and pi is a critical configuration. since by lemma each of these point sets is a ruled quadric one is led to assume that the critical point set in the three-view case is simply an intersection of three quadrics. although this is not far from the truth the reasoning is somewhat fuzzy. the crucial point missing in this argument is that the corresponding conjugate points may not be the same for each of the three pairs. more precisely corresponding to the critical configuration pi there exists a conjugate configuration for which pjpi for j similarly for the critical configuration pi there exists a conjugate configuration for which pjpi i are not necessarily the same as so we cannot conclude that there exist points qi such that i pjpi qjqi for all i and j at least not immediately. for j however the points i i i i we now consider this a little more closely. considering just the first pairs of cameras and lemma tells us that if p and q are points such that pjp qjq then p must lie on a quadric surface p determined by these camera matrices. similarly point q lies on a quadric q likewise considering the camera pairs and one finds that the point p must lie on a second quadric p defined by these two camera pairs. similarly there exists a further quadric defined by the camera pairs and on which the point p must lie. thus for points p and q to exist such that pjp qjq for j it is necessary that p lie on the intersection of the three quadrics p p it will now be seen that this is almost a necessary and sufficient condition. p p result let and be two triplets of camera matrices and assume for each of the pairs j and let sij p and sij q be the ruled quadric critical surfaces defined for camera matrix pairs pj and qj as in lemma p p lie on the intersection q conversely if p is a point lying on the intersection of quadrics q and if there exist points p and q such that pip qiq for all i then p must q q p p p q then there q such that pip qiq for all i but not on a plane containing the three camera centres exists a point q lying on p and q must lie on p p q q q the centre of camera lies on p lies on p and lies on p p three-view critical configurations note that the condition that is not any restriction of generality since the projective frames for the two configurations and are independent. one may easily choose a projective frame for the second configuration in which this condition is true. this assumption is made simply so that one may consider the point p in relation to the projective frame of the second set of cameras. the extra condition that the point p does not lie on the plane of camera centres ci q is necessary however the reader is referred to for justification of this claim. note that this case will usually not arise however since the intersection point of the three quadrics with the trifocal plane will be empty or in special cases consist of a finite number of points. where it does arise is through the possibility that the three camera centres q are collinear in which case any other point is coplanar with these three camera centres. q and q proof. the first statement follows directly from lemma for the second part the fact that the points p and q lie on the intersections of the three quadrics follows pointed out before the statement of the theorem from lemma applied to each pair of cameras in turn. to prove the final assertion suppose that p lies on the intersection of the three quadrics. then from lemma applied to each of the three quadrics sij p there exist points qij such that the following conditions hold it is easy to be confused by the superscripts here but the main point is that each line is precisely the result of lemma applied to one of the three pairs of camera matrices at a time. these equations may be rearranged as now the condition that means that the points and are collinear with the camera centre q of thus assuming that the points qij are distinct they must lie in a configuration as shown in figure one sees from the diagram that if two of the points are the same then the third one is the same as the other two. if the three points are distinct then the three points qij and the three camera centres ci q are coplanar since they all lie in the plane defined by and the line joining to thus the three points all lie in the plane of the camera centres ci q. however since it follows that p must lie along the same line as and and hence must lie in the same plane as the camera centres ci q. thus this result shows that the points in a critical configuration lie on the intersection of three quadrics whereas the camera centres lie on the intersections of degenerate configurations p q q q q p q fig. configuration of the three camera centres and the three ambiguous points. if the three points qij are distinct then they all lie in the plane of the camera centres ci q. pairs of the quadrics. in general the intersection of three quadrics will consist of eight points. in this case the critical set with respect to the two triplets of camera matrices will consist of these eight points less any such points that lie on the plane of the three cameras qi. in fact it has been shown a longer unpublished version of that of the eight points of intersection of three quadrics only seven are critical since the eighth point lies on the plane of the three cameras. p p p and p p p will also satisfy in some cases however the camera matrices may be chosen such that the three quadric surfaces meet in a curve. this will occur if the three quadrics sij p are linp then any point p that satisfies early dependent. for instance if p p thus the intersection of the three quadrics is the same as the intersection of two of them. in this case the three cameras must also lie on the same intersection curve. we define a non-degenerate elliptic quartic to be the intersection curve of two non-degenerate ruled quadrics consisting of a single curve. this is a fourth-degree space curve. other ways that two quadrics can intersect include a twisted-cubic plus a line or two conics. examples of elliptic quartics are shown in figure example three-view critical configuration the elliptic quartic. we consider the quadrics represented by matrices a and b b bt s u s u s t s t and b p q a r p q r where thus b is a member of a family of quadrics generated by q r s t u that scale is irrelevant. the camera matrices i i and i have centres lying on the intersection of these three quadrics. we show that a configuration consisting of these three cameras and any number of points on the intersection of the two quadrics is critical. this is demonstrated by explicitly exhibiting two alternative configurations consisting of three cameras qi and for each point p lying on the intersection of the two quadrics a conjugate point q such three-view critical configurations fig. examples of elliptic quartic curves generated as the intersection of two ruled quadrics. that pip qiq. in fact two different conjugate configurations are given in table and table it may be verified directly that pip qiq for all points p y xy and corresponding points q provided that p lies on the quadric b. always lies on quadric a. the easiest way to see this is to verify that for all such points. in fact for i the cross-product is always zero whereas for i it may be verified by direct computation that for the first solution and ptbp ptbp for the second solution. thus if and only if p lies on b. and note that in this example a is the matrix representing the quadric p this example is quite general since if are two non-degenerate ruled quadrics containing the centres of three cameras then by a projective transformation we may map to a and the three camera centres to those of the given pi provided only that no two of the camera centres lie on the same generator of in addition will map to a b for some thus the pencil generated by and and hence also their intersection curve are projectively equivalent to those generated by a and b. the possibility that two of the camera centres lie on the same generator of is not a difficulty since if the line of the camera centres lies on all quadrics in the pencil then the quadric intersection can not be an non-degenerate elliptic quartic. otherwise degenerate configurations the camera matrices are and q t u s u q s t q s t q q t u t u q t u the conjugate point to p y xy is q y xyt table first conjugate solution to reconstruction problem for cameras pi and points on the intersection of quadrics a and b given in the camera matrices are and s u t u q r s t t u q t u r s t q t u the conjugate point to p y xy is q x xyt table second conjugate solution to reconstruction problem. we can choose centres. this demonstrates to be one of the quadrics not containing the line of the two camera result any configuration consisting of three cameras and any number of points lying on a non-degenerate elliptic quartic is critical. closure the literature the twisted cubic as the critical curve for camera resectioning was brought to the attention of the computer-vision community by for more about critical sets of two views the reader is referred to and the book in both these cases the critical point sets were known much earlier. in fact refers the reader to the german photogrammetric literature for two views the result that and are not critical in theorem is due to fredrik kahl closure the discussion of critical configurations for three views given in this chapter is only a part of what is known about this topic. more can be found in in particular the elliptic-quartic configuration is extended to any number of cameras in a critical configuration for any number of cameras consisting of points on a twisted cubic and cameras on a straight line is considered in earlier work on this area includes an investigation of the critical camera positions for sets of six points in and an unpublished report deals with critical configurations in three views. nothing has been said here about critical configurations of lines in three or more views but this topic has been treated in in addition critical configuration for linear reconstruction from lines linear line complex have been identified in notes and exercises fill out the details of the following sketch to prove that any two configurations consisting of a hyperboloid of one sheet and two points on the hyperboloid are projectively equivalent a projectivity of provided that the points in both pairs either do or do not lie on the same generator. since any hyperboloid of one sheet is projectively equivalent to any two hyperboloids of one sheet are projectively equivalent to each other and also to the hyperboloid given by z xy. define a projective transformation hxx x bcx d. one computes that a c x y xy d c b a b d x y y x this is a projective transformation taking the surface z xy to itself. composing this with a similar transformation of y one finds a projective transformation that takes y xy to while fixing the quadric z xy. since hx and hy are arbitrary projective transformations this gives enough freedom to map any two points to two others. y x y show that maps a line that meets one of the edges of the reference tetrahedron to a conic. show that maps a straight line meeting two opposite edges of the reference tetrahedron to a straight line meeting the same two edges. how are these configurations related to degenerate configurations for camera resectioning as shown in figure two-view degeneracy occurs when all points and the two cameras lie on a ruled quadric. given eight points on the corners of a euclidean cube and two camera centres show that these points always lie on a quadric. if this is a ruled quadric then the configuration is degenerate and reconstruction is not possible from points. investigate under what conditions the quadric is ruled. hint degenerate configurations there is a two-parameter family of quadrics passing through the cube vertices. what does this two-parameter family look like? extend result by showing that a configuration of any number of cameras and points lying on a non-degenerate elliptic quartic is critical. this does not require complex computations. if stuck refer to part v appendices portrait of the countess d haussonville on canvas by jean-auguste-dominique ingres the frick collection new york appendix tensor notation since tensor notation is not commonly used in computer vision it seems appropriate to give a brief introduction to its use. for more details the reader is referred to for simplicity these concepts will be explained here in the context of low-dimensional projective spaces rather than in their full generality. however the ideas apply in arbitrary dimensional vector spaces. consider a set of basis vectors ei i for a projective space for reasons to become clear we will write the indices as subscripts. with respect to this basis a point in is represented by a set of coordinates xi which represents xi ei. we write the coordinates with an upper index as shown. let x the point represent the triple of coordinates x now consider a change of coordinate axes in which the basis vectors ei are replaced by a new basis set ej where ej ei and h is the basis transformation matrix j. if x are the coordinates of the vector with respect to with entries h i the new basis then we may verify that x h thus if the basis vectors transform according to h the coordinates of points transform according to the inverse transformation h i h i j next consider a line in represented by coordinates l with respect to the original basis. with respect to the new basis it may be verified that the line is represented by a new set of coordinates l htl. thus coordinates of the line transform according to ht. as a further example let p be a matrix representing a mapping between projective vector spaces. if g and h represent basis transformations in the domain and range spaces then with respect to the new bases the mapping is represented by a new matrx p h note in these examples that sometimes the matrix h or ht is used in the transformation and sometimes h these three examples of coordinate transformations may be written explicitly as fol lows. xi j xj li h j i lj p i j k gl j p k l where we use the tensor summation convention that an index repeated in upper and lower positions in a product represents summation over the range of the index. note that those indices that are written as superscripts transform according to h whereas the tensor those that are written as subscripts transform as h g. note that there is no distinction in tensor notation between indices that are transformed by h and those that are transformed by ht. in general tensor indices will transform by either h or h in fact this is the characteristic of a tensor. those indices that transform according to h are known as covariant indices and are written as subscripts. those indices that transform according to h are known as contravariant indices and are written as superscripts. the number of indices is the valency of the tensor. the sum over an index e.g. h j i lj is referred to as a contraction in this case the tensor h j i is contracted with the line lj. the tensor is defined for r s t as follows the tensor unless r s and t are distinct if rst is an even permutation of if rst is an odd permutation of the tensor its contravariant counterpart is connected with the cross product of two vectors. if a and b are two vectors and c a b is their cross product then the following formula may easily be verified. ci bi related to this is the expression for the skew-symmetric matrix using tensor notation one writes this as thus one sees that if a is a contravariant vector then is a matrix with two covariant indices. a similar formula holds for where v is covariant namely finally the tensor is related to determinants for three contravariant tensors ai bj and ck one verifies that aibjckijk is the determinant of the matrix with rows ai bj and ck. the trifocal tensor i the trifocal tensor t jk has one covariant and two contravariant indices. for vectors and matrices such as xi li and p i j it is possible to write the transformation rules using standard linear algebra notation e.g. hx. however for tensors with three or more indices this cannot conveniently be done. there is really no choice but to use tensor notation when dealing with the trifocal tensor. transformation rule. the arrangement of indices for the trifocal tensor implies a transformation rule t with respect to changes of basis in the three images. it is worthwhile pointing out one possible source of confusion here. the transformation rule shows how the t jk i f r i s t st r appendix tensor notation l l l l l l l l t l l l t l l l l l l l l l fig. a representation of the trifocal tensor figure after faugeras and papadopoulo the picture represents li l which is the contraction of the tensor with the lines to produce a line l. in pseudo-matrix notation this can be written as li and where t jk kt jk jl i i tensor is transformed in terms of basis transformations in the three images. often we are concerned instead with point coordinate transformations. thus if and represent coordinate transformations in the images in the sense that xj f i xi and are similarly defined for the other images then the transformation rule may be written as and t jk i i g s h t t st r picture of tensors. a vector x may be thought of as a set of numbers arranged in a column or row and a matrix h as a array of numbers. similarly a tensor with three indices may be thought of as a array of numbers. in particular the trifocal tensor is a cube of cells as illustrated in figure appendix gaussian and distributions gaussian probability distribution given a vector x of random variables xi for i n with mean x ex where e represents the expected value and x x x the covariance matrix is an n n matrix given by e x xt so that ij e xi xj. the diagonal entries of the matrix are the variances of the individual variables xi whereas the off-diagonal entries are the cross-covariance values. the variables xi are said to conform to a joint gaussian distribution if the probability distribution of x is of the form det exp p x for some positive-semidefinite matrix it may be verified that x and are the mean and covariance of the distribution. a gaussian distribution is uniquely determined by det is just the normalizing factor its mean and covariance. the factor necessary to make the total integral of the distribution equal to in the special case where is a scalar matrix the gaussian pdf takes a p simple form n exp xt where x xn this distribution is called an isotropic gaussian distribution. mahalanobis distance. note that in this case the value of the pdf at a point x is of the point x from simply a function of the euclidean distance the mean x xn by analogy with this one may define the mahalanobis distance between two vectors x and y to be n yt y appendix gaussian and distributions one verifies that for a positive-definite matrix this defines a metric on irn. using this notation the general form of the gaussian pdf may be written as p exp where the normalizing factor has been omitted. thus the value of the gaussian pdf is a function of the mahalanobis distance of the point x from the mean. exp ux and ux and substituting in leads to change of coordinates. since is symmetric and positive-definite it may be written as utdu where u is an orthogonal matrix and d n is diagonal. writing xt thus the orthogonal change of coordinates from x to ux transforms a general gaussian pdf into one with diagonal covariance matrix. a further scaling by i in each coordinate direction may be applied to transform it to an isotropic gaussian distribution. equivalently stated a change of coordinates may be applied to transform mahalanobis distance to ordinary euclidean distance. exp exp distribution n distribution is the distribution of the sum of squares of n independent gaussian the random variables. as applied to a gaussian random vector v with non-singular covariance matrix the value of vt v satisfies a n distribution where n is the dimension of v. if the covariance matrix is singular then we must replace with the pseudo-inverse in this case if v is a gaussian random vector with mean v and covariance matrix then the value of vt v satisfies a the cumulative chi-squared distribution is defined as n this represents the probability that the value of the n random variable is less than graphs of the n distributions for n are shown in figure a program for computing the cumulative chi-squared distribution is given in since it is a monotonically increasing function one may compute the inverse function by any simple technique such as subdivision and values are tabulated in table with figure r distribution where r rank n distribution and inverse cumulative distribution fig. the in both cases graphs are for n bottom to top middle point of horizontal axis. n distribution and inverse cumulative n distribution f n for n n table values of for which the cumulative distribution with n degrees of freedom equals i.e. f n where is the probability. appendix parameter estimation there is much theory about parameter estimation dealing with properties such as the bias and variance of the estimate. this theory is based on analysis of the probability density functions of the measurements and the parameter space. in this appendix we discuss such topics as bias of an estimator the variance the cram er-rao lower bound on the variance and the posterior distribution. the treatment will be largely informal based on examples and exploring these concepts in the context of reconstruction. the general lesson to be learnt from this discussion is that many of these concepts depend strongly on the particular parametrization of the model. in problems such as projective reconstruction where there is no preferred parametrization these concepts are not well defined or depend very strongly on assumed noise models. a simple geometric estimation problem. the problem we shall consider is related to the triangulation problem of determining a point in space from its projection into two images. to simplify this problem however we consider its analog. in addition we fix one of the rays reducing the problem to one of estimating the position of a point along a known line from observing it in a single image. thus consider a line camera is one forming a image as in section observing points on a single line. let the camera be located at the origin and point in the positive y direction. further assume that it has unit focal length. thus the camera matrix for this camera is simply now suppose that the camera is observing points on the line y world line a point on this line will be mapped to the image point x xx however we assume that a point is measured with a certain inaccuracy which may be modelled with a probability density function the usual practice is to model the noise using a gaussian distribution. let us assume at least that the mode of the distribution is at zero. the imaging setup is illustrated in figure the estimation problem we consider is the following given the image coordinates of a point estimate the position of the world point on the line y x to consider a specific scenario we may think of the line as a scintillator being flooded with gammarays. a camera is used to measure the location of each scintillation and determine its position along the line. the problem seems to be ridiculously simple but it will turn out that there are some surprises. bias y x c x fig. the imaging setup for a simple estimation problem. a point on the line y x is imaged by a line camera. the projection mapping is given by f x where parametrizes the points on the line y x measurement is subject to noise with a zero-mode distribution. probability density function. we start by parametrizing the world line y x by a parameter where the most convenient parametrization is x so that the point parametrized by is this point projects to we denote this projection function from the world line to the image line by f so that f the measurement of this point is corrupted by noise resulting in a random variable x with probability distribution given by px gx f for instance if g is a zero-mean gaussian distribution with variance then px exp f maximum likelihood estimate. an estimate of the parameter vector given a measured value x is a function denoted assigning a parameter vector to a measurement x. the maximum likelihood estimate is given by m l arg max px in the current estimation problem it is easily seen that the ml estimate is obtained simply by back-projecting the measured point x and selecting its intersection with the world line according to the formula x. this is the ml estimate because the resulting point with parameter projects forward to x hence px gx x which by assumption gives the maximum of the probability density function g. any other choice of parameter will give a smaller value of px bias a desirable property of an estimator is that it can be expected to give the right answer on the average. given a parameter or equivalently in our case a point on the world line we consider all possible measurements x and from them reestimate the parameter namely the estimator is known as unbiased if on the average we obtain appendix parameter estimation x for different fig. the ml estimate of the world-point position f measurements of the image point x. note that for values of x greater than the ml estimate switches to behind the camera. the original parameter true value. in forming this average we weight the measurements x according to their probability. more formally the bias of the estimator is defined as e px x and the estimator is unbiased if e for all here e stands for the expected value given defined as shown. another way of thinking of bias is in terms of repeating an experiment many times with identical model parameters and a different instance of the noise at each trial. the bias is the difference between the average value of the estimated parameters and the true parameter value. it is worth noting that for the bias to be defined it is not necessary that the parameter space have an a priori distribution defined on it not even that it be a measure space. it is necessary however that it have some affine structure so that the average integral can be formed. now we determine whether the ml estimate of is unbiased in the case where f the integral becomes px exp x x x dx x it turns out that this integral diverges and hence the bias is undefined. the difficulty is that with an assumed gaussian distribution of noise for any value of there is always a finite perhaps very small probability px that x for values of x the corresponding ray does not meet the world line in front of the camera the ray is parallel to the world line at x the estimate as a function of x is shown in figure showing how it results in estimated world-points behind the camera. even if values of behind the camera are ignored the ml estimator has infinite bias as is explained in figure limiting the range of parameters. since the range of the parameter is from to it makes sense to limit its range. in fact we may have knowledge that all events on the world-line lie in a more restricted range. as an example suppose that we assume that lies in the range and hence noise-free projected points are in the range x in this case the ml estimate for any image point x will a bias b c fig. the reason that the ml estimate with gaussian noise model has infinite bias. the distribution of possible values of the image measurement given a world-point at x y assuming gaussian noise distribution with in symbols px the ml estimate of the world point for different values of the image point x. note that as the image point approaches the estimated point on the world-line recedes to infinity. product px the integral of this function from x to x gives the bias of the ml estimator. note that as x approaches the graph increases abruptly to infinity. the integral is unbounded meaning that the estimator has infinite bias. b a fig. if the range of possible values of the world-point parameter is limited to the range then the ml estimate of any point x will be this will prevent infinite bias in the estimate but there will still be bias. the bias e as a function of measurement noise is gaussian with x be at with this restriction on the parameter the ml estimate is still biased as shown in figure if the noise-distribution has finite support then the bias will also be finite for most values of even if the range of the parameter is unrestricted. this is shown in figure one learns from this that the bias of the estimator can be very dependent on the noise-model a factor that is usually not within our control. dependency of bias on parametrization. the reason for the infinite bias for the ml estimator with gaussian noise model in this example is the projective mapping between the world line and the image line. it is possible to parametrize the world line differently in a way that will change the bias. let the world line y x be parametrized in such a way that parameter represents the point on the line. the part of the line in front of the camera positive y coordinate is parametrized by in the range under the projection y xy the projection map f is given by f xy thus the point with parameter maps to in other words points on the world line are appendix parameter estimation a b fig. if the noise-model has finite support then the bias will be finite. in this example the noise model is for x where bias as a function of for small values of percentage bias the bias is relatively small for small values of but larger to for large values. the position of the point along the world-line is always over-estimated. parametrized by the coordinate of the point that they project to under the camera mapping. and the bias is now in this case the ml estimate is given by x xgx f f x x xgxdx f f x x gxdx assuming that the distribution gx is zero-mean. note this shows that the estimate of the original measurement x is unbiased. lessons about bias. by a change of parametrization of the world line the bias has been changed from infinite to zero. in the present example there is a natural affine parametrization of the world line for which we have seen that the bias is infinite. however if we are working in a projective context then the parameter space has no natural affine parametrization. in this case it is somewhat meaningless to speak of any absolute measurement of bias. a second lesson from the above example is that the ml estimate of the corrected measurement opposed to the world point is unbiased. it was also seen that the value of bias is strongly dependent on the noise distribution. even the very small tails of the gaussian distribution have a very large effect on the computed bias. of course a gaussian distribution of the noise is only a convenient model for modelling image measurement errors. the exact distribution of image measurement noise is generally unknown and the conclusion is inescapable that one can not theoretically compute an exact value for the bias of a given estimator except for synthetic data with known noise model. variance of an estimator variance of an estimator the other important attribute of an estimator is its variance. consider an experiment being repeated many times with the same model parameters but a different instantiation of the noise at each trial. applying our estimator to the measured data we obtain an estimate for each of these trials. the variance of the estimator is the variance covariance matrix of the estimated values. more precisely we can define the variance for an estimation problem involving a single parameter as var x where e x bias in the case where the parameters form a vector var is the covariance matrix var in many cases we might be more interested in the variability of the estimate with respect to the original parameter which is the mean-squared error of the estimator. this is easily computed from e var bias it should be noted that as with the bias the variance of an estimator makes good sense only when there is a natural affine structure on the parameter set at least locally. most estimation algorithms will give the right answer if there is no noise. if an algorithm performs badly when noise is added this means that either the bias or variance of the algorithm is high. this is the case for instance with the dlt algorithm or the unnormalized algorithm discussed in section the variance of the algorithm grows quickly with added noise. the cram er-rao lower bound. it is evident that by adding noise to a set of measurements information is lost. consequently it is not to be expected that any estimator can have zero bias and variance in the presence of noise on the measurements. for unbiased estimators this notion is formalized in the cram er-rao lower bound which is a bound on the variance of an unbiased estimator. to explain the cram er-rao bound we need a few definitions. given a probability distribution px the fisher score is defined as v log px the fisher information matrix is defined to be f e v x the relevance of the fisher information matrix is expressed in the following result. result cram er-rao lower bound. for an unbiased estimator dete det f a cram er-rao lower bound may also be given in the case of a biased estimator. appendix parameter estimation the posterior distribution an alternative to the ml estimate is to consider the probability distribution for the parameters given the measurements namely p this is known as the posterior distribution namely the distribution for the parameters after the measurements have been taken. to compute it we need a prior distribution p for the parameters before any measurement has been taken. the posterior distribution can then be computed from bayes law p px p px since the measurement x is fixed so is its probability px so we may ignore it leading to p px p the maximum of the posterior distribution is known as the maximum a posteriori estimate. note. though the map estimate may seem like a good idea it is important to realize that it depends on the parametrization of the parameter space. the posterior probability distribution is proportional to px however p is dependent on the parametrization of for instance if p is a uniform distribution in one parametrization it will not be a uniform distribution in a different parametrization that differs by a non-affine transformation. on the other hand px does not depend on the parametrization of therefore the result of a change of parametrization is to alter the posterior distribution in such a way that its maximum will change. if the parameter space does not have a natural affine coordinate system instance if the parameter space is projective then the map estimate does not really make a lot of sense. other estimates based on the posterior distribution are also possible. given a measurement x and the posterior distribution p we may wish to make a different estimate of the parameter one sensible choice is the estimate that minimizes the expected squared error in the estimate namely argminy argminy which is the mean of the posterior distribution. a further alternative is to minimize the expected absolute error argminy argminy which is the median of the posterior distribution. examples of these estimates are shown in figure and figure more properties of these estimates are listed in the notes at the end of this appendix. estimation of corrected measurements we have seen that in geometric estimation problems particularly those that involve projective models concepts such as bias and variance of the estimator are dependent on the particular parametrization of the model for instance a particular projective coordinate frame chosen. even in cases where a natural affine parametrization of the model estimation of corrected measurements a b fig. different estimators for for the imaging setup of figure the a posteriori distribution p assuming a gaussian noise distribution with and a prior distribution for uniform on the interval the mode of this distribution is the maximal apriori estimate of which is identical with the ml estimate because of the assumed uniform distribution for the mean of this distribution is the estimate that minimizes the expected squared error e with respect to the true measurement the cumulative a posteriori distribution by the zero point of this graph is the median of the distribution namely the estimate that minimizes e the median lies at a b fig. different estimators with the parabolic noise model. the two graphs show the a posteriori distribution of and its cumulative distribution. in this example the noise model is for x where the mode of the distribution is the map estimate identical with the ml estimate the mean minimizes the expected squared error in and the median minimizes the expected absolute error. exists it may be difficult to find an unbiased estimator. for instance the ml estimator for problems such as triangulation is biased. we saw however in the example of back-projection discussed in section that if instead of attempting to compute the model the back-projected point we estimate the corrected measurement instead then the ml estimator is unbiased. we explore this notion further in this section and show that in a general setting the ml estimator of the corrected measurements is not only unbiased but attains the cram errao lower bound when the noise-model is gaussian. consider an estimation problem that involves fitting a parametrized model to a set of image measurements. as seen in section this problem may be viewed as an estimation problem in a high-dimensional euclidean space irn which is the space of all image measurements. this is illustrated in figure the estimation problem is given a measurement vector x to find the closest point lying on a surface representing the set of all allowable exact measurements. the vector represents the appendix parameter estimation set of corrected image measurements that conform to the given model. the model itself may depend on a set of parameters such as the fundamental matrix hypothesized points or other parameters appropriate to the problem. the estimation of the parameters is subject to bias in the same way as we have seen with the simple problem discussed in section and the exact degree of bias is dependent on the precise parametrization. generally instance in projectivereconstruction problems there is no natural affine coordinate system for the model parameters though there is a natural affine coordinate system for the image plane. measurement vector then we find a more favourable situation. the measurements if we think of the problem differently as the problem of directly finding the corrected are carried out in the images which have a natural affine coordinate system and so questions of bias in estimating the corrected measurements make more sense. we will show that provided the measurement surface is well approximated by its tangent plane the ml estimate of the corrected measurement vector is unbiased provided the noise is zero-mean. in addition if the noise is gaussian and isotropic then the ml estimate meets the cram er-rao lower-bound. the geometric situation is follows. a point x lies on a measurement surface as shown in figure noise is added to this point to obtain a measured point x. the estimate of the true point x is obtained by selecting the closest point on the mea surement surface to the measured point. we make an assumption that the measurement surface is effectively planar near x. is spanned by the first d coordinates. we may write x a d-vector. the measured point may similarly be written as x we may choose a coordinate system in which the measurement surface close to x n dt where is and its we suppose that the projection onto the tangent plane is noise-distribution is given by pxx gx x. now the bias of the estimate is xt x xgx xdx x xpxxdx jx xgx xdx xgx xdx x x j x xtpxxdx jx xx xtjtgx xdx xx xtgx xdxjt x x x j j gjt x where j is the matrix d. this shows that the estimate of x is unbiased as xt long at g has zero-mean. the variance of the estimate is equal to xtgx xdx where g is the covariance matrix of g. notes and exercises we now compute the cram er-rao lower bound for this estimator supposing that the distribution gx is gaussian defined by gx k exp in this case the variance of the estimator is simply d. we next compute the fisher information matrix. the probability distribution is pxx gx x exp k exp exp taking logarithms and derivatives with respect to gives log pxx the fisher information matrix is then id d thus the fisher information matrix is the inverse of the covariance matrix for the estimator. thus for the case where the noise distribution is gaussian the ml estimator meets the cram er-rao lower bound to the extent that the measurement surface is flat. it should be noticed that the fisher information matrix does not depend on the specific shape of the measurement surface but only on its first-order approximation the tangent plane. the properties of the estimate does however depend on the shape of the measurement surface both as regards its bias and variance. it may also be shown that if the cram er-rao bound is met then the noise distribution must be gaussian. in other words if the noise distribution is not gaussian then we can not meet the lower bound. notes and exercises show by a specific example that the a posteriori distribution is altered by a change of coordinates in the parameter space. show also that the mean of the distribution may be altered by such a coordinate change. thus the mode estimate and mean of the posterior distribution are dependent on the choice of coordinates for the parameter space. show for any pdf p defined on irn that argminy mean of the distribution. show for any pdf p defined on ir that argminy median of the distribution. in higher dimensions show that is a convex function of y and hence has a single minimum. the value of y that minimizes this is a higher-dimensional generalization of the median of a distribution. show that the median of a pdf defined on ir is invariant to reparametrization of ir. show by an example that this is not true in higher dimensions however. is the is the appendix matrix properties and decompositions in this appendix we discuss matrices with particular forms that occur throughout the book and also various matrix decompositions. orthogonal matrices a square matrix u is known as orthogonal if its transpose is its inverse symbolically utu i where i is the identity matrix. this means that the column vectors of u are all of unit norm and are orthogonal. this may be written ut uj ij. from the condition i utu i one easily deduces that uut i. hence the row vectors of u are also of unit norm and are orthogonal. consider once more the equation utu i. taking determinants leads to the equation since det u det ut. thus if u is orthogonal then det u one easily verifies that the orthogonal matrices of a given fixed dimension form a group denoted on since if u and v are orthogonal then vtutuv i. furthermore the orthogonal matrices of dimension n with positive determinant form a group called son. an element of son is called an n-dimensional rotation. norm-preserving properties of orthogonal matrices. given a vector x the notation represents its euclidean length. this can be written as an important property of orthogonal matrices is that multiplying a vector by an orthogonal matrix preserves its norm. this is easily seen by computing xtutux xtx. by the qr decomposition of a matrix is usually meant the decomposition of the matrix a into a product a qr where q is orthogonal and r is an upper-triangular matrix. the letter r stands for right meaning upper-triangular. similar to the qr decomposition there are also ql lq and rq decompositions where l denotes a left or lower-triangular matrix. in fact the rq decomposition of a matrix is the one that will be of most use in this book and which will therefore be discussed here. the most important case is the decomposition of a matrix and we will concentrate on this in the following section. orthogonal matrices givens rotations and rq decomposition a givens rotation is a rotation about one of the three coordinate axes. the three givens rotations are qx c c s c s qy s s c c s s qz c where c cos and s sin for some angle and blank entries represent zeros. multiplying a matrix a on the right by instance qz has the effect of leaving the last column of a unchanged and replacing the first two columns by linear combinations of the original two columns. the angle may be chosen so that any given entry in the first two columns becomes zero. for instance to set the entry to zero we need to solve the equation the solution to this is c it is required that since c cos and s sin and the values of c and s given here satisfy that requirement. the strategy of the rq algorithm is to clear out the lower half of the matrix one entry at a time by multiplication by givens rotations. consider the decomposition of a matrix a as a rq where r is upper-triangular and q is a rotation matrix. this may take place in three steps. each step consists of multiplication on the right by a givens rotation to set a chosen entry of the matrix a to zero. the sequence of multiplications must be chosen in such a way as not to disturb the entries that have already been set to zero. an implementation of the rq decomposition is given in algorithm and s objective carry out the rq decomposition of a matrix a using givens rotations. algorithm multiply by qx so as to set to zero. multiply by qy so as to set to zero. this multiplication does not change the second column of a hence remains zero. multiply by qz so as to set to zero. the first two columns are replaced by linear combinations of themselves. thus and remain zero. algorithm rq decomposition of a matrix. other sequences of givens rotations may be chosen to give the same result. as a result of these operations we find that aqxqyqz r where r is upper-triangular. qt consequently a rqt x is a rotation. in z addition the angles x y and z associated with the three givens rotations provide a parametrization of the rotation by three euler angles otherwise known as roll pitch and yaw angles. qt x and so a rq where q qt qt y qt y z it should be clear from this description of the decomposition algorithm how similar qr ql and lq factorizations may be carried out. furthermore the algorithm is easily generalized to higher dimensions. appendix matrix properties and decompositions householder matrices and qr decomposition for matrices of larger dimension the qr decomposition is more efficiently carried out using householder matrices. the symmetric matrix hv i v hv i and so hv is orthogonal. has the property that ht let be the vector t and let x be any vector. let v x one easily verifies that hvx thus hv is an orthogonal matrix that transforms the vector x to a multiple of geometrically hv is a reflection in the plane perpendicular to v and v x is a vector that bisects x and thus reflection in the v direction takes x to for reasons of stability the sign ambiguity in defining v should be resolved by setting v x if a is a matrix x is the first column of a and v is defined by then forming the product hva will clear out the first column of the matrix replacing the first column by t. one continues left multiplication by orthogonal householder matrices to clear out the below-diagonal part of the matrix a. in this way one finds that eventually qa r where q is a product of orthogonal matrices and r is an uppertriangular matrix. therefore one has a qtr. this is the qr decomposition of the matrix a. when multiplying by householder matrices it is inefficient to form the householder matrix explicitly. multiplication by a vector a may be carried out most efficiently as hva a and the same holds for multiplication by a matrix a. for more about householder matrices and the qr decomposition the reader is referred to note. in the qr or rq decomposition r refers to an upper-triangular matrix and q refers to an orthogonal matrix. in the notation used elsewhere in this book r refers usually to a rotation orthogonal matrix. symmetric and skew-symmetric matrices symmetric and skew-symmetric matrices play an important role in this book. a matrix is called symmetric if at a and skew-symmetric if at a. the eigenvalue decompositions of these matrices are summarized in the following result. result eigenvalue decomposition. if a is a real symmetric matrix then a can be decomposed as a udut where u is an orthogonal matrix and d is a real diagonal matrix. thus a real symmetric matrix has real eigenvalues and the eigenvectors are orthogonal. if s is real and skew-symmetric then s ubut where b is a block-diagonal symmetric and skew-symmetric matrices matrix of the form amz where z the eigenvectors of s are all purely imaginary and a skew-symmetric matrix of odd order is singular. a proof of this result is given in jacobi s method. in general eigenvalue extraction from arbitrary matrices is a difficult numerical problem. for real symmetric matrices however a very stable method exists jacobi s method. an implementation of this algorithm is given in cross products of particular interest are skew-symmetric matrices. if a is a then one defines a corresponding skew-symmetric matrix as follows note that any skew-symmetric matrix may be written in the form for a suitable vector a. matrix is singular and a is its null-vector or left. hence a skew-symmetric matrix is defined up to scale by its null-vector. the cross product vector product of two a b written a b is the vector the cross product is related to skew-symmetric matrices according to a b b atb cofactor and adjoint matrices. let m be a square matrix. by m is meant the matrix is equal to det mij of cofactors of m. that is the entry of the matrix m where mij is the matrix obtained from m by striking out the i-th row and j-th column. the transpose of the cofactor matrix m is known as the adjoint of m and denoted adjm. if m is invertible then it is well known that where m t is the inverse transpose of m. this formula does not hold for non-invertible matrices but adjm m m adjm detm i is always valid. m detm m t the cofactor matrix is related to the way matrices distribute with respect to the cross product. lemma if m is any matrix or not and x and y are column vectors then y. appendix matrix properties and decompositions this equation may be written as m m dropping y which is inessential. now putting t mx and assuming m is invertible one obtains a rule for commuting a skew-symmetric matrix with any non-singular matrix m. one may write as follows. result for any vector t and non-singular matrix m one has m tm to scale. m m note result that m is the form of the fundamental matrix for a pair of cameras p and the formula of result is used in deriving alternative forms for the fundamental matrix. a curious property of skew-symmetric matrices is that up to scale scale this is easily verified since the right hand side is clearly skew-symmetric and its null-space generator is a. the next result follows immediately result if f m f f to scale. hence one may decompose f as f f. m is a fundamental matrix singular matrix then m where positive-definite symmetric matrices the special class of real symmetric matrices that have positive real eigenvalues are called positive-definite symmetric matrices. we list some of the important properties of a positive-definite symmetric real matrix. result positive-definite symmetric real matrix. a symmetric matrix a is positive-definite if and only if xtax for any non zero vector x. a positive-definite symmetric matrix a may be uniquely decomposed as a kkt where k is an upper-triangular real matrix with positive diagonal entries. proof. the first part of this result follows almost immediately from the decomposition a udut. as for the second part since a is symmetric and positive-definite it may be written as a udut where d is diagonal real and positive and u is orthogonal. we may take the square root of d writing d eet where e is diagonal. then a vvt where v ue. the matrix v is not upper-triangular. however we may apply the rqdecomposition to write v kq where k is upper-triangular and q is orthogonal. then a vvt kqqtkt kkt. this is the cholesky factorization of a. one may ensure that the diagonal entries of k are all positive by multiplying k on the right by a diagonal matrix with diagonal entries equal to this will not change the product kkt. representations of rotation matrices now we prove uniqueness of the factorization. specifically if and are two uppertriangular matrices satisfying since the left side of this equation is upper-triangular and the right side is lower-triangular they must both in fact be diagonal. thus d k is the inverse transpose of kt and so d is equal to its own inverse transpose and hence is a diagonal matrix with diagonal entries equal to if both and have positive diagonal entries then d i and kt however k then k k t kt k t k t the above proof gives a constructive method for computing the cholesky factorization. there is however a very simple and more efficient direct method for computing the cholesky factorization. see for an implementation. representations of rotation matrices rotations in n-dimensions given a matrix t we define et to be the sum of the series et i t tkk! this series converges absolutely for all values of t. now we consider powers of a skew-symmetric matrix. according to result a skew-symmetric matrix can be written as s ubut where b is block diagonal of the form b amz matrix u is orthogonal and we observe that the powers of z are i z i and so on. thus ez i z where means the matrix representing a rotation through radian. more generally eaz cosai sinaz with s ubut as above it now follows that es uebut u ut thus es is a rotation matrix. on the other hand any rotation matrix may be written in the block-diagonal form u ut and it follows that the matrices es where s is an n n skew-symmetric are exactly the set of ndimensional rotation matrices. rotations in if t is a then is a skew-symmetric matrix and any skew-symmetric matrix is of this form. consequently any rotation can be written as et we seek to describe the rotation et appendix matrix properties and decompositions let u diagaz ut. then by matching the frobenius norms of the matrices on both sides we see that a thus et u ut thus et represents a rotation through an angle it is easily verified that the column of u is the eigenvector of u diagr ut with unit eigenvector hence the axis of rotation. however udiagaz u diagaz since is the generator of the null space of it must be that is a unit vector in the direction of t. we have shown result the matrix et is a rotation matrix representing a rotation through an angle about the axis represented by the vector t. this representation of a rotation is called the angle-axis representation. we may write a specific formula for the rotation matrix corresponding to et we observe that t where t represents a unit vector in the direction t. then with sinc representing sin we have et i i t t i t i ttt where the last line follows from the identity ttt some properties of these representations extraction of the axis and rotation angle from a rotation matrix r is just a little tricky. the unit rotation axis v can be found as the eigenvector corresponding to the unit eigenvalue that is by solving iv next it is easily seen from that the rotation angle satisfies cos sin writing this second equation as sin v we can then compute sin vt v. now the angle can be computed from sin and cos using a twoargument arctan function as the c-language function x. it has often been written that can be computed directly from using arccos or arcsin. however this method is not numerically accurate and fails to find the axis when to apply a rotation rt to some vector x it is not necessary to construct the matrix representation of t. in fact singular value decomposition i x x rtx x t x if t is written as t t where t is a unit vector in the direction of the axis and is the angle of rotation then is equivalent to the rodrigues formula for a rotation matrix r t i sin t cos quaternions three-dimensional rotations may also be represented by unit quaternions. a unit quaternion is a and may be written in the form q sin cos as may indeed any unit such a quaternion represents a rotation about the vector v through the angle this is a representation in that both q and q represent the same rotation. to check this note that q sin cos which represents a rotation through the relationship between the angle-axis representation of a rotation and the quaternion representation is easily determined. given a vector t the angle-axis representation of a rotation the corresponding quaternion is easily seen to be t q singular value decomposition the singular value decomposition is one of the most useful matrix decompositions particularly for numerical computations. its most common application is in the solution of over-determined systems of equations. given a square matrix a the svd is a factorization of a as a udvt where u and v are orthogonal matrices and d is a diagonal matrix with non-negative entries. note that it is conventional to write vt instead of v in this decomposition. the decomposition may be carried out in such a way that the diagonal entries of d are in descending order and we will assume that this is always done. thus a circumlocutory phrase such as the column of v corresponding to the smallest singular value is replaced by the last column of v. the svd also exists for non-square matrices a. of most interest is the case where a has more rows than columns. specifically let a be an m n matrix with m n. in this case a may be factored as a udvt where u is an m n matrix with orthogonal columns d is an n n diagonal matrix and v is an n n orthogonal matrix. the fact that u has orthogonal columns means that utu in n. furthermore u has the normpreserving property that for any vector x as one readily verifies. on the other hand uut is in general not the identity unless m n. not surprisingly one can also define a singular value decomposition for matrices appendix matrix properties and decompositions with more columns than rows but generally this will not be of interest to us. instead on the occasional instances in this book where we need to take the singular value decomposition of a matrix a with m n it is appropriate to extend a by adding rows of zeros to obtain a square matrix and then take the svd of this resulting matrix. usually this will be done without special remark. common implementations of the svd such as the one in assume that m n. since in this case the matrix u has the same dimension m n as the input matrix a may be overwritten by the output matrix u. implementation of the svd. a description of the singular value decomposition algorithm or a proof of its existence is not given in this book. for a description of how the algorithm works the reader is referred to a practical implementation of the svd is given in however the implementation of the svd given in the first edition of numerical recipes in c can sometimes give incorrect results. the version of the algorithm given in the second edition of numerical recipes in c corrects mistakes in the earlier version. singular values and eigenvalues. the diagonal entries of matrix d in the svd are non-negative. these entries are known as the singular values of the matrix a. they are not the same thing as eigenvalues. to see the connection of the singular values of a with eigenvalues we start with a udvt. from this it follows that ata vdutudvt since v is orthogonal vt v and so ata this is the defining equation for eigenvalues indicating that the entries of are the eigenvalues of ata and the columns of v are the eigenvectors of ata. in short the singular values of a are the square-roots of the eigenvalues of ata. note ata is symmetric and positive-semi-definite section above so its eigenvalues are real and non-negative. consequently singular values are real and non-negative. computational complexity of the svd the computational complexity of the svd depends on how much information needs to be returned. for instance in algorithm to be considered later the solution to the problem is the last column of the matrix v in the svd. the matrix u is not used and does not need to be computed. on the other hand algorithm of section requires the complete svd to be computed. for systems of equations with many more rows than columns the extra effort required to compute the matrix u is substantial. approximate numbers of floating-point operations required to compute the svd of an m n matrix are given in to find matrices u v and d a total of flops are needed. however if only the matrices v and d are required then only flops are required. this is an important distinction since this latter expression does not contain any term in specifically the number of operations required to compute u varies as the square of m the number of rows. on the other hand the complexity of computing d and v is linear in m. for cases where there are many more rows than columns therefore it is important singular value decomposition computation time is an issue to avoid computing the matrix u unless it is needed. to illustrate this point we consider the dlt algorithm for camera resection described in chapter in this algorithm a camera matrix is computed from a set of n to point matches. the solution involves using algorithm to solve a set of equations ap where a is a matrix. the solution vector p is the last column of the matrix v in an svd a udvt. thus the matrix u is not required. table gives the total number of flops for carrying out the svd for six minimum number or point correspondences. points equations per point equations operations not computing u operations computing u table comparison of the number of flops required to compute the svd of a matrix of size m n for varying values of m and for n note that the computational complexity increases sub-linearly in the number of equations when u is not computed. on the other hand the extra computational burden of computing u is very large especially for large numbers of equations. further reading. two invaluable text books for this area are and appendix least-squares minimization in this appendix we discuss numerical algorithms for solving linear systems of equations under various constraints. as will be seen such problems are conveniently solved using the svd. solution of linear equations consider a system of equations of the form ax b. let a be an m n matrix. there are three possibilities if m n there are more unknowns than equations. in this case there will not be a unique solution but rather a vector space of solutions. if m n there will be a unique solution as long as a is invertible. if m n then there are more equations than unknowns. in general the system will not have a solution unless by chance b lies in the span of the columns of a. least-squares solutions full-rank case. we consider the case m n and assume for the present that a is known to be of rank n. if a solution does not exist then in many cases it still makes sense to seek a vector x that is closest to providing a solution to the system ax b. in other words we seek x such that is minimized where represents the vector norm. such an x is known as the least-squares solution to the over-determined system. the least-squares solution is conveniently found using the svd as follows. we seek x that minimizes because of the norm-preserving property of orthogonal transforms and this is the quantity that we want to minimize. writing y vtx and utb the problem becomes one of minimizing where d is an m n matrix with vanishing dn yn b b b n b m b b off-diagonal entries. this set of equations is of the form solution of linear equations clearly the nearest dy can approach to n t and this is achieved by setting yi b idi for i n. note that the assumption ranka n ensures that di finally one retrieves x from x vy. the complete algorithm is is the vector b objective find the least-squares solution to the m n set of equations ax b where m n and rank a n. algorithm find the svd a udvt. set utb. find the vector y defined by yi b the solution is x vy. idi where di is the i-th diagonal entry of d. algorithm linear least-squares solution to an over-determined full-rank set of linear equations. deficient-rank systems. sometimes one is called upon to solve a system of equations that is expected not to be of full column rank. thus let r ranka n where n is the number of columns of a. it is possible that because of noise corruption the matrix a actually has rank greater than r but we wish to enforce the rank r constraint because of theoretical considerations derived from the particular problem being considered. in this case there will be an r-parameter family of solutions to the set of equations where r ranka n. this family of solutions is appropriately solved using the svd as follows this algorithm gives an r-parameter family by the indeterminate values i of least-squares solutions to the deficient-rank system. the justification of this algorithm is similar to that of algorithm for the least-squares solution of fullrank systems. systems of unknown rank. in most cases encountered in this book the rank of a system of linear equations will be known theoretically in advance of solution. if the rank of the system of equations is not known then one must guess at its rank. in this case it is appropriate to set singular values that are small compared with the largest appendix least-squares minimization objective find the general solution to a set of equations ax b where a is an m n matrix of rank r n. algorithm order. find the svd a udvt where the diagonal entries di of d are in descending numerical set utb. find the vector y defined by yi b the solution x of minimum norm is vy. the general solution is x vy nvn where vn are idi for i r and yi otherwise. the last n r columns of v. algorithm general solution to deficient-rank system singular value to zero. thus if where is a small constant of the order of the machine then one sets yi a least-squares solution is then given by x vy as before. the pseudo-inverse given a square diagonal matrix d we define its pseudo-inverse to be the diagonal matrix d such that d ii d ii if dii otherwise. now consider an m n matrix a with m n. let the svd of a be a udvt. we define the pseudo-inverse of a to be the matrix a vdut. where one very simply verifies that the vector y in algorithm or algorithm is nothing more than result the least-squares solution to an m n system of equations ax b of rank n is given by x ab. in the case of a deficient-rank system x ab is the solution that minimizes as remarked when discussing the svd if a has fewer rows than columns then this result may be applied after extending a to a square matrix by adding rows of zeros. utb. thus symmetric matrices. for symmetric matrices one may generalize the pseudoinverse as follows. this generalization was used in chapter section for discussing singular covariance matrices. if a is a non-invertible symmetric matrix and one can see that this depends xtax is invertible then we write ax def xxtax only on the span of the columns of x. in other words if x is replaced by xb for any invertible matrix b then ax axb. otherwise stated ax depends only on the machine precision is the largest floating point value such that the pseudo-inverse null-space of x namely the space of vectors perpendicular to the columns of x. define the null-space nlx xtx one finds that under a simple condition ax is the pseudo-inverse of a result let a be a symmetric matrix then ax def xxtax if nlx la. a if and only only a sketch proof is given. the necessity is obvious since nlx and nla are the null-spaces of the left and right sides of the equation. to prove the converse one may assume that the columns of x are orthonormal since as shown above only the null-space of x is of importance. thus x may be extended by adding further columns now the rows of span the null-space of x and hence by assumption of a. now the proof is completed in a few lines by with the definition of the pseudocomparing the definition ax def xxtax inverse. to form an orthogonal matrix u linear least-squares using normal equations the linear least-squares problem may also be solved by a method involving the socalled normal equations. once more we consider the set of linear equations ax b where a is an m n matrix with m n. in general no solution x will exist for this set of equations. consequently the task is to find the vector x that minimizes the norm as the vector x varies over all values the product ax varies over the complete column space of a that is the subspace of irm spanned by the columns of a. the task therefore is to find the closest vector to b that lies in the column space of a where closeness is defined in terms of vector norm. let x be the solution to this problem thus ax is the closest point to b. in this case the difference ax b must be a vector orthogonal to the column space of a. this means explicitly that ax b is perpendicular to each of the columns of a and hence atax b multiplying out and separating terms gives an equation atb. this is a square n n set of linear equations called the normal equations. this set of equations may be solved to find the least-squares solution to the problem ax b. even if a is not of full rank n this set of equations should have a solution since atb lies in the column space of ata. in the case where a has rank n the matrix ata is objective find x that minimizes algorithm solve the normal equations atax atb. if ata is invertible then the solution is x algorithm linear least-squares using the normal equations. appendix least-squares minimization since x ab this implies invertible and so x may be found by x the following result which is also easily verified directly result if a is an m n matrix of rank n then a this result is useful in theoretical analysis as well as being a computationally simpler method than using the svd to compute a pseudo-inverse if n is small compared with m that computing the inverse of is inexpensive compared to computing the svd of a. vector space norms. one sometimes wishes to minimize ax b with respect to a different norm on the vector space irn. the usual norm in a vector space irn is given in terms of the usual inner product. thus for two vectors a and b in irn one may define the inner product a b to be atb. the norm of a vector a is then one notes the properties the inner product is a symmetric bilinear form on irn. for all non-zero vectors a irn. we say that the inner product is a positive-definite symmetric bilinear form. it is possible to define other inner products on a vector space irn. let c be a real symmetric positive-definite matrix and define a new inner product ca b tcb. the symmetry of the inner product follows from the symmetry of c. a norm may be defined by and this is defined and positive-definite because c is assumed to be a positive-definite matrix. weighted linear least-squares problems. sometimes one desires to solve a weighted least-squares problem of the form ax b by minimizing the c-norm of the error. here c is a positive-definite symmetric matrix defining an inner product and a norm on irn. as before one can argue that the minimum error vector ax b must be orthogonal in the inner product defined by c to the column space of a. this leads to a requirement atcax b rearranging this one obtains the weighted normal equations atcb. the most common weighting will be where c is a diagonal matrix corresponding to independent weights in each of the axial directions in irn. however general weighting matrices c may be used also. least-squares solution of homogeneous equations similar to the previous problem is that of solving a set of equations of the form ax this problem comes up frequently in reconstruction problems. we consider the case where there are more equations than unknowns an over-determined set of equations. the obvious solution x is not of interest we seek a non-zero solution to the set of equations. observe that if x is a solution to this set of equations then so is kx for any scalar k. a reasonable constraint would be to seek a solution for which least-squares solution to constrained systems in general such a set of equations will not have an exact solution. suppose a has dimension m n then there is an exact solution if and only if ranka n the matrix a does not have full column rank. in the absence of an exact solution we will normally seek a least-squares solution. the problem may be stated as find the x that minimizes subject to this problem is solvable as follows. let a udvt. the problem then requires us to minimize however and thus we need to minimize subject to the condition we write y vtx and the problem is minimize subject to now d is a diagonal matrix with its diagonal entries in descending order. it follows that the solution to this problem is y having one non-zero entry in the last position. finally x vy is simply the last column of v. the method is summarized in algorithm objective given a matrix a with at least as many rows as columns find x that minimizes subject to solution x is the last column of v where a udvt is the svd of a. algorithm least-squares solution of a homogeneous system of linear equations. as mentioned in section the last column of v may alternatively be described as the eigenvector of ata corresponding to the smallest eigenvalue. least-squares solution to constrained systems in the previous section we considered a method of least-squares solution of equations of the form ax such problems may arise from situations where measurements are made on a set of image features. with exact measurements and an exact imaging model the mathematical model predicts an exact solution to this system. in the case of inexact image measurements or noise there will not be an exact solution. in this case it makes sense to find a least-squares solution. on other occasions however some of the equations represented by rows of the matrix a are derived from precise mathematical constraints and should be satisfied exactly. this set of constraints may be described by a matrix equation cx which should be satisfied exactly. others of the equations are derived from image measurements and are subject to noise. this leads to a problem of the following sort find the x that minimizes subject to and cx this problem can be solved in the following manner. the condition that x satisfies cx means that x lies perpendicular to each of the rows of c. the set of all such x is a vector space called the orthogonal complement of the row space of c. we wish to find this orthogonal complement. appendix least-squares minimization first if c has fewer rows than columns then extend it to a square matrix by adding rows of zero elements. this has no effect on the set of constraints cx now let c udvt be the singular value decomposition of c where d is a diagonal matrix with r non-zero diagonal entries. in this case c has rank r and the row-space of c is generated by the first r rows of vt. the orthogonal complement of the row-space of c consists of the remaining rows of vt. define c to be the matrix v with the first r columns deleted. then cc and so the set of vectors x satisfying cx is spanned by the columns of c and we may write any such x as x c for suitable has orthogonal columns one observes that the since c minimization problem now becomes that minimizes subject to find the this is simply an instance of the problem discussed in section solved by algorithm the complete algorithm for solution of the constrained minimization problem is given as algorithm objective given an m n matrix a with m n find the vector x that minimizes subject to and cx algorithm if c has fewer rows than columns then add zero-filled rows to c to make it square. compute the svd c udvt where diagonal entries of d are sorted with non-zero ones first. let c be the matrix obtained from v by deleting the first r columns of v where r is the number of non-zero entries in d rank of c. find the solution to the minimization problem ac using algorithm the solution is given by x c algorithm algorithm for constrained minimization. more constrained minimization a further constrained minimization problem arises in the algebraic estimation method used frequently throughout this book for instance for computation of the fundamental matrix or the trifocal tensor the problem is minimize subject to and x g x for a given matrix g and some unknown vector x. note that this is very similar to the previous minimization problem of section which was reduced to the form of the present problem in which the matrix g had orthonormal columns. the condition that x g x for some x means nothing more than that x lies in the span of the columns of g. thus to solve the present problem using algorithm we need only to replace g by a matrix with the same column space the space spanned by the columns but with orthonormal columns. if g udvt where d has r non-zero entries is g has rank r then let be the matrix consisting of the least-squares solution to constrained systems if x is also required then it may be obtained by solving g x x have the same column space. as in section the to be the unit vector that minimizes then setting first r columns of u. then g and solution is found by setting x the solution is expressed in terms of the pseudo-inverse as x gx it may not be unique if g does not have full column rank. since g vdut we may write x consists of the first r and columns of which simplifies to x is the upper r r block of d. where the complete method is summarized in algorithm objective find the vector x that minimizes subject to the conditions and x g x where g has rank r. algorithm diagonal. compute the svd g udvt where the non-zero values of d appear first down the let find the unit vector the required solution is x if desired one may compute x as that minimizes using algorithm be the matrix comprising the first r columns of u. consists of the first r columns of where v and is the upper r r block of d. algorithm algorithm for constrained minimization subject to a span-space constraint. yet another minimization problem a very similar problem is minimize subject to a condition this problem comes up for instance in the solution to the dlt camera calibration problem in general it will be the case that rankc n where n is the dimension of the vector x. geometrically the problem may be thought of as finding the lowest point on a quadratic surface by xtatax with the constraint that the point must lie on the conic xtctcx we start by taking the svd of the matrix c obtaining c udvt. the condition is equivalent to and it is not necessary to compute u vtx the problem becomes minimize subject to explicitly. then writing the condition writing av this becomes minimize subject to thus we have reduced to the case where the constraint matrix is a diagonal matrix d. we suppose that d has r non-zero diagonal entries and s zero entries where r s i of n the non-zero entries appearing first on the diagonal of d. then the entries x since the corresponding diagonal entries of for i r do not affect the value of d are zero. then for a specific choice of the x i for i r the other entries x i i appendix least-squares minimization i and and let consists of the first r columns of where consist of the remaining s elements of i r n should be chosen so as to minimize the value of remaining s columns. similarly let of diagonal matrix consisting of the first r diagonal entries of d. then and the minimization problem is to minimize we write consists of the be an r-vector consisting of the first r elements further let be the r r now temporarily fixing subject to the condition takes the form of a least-squares minimization problem of the type discussed in section according to result the value of substituting this in gives which we are required to minimize subject to the condition the problem reduces at last to a problem of the form of the familiar minimization problem of algorithm minimize we now summarize the algorithm. that minimizes is finally writing subject to d objective minimize subject to algorithm and where is formed from the remaining columns. compute the svd c udvt and write av. suppose rankd r and let let be the upper r r minor of d. this is an n r matrix. compute minimize subject to using algorithm set the solution is given by x let d and consists of the first r columns of algorithm least-squares solution of homogeneous equations subject to the constraint appendix iterative estimation methods in this appendix we describe the various components involved in building an efficient and robust iterative estimation algorithm. we start with two of the most common iterative parameter minimization methods namely newton iteration the closely related gauss-newton method and levenberg marquardt iteration. the general idea of newton iteration is familiar to most students of numerical methods as a way of finding the zeros of a function of a single variable. its generalization to several variables and application to finding least-squares solutions rather than exact solutions to sets of equations is relatively straightforward. the levenberg marquardt method is a simple variation on newton iteration designed to provide faster convergence and regularization in the case of overparametrized problems. it may be seen as a hybrid between newton iteration and a gradient descent method. for the type of problem considered in this book important reductions of computational complexity are obtained by dividing the set of parameters into two parts. the two parts generally consist of a set of parameters representing camera matrices or homographies and a set of parameters representing points. this leads to a sparse structure to the problem that is described starting at section we discuss two further implementation issues the choice of cost function with respect to their robustness to outliers and convexity and the parametrization of rotations and homogeneous and constrained vectors finally those readers who want to learn more about iterative techniques and bundle-adjustment are referred to for more details. newton iteration suppose we are given a hypothesized functional relation x f where x is a measurement vector and p is a parameter vector in euclidean spaces irn and irm respectively. a measured value of x approximating the true value x is provided and we wish to find the vector that most nearly satisfies this functional relation. more precisely we seek the vector satisfying x f for which is minimized. note that the linear least-squares problem considered in section is exactly of this type the function f being defined as a linear function fp ap. appendix iterative estimation methods to solve the case where f is not a linear function we may start with an initial estimated value and proceed to refine the estimate under the assumption that the function f is locally linear. let be defined by f x. we assume that the function f is approximated at by f j where j is the linear mapping represented by the jacobian matrix j f p. we seek a point f with which minimizes f x x j thus it is required to minimize j over which is a linear minimization problem. the vector is obtained by solving the normal equations or by using the pseudo-inverse thus the solution vector is obtained jtj by starting with an estimate and computing successive approximations according to the formula where i is the solution to the linear least-squares problem pi i this algorithm will converge to the required least-squares solution unfortunately it matrix j is the jacobian f p evaluated at pi and fpi x. one hopes that j i is possible that this iteration procedure converges to a local minimum value or does not converge at all. the behaviour of the iteration algorithm depends very strongly on the initial estimate weighted iteration. as an alternative to all the dependent variables being equally weighted it is possible to provide a weight matrix specifying the weights of the dependent variables x. to be more precise one may assume that the measurement x satisfies a gaussian distribution with covariance matrix x and one wishes to minimize the ma halanobis distance this covariance matrix may be diagonal specifying that the individual coordinates of x are independent or more generally it may be an arbitrary symmetric and positive definite matrix. in this case the normal equations become jt i jt the rest of the algorithm remains unchanged. newton s method and the hessian. we pass now to consideration of finding minima of functions of many variables. for the present we consider an arbitrary scalar-valued function gp where p is a vector. the optimization problem is simply to minimize gp over all values of p. we make two assumptions that gp has a well-defined minimum value and that we know a point reasonably close to this minimum. we may expand gp about in a taylor series to get g gp tgpp where subscript p denotes differentiation and the right hand side is evaluated at we wish to minimize this quantity with respect to to this end we differentiate with respect to and set the derivative to zero arriving at the equation gp gpp or newton iteration gpp gp. in this equation gpp is the matrix of second derivatives the hessian of g the j-th entry of which is pi pj and pi and pj are the i-th and j-th parameters. vector gp is the gradient of g. the method of newton iteration consists in starting at an initial value of the parameters and iteratively computing parameter increments using until convergence occurs. now we turn to the sort of cost function that arises in the least-squares minimization problem considered above. specifically gp is the squared norm of an error function gp where is a vector-valued function of the parameter vector p. in particular fp x. the factor is present for simplifying the succeeding computations. the gradient vector gp is easily computed to be p. however we may write f p j using the notation introduced previously. in short gp jt. differentiating gp p a second time we compute the following formula for the gpp pp pp. now under the assumption that f is linear the second term on the right vanishes pp jtj. now substituting for the gradient and hessian in leaving gpp yields jtj jt which is nothing more than the normal equations thus we have arrived at the same iterative procedure as previously solving the parameter estimation problem under the assumption that jtj pp is a reasonable approximation for the hessian of the function gp. this procedure in which jtj is used as an approximation for the hessian is known as the gauss-newton method. gradient descent. the negative down-hill gradient vector gp p defines the direction of most rapid decrease of the cost function. a strategy for minimization of g is to move iteratively in the gradient direction. this is known as gradient descent. the length of the step may be computed by carrying out a line search for the function minimum in the negative gradient direction. in this case the parameter increment is computed from the equation gp where controls the length of the step. we may consider this as related to newton iteration as expressed by the update equation in which the hessian is approximated arbitrarily by the scalar matrix i. gradient descent by itself is not a very good minimization strategy typically characterized by slow convergence due to zig-zagging. for a closer analysis. it will be seen in the next section however that it can be useful in conjunction with gauss-newton iteration as a way of getting out of tight corners. the the last term in this formula needs some clarification. since is a vector is a array tensor. the sum iippi where is the t pp is over the components of it may be written more precisely as implied by the product i-th components of the vector and is its hessian. appendix iterative estimation methods levenberg marquardt method is essentially a gauss-newton method that transitions smoothly to gradient descent when the gauss-newton updates fail. to summarize we have so far considered three methods of minimization of a cost function gp newton. update equation gpp gp pp pp and gp where gpp p. newton iteration is based on the assumption of an approximately quadratic cost function near the minimum and will show rapid convergence if this condition is met. the disadvantage of this approach is that the computation of the hessian may be difficult. in addition far from the minimum the assumption of quadratic behaviour is probably invalid so a lot of extra work is done with little benefit. gauss-newton. update equation pp p this is equivalent to newton iteration in which the hessian is approximated by pp. generally this is a good approximation particularly close to a minimum or when is nearly linear in p. gradient descent. update equation p gp. the hessian in newton iteration is replaced by a multiple of the identity matrix. each update is in the direction of most rapid local decrease of the function value. the value of may be chosen adaptively or by a line search in the downward gradient direction. generally gradient descent by itself is not recommended but in conjunction with gauss-newton it yields the commonly used levenberg marquardt method. levenberg marquardt iteration the levenberg marquardt lm iteration method is a slight variation on the gauss-newton iteration method. the normal equations jtj jt are replaced by the augmented normal equations i jt for some value of that varies from iteration to iteration. here i is the identity matrix. a typical initial value of is times the average of the diagonal elements of n jtj. if the value of obtained by solving the augmented normal equations leads to a reduction in the error then the increment is accepted and is divided by a factor before the next iteration. on the other hand if the value leads to an increased error then is multiplied by the same factor and the augmented normal equations are solved again this process continuing until a value of is found that gives rise to a decreased error. this process of repeatedly solving the augmented normal equations for different values of until an acceptable is found constitutes one iteration of the lm algorithm. an implementation of the lm algorithm is given in levenberg marquardt iteration justification of lm. to understand the reasoning behind this method consider what happens for different values of when is very small the method is essentially the same as gauss-newton iteration. if the error function is close to being quadratic in p then this method will converge fast to the minimum value. on the other hand when is large then the normal equation matrix is approximated by i and the normal equations become jt. recalling that jt is simply the gradient vector of we see that the direction of the parameter increment approaches that given by gradient descent. thus the lm algorithm moves seamlessly between gauss-newton iteration which will cause rapid convergence in the neighbourhood of the solution and a gradient descent approach which will guarantee a decrease in the cost function when the going is difficult. indeed as becomes larger and larger the length of the increment step decreases and eventually it will lead to a decrease of the cost function to demonstrate that the parameter increment obtained by solving the augmented normal equations for all values of is in the direction of decreasing cost we will show that the inner product of and the negative gradient direction for the function gp is positive. this results from the following computation. gp gt p i however jtj i is positive-definite for any value of and so therefore is its inverse. is positive unless jt is zero. by definition this means that i thus the increment is in a direction of locally decreasing cost unless of course the gradient jt is zero. a different augmentation. in some implementations of levenberg-marquardt notably that given in a different method of augmenting the normal equations is used. the augmented normal equation matrix is defined in terms of the matrix ij nij for i j. thus the diagonal of n is n jtj by augmented by a multiplicative factor instead of an additive factor. as before a small value of results essentially in a gauss-newton update. for large the offdiagonal entries of the normal equation matrix become insignificant with respect to the diagonal ones. ii and the i-th diagonal entry of is simply i ji where ji f pi and pi is the i-th parameter. the update equation is then where i is i the increment in the i-th parameter. apart from the factor this is the normal equation that would result from minimizing the cost by varying only the i-th parameter i. thus in the limit as becomes large the increment to the parameters is the direction that would result from minimizing each one separately. ji i jt i with this sort of augmentation the parameter increments for large are not the same as for gradient descent. nevertheless the same analysis as before shows that the resulting increment is still in the down-hill direction for any value of one small problem may arise if some parameter pi has no effect on the value of the function f then ji f pi is zero and the i-th diagonal entry of n and hence is zero. the augmented normal equation matrix trouble. in practice this is a rare occurrence but it can occur. appendix iterative estimation methods is then singular which can cause implementation of lm. to carry out levenberg marquardt minimization in its simplest form it is necessary only to provide a routine to compute the function being min imized a goal vector of observed or desired values of the function and an initial estimate computation of the jacobian matrix j may be carried out either numerically or by providing a custom routine. numerical differentiation may be carried out as follows. each independent variable xi is incremented in turn to xi the resulting function value is computed using the routine provided for computing f and the derivative is computed as a ratio. good results have been found by setting the value to the maximum of this choice seemingly gives a good approximation to the derivative. in practice there seems to be little disadvantage in using numerical differentiation though for simple functions f one may prefer to provide a routine to compute j partly for aesthetic reasons partly because of a possible slightly improved convergence and partly for speed. xi and a sparse levenberg marquardt algorithm the lm algorithm as described above in section is quite suitable for minimization with respect to a small number of parameters. thus in the case of homography estimation chapter for the simple cost functions and which are minimized with respect only to the entries of the homography matrix h the lm algorithm works well. however for minimizing cost functions with respect to large numbers of parameters the bare lm algorithm is not very suitable. this is because the central step of the lm algorithm the solution of the normal equations has complexity n in the number of parameters and this step is repeated many times. however in solving many estimation problems of the type considered in this book the normal equation matrix has a certain sparse block structure that one may take advantage of to realize very great time savings. an example of the situation in which this method is useful is the problem of estimating a homography between two views assuming errors in both images by minimizing the cost function this problem may be parametrized in terms of a set of parameters characterizing the homography the entries of the homography matrix plus parameters for each of the n points in the first view a total of parameters. another instance where these methods are useful is the reconstruction problem in which one has image correspondences across two or more us say m views and one wishes to estimate the camera parameters of all the cameras and also the positions of all the points. one can assume arbitrary projective cameras or fully or partially calibrated cameras. furthermore to remove some of the incidental degrees of freedom one can fix one of the cameras. for instance in the projective reconstruction problem the problem may be parametrized by the entries of all the camera matrices total of or parameters depending on how the cameras are parametrized plus a set of parameters for the coordinates of the points. a sparse levenberg marquardt algorithm the sparse lm algorithm is often perceived as complex and difficult to implement. to help overcome this the algorithms are given cook-book style. given a suitable library of standard matrix manipulation routines a reader should be able to implement the algorithm without difficulty. notation one after the other in a single column vector is denoted by similar notation is used for matrices. if n are vectors then the vector obtained by placing them nt. a t at partitioning the parameters in the lm method the sparse lm method will be described primarily in terms of the reconstruction problem since this is the archetypal problem to which this method relates. the estimation problem will be treated in general terms first of all since this will illuminate the general approach without excessive detail. at this level of abstraction the benefits of this approach may not be apparent but they will become clearer in section we start with the simple observation that the set of parameters in this problem may be divided up into two sets a set of parameters describing the cameras and a set of parameters describing the points. more formally the parameter vector p irm may be partitioned into parameter vectors a and b so that p btt. we are given a measurement vector denoted by x in a space irn in the reconstruction problem this consists of the vector of all image point coordinates. in addition let x be the covariance matrix the parameter vector p to the estimated measurement vector f denoting by for the measurement we consider a general function f irm irn taking the difference x between the measured and estimated quantities one seeks the set of parameters that minimize the squared mahalanobis distance j p has a block structure of the form j where jacobian submatrices corresponding to the division of parameters p btt the jacobian matrix x x are defined by and a b the set of equations j solved as the central step in the lm algorithm section now has the form a b a at a b x bt x j b x j jt then the normal equations jt algorithm are of the form at x a at x b x a bt x b bt in the absence of other knowledge one usually assumes that x is the identity matrix. x to be solved at each step of the lm appendix iterative estimation methods at this point in the lm algorithm the diagonal blocks of this matrix are augmented by multiplying their diagonal entries by a factor for the varying parameter this augmentation alters the matrices at x a and bt x b. the resulting matrices will be denoted by x b the reader may wish to look ahead to figure and figure which shows graphically the form of the jacobian and normal equations in an estimation problem involving several cameras and points. x a the set of equations may now be written in block form as and u w wt v a b as a first step to solving these equations both sides are now multiplied on the left by i wv i resulting in u wv wt a b v wv this results in the elimination of the top right hand block. the top half of this set of equations is wv a wv these equations may be solved to find a. subsequently the value of b may be found by back-substitution giving v b wt a. as in section if the newly computed value of the parameter vector p at btt results in a diminished value of the error function then one accepts the new parameter vector p diminishes the value of by a factor of and proceeds to the next iteration. on the other hand if the error value is increased then one rejects the new p and tries again with a new value of increased by a factor of the complete partitioned levenberg marquardt algorithm is given in algorithm although in this method we solve first for a and subsequently for b based on the new value of a it should not be thought that the method amounts to no more than independent iterations over a and b. if one were to solve for a holding b constant then the normal equations used to solve for a would take the simpler form u a compared with the method of alternating between solving for a and b is not recommended however because of potential slow convergence. covariance it was seen in result that the covariance matrix of the estimated parameters is given by p x j. a sparse levenberg marquardt algorithm of parameters p btt and a function f p taking the parameter vector to an given a vector of measurements x with covariance matrix x an initial estimate of a set estimate of the measurement vector. objective find the set of parameters p that minimizes algorithm compute the derivative matrices a a and b b and the error vector initialize a constant value. x where x compute intermediate expressions u at x a at x v bt x b bt x w at x b of v augment u and v by multiplying their diagonal elements by compute the inverse v and define y wv the inverse may overwrite the value find a by solving ywt a yb. find b by back-substitution b v wt a. update the parameter vector by adding the incremental vector t which will not be needed again. bt and compute a t the new error vector. if the new error is less than the old error then accept the new values of the parameters diminish the value of by a factor of and start again at step or else terminate. if the new error is greater than the old error then revert to the old parameter values increase the value of by a factor of and try again from step algorithm a partitioned levenberg marquardt algorithm. in the over-parametrized case the covariance matrix p given by is singular and in particular no variation in the parameters is allowed in directions perpendicular to the constraint surface the variance is zero in these directions. in the case where the parameter set is partitioned as p btt matrix x j has the block form given in and without augmentation represented by stars. thus we may write jt x j at bt x a at x b x a bt x b u w wt v the covariance matrix p is the pseudo-inverse of this matrix. under the assumption that v is invertible redefine y wv then the matrix may be diagonalized according to jt x j w u wt v i y i u wv v i yt i for matrices g and h with g invertible we assume an identity g thg this identity is valid under conditions explored in the exercise at the end of this ap appendix iterative estimation methods objective compute the covariance of the parameters a and b estimated using algorithm algorithm compute matrices u v and w as in algorithm and also y wv a wv b yt ay v the cross-covariance ab ay. algorithm computation of the covariance matrix of the lm parameters. pendix. applying this to and multiplying out provides a formula for the pseudo inverse xy ytxy v p x j x ytx where x wv the condition for this to be true is that spana spanb where span represents the span of the columns of the matrix. here a and b are as in proof of this fact and interpretation of the condition spana spanb is outlined in exercise on page the division of matrix jt x j into blocks as in corresponds in to the division of p into parameters a and b. truncation of the covariance matrix for parameters p gives covariance matrices for parameters a and b separately. the result is summarized in algorithm xt xt general sparse lm method in the previous pages a method has been described for carrying out lm iteration and computing covariances of the solution in the case where the parameter vector may be partitioned into two sub-vectors a and b. it is not clear from the foregoing discussion that the methods described there actually give any computational advantage in the general case. however such methods become important when the jacobian matrix obeys a certain sparseness condition as will be described now. we suppose that the measurement vector x irn may broken up into pieces as nt. similarly suppose that the parameter vector p irm may x to a given assignment of parameters will be denoted by we make the sparseness be divided up as p bt nt. the estimated values of xi corresponding assumption that each is dependent on a and bi only but not on the other parameters bj. in this case bj for i j. no assumption is made about a. this in which bi is the vector of parameters of the i-th point and is the vector of meaa point does not depend on any other point one sees that bj as required corresponding to this division the jacobian matrix j p has a sparse block surements of the image of this point in all the views. in this case since the image of situation arises in the reconstruction problem described at the start of this discussion bt t unless i j. structure. we define jacobian matrices by application of sparse lm to homography estimation a ai bi bi nt x the set of equations given an error vector of the form t j now has the form j an bn a bn we suppose further that all of the measurements xi are independent with covariance matrices xi. thus the covariance matrix for the complete measurement vector x has the block-diagonal form x diag xn. in the notation of algorithm we have at nt t a b n x diag xn b t bnt t nt t t now it is a straightforward task to substitute these formulae into algorithm the result of this substitution is given in algorithm representing the computation of one step of the lm algorithm. the important observation is that in this form each step of the algorithm requires computation time linear in n. without the advantage resulting from the sparse structure the algorithm instance a blind adherence to algorithm would have complexity of order application of sparse lm to homography estimation i i we apply the foregoing discussion to the estimation of a homography h given a set of corresponding image points xi i in two images. the points in each image are subject to noise and one seeks to minimize the cost function we define a measurement vector xi tt. in this case the parameter vector p may be divided up as p xt nt where the values xi are the estimated values of the image points in the first image and h is a vector of entries of the homography h. thus one must simultaneously estimate the homography h and the parameters of nt where each each point in the first image. the function f maps p to xt the jacobian matrices have a special form in this case since one observes that tt. then algorithm applies directly. i xt xt i h xt i xt i ai h i h appendix iterative estimation methods bt nt and the measurement vector as x objective formulate lm algorithm in the case where the parameter vector is partitioned as p bt nt such that bj for i j. compute the derivative matrices ai a and bi bi and the error vectors xi algorithm steps to of algorithm become xt compute the intermediate values i u i at xi ai v vn where vi bt w wn where wi at i at xi i bi xi i bi xi i yi wiv bnt where bt i xi i compute a from the equation i i a yiwt i yibi compute each bi in turn from the equation bi v i wt i a. covariance a redefine yi wiv i i yiwt i bibj yt abi ayi i ayj ijv i algorithm a sparse levenberg marquardt algorithm. since xi is independent of h. also bi xi because of the form of xt i tt. i i i xi computation of the covariance as an example of covariance computation we consider the same problem as in section in which a homography is estimated from point correspondences. as in that example we consider a case in which the estimated homography is actually the identity mapping h i. for the purposes of this example the number of points or their distribution is not important. it will be assumed however that the errors of all application of sparse lm to fundamental matrix estimation point measurements are independent. we recall from that in the case of errors in the second image only h where ji xi we now proceed to compute the covariance of the camera parameter vector h in the case where the points in the first image are subject to noise as well. we assume further that and denote them by si. in this case the inverse covariance matrix x xi is block-diagonal then applying the steps of algorithm to compute the covariance matrix for h x diag i h. jt i ji i i i i i ai jt bi itt since h i at i diagsi siai u jt i siji u i wiv i vi bt wi at wt i i i i diagsi sibi i diagsi sibi jt si i jt i i i h jt i siji jt i i hence the covariance matrix for h is just twice the value of the covariance matrix for the case of error in one image. this is not generally true and results from the fact that h is the identity mapping. as exercises one may verify the following. if h represents a scaling by a factor s then h if h is an affine transformation and d is the upper part of h nontranslational part and if si i for all i and independent noise then h i di dtd siji jt i i ji jt i i application of sparse lm to fundamental matrix estimation in estimating the fundamental matrix and a set of points the algorithm is effectively that described in section a sparse lm algorithm for the estimation of homographies but slightly modified to the present case. the analogy with the homography estimation problem is as follows in estimating homographies one has a mapping h that takes points xi to corresponding points i in the present problem one has a mapping represented by a pair of camera matrices p and that map a point to a pair of corresponding points i. for convenience the notation of section will be used here. in particular note that in section and here the notation x is used to denote the total measurement vector this case n and not a point. also be careful to distinguish between p the parameter vector and p the camera matrix. n the parameter vector p is partitioned as p bt a is made up of the entries of camera matrix t and nt where appendix iterative estimation methods bi yi tit is a parametrizing the i-th point yi ti. thus there are a total of parameters where n is the number of points. parameter vector a provides a parametrization for the camera and the other camera p is taken as note also that it is convenient and permissible to set the third coordinate of the space point to as here since a point yi tit maps to yi which is an infinite point not anywhere close to the measured point yi tt the measured images of the i-th point. the measurement vector x is partitioned as x now the jacobian matrices ai a and bi bi may be computed and xi algorithm applied to estimate the parameters and hence computed. from which f may be nt where each xt i xt i partial derivative matrices since xt i i jacobian matrices in section i a ai bi i bi tt one may compute that ai and bi have a form similar to the the covariance matrix xi breaks up into diagonal blocks diagsi i where now calculating the intermediate expressions in step of xi and i si algorithm we find i vi bt i diagsi ibi i i i b the abstract form of at i expressions wi at i the estimation procedure otherwise proceeds precisely as in algorithm ai is the same as in the homography case and the other may easily be computed. and at i xi xi xi xi bi bt i covariance of f according to the discussion of section and in particular algorithm the covariance matrix of the camera parameters namely the entries of is given by wiv i wt i with notation as in algorithm i in computing this pseudo-inverse it is useful to know the expected rank of in this case this rank is since the total number of degrees of freedom in the solution involving two cameras and n point matches is looked at another way is m then any other matrix tmt m not determined uniquely since if also determines the same fundamental matrix. thus in computing the pseudo-inverse appearing in the right hand side of one should set five of the singular values to zero. of is a simple formula for the entries of f in terms of the entries of the foregoing discussion shows how to compute the covariance matrix of the entries we desire to compute the covariance matrix of the entries of f. however there m namely application of sparse lm to multiple image bundle adjustment f m. if one desires to compute the covariance matrix of f normalized so that then one writes f therefore one may express the entries of f as a simple function in terms of the entries of let j be the jacobian matrix of this function. the covariance of f is then computed by propagating the covariance of using result to get f j ju wiv i wt i where is given by this is the covariance of the fundamental matrix estimated according to an ml algorithm from the given point correspondences. i application of sparse lm to multiple image bundle adjustment in the previous section the application of the sparse levenberg marquardt algorithm to the computation of the fundamental matrix was considered. this is essentially a reconstruction problem from two views. it should be clear how this may easily be extended to the computation of the trifocal tensor and the quadrifocal tensor. more generally one may apply it to the simultaneous estimation of multiple camera and points to compute projective structure or perhaps affine or metric structure given appropriate constraints. this technique is called bundle adjustment. in the case of multiple cameras one may also take advantage of the lack of interaction between parameters of the different cameras as will be shown now. in the following discussion for simplicity of notation it will be assumed that each point is visible in all the views. this is not at all necessary points may in general be visible in some arbitrary subset of the available views. xt t we use the same notation as in section the measurement data may be expressed as a vector x which may be divided up into parts xi representing the measured image coordinates of some point in all views. one may further subdivide xi writing xi imt where xij is the image of the i-th point in the j-th image. the parameter vector a parameters may correspondingly be partitioned as a mt where aj are the parameters of the j-th camera. since the image point xij does not depend on the parameters of any but the j-th camera one observes that xij ak unless j k. in a similar way for derivatives with respect to the parameters bk of the k-th point one has xij bk unless i k. at t the form of the jacobian matrix j for this problem and the resulting normal equations jtj jt are shown schematically in figure and figure referring to the jacobian matrices defined in algorithm one sees that ai a is a trix bi bi decomposes as bi block diagonal matrix ai im where aij xij aj. similarly maimt where bij xij bi. it may normally be assumed also that xi has a diagonal structure xi diag xim meaning that the measurements of the projected points in separate images are independent more precisely uncorrelated. with these assumptions one is easily able to adapt algorithm as shown in algorithm as the reader is left to verify. t appendix iterative estimation methods jx jx jx camera parameters feature parameters fig. form of the jacobian matrix for a bundle-adjustment problem consisting of cameras and points. w wt fig. form of the normal equations for the bundle-adjustment problem consisting of cameras and points. missing data. typically in a bundle-adjustment problem some points are not visible in every image. thus some measurement xij may not exist meaning that i-th point is not visible in the j-th image. algorithm is easily adapted to this situation by ignoring terms subscripted by ij where the measurement xij does not exist. such missing terms are simply omitted from the relevant summations. this includes all of aij bij xij wij and yij. it may be seen that this is equivalent to setting aij and bij to zero thus effectively giving zero weight to the missing measurements. this is convenient when programming this algorithm since the above quantities subscripted by ij may be associated only with existing measurements in a common data structure. sparse methods for equation solving compute the derivative matrices aij xij aj and bij xij bi and the error compute the intermediate values vectors xij xij. uj i ij at xij aij vi bij wij at ij xij bij ij at xij ij bt xij yij wijv i i j ij bt xij j i yijwt yijwt i compute a t where in each case i n and j m. amt from the equation et s a t mt where s is an m m block matrix with blocks sjk defined by sjj sjk j ij u ik if j k and i ej yijbi compute each bi in turn from the equation bi v i wt ij aj j covariance redefine yij wijv a s where s is defined as above without the augmentation represented by the bibj yt abi ayi. i ayj ijv i i algorithm general sparse levenberg marquardt algorithm. sparse methods for equation solving in a long sequence of images it is rare for a point to be tracked through the whole sequence and usually point tracks disappear and new ones start causing the set of point tracks to have a banded structure as seen in figure this banded structure of the point track set leads to a banded structure for the set of equations that are solved to compute structure and motion we refer here to the matrix s in algorithm thus for bundle-adjustment problems with banded track structure sparseness can appear at two levels first at the level of independence of the individual point measurements as exploited in algorithm and secondly arising from the banded track structure as will be explained in this section. another similar context in which this will occur is solution for structure and motion appendix iterative estimation methods in section or simply motion as in section in both these methods large sparse sets of equations may arise. in order for large problems of this kind to be tractable it is necessary to take advantage of this sparse structure in order to minimize the amount of storage and computation involved. in this section we will consider sparse matrix techniques that are valuable in this context. trix with off-diagonal blocks of the form sjk banded structure in bundle-adjustment the time-consuming step in finding the parameter increments in the iterative step of bundle-adjustment as given in algorithm is the solution of the equations s a e in step of the algorithm. as shown there the matrix s is a symmetric mawt ik. we see that the block sjk is non-zero only when for some i both wij and wik are non-zero. since wij xij ajt xij xij bi it follows that wij is non-zero only when the corresponding measurement xij depends on parameters aj and bi. to be more concrete if aj represents the parameters of the j-th camera and bi represents the parameters of the i-th point then wij is non-zero only when the i-th point is visible in the j-th image and xij is its measured image position. i wijv i the condition that for some i both wij and wik are non-zero means that there exists some point with index i that is visible in both the j-th and k-th images. to summarize the block sjk is non-zero only if there exists a point that is visible in both the j-th and k-th images. thus if point tracks extend only over consecutive views then the matrix s will be banded. in particular if no point track extends over more than b views representing bandwidth then the block sjk is zero unless k b. consider tracking points over a long sequence for instance along a path that may loop back and cross itself. in this case it may be possible to recognize a point that had been seen previously in the sequence and pick up its track again. the set of views in which a point is seen will not be a consecutive set of views. this will destroy the banded nature of the matrix s by introducing non-zero blocks possibly far away from the central band. nevertheless if there is not too much filling-in of off-diagonal blocks sparse solution techniques may still be utilized as we shall see later. solution of symmetric linear equations in solving a set of linear equations ax b in which the matrix a is symmetric it is best not to use a general purpose equation solver such as gaussian-elimination but rather to take advantage of the symmetry of the matrix a. one way of doing this is the use the ldlt decomposition of the matrix a. this relies on the following observation result any positive-definite symmetric matrix a can be factored as a ldlt in which l is a lower-triangular matrix with unit diagonal entries and d is diagonal. the reader is advised to consult for details of efficient implementation and numeric properties of ldlt decomposition. the normal equations derived from structure and motion problems are always at least positive semi-definite and with stabiliza sparse methods for equation solving a b fig. a sparse matrix and its corresponding skyline structure. non-zero entries in the original matrix are shown in black. in the skyline format all non-zero entries lie in the shaded area. for each row i there is an integer mi representing the first non-zero entry in that row. note that non-zero off-diagonal elements cause fill-in of the skyline format for that row symmetric above-diagonal column. if such entries are relatively rare the skyline format will remain sparse and techniques for skyline matrices may be usefully applied. the ldlt decomposition of a matrix in skyline format has the same skyline structure. thus the ldlt decomposition of the original sparse matrix shown in will have non-zero entries only within the shaded area of tion through enhancement they are positive-definite and symmetric factorization is the recommended method of solution. solved for x in three steps as given the ldlt factorization the set of linear equations ax ldltx b may be solving the equations b is carried out by the process of forward-substitution. in particular in mind that l has unit diagonal entries the components of x may be computed in order as b d ltx forward-substitution i bi i j. since lt is upper-triangular the second set of equations is solved in a similar fashion except that the values xi are computed in inverse order in a process known as backsubstitution. back-substitution xi i ljixj. the number of operations involved in this computation is given in and is equal to where n is the dimension of the matrix. solution of sparse symmetric linear systems we consider a special type of sparse structure for a symmetric matrix known as skyline format. this is illustrated in figure an n n symmetric matrix a in skyline format is characterized by the existence of an array of integers mi for i n such that aij for j mi. a diagonally banded matrix is a special case of a matrix with skyline structure. appendix iterative estimation methods although a diagonally banded or skyline matrix may be sparse its inverse is not and in fact will be completely filled out with non-zero elements. thus it is a very bad idea actually to compute the inverse of a to find the solution x a to the set of equations. however the importance of matrices in skyline banded form is that skyline structure of the matrix is preserved by the ldlt decomposition as expressed in the following result. result let a be a symmetric matrix such that aij for j mi. let a ldlt. then lij for j mi. in other words the skyline structure of l is the same as that of a. proof. suppose that j is the smallest index such that lij then in multiplying out a ldlt it may be verified that only one product contributes to the j-th element of aij. specifically aij lijdjjljj thus in computing the ldlt decomposition of a having a sparse skyline structure we know in advance that many of the entries of l will be zero. the algorithm for computing the ldlt decomposition for such a matrix is much the same as the that for a full symmetric matrix except that we do not need to consider the zero elements. forward and back substitution involving a matrix l with skyline structure easily take advantage of the sparse structure. in fact the forward substitution formula becomes i bi i j. back-substitution is left for the reader to work out. more details of implementation are given in jmi robust cost functions in estimation problems of the newton or levenberg-marquardt type an important decision to make is the precise form of the cost function. as we have seen an assumption of gaussian noise without outliers implies that the the maximum likelihood estimate is given by a least-squares cost function involving the predicted errors in the measurements where the noise is introduced. negative logarithm gives logp n the same analysis may be carried out for other assumed probability models for the measurements. thus if all measurements are assumed to be independent and f is the probability distribution of an error in the measurement then the probability of a n set of measurement with errors i is given by p n f i. taking the n logf i and the right-hand side of this expression is a suitable cost function for a set of measurements. it is usually appropriate to set the cost of an exact measurement to be zero by subtracting logf though this is not strictly necessary if our purpose is cost minimization. graphs of various specific cost functions to be discussed next are shown in figure robust cost functions cost function pdf attenuation factor squarederror blakezisserman corrupted gaussian cauchy huber pseudohuber fig. a comparison of different cost functions c for robust estimation. their corresponding pdfs exp c and attenuation factors c see text are also shown. appendix iterative estimation methods statistically based cost functions. determination of a suitable cost function may be approached by estimating or guessing the distribution of errors for the particular measurement process involved such as point extraction in an image. in the following list for simplicity we ignore the normalization constant for gaussian distributions and assume that squared error. assuming the data is gaussian distributed the probability distribution function is p exp which leads to a cost function c blake-zisserman. the data is assumed to have a gaussian distribution for inliers with a uniform distribution of outliers. the pdf is taken to be of the form p exp this is not actually a pdf since it integrates to infinity. nevertheless it leads to a cost function of the form c logexp for inliers this approximates whereas for outliers the asymptotic cost is log thus the crossover point from inliers to outliers is given approximately by log the actual cost function used by blake and zisserman in was min and exp corrupted gaussian. the previous example has the theoretical disadvantage that it is not actually a pdf. an alternative is to model the outliers by a gaussian with larger standard deviation leading to a mixture model probability distribution of the form p exp exp where w is the ratio of standard deviations of the outliers to the inliers and is the expected fraction of inliers. then c log exp exp heuristic cost functions. next we consider cost functions justified more by heuristics and required noise-immuneness properties than by adherence to a specific noisedistribution model. for this reason they will be introduced directly as a cost function rather than a pdf. cauchy cost function. the cost function is given by c for some constant b. for small values of this curve approximates and the value of b determines for what range of this approximation is close. the cost function is derived from the cauchy distribution p which is a bell-curve similar to the gaussian but with heavier tails. the cost function. instead of using the sum of squares we use the sum of absolute errors. thus c robust cost functions where is some positive constant normally could just be this cost function is known as the total variation. huber cost function. this cost function is a hybrid between the and least-squares cost function. thus we define c for b otherwise this cost function is continuous with continuous first derivative. the value of the threshold b is chosen approximately to equal the outlier threshold. pseudo-huber cost function. the cost function c is very similar to the huber cost function but has continuous derivatives of all orders. note that it approximates for small and is linear with slope for large properties of the different cost functions squared error. the most basic cost function is the squared error c its main drawback is that it is not robust to outliers in the measurements as we shall see. because of the rapid growth of the quadratic curve distant outliers exert an excessive influence and can draw the cost minimum well away from the desired value. non-convex cost functions. the blake-zisserman corrupted gaussian and cauchy cost functions seek to mitigate the deleterious effect of outliers by giving them diminished weight. as is seen in the plot of the first two of these once the error exceeds a certain threshold it is classified as an outlier and the cost remains substantially constant. the cauchy cost function also seeks to deemphasize the cost of outliers but this is done more gradually. these three cost functions are non-convex which has important effects as we will see. i asymptotically linear cost functions. the cost function measures the absolute value of the error. the main effect of this is to give outliers less weight compared with the squared error. the key to understanding the performance of this cost function is to observe that it acts to find the median of a set of data. consider a set of real valued data and a cost function defined by cx ai. the minimum of this function is at the median of the set to see this note that the derivative of ai with respect to x is when x ai and when x ai. thus the derivative is zero when there are as many values of ai less than x as there are greater than x. thus the cost is minimized at the median of the values ai. note that the median is immune to changes in the values of data ai that lie far from the median. the value of the cost function changes but not the position of its minimum. for higher dimensional data ai irn the minimum of the cost function cx has similar stability properties. note that is a convex function i appendix iterative estimation methods of x and therefore so is a sum of such terms function has a single minimum do all convex functions. i consequently this cost the huber cost function takes the form of a quadratic for small values of the error and becomes linear for values of beyond a given threshold. as such it retains the outlier stability of the cost function while for inliers it reflects the property that the squared-error cost function gives the maximum likelihood estimate. the pseudo-huber cost function is also near-quadratic for small and linear for large thus it may be used as a smooth approximation to the huber cost function and gives similar results. it is important to note that each of these three cost functions has the very desirable property of being convex. performance of the different cost functions to illustrate the properties of the different cost functions we will evaluate the cost i cx ai for two synthetic example data sets of the group of asymptotically linear cost functions only the huber cost function will be shown since the other two and pseudo-huber give very similar results. the data may be thought of as the outcome of an experiment to measure some quantity with repeated measurements. the measurements are subject to random gaussian noise with outliers. the purpose of the estimation process is to estimate the value of the quantity by minimizing a cost function. the experiments and the results for the two data sets are described in the captions of figure and figure summary of findings. the squared-error cost function is generally very susceptible to outliers and may be regarded as unusable as long as outliers are present. if outliers have been thoroughly eradicated using for instance ransac then it may be used. the non-convex cost functions though generally having a stable minimum not much effected by outliers have the significant disadvantage of having local minima which can make convergence to a global minimum chancy. the estimate is not strongly attracted to the minimum from outside of its immediate neighbourhood. thus they are not useful unless until the estimate is close to the final correct value. the huber cost function has the pleasant property of being convex which makes convergence to a global minimum more reliable. the minimum is quite immune to the baleful influence of outliers since it represents a compromise between the maximum likelihood estimate of the inliers and the median of the outliers. the pseudo-huber cost function is a good alternative to huber but use of should be approached with care because of its non-differentiablity at the origin. these findings were illustrated on one-dimensional data but they carry over to higher dimensional data also. parameter minimization. we have seen that the huber and related cost functions are convex and hence have a single minimum. we refer here to the cost c as a function of the error in general in problems such as structure from motion the error itself is a non-linear function of the parameters as camera and point positions. for this reason the total cost expressed as a function of the motion and structure parameters robust cost functions fig. the data in the top left graph consists of a set of measurements centred around with unit gaussian noise plus of outliers biased towards the right of the true value. the i cx ai correspond and top-to-bottom to the cost functions squared graphs of error cauchy corrupted-gaussian blake-zisserman a zoom of the blake-zisserman and huber cost functions. note that the minimum of the squared-error cost function is pulled significantly to the right by the outliers whereas the other cost-functions are relatively outlier-independent. the blake-zisserman cost function which is based most nearly on the distribution of the data has a very clear minimum. however close examination zoomed plot shows an undesirable characteristic which is the presence of local minima near each of the outliers. an iterative method to find the cost minimum will fail if it is initiated outside the narrow basin of attraction surrounding the minimum. by contrast the huber cost function is convex which means the estimate will be drawn towards the single minimum from any initialization point. can not be expected to be convex and local minima are inevitable. nevertheless an important principle is choose a parameterization in which the error is as close as possible to being a linear function of the parameters at least locally. observing this principle will lead to simpler cost surfaces with fewer local minima and generally quicker convergence. cost functions and least-squares. usually cost functions of the type we have discussed are used in the context of a parameter minimization procedure such as levenberg-marquardt or newton iteration. commonly these procedures seek to minimize the norm of some vector depending on a set of parameters p. thus they minimize over all choices of the parameter vector p. for instance in a ture and motion problem we may seek to minimize where the values xi are measured image coordinates the xi are the predicted values de i i appendix iterative estimation methods fig. in this experiment as in figure the main part of the data is centred at the origin with of outliers concentrated in a block away from the origin top left graph. this type of measurement distribution is quite realistic in many imaging scenarios for instance where point or edge measurement is confused by ghost edges. the cost functions in order from the top are square error cauchy corrupted gaussian blake-zisserman and huber. the squared error cost function finds the mean of the measurement distribution which is significantly pulled to the right by the block of outliers. the effect of the outlier block on the non-convex cost functions is also shown clearly here. because of the non-convexity the total cost function does not have a single minimum but rather two minima around the separate blocks of measurements. because of its convexity the huber cost function has a single minimum which is located close to the median of the data and is hardly influenced by the presence of the of outliers. rived from the current parameter values and is the vector formed by concatenating the individual error vectors i. since minimization of a squared vector norm is built into most implementations of levenberg-marquardt we need to see how to apply the robust cost function in this case. the answer is to replace each vector i by a weighted vector i wi i such that i i for then i i as desired. from this equality we find wi thus the minimization problem is to minimize where is the vector obtained by concatenating the vectors i wi i and each wi is computed from note that wi is a function of which normally seeks to attenuate the cost of the outliers. this attenuation function is shown in the final column of figure for the different cost functions. for the squared error cost function the attenuation factor is meaning no attenuation occurs. for the other cost functions there is little attenuation within an inlier region and points outside this region are attenuated to different degrees. parametrization parametrization in the sort of iterative estimate problems we are considering here an important consideration is how the solution space is to be parametrized. most of the geometric entities that we consider do not have a simple euclidean parametrization. for example in solving a geometric optimization problem we often wish to iterate over all camera orientations represented by rotations. rotations are most conveniently represented for computational purposes by rotation matrices but this is a major overparametrization. the set of rotations is naturally fact it forms a lie group and we may wish to parametrize it with only parameters. homogeneous vectors or matrices are another common type of representation. it is tempting to use a parametrization of a homogeneous n-vector just by using the components of the vector itself. however there are really only n degrees of freedom in a homogeneous n-vector and it is sometimes advantageous to parametrize it with only n parameters. gauge freedom. there has been much attention paid to gauge freedom and gauge independence in recent papers instance in this context the word gauge means a coordinate system for a parameter set and gauge-freedom essentially refers to a change in the representation of the parameter set that does not essentially change the underlying geometry and hence has no effect on the cost function. the most important gauge freedoms commonly encountered are projective or other ambiguities such as those arising in reconstruction problems. however the scale ambiguity of homogeneous vectors can be counted as gauge freedom also. gauge freedoms in the parametrization of an optimization problem cause the normal equations to be singular and hence allow multiple solutions. this problem is avoided by the regularization enhancement step in levenberg-marquardt but there is evidence that excessive gauge freedoms causing slop in the parametrization can lead to slower convergence. in addition when gauge freedoms are present the covariance matrix of the estimated parameters is troublesome in that there will be infinite variance in unconstrained parameter directions. for instance it makes no sense to talk of the covariance matrix of an estimated homogeneous vector unless the scale of the vector is constrained. therefore in the following pages we will give some methods for obtaining minimal parametrizations for certain common geometric parameter sets. what makes a good parametrization? the foremost requirement of a good parametrization is that it be singularity-free at least in the areas that are visited during the course of an iterative optimization. this means that the parametrization should be locally continuous differentiable and one-to-one in short a diffeomorphism. a simple example of what is meant by this is given by the latitude-longitude parametrization of a sphere that is spherical-polar coordinates. this has a singularity at the poles where the mapping from the lat-long coordinates to a neighbourhood of the pole is not one-to-one. the difficulty is that the point with coordinates longitude they are both points very close to the pole. however they are a long way apart in parameter space. to see is very close to the point longitude appendix iterative estimation methods the effect of this suppose that an optimization is taking place on the sphere tracking down a minimum of a cost function which exists at the point if the current estimate is proceeding in the general direction of this minimum up the line of zero longitude when it gets near the pole it will find that although close to the minimum it can not get there without a long detour in lat-long parameter space. the difficulty is that arbitrarily close points on the sphere in the neighbourhood of the singularity pole can have large differences in parameter values. the same sort of thing happens with representations of rotations using euler angles. now we move on to consider some specific parametrizations. parametrization of rotations using the angle-axis formula of we may parametrize a rotation by a t. this represents a rotation through an angle about the axis determined by the vector t. we denote the corresponding rotation matrix by rt. regarding this representation we may make certain simple observations the identity map rotation is represented by the zero vector t if some rotation r is represented by a vector t then the inverse rotation is rep resented by t. in symbols rt r t. if t is small then the rotation matrix is approximated by i for small rotations represented by and the composite rotation is represented to first-order by in other words thus the mapping t rt is to first order a group isomorphism for small t. in fact for small t the map is an isometry preserving map in terms of the distance between two rotations and defined to equal to the angle of the rotation any rotation may be represented as rt for some t such that that is any rotation is a rotation through an angle of at most radians about some axis. the mapping t rt is one-to-one for and two-to-one for if then rt is the identity map regardless of t. thus the parametrization has a singularity at in parametrizing rotations by a vector t it is best to maintain the condition that in order to keep away from the singularity when if then it may be replaced by the vector which represents the same rotation. normalization parametrization of homogeneous vectors the quaternion representation of a rotation is a redundant representation in that it contains parameters where will suffice. the angle-axis representation on the other hand is a minimum parametrization. many entities in projective geometry are represented by homogeneous quantities either vectors or matrices for instance points in projective space or the fundamental matrix to name a few. for computational purposes it is possible to represent such quantities as vectors with a min parametrization imum number of parameters in a similar way to which the angle-axis representation gives an alternative to the quaternion representation of a rotation. let v be a vector of any dimension and represent by v the unit vector this mapping v v maps the disk of radius is the set of vectors of length at most smoothly and one-to-one onto the set of unit vectors v with non-negative final coordinate. thus it provides a mapping onto the set of homogeneous vectors. the only difficult point with this mapping is that it takes any vector of length to the same vector however this singular point may be avoided by renormalizing any vector v of length replacing it with which represents the same homogeneous vector v. parametrization of the n-sphere commonly it occurs in geometric optimization problems that some vector of parameters is required to lie on a unit sphere. as an example consider a complete euclidean bundle-adjustment with two views. the two cameras may be taken as p and where r is a rotation and t is a translation. in addition points xi are defined which are to map via the two camera matrices to image points. this defines an optimization problem in which the parameters are r t and the points xi and the cost to be minimized is a geometric residual of the projections with respect to the image measurements. in this problem there is an overall scale ambiguity and this is conveniently resolved by requiring that a minimum parametrization for the rotation matrix r is given by the rotation parametrization of section similarly the points xi are conveniently parametrized as homogeneous using the parametrization of section we consider in this section how one may parametrize the unit vector t. note that we can not simply parametrize t as a homogeneous vector since change of sign of t changes the projection the same problem arises in multiple-view euclidean bundle-adjustment. in this case we have many camera matrices pi and we may fix the set of translations ti for all i are subject to scale ambiguity. we can minimally parametrize the translations by requiring that where t is the vector formed by concatenating all the ti for i there may be several ways of parametrizing a unit vector. we consider one particular parametrization here based on a local parametrization of the tangent plane to the unit sphere. we consider a sphere of dimension n which consists of the set of of unit length. let x be a such a vector. let hvx be a householder matrix section such that hvxx thus we have transformed the vector x to lie along the coordinate axis. now we consider a parametrization of the unit sphere in the vicinity of such a parametrization is a map irn sn that is well behaved in the vicinity of the origin. there are many choices of which two possibilities are f where y f appendix iterative estimation methods both these functions map the origin t to and their jacobian is f y note that although we are interested in these functions just as local parametrizations the first provides a parametrization for half the sphere whereas for the second map parametrizes the whole of the sphere with no singularity except at the composite map y hvxf provides a local parametrization for a neighbourhood of the point x on the sphere here that we should write h vx but vx. the jacobian of this map is simply which consists of hvx h the first n columns of the householder matrix and hence is easy to compute. in minimization problems we usually need to compute a jacobian matrix c y of a vector valued cost function c with respect to a set of parameters y. in the case where the parameters are constrainted to lie on a sphere s n in the cost function is nonetheless usually defined for all values of the parameter x in as an example in the euclidean bundle-adjustment problem considered at the start of this section the cost function instance residual reprojection error can be defined for all pairs of cameras p and with t taking any value. nevertheless we may wish to minimize the cost function constraining t to lie on a sphere. thus consider the case where a cost function cx is defined for x but we parametrize x to lie on a sphere by setting x hvxf with y irn. in this case we see that j c y c x x y c x in summary by using local parametrizations a parameter vector may be constrained to lie on an n-sphere with a modest added computational cost compared with the overparametrization of allowing the vector to vary over the whole of the key points of the method are as follows. store the parameter vector x satisfying in forming the linear update equations compute the jacobian matrix c x and multiply it by to obtain the jacobian with respect to a minimal parameter set y. multiplication of c x by is efficiently carried out by the method of the iteration step provides an increment parameter vector y. compute the new value of x hvxf y. essentially the same method of using local-parametrizations may be used more generally in other situations where a minimal parametrization is required. for instance in section it was seen how the fundamental matrix may be parametrized locally with a minimum number of parameters but no minimal parametrization can cover the whole set of fundamental matrices. notes and exercises we prove in various steps the form of the pseudo-inverse of a block matrix given in notes and exercises if and only if nlg nlh recall that h ggthg let g be invertible. then g thg if and only if section nlhgt nlhg applying this condition to the necessary and sufficient condition for to be valid is that nlu wv nly nlw. equivalent to the condition spana spanb with u v and w defined in terms of a and b as in this is investigate conditions under which the condition spana spanb is true. it may be interpreted as meaning that the effects of varying the parameters a instance camera parameters and the effects of varying b parameters can not be complementary. clearly this is not the case with instance unconstrained projective reconstruction where both cameras and points may vary without affecting the measurements. in such a case the variance of parameters a and b is infinite in directions a and b such that a a b b. appendix some special plane projective transformations projective transformations can be classified according to the algebraic and geometric multiplicity of their eigenvalues. the algebraic multiplicity of an eigenvalue is the number of times the root is repeated in the characteristic equation. the geometric multiplicity may be determined from the rank of the matrix i where h is the homography and the eigenvalue. a complete classification is given in projective geometry textbooks such as here we mention several special cases which are important in practical situations and occur at several points throughout this book. the description will be for plane transformations where h is a matrix but the generalization to transformations is straightforward. the special forms are significant because h satisfies a number of relationships the only restriction a general projective transformation is that it has full rank. since h satisfies constraints it has fewer degrees of freedom and consequently can be computed from fewer correspondences than a general projective transformation. the special transformations also have richer geometry and invariants than in the general case. note that unlike the special forms etc. discussed in chapter which form subgroups the following special projectivities do not form subgroups in general since they are not closed under multiplication. they do form a subgroup if all the elements have coincident fixed points and lines differing only in their eigenvalues. conjugate rotations a rotation matrix r has eigenvalues ei e i with corresponding eigenvectors i j where a is the rotation axis i.e. ra a is the angle of rotation about the axis and i and j are complex conjugate are the circular points for the plane orthogonal to a. suppose a projective transformation between two planes has the form h t r t with t a general projective transformation then h is a conjugate rotation. eigenvalues are preserved under a conjugate so the eigenvalues of the projective transformation h are also ei e i up to a common scale. conjugacy is also referred to as a similarity transformation this meaning of similarity is unrelated to its use in this book as an isometry plus scaling transformation. planar homologies e v vertex point fixed lines a axis of fixed points e e fig. a planar homology. a planar homology is a plane projective transformation which has a line a of fixed points called the axis and a distinct fixed point v not on the line called the centre or vertex of the homology. there is a pencil of fixed lines through the vertex. algebraically two of the eigenvalues of the transformation matrix are equal and the fixed line corresponds to the invariant space of the matrix the repeated eigenvalues are and consider two images obtained by a camera rotating about its centre in figure then as shown in section the images are related by a conjugate rotation. in this case the complex eigenvalues determine the angle through which the camera rotates and the eigenvector corresponding to the real eigenvalue is the vanishing point of the rotation axis. note that a metric invariant can be measured directly from the projective transformation. planar homologies a plane projective transformation h is a planar homology if it has a line of fixed points the axis together with a fixed point the vertex not on the line see figure algebraically the matrix has two equal and one distinct eigenvalues and the eigenspace corresponding to the equal eigenvalues is two-dimensional. the axis is the line through the two eigenvectors points spanning this eigenspace. the vertex corresponds to the other eigenvector. the ratio of the distinct eigenvalue to the repeated one is a characteristic invariant of the homology the eigenvalues are up to a common scale factor properties of a planar homology include lines joining corresponding points intersect at the vertex and corresponding lines lines through two pairs of corresponding points intersect on the axis. this is an example of desargues theorem. see figure the cross ratios defined by the vertex a pair of corresponding points and the intersection of the line joining these points with the line of fixed points are the same for all points related by the homology. see figure for curves related by a planar homology corresponding tangents limit of neighbouring points defining corresponding lines intersect on the axis. the vertex dof axis dof and invariant dof are sufficient to define the homology completely. a planar homology thus has degrees of freedom. appendix some special plane projective transformations vertex v x a h x v x x axis a x p x i a b i fig. homology transformation. under the transformation points on the axis are mapped to themselves each point off the axis lies on a fixed line through v intersecting a and is mapped to another point on the line. consequently corresponding point pairs x and the vertex of the homology are collinear. corresponding lines i.e. lines through pairs of corresponding points intersect on the axis for example the lines and the cross ratio defined by the vertex v the corresponding points x and the intersection of their join with the axis i is thecharacteristic invariant of the homology and is the same for all corresponding points. for example the cross ratios of the four points are equal since they are perspectively related by lines concurrent at it follows that the cross ratio is the same for all points related by the homology. matched points are sufficient to compute a planar homology. the degrees of freedom of the point matches over-constrain the degrees of freedom of the homology. and a planar homology arises naturally in an image of two planes related by a perspectivity of lines joining corresponding points on the two planes are concurrent. an example is the transformation between the image of a planar object and the image of its shadow on a plane. in this case the axis is the imaged intersection of the two planes and the vertex is the image of the light source see figure parametrization. the projective transformation representing the homology can be parametrized directly in terms of the representing the axis a and vertex v and the characteristic ratio as where i is the identity. it is straightforward to verify that the inverse transformation is given by vat vta h i h i vat vta. the eigenvectors are v a a elations with corresponding eigenvalues i are two vectors that span the space orthogonal to the a i.e. ata i where a and a a a if the axis or the vertex is at infinity then the homology is an affine transformation. algebraically if a then the axis is at infinity or if v then the vertex is at infinity and in both cases the transformation matrix h has last row planar harmonic homology. a specialization of a planar homology is the case that the cross ratio is harmonic this planar homology is called a planar harmonic homology and has degrees of freedom since the invariant is known. the transformation matrix h obeys i i.e. the transformation is a square root of the identity which is called an involution a collineation of period the eigenvalues are up to a common scale factor two pairs of point correspondences determine h. in a perspective image of a plane object with a bilateral symmetry corresponding points in the image are related by a planar harmonic homology. the axis of the homology is the image of the symmetry axis. algebraically h is a conjugate reflection where the conjugating element is a plane projective transformation. in an affine image by an affine camera the resulting transformation is a skewed symmetry and the conjugating element is a plane affine transformation. for a skewed symmetry the vertex is at infinity and the lines joining corresponding points are parallel. the harmonic homology can be parametrized as h h i vat vta. again if the axis or vertex is at infinity then the transformation is affine. elations an elation has a line of fixed points axis and a pencil of fixed lines intersecting in a point vertex on the axis. it may be thought of as the limit of a homology where the vertex is on the line of fixed points. algebraically the matrix has three equal eigenvalues but the eigenspace is it may be parametrized as h i vat with atv where a is the axis and v the vertex. the eigenvalues are all unity. the invariant space of h is spanned by a this is a line of fixed points includes v since atv the invariant space of ht is spanned by vectors v orthogonal to v. this is a pencil of fixed lines l v for which ltv i.e. all lines of the pencil are concurrent at the point v. v v a an elation has degrees of freedom one less than a homology due to the constraint atv it is defined by the axis a dof the vertex v on a dof and the parameter dof. it can be determined from point correspondences. appendix some special plane projective transformations x c b a a b c x fig. a line perspectivity. the lines joining corresponding points a etc. are concurrent. compare with figure elations often arise in practice as conjugate translations. consider a pattern on a plane that repeats by a translation t tyt for example identical windows on the wall of a building. this action is represented on the plane of the wall as he t i which is an elation where v ty is the translation direction of the repetition and a is the line at infinity. in an image of the wall the windows are related by a conjugate translation h t he t where t is the projectivity which maps the plane of the wall to the image. the image transformation h is also an elation. the vertex of this elation is the vanishing point of the translation direction and the axis is the vanishing line of the wall plane. perspectivities one other special case of a projectivity is a perspectivity which is shown in figure for a projectivity on the plane. the distinctive property of a perspectivity is that lines joining corresponding points are concurrent. the difference between a perspectivity and projectivity is made clear by considering the composition of two perspectivities. as shown in figure the composition of two perspectivities is not in general a perspectivity. however the composition is a projectivity because a perspectivity is a projectivity and projectivities form a group so that the composition of two projectivities is a projectivity. to summarize the composition of two more perspectivities is a projectivity but not in general a perspectivity. a central projection image of a world plane as in figure is an example of a perspectivity between different planes. notice that identifying the projectivity as a perspectivity requires the embedding of the planes in finally imagine that the planes and camera centre of figure are mapped another perspectivity onto one of the planes. then this imaged perspectivity is now a map between points on the same plane and is seen to be a planar homology perspectivities x c b a image p r q x a b c image a b c fig. a line projectivity. points b c are related to points b c by a line to line perspectivity. points are also related to points b c by a perspectivity. however points b c are related to points by a projectivity they are not related by a perspectivity because lines joining corresponding points are not concurrent. in fact the pairwise intersections result in three distinct points q r. further reading. classifies projectivities and covers special cases e.g. planar homologies. planar homologies appear in many guises modelling imaged shadow relations in modelling imaged extruded surfaces in and modelling relations for planar pose recovery in the parametrization of planar homologies is given in vi eville and lingrand elations appear in the grouping of imaged repeated patterns on a plane and in they appear in the generalized bas-relief ambiguity bibliography m. agrawal and l. davis. camera calibration using spheres a dual-space approach. research report center for automation research university of maryland j. y. aloimonos. perspective approximations. image and vision computing august p. anandan and m. irani. factorization with uncertainty. international journal of com puter vision m. armstrong a. zisserman and p. beardsley. euclidean reconstruction from uncali brated images. in proc. british machine vision conference pages m. armstrong. self-calibration from image sequences. phd thesis university of oxford england m. armstrong a. zisserman and r. hartley. self-calibration from image triplets. in proc. european conference on computer vision lncs pages springer-verlag k. astr om and a. heyden. continuous time matching constraints for image streams. inter national journal of computer vision s. avidan and a. shashua. threading fundamental matrices. in proc. european con ference on computer vision freiburg germany pages c. baillard and a. zisserman. automatic reconstruction of piecewise planar models from multiple views. in proc. ieee conference on computer vision and pattern recognition pages june e. b. barrett m. h. brill n. n. haag and p. m. payton. invariant linear methods in photogrammetry and model-matching. in j. l. mundy and a. zisserman editors geometric invariance in computer vision. mit press cambridge b. bascle and a. blake. separability of pose and expression in facial tracing and animation. in proc. international conference on computer vision pages r. basri and d. jacobs. projective alignment with regions. in proc. international confer ence on computer vision kerkyra greece pages k-j. bathe and e. wilson. numerical methods in finite element analysis. prentice hall insight p. a. beardsley d. sinclair and a. zisserman. ego-motion from six points. meeting catholic university leuven february p. a. beardsley a. zisserman and d. w. murray. navigation using affine structure and motion. in proc. european conference on computer vision lncs pages springerverlag p. a. beardsley and a. zisserman. affine calibration of mobile vehicles. in europe china workshop on geometrical modelling and invariants for computer vision pages xidan university press xi an china p. a. beardsley i. d. reid a. zisserman and d. w. murray. active visual navigation in proc. international conference on computer vision pages using non-metric structure. bibliography p. a. beardsley p. h. s. torr and a. zisserman. model aquisition from extended image sequences. in proc. european conference on computer vision lncs cambridge pages a. blake and a. zisserman. visual reconstruction. mit press cambridge usa august w. boehm and h. prautzsch. geometric concepts for geometric design. a. k. peters f. bookstein. fitting conic sections to scattered data. computer graphics and image processing s. bougnoux. from projective to euclidean space under any practical situation a criticism of self-calibration. in proc. international conference on computer vision bombay india pages january i. e. boult and l. gottesfeld brown. factorisation-based segmentation of motions. in proc. ieee workshop on visual motion m. brand. morphable models from video. in proc. ieee conference on computer vision and pattern recognition pages ii d. c. brown. close-range camera calibration. photogrammetric engineering t. buchanan. the twisted cubic and camera calibration. computer vision graphics and image processing t. buchanan. critical sets for reconstruction using lines. in proc. european confer ence on computer vision lncs pages springer-verlag j. f. canny. a computational approach to edge detection. ieee transactions on pattern analysis and machine intelligence d. capel and a. zisserman. automated mosaicing with super-resolution zoom. in proc. ieee conference on computer vision and pattern recognition santa barbara pages june b. caprile and v. torre. using vanishing points for camera calibration. international jour nal of computer vision s. carlsson. multiple image invariance using the double algebra. in applications of in variance in computer vision volume sln comp. science vol pages s. carlsson. multiple image invariance using the double algebra. in j. mundy a. zisserman and d. forsyth editors applications of invariance in computer vision lncs springerverlag s. carlsson. duality of reconstruction and positioning from projective views. in ieee workshop on representation of visual scenes boston s. carlsson and d. weinshall. dual computation of projective shape and camera positions from multiple images. international journal of computer vision s. christy and r. horaud. euclidean shape and motion from multiple perspective views by affine iteration. ieee transactions on pattern analysis and machine intelligence november o. chum t. werner and t. pajdla. on joint orientation of epipoles. research report ctu cmp center for machine perception fee czech technical university prague czech republic april r. cipolla t. drummond and d. robertson. camera calibration from vanishing points in images of architectural scenes. in proc. british machine vision conference september r. t. collins and j. r. beveridge. matching perspective views of coplanar structures using projective unwarping and similarity matching. in proc. ieee conference on computer vision and pattern recognition j.p. costeira and t. kanade. a multibody factorization method for independently moving objects. international journal of computer vision a. criminisi i. reid and a. zisserman. duality rigidity and planar parallax. in proc. bibliography european conference on computer vision pages springer-verlag june a. criminisi i. reid and a. zisserman. single view metrology. in proc. interna tional conference on computer vision kerkyra greece pages september a. criminisi i. reid and a. zisserman. a plane measuring device. image and vision computing a. criminisi i. reid and a. zisserman. single view metrology. international journal of computer vision november a. criminisi. accurate visual metrology from single and multiple uncalibrated images. distinguished dissertation series. springer-verlag london ltd. july isbn g. cross and a. zisserman. quadric surface reconstruction from dual-space geometry. in proc. international conference on computer vision bombay india pages january g. cross a. w. fitzgibbon and a. zisserman. parallax geometry of smooth surfaces in multiple views. in proc. international conference on computer vision kerkyra greece pages september g. csurka c. zeller z. zhang and o. d. faugeras. characterizing the uncertainty of the fundamental matrix. computer vision and image understanding october g. csurka d. demirdjian a. ruf and r. horaud. closed-form solutions for the euclidean calibration of a stereo rig. in proc. european conference on computer vision freiburg germany pages june l. de agapito e. hayman and i. reid. self-calibration of a rotating camera with varying intrinsic parameters. in proc. british machine vision conference southampton l. de agapito r. i. hartley and e. hayman. linear self-calibration of a rotating and in proc. ieee conference on computer vision and pattern recognition pages zooming camera. d. dementhon and l. davis. model based pose in lines of code. international journal of computer vision f. devernay and o. d. faugeras. automatic calibration and removal of distortion from scenes of structured environments. in spie volume san diego ca july f. devernay and o. d. faugeras. from projective to euclidean reconstruction. in proc. ieee conference on computer vision and pattern recognition pages o. d. faugeras and s. j. maybank. motion from point matches multiplicity of solutions. international journal of computer vision o. d. faugeras q. luong and s. maybank. camera self-calibration theory and experiments. in proc. european conference on computer vision lncs pages springerverlag o. d. faugeras. what can be seen in three dimensions with an uncalibrated stereo rig? in proc. european conference on computer vision lncs pages springer-verlag o. d. faugeras. three-dimensional computer vision a geometric viewpoint. mit press o. d. faugeras and l. robert. what can two images tell us about a third one. in j. o. eckland editor proc. european conference on computer vision stockholm pages springer-verlag o. d. faugeras and b. mourrain. on the geometry and algebra of point and line corin proc. international conference on computer vision pages respondences between n images. o. d. faugeras. stratification of three-dimensional vision projective affine and metric representation. journal of the optical society of america o. d. faugeras s. laveau l. robert g. csurka and c. zeller. reconstruction of urban scenes from sequences of images. technical report inria o. d. faugeras and t. papadopoulo. grassmann-cayley algebra for modeling systems of cameras and the algebraic equations of the manifold of trifocal tensors. technical report inria sophia-antipolis france bibliography o. d. faugeras l. quan and p. sturm. self-calibration of a projective camera and its application to the self-calibration of a projective camera. in proc. european conference on computer vision pages m. a. fischler and r. c. bolles. random sample consensus a paradigm for model fitting with applications to image analysis and automated cartography. comm. assoc. comp. mach. a. w. fitzgibbon and a. zisserman. automatic camera recovery for closed or open in proc. european conference on computer vision pages springer image sequences. verlag june a. w. fitzgibbon g. cross and a. zisserman. automatic model construction for turn-table sequences. in r. koch and l. van gool editors structure from multiple images of large-scale environments lncs pages springer-verlag june a. w. fitzgibbon m. pilu and r. b. fisher. direct least-squares fitting of ellipses. ieee transactions on pattern analysis and machine intelligence may c. w. gear. multibody grouping from motion images. international journal of computer vision p. giblin and r. weiss. reconstruction of surfaces from profiles. in proc. international conference on computer vision london pages london p. e. gill and w. murray. algorithms for the solution of the nonlinear least-squares problem. siam j num anal g. h. golub and c. f. van loan. matrix computations. the johns hopkins university press baltimore md second edition g. gracie. analytical photogrammetry applied to single terrestrial photograph mensuration. in xith international conference of photogrammetry lausanne switzerland july r. gupta and r. i. hartley. linear pushbroom cameras. ieee transactions on pattern analysis and machine intelligence september r. m. haralick c. lee k. ottenberg and m. n olle. analysis and solutions of the three point perspective pose estimation problem. in proc. ieee conference on computer vision and pattern recognition pages c. j. harris and m. stephens. a combined corner and edge detector. in proc. alvey vision conference manchester pages r. i. hartley. estimation of relative camera positions for uncalibrated cameras. in proc. european conference on computer vision lncs pages springer-verlag r. i. hartley. invariants of points seen in multiple images. ge internal report ge crd schenectady ny usa may r. i. hartley r. gupta and t. chang. stereo from uncalibrated cameras. in proc. ieee conference on computer vision and pattern recognition r. i. hartley. self-calibration from multiple views with a rotating camera. in proc. euro pean conference on computer vision lncs pages springer-verlag r. i. hartley. euclidean reconstruction from uncalibrated views. in j. mundy a. zisserman and d. forsyth editors applications of invariance in computer vision lncs pages springer-verlag r. i. hartley. projective reconstruction and invariants from multiple images. ieee trans actions on pattern analysis and machine intelligence october r. i. hartley. projective reconstruction from line correspondence. in proc. ieee confer ence on computer vision and pattern recognition r. i. hartley. multilinear relationships between coordinates of corresponding image points and lines. in proceedings of the sophus lie symposium nordfjordeid norway published yet r. i. hartley. a linear method for reconstruction from lines and points. in proc. interna tional conference on computer vision pages r. i. hartley. lines and points in three views and the trifocal tensor. international journal bibliography of computer vision r. i. hartley and p. sturm. triangulation. computer vision and image understanding november r. i. hartley. in defense of the eight-point algorithm. analysis and machine intelligence october ieee transactions on pattern r. i. hartley. kruppa s equations derived from the fundamental matrix. ieee transactions on pattern analysis and machine intelligence r. i. hartley and t. saxena. the cubic rational polynomial camera model. in proc. darpa image understanding workshop pages r. i. hartley. chirality. international journal of computer vision r. i. hartley. dualizing scene reconstruction algorithms. in r. koch and l. van gool editors structure from multiple images of large-scale environments lncs pages springer-verlag june r. i. hartley. computation of the quadrifocal tensor. in proc. european conference on computer vision lncs pages springer-verlag r. i. hartley. minimizing algebraic error in geometric estimation problems. in proc. international conference on computer vision pages r. hartley l. de agapito e. hayman and i. reid. camera calibration and the search for infinity. in proc. international conference on computer vision kerkyra greece pages september r. i. hartley and n. y. dano. reconstruction from six-point sequences. in proc. ieee conference on computer vision and pattern recognition pages ii ii r. i. hartley. ambiguous configurations for projective reconstruction. in proc. european conference on computer vision part i lncs dublin ireland pages r. hartley and f. kahl. critical curves and surfaces for euclidean reconstruction. in proc. european conference on computer vision part ii lncs copenhagen denmark pages r. hartley and r. kaucic. sensitivity of calibration to principal point position. in proc. european conference on computer vision copenhagen denmark volume pages springer-verlag r. hartley and f. kahl. a critical configuration for reconstruction from rectilinear motion. in proc. ieee conference on computer vision and pattern recognition e. hayman t. th orhallsson and d.w. murray. tracking while zooming using affine international journal of computer vision january transfer and multifocal tensors. a. heyden. reconstruction from image sequences by means of relative depths. in e. grimson editor proc. international conference on computer vision boston cambridge ma june a. heyden. geometry and algebra of multiple projective transformations. phd thesis department of mathematics lund university sweden december a. heyden. projective structure and motion from image sequences using subspace meth ods. in scandinavian conference on image analysis lappenraanta pages a. heyden and k. astr om. euclidean reconstruction from image sequences with varying and unknown focal length and principal point. in proc. ieee conference on computer vision and pattern recognition a. heyden. reconstruction from multiple images by means of using relative depths. in ternational journal of computer vision a. heyden. algebraic varieties in multiple view geometry. in proc. european confer ence on computer vision freiburg germany pages d. hilbert and s. cohn-vossen. geometry and the imagination. chelsea ny r. horaud and g. csurka. self-calibration and euclidean reconstruction using motions of a bibliography stereo rig. in proc. international conference on computer vision bombay india pages january b. k. p. horn. relative orientation. international journal of computer vision b. k. p. horn. relative orientation revisited. journal of the optical society of america y. horry k. anjyo and k. arai. tour into the picture using a spidery mesh interface in proceedings of the acm siggraph conference on to make animation from a single image. computer graphics pages t. s. huang and o. d. faugeras. some properties of the e-matrix in two-view motion estimation. ieee transactions on pattern analysis and machine intelligence p. j. huber. robust statistics. john wiley and sons d.q. huynh r. hartley and a heyden. outlier correction of image sequences for the affine camera. in proc. international conference on computer vision vancouver france m. irani p. anandan and d. weinshall. from reference frames to reference planes multiview parallax geometry and applications. in proc. european conference on computer vision m. irani. multi-frame optical flow estimation using subspace contraints. in proc. international conference on computer vision michal irani and p. anandan. factorization with uncertainty. in proc. european confer ence on computer vision part i lncs dublin ireland pages g. jiang h. tsui l. quan and a. zisserman. single axis geometry by fitting conics. in proc. european conference on computer vision copenhagen denmark volume pages springer-verlag f. kahl and a. heyden. structure and motion from points lines and conics with affine cameras. in proc. european conference on computer vision freiburg germany pages f. kahl and a. heyden. using conic correspondences in two images to estimate epipolar geometry. in proc. international conference on computer vision bombay india pages f. kahl. critical motions and ambiguous euclidean reconstructions in auto-calibration. proc. international conference on computer vision kerkyra greece pages f. kahl r. hartley and k. astr om. critical configurations for n-view projective reconstruction. in proc. ieee conference on computer vision and pattern recognition pages ii ii in f. kahl. geometry and critical configurations of multiple views. phd thesis lund institute of technology k. kanatani. geometric computation for machine vision. oxford university press ox ford k. kanatani. statistical bias of conic fitting and renormalization. ieee transactions on pattern analysis and machine intelligence k. kanatani. statistical optimization for geometric computation theory and practice. elsevier science amsterdam r. kaucic r. i. hartley and n. y. dano. plane-based projective reconstruction. in proc. international conference on computer vision vancouver canada pages i f. klein. elementary mathematics from an advanced standpoint. macmillan new york j. knight a. zisserman and i. reid. linear auto-calibration for ground plane motion. in proc. ieee conference on computer vision and pattern recognition june j. j. koenderink. what does the occluding contour tell us about solid shape? perception j. koenderink. solid shape. mit press j. j. koenderink and a. j. van doorn. affine structure from motion. journal of the optical society of america bibliography j. krames. uber die bei der hauptaufgabe der luftphotogrammetrie auftretenden gef ahrlichen fl achen. bildmessung und luftbildwesen zur allg. vermessungs-nachr. heft d. j. kriegman and p. belhumeur. what shadows reveal about object structure. in proc. european conference on computer vision pages s. laveau. g eom etrie d un systeme de n cam eras. th eorie estimation et applications. phd thesis inria s. laveau and o. d. faugeras. oriented projective geometry in computer vision. in proc. european conference on computer vision lncs cambridge pages springer verlag buxton b. and cipolla r. d. liebowitz and a. zisserman. metric rectification for perspective images of planes. in proc. ieee conference on computer vision and pattern recognition pages june d. liebowitz a. criminisi and a. zisserman. creating architectural models from im ages. in proc. eurographics volume pages september d. liebowitz and a. zisserman. combining scene and auto-calibration constraints. in proc. international conference on computer vision kerkyra greece september d. liebowitz. camera calibration and reconstruction of geometry from images. phd thesis university of oxford dept. engineering science june d.phil. thesis. h. c. longuet-higgins. a computer algorithm for reconstructing a scene from two projections. nature september q. luong. matrice fondamentale et autocalibration en vision par ordinateur. phd thesis universit e de paris-sud france q. t. luong and t. vi eville. canonic representations for the geometries of multiple projective views. in proc. european conference on computer vision stockholm pages may q. t. luong and t. vi eville. canonical representations for the geometries of multiple pro jective views. computer vision and image understanding september h. lutkepohl. handbook of matrices. wiley isbn y. ma s. soatto j. kosecka and s. sastry. euclidean reconstruction and reprojection up to subgroups. in proc. international conference on computer vision kerkyra greece pages s. wolfram. mathematica a system for doing mathematics by computer second edition. addison-wesley s. j. maybank. the projective geometry of ambiguous surfaces. philosophical transac tions of the royal society of london series a a s. j. maybank. theory of reconstruction from image motion. springer-verlag berlin s. j. maybank and a. shashua. ambiguity in reconstruction from images of six points. in proc. international conference on computer vision bombay india pages p. f. mclauchlan. gauge independence in optimization algorithms for vision. in w. triggs a. zisserman and r. szeliski editors vision algorithms theory and practice volume of lncs pages springer r. mohr. projective geometry and computer vision. in c. h. chen l. f. pau and p. s. p. wang editors handbook of pattern recognition and computer vision. world scientific r. mohr f. veillon and l. quan. relative reconstruction using multiple uncalibrated images. in proc. ieee conference on computer vision and pattern recognition pages t. moons l. van gool m. van diest and e. pauwels. affine reconstruction from perspective image pairs. in j. mundy a. zisserman and d. forsyth editors applications of invariance in computer vision lncs springer-verlag m. m uhlich and r. mester. the role of total least squares in motion analysis. in proc. european conference on computer vision freiburg germany pages springer-verlag bibliography j. mundy and a. zisserman. geometric invariance in computer vision. mit press g. newsam d. q. huynh m. brooks and h. p. pan. recovering unknown focal lengths in self-calibration an essentially linear algorithm and degenerate configurations. in int. arch. photogrammetry remote sensing volume pages vienna w. niem and r. buschmann. automatic modelling of natural objects from multiple views. in european workshop on combined real and synthetic image processing for broadcast and video production hamburg germany d. nister. reconstruction from uncalibrated sequences with a hierarchy of trifocal tensors. in proc. european conference on computer vision m. oskarsson a. zisserman and k. astr om. minimal projective reconstruction for combinations of points and lines in three views. in proc. british machine vision conference pages c. poelman and t. kanade. a paraperspective factorization method for shape and motion recovery. in proc. european conference on computer vision stockholm volume pages m. pollefeys l. van gool and a. oosterlinck. the modulus constraint a new constraint for self-calibration. in proc. international conference on pattern recognition pages m. pollefeys r. koch and l. van gool. self calibration and metric reconstruction in spite of varying and unknown internal camera parameters. in proc. international conference on computer vision bombay india pages m. pollefeys r. koch and l. van gool. a simple and efficient rectification method for general motion. in proc. international conference on computer vision pages m. pollefeys. self-calibration and metric reconstruction from uncalibrated image sequences. phd thesis esat-psi k.u.leuven m. pollefeys f. verbiest and l. j. van gool. surviving dominant planes in uncalibrated structure and motion recovery. in eccv pages j. ponce d. h. marimont and t. a. cass. analytical methods for uncalibrated stereo and motion measurement. in proc. european conference on computer vision stockholm volume pages j. porrill and s. b. pollard. curve matching and stereo calibration. image and vision com puting v. pratt. direct least-squares fitting of algebraic surfaces. computer graphics w. press b. flannery s. teukolsky and w. vetterling. numerical recipes in c. cambridge university press p. pritchett and a. zisserman. wide baseline stereo matching. in proc. international conference on computer vision bombay india pages january m. proesmans t. tuytelaars and l. j. van gool. monocular image measurements. technical report k.u.leuven l. quan. invariants of points from uncalibrated images. in j. o. eckland editor proc. european conference on computer vision stockholm pages springer-verlag l. quan and t. kanade. affine structure from line correspondences with uncalibrated affine cameras. ieee transactions on pattern analysis and machine intelligence august ieee conference on computer vision and pattern recognition pages l. quan. uncalibrated projective camera and affine reconstruction of lines. in proc. l. quan and z. lan. linear n pose determination. conference on computer vision bombay india pages in proc. international i. d. reid and d. w. murray. active tracking of foveated feature clusters using affine structure. international journal of computer vision k. rinner and r. burkhardt. photogrammetrie. in handbuch der vermessungskunde volume bibliography band iii jordan eggert kneissel stuttgart j.b. metzlersche verlagsbuchhandlung l. robert and o. d. faugeras. relative positioning and convex hull computation in proc. international conference on computer vision from a weakly calibrated stereo pair. berlin pages c. rother and s. carlsson. linear multi view reconstruction and camera recovery. in proc. international conference on computer vision vancouver canada pages i c. rother. multi-view reconstruction and camera recovery using a real or virtual reference plane. phd thesis computational vision and active perception laboratory kungl tekniska h ogskolan p. j. rousseeuw. robust regression and outlier detection. wiley new york p. d. sampson. fitting conic sections to very scattered data an iterative refinement of the bookstein algorithm. computer vision graphics and image processing h. s. sawhney s. hsu and r. kumar. robust video mosaicing through topology inference and local to global alignment. in proc. european conference on computer vision pages springer-verlag f. schaffalitzky and a. zisserman. geometric grouping of repeated elements within in d.a. forsyth j.l. mundy v. di gesu and r. cipolla editors shape contour and images. grouping in computer vision lncs pages springer-verlag f. schaffalitzky. direct solution of modulus constraints. in proceedings of the indian conference on computer vision graphics and image processing bangalore pages f. schaffalitzky and a. zisserman. planar grouping for automatic detection of van ishing lines and points. image and vision computing f. schaffalitzky a. zisserman r. i. hartley and p. h. s. torr. a six point solution for structure and motion. in proc. european conference on computer vision pages springerverlag june c. schmid and a. zisserman. automatic line matching across views. in proc. ieee con ference on computer vision and pattern recognition pages c. schmid and a. zisserman. the geometry and matching of curves in multiple views. in proc. european conference on computer vision pages springer-verlag june s. se. zebra-crossing detection for the partially sighted. in proc. ieee conference on computer vision and pattern recognition pages j. g. semple and g. t. kneebone. algebraic projective geometry. oxford university press l. s. shapiro a. zisserman and m. brady. motion recovery via affine epipolar geom etry. international journal of computer vision a. shashua. trilinearity in visual recognition by alignment. in proc. european con ference on computer vision stockholm volume pages may a. shashua. algebraic functions for recognition. ieee transactions on pattern analysis and machine intelligence august a. shashua and m. werman. on the trilinear tensor of three perspective views and its underlying geometry. in proc. international conference on computer vision boston a. shashua and s. j. maybank. degenerate n-point configurations of three views do critical surfaces exist? technical report tr hebrew university computer science november a. shashua and s. toelg. the quadric reference surface theory and applications. inter national journal of computer vision i. shimshoni r. basri and e. rivlin. a geometric interpretation of weak-perspective motion. technical report technion d. a. sinclair. experiments in motion and correspondence. phd thesis university of oxford c. slama. manual of photogrammetry. american society of photogrammetry falls church va usa edition bibliography m. e. spetsakis and j. aloimonos. a multi-frame approach to visual motion perception. international journal of computer vision c. e. springer. geometry and analysis of projective spaces. freeman g. stein and a. shashua. on degeneracy of linear reconstruction from three views linear ieee transactions on pattern analysis and machine intelligence line complex and applications. j. stolfi. oriented projective geometry. academic press c.strecha and l. van gool. pde-based multi-view depth estimation. int. symp. of data processing visualization and transmission pages p. sturm and w. triggs. a factorization based algorithm for multi-image projective structure and motion. in proc. european conference on computer vision cambridge pages p. sturm. critical motion sequences for monocular self-calibration and uncalibrated euin proc. ieee conference on computer vision and pattern recognition clidean reconstruction. puerto rico pages june p. sturm. vision non calibr ee contributions la reconstruction projective et etude des mouvements critiques pour l auto calibrage. phd thesis inria rh one-alpes p. sturm and s. j. maybank. a method for interactive reconstruction of piecewise planar objects from single images. in proc. british machine vision conference nottingham p. sturm. critical motion sequences for the self-calibration of cameras and stereo systems in proc. british machine vision conference nottingham pages with variable focal length. p. sturm and s. maybank. on plane based camera calibration a general algorithm singularities applications. in proc. ieee conference on computer vision and pattern recognition pages june p. sturm. on focal length calibration from two views. in proc. ieee conference on computer vision and pattern recognition pages i. e. sutherland. sketchpad a man-machine graphical communications system. technical report mit lincoln laboratories also published by garland publishing new york r. szeliski and s. b. kang. shape ambiguities in structure from motion. in b. buxton and cipolla r. editors proc. european conference on computer vision lncs cambridge pages springer verlag r. szeliski and s. heung-yeung. creating full view panoramic image mosaics and envi ronment maps. in proceedings of the acm siggraph conference on computer graphics g. taubin. estimation of planar curves surfaces and nonplanar space curves defined by implicit equations with applications to edge and range image segmentation. pami t. thorhallsson and d.w. murray. the tensors of three affine views. in proc. ieee conference on computer vision and pattern recognition c. tomasi and t. kanade. shape and motion from image streams under orthography a factorization approach. international journal of computer vision november b. tordoff and d.w. murray. reactive zoom control while tracking using an affine camera. in proc. british machine vision conference volume pages p. h. s. torr and d. w. murray. outlier detection and motion segmentation. in proc spie sensor fusion vi pages boston september p. h. s. torr a. zisserman and d. w. murray. motion clustering using the trilinear constraint over three views. in r. mohr and c. wu editors europe china workshop on geometrical modelling and invariants for computer vision pages xidan university press p. h. s. torr. motion segmentation and outlier detection. phd thesis dept. of engineering science university of oxford p. h. s. torr and a. zisserman. robust parameterization and computation of the trifocal tensor. bibliography image and vision computing p. h. s. torr and a. zisserman. robust computation and parameterization of multiple view relations. in proc. international conference on computer vision bombay india pages january p. h. s. torr a. w. fitzgibbon and a. zisserman. the problem of degeneracy in structure and motion recovery from uncalibrated image sequences. international journal of computer vision august l. torresani d. yang g. alexander and c. bregler. tracking and modelling non-rigid objects with rank constraints. in proc. ieee conference on computer vision and pattern recognition pages i w. triggs. the geometry of projective reconstruction i matching constraints and the joint image. in proc. international conference on computer vision pages w. triggs. factorization methods for projective structure and motion. in proc. ieee con ference on computer vision and pattern recognition pages w. triggs. auto-calibration and the absolute quadric. in proc. ieee conference on com puter vision and pattern recognition pages w. triggs. autocalibration from planar scenes. in proc. european conference on com puter vision freiburg germany w. triggs. camera pose and calibration from or known points. in proc. international conference on computer vision pages w. triggs. differential matching constraints. in proc. international conference on com puter vision pages w. triggs p. f. mclauchlan r. i. hartley and a. fitzgibbon. bundle adjustment for structure from motion. in vision algorithms theory and practice. springer-verlag w triggs. plane parallax tensors and factorization. in proc. european conference on computer vision pages r. y. tsai and t. s. huang. the perspective view of three points. ieee transactions on pattern analysis and machine intelligence l. van gool m. proesmans and a. zisserman. planar homologies as a basis for grouping and recognition. image and vision computing january t. vi eville and q. luong. motion of points and lines in the uncalibrated case. technical report i.n.r.i.a. t. vi eville and d. lingrand. using singular displacements for uncalibrated monocular vision systems. technical report i.n.r.i.a. h. von sanden. die bestimmung der kernpunkte in der photogrammetrie. phd thesis univ. g ottingen december d. weinshall m. werman and a. shashua. shape descriptors bilinear trilinear and quadrilinear relations for multi-point geometry and linear projective reconstruction algorithms. in ieee workshop on representation of visual scenes boston pages j. weng n. ahuja and t. s. huang. closed-form solution and maximum likelihood a robust approach to motion and structure estimation. in proc. ieee conference on computer vision and pattern recognition j. weng t. s. huang and n. ahuja. motion and structure from two perspective views algorithms error analysis and error estimation. ieee transactions on pattern analysis and machine intelligence t. werner and t. pajdla. oriented matching constraints. in t cootes and c taylor editors proc. british machine vision conference pages london uk september british machine vision association. t. werner. a constraint on five points in two images. in proc. ieee conference on computer vision and pattern recognition june w. j. wolfe d. mathis c. weber sklair and m. magee. the perspective view of three points. ieee transactions on pattern analysis and machine intelligence january bibliography g. xu and z. zhang. epipolar geometry in stereo motion and object recognition. kluwer academic publishers c. zeller. projective affine and euclidean calibration in computer vision and the application of three dimensional perception. phd thesis robotvis group inria sophia-antipolis z. zhang r. deriche o. d. faugeras and q. luong. a robust technique for matching two uncalibrated images through the recovery of the unknown epipolar geometry. artificial intelligence z. zhang. determining the epipolar geometry and its uncertainty a review. international journal of computer vision march z. zhang. a flexible new technique for camera calibration. ieee transactions on pattern analysis and machine intelligence november a. zisserman. notes on geometric invariance in vision. tutorial british machine vision conference a. zisserman and s. maybank. a case against epipolar geometry. in j. mundy a. zisserman and d. forsyth editors applications of invariance in computer vision lncs springerverlag a. zisserman j. mundy d. forsyth j. liu n. pillow c. rothwell and s. utcke. class-based grouping in perspective images. in proc. international conference on computer vision a. zisserman p. beardsley and i. reid. metric calibration of a stereo rig. in ieee workshop on representation of visual scenes boston pages a. zisserman. a users guide to the trifocal tensor. dept. of engineering science uni versity of oxford a. zisserman d. liebowitz and m. armstrong. resolving ambiguities in autocalibration. philosophical transactions of the royal society of london series a index a absolute conic relation to orthogonality absolute dual quadric absolute dual quadric absolute dual quadric extracting the rectifying transform properties simple properties adjoint matrix affine camera affine camera counting arguments decomposition definition definition error in employing estimation of hierarchy of more properties affine fundamental matrix affine fundamental matrix algebraic derivation derivation geometric derivation geometric interpretation gold standard algorithm linear algorithm minimal configuration properties singularity constraint affine geometry. affine imaging affine imaging conditions affine imaging model affine matrix affine matrix affine multiple view tensors computation affine properties affine properties of reconstruction affine properties recovery from image affine reconstruction affine reconstruction by alternation affine transformation algebraic distance algebraic distance comparison with geometric distance algebraic error minimizing algebraic minimization algebraic solution limitations ambiguities auto-calibration ambiguity ambiguity affine auto-calibration bas-relief examples for cameras for cameras for three views necker reversal of auto-calibration of auto-calibration for a sequence projective single view two views angle between two lines in image between two planes between two rays between two scene lines of rotation angle-axis parametrization augmentation auto-calibration see also reconstruction metric auto-calibration auto-calibration ambiguities critical motion sequences finding plane at infinity from planar motion implementation iterative methods limitations of absolute dual quadric method metric from affine numbers of views needed of stereo rig problems if q not positive-definite removing ambiguity removing the ambiguity solving for q linear non-linear solving forq non-linear typical ambiguities using q varying parameters auto-epipolar axis planes of camera b back-projection of conics of lines of points to rays banded data bas-relief ambiguity bias dependency on parametrization lessons bundle adjustment bundle adjustment bundle adjustment banded structure incremental initial solution sparse methods with missing data c calibrating conic orthogonality calibration constraints calibration constraints known internal parameters same camera in all images calibration matrix calibration internal what does it give? camera anatomy camera calibration camera centre camera centre finding it moving camera matrices compatible with two fundamental matrices computation from f computed from three fundamental matrices defined by three fundamental matrices uniqueness camera matrix canonical form computation decomposition in projective space reduced see reduced camera matrix index camera motion recovering it camera orientation finding it camera parameters camera resectioning covariance degenerate configurations from five points minimal solution over-determined solution camera rotation camera translation camera translation camera affine see affine camera affine at infinity basic pinhole model calibrated ccd centre finite finite projective general projective known orientation line pinhole model projective projective action on points pushbroom resection ambiguity rotation rotation and translation cameras as points carlsson weinshall duality carlsson weinshall map carlsson weinshall map definition caution central projection central projection change of coordinates change of coordinates chasles theorem cheiral inequalities solving cholesky factorization choosing the depths circular points circular points cofactor matrix collineation see also projective transformation column vector column vector compatibility conditions computing a plane from point and line correspondence from three point correspondences computing vanishing lines concurrent lines concurrent lines condition number conic conic fitting conic affine classification analog for fundamental matrix classification defined by points degenerate dual see also dual conic dual dual to circular points projective normal form projective normal form of tangent lines transformations of conjugacy conjugacy relation conjugate configurations definition consistency conditions constraints from internal parameters from same amera from scene orthogonality contour contour generator contour generator definition contour apparent occluding convex hull coordinate orientation coordinates. coplanarity constraint correlation correlation definition correspondence of curves and surfaces of lines correspondences determining corridor scene corridor scene cosine formula cost function cost function cost function heuristic huber least squares non-convex performance properties robust squared error statistically based cost functions asymptotically linear linear robust summary counting argument counting argument covariance estimation covariance estimation camera resectioning index covariance backward propagation backward propagation over-parametrized case estimation forward propagation matrix of epipolar lines use in point transfer cram er-rao lower bound critical configurations examples critical motion sequences critical set for camera definition for cameras critical surface for three views cross product cross ratio cross ratio d deficient-rank systems. degeneracy degeneracy degeneracy of triangulation transfer degenerate configuration for resectioning for transfer degenerate configurations see also camera resectioning transfer homography estimation degenerate configurations degenerate configurations homography degenerate homographies degrees of freedom degrees of freedom of trifocal tensor degrees of freedom trifocal depth of points derivative matrix computation determining the correct convergence of an algorithm determining the intersection diac see dual image of the absolute conic direct metric reconstruction using direct motion estimation direct solution for structure and translation distance ratio distance ratios on a line distortion correction distortion function choice computing distortion correction dlt see also homography computation transformation invariance triangulation dlt dlt algorithm non-invariance using line correspondences dual absolute quadric computing assuming zero skew limitations with constrained parameters equivalence to calibration linear solution specifying linear constraints dual circular points dual conic dual conic dual image of the absolute conic dual image of the absolute conic definition dual quadric dual reconstruction algorithm dual reconstruction algorithm dual reconstruction algorithm justification dual of absolute conic see absolute dual quadric of circular points duality duality duality principle e eigenvalue extraction jacobi s method elation elliptic quartic epipolar distance epipolar envelope epipolar line see also epipolar lines epipolar line epipolar line correspondence epipolar line homography epipolar line affine epipolar lines affine cameras epipolar transfer degeneracies epipoles epipoles as parameters as tensors for affine cameras retrieval from trifocal tensor retrieving error algebraic algebraic camera resectioning geometric interpretation geometric index in both images in one image minimizing algebraic minimizing geometric reproduction reprojection residual transfer essential matrix computation of definition extraction of cameras from four solutions properties estimation error estimation problem estimator euclidean and affine interpretations euclidean geometry. euclidean transformation fixed points extending the baseline exterior orientation exterior orientation of camera extracting the fundamental matrices f factorization non-rigid feature detection fisher information matrix fixed points fixed points of a euclidean transformation fixed points of euclidean transformation focal length forward projection forward projection forward projection of lines of quadrics frobenius norm fundamental matrix affine see affine fundamental matrix algebraic derivation algorithm results and recommendations both epipoles as parameters computation computation from seven points connection to quadrics computation from seven points from two planes gold standard algorithm maximum likelihood condition for point correspondence consistency conditions covariance definition degeneracies no translation points on a plane points on a ruled quadric derivation from four planes epipolar parametrization index extraction of canonical cameras for planar motion computation of form of for translation computation of form of geometric derivation geometric derivation iterative estimation over-parametrization parametrization of parametrization of over-parametrization projective ambiguity given f projective invariance of properties reduced reduced computation of sampson method for estimation singularity constraint symmetric part g gauge freedom gaussian distribution distribution isotropic error noise general motion general position general position generator of quadric geometric distance geometric error see also error geometric camera resectioning invariance to coordinate transforms geometric interpretation geometric interpretation geometric interpretation of estimation geometric minimization geometric representation givens rotation gold standard algorithm gold standard algorithm for affine fundamental matrix for affine homography for fundamental matrix for homography for trifocal tensor gradient descent ground truth groups of projectivities guided matching h hessian hierarchical merging homogeneity. homogeneous representation of lines of points homogeneous scaling homogeneous vector homographies what do they say about the camera matrices? homography estimation approximate solution conic analogue degenerate configurations dlt error in both images error in one image errors in world points experimental evaluation from noisy points function specification gold standard algorithm inhomogeneous solution initialization iterative methods linear cost function over-determined solution parametrization symmetric transfer error using ransac homography compatible with epipolar geometry degenerate induced by a plane homology parametrization of planar harmonic horopter horopter householder matrix huber cost function hyperboloid see quadric i iac see image of the absolute conic iac advantage over diac ideal point image of the absolute conic image of the absolute conic connection to calibration image plane moving it image-equivalent configurations definition incidence relations incidence relations for lines independently moving objects. infinite homography infinite homography index infinite homography constraint relationship to kruppa equations infinite homography definition inhomogeneous method initialization for camera resectioning interest points internal parameters of camera finding them intersection of lines of parallel lines invariance to image coordinate transformations invariants invariants invariants of a transformation isometries iteration weighted iterative algorithms iterative methods iterative minimization j jacobi s method jacobian k klein erlangen program known principal point kruppa equations kruppa equations relationship to infinite homography l least squares least squares solution least-squares problems least-squares solution least-squares solution of constrained systems using normal equations weighted least-squares solutions full rank case length ratios levenberg-marquardt levenberg-marquardt covariance implementation justification sparse line at infinity line at infinity line correspondences line estimation line projection matrix definition line reconstruction line transfer line transfer linear equations systems of unknown rank linear solution lines concurrent parallel representation transformations of m mahalanobis distance norm matching using trifocal tensor matrix euclidean orthogonal norm-preserving properties skew-symmetric part symmetric symmetric part maximum likelihood estimate maximum likelihood estimate robust maxmimum likelihood estimate robust measurement matrix reduced metric calibration metric properties metric properties of reconstruction metric properties recovery from images metric reconstruction via the infinite homography metric rectification metric rectification metric structure metric structure structure metric metric-calibration of a stereo rig minimal solution minimization iterative mle see maximum likelihood estimate modulus constraint modulus constraint multiview tensor affine n necker reversal necker reversal ambiguity newton iteration newton s method and the hessian. non-collinearity conditions non-isotropic scaling see scaling non-isotropic non-rigid factorization non-zero skew norm in vector space normal equations normalization for camera resectioning for trifocal tensor why is it essential? normalized coordinates normalized coordinates for calibrated camera normalizing transformation note. null-space numbers of equations generated. o orientation see also camera orientation orientation orthogonal matrices norm-preserving properties orthogonal regression orthogonal regression orthogonality and orthogonality in the image orthogonality relationships orthographic projection over-parametrization over-parametrization p parallax induced by a plane parallel lines parallel projection parameter minimization parameter space parameters constant internal limit range parametrization epipolar of rotations of homogeneous vectors of homology of the n-sphere what makes a good one? pl ucker coordinates line coordinates line representation matrix planar harmonic homology planar harmonic homology planar homology index parametrization planar motion fixed image points planar projective transformation definition plane at infinity computation methods of finding plane induced parallax plane induced parallax plane plus parallax plane plus parallax reconstruction counting arguments plane defined by three points homogeneous vector representation point equations recommended method point transfer using fundamental matrix using trifocal tensor point defined by three planes points on a plane polarity pole polar relationship positive definite matrix positive-definite matrix symmetric preserve the convex hull definition principal axis vector principal axis vector principal plane principal plane principal plane of camera principal point principal point principal point offset probability density function profile of a surface programming hint projection orthographic parallel scaled orthographic weak perspective projective ambiguity projective camera action on conics action on lines action on planes definition projective depth projective depth projective factorization normalizing image coordinates normalizing the weights what is being minimized projective plane model projective plane model topology projective realization see realization projective projective reconstruction dual algorithm from reduced cameras matrices from seven points in n views from six points from six points in n views projective transformation projective transformation decomposition of projectivity definition pseudo-inverse q qr decomposition quadric dual see dual quadric ruled ruled definition quadrics quadrics classification of quadrifocal tensor quadrifocal tensor derivation from four planes quartic quasi-affine mapping definition two-dimensional quasi-affine reconstruction algorithm bounds on quaternions quaternions r radial distortion estimating ransac ransac adaptive application domain distance threshold for homography for homography number of samples run details size of consensus set realizable points definition realization realization definition strong realizations equivalent definition non-equivalent oppositely oriented recommendations reconstruction affine see affine reconstruction index affine affine properties affine from affine camera from scene constraints from translation euclidean metric see also auto-calibration metric metric properties projective quasi-affine rectifying homography reduced camera matrix reduced camera matrix definition reduced fundamental matrix see fundamental matrix reduced reduced measurement matrix reduced measurement matrix reduced trifocal tensor see trifocal tensor reduced relation bilinear quadrilinear trilinear reprojection error reprojection error both images geometric interpretation resection resectioning see camera resectioning covariance estimation degenerate configuration initialization normalization residuals retrieving the camera matrices robust algorithms robust methods rodrigues formula rotations in n dimensions in dimensions row vector row vector s sampson approximation sampson distance sampson error scaled orthographic projection scaling isotropic non-isotropic with points near infinity scene constraints distance ratios on a line parallel lines scene orthogonality index screw axis screw decomposition of a rigid motion similarity matrix similarity transformation singular value decomposition singular value decomposition computational complexity implementation singular values relation to eigenvalues singularity constraint singularity constraint skew-symmetric part skyline structure solution over-determined space curve span representation sparse linear systems solution special points stability stereo correspondence stereo correspondence stereo rectification stereo rectification affine algorithm outline mapping the epipole to infinity matching transforms stereo-rig metric calibration stratification stratification stratified reconstruction affine metric structure affine metric projective subspaces and tensors svd see singular value decomposition symmetric epipolar distance symmetric linear equations symmetric linear equations sparse symmetric matrices symmetric part symmetric transfer error synthetic data t tangent line to conic tensor notation tensor pictorial representation terminology topology of total least squares transfer transfer degenerate configurations transformation invariance transformation invariance transformation invariance of dlt transformation rule transformation of conic of conics of lines projective similarity translational motion triangulation triangulation triangulation dlt method evaluation on real images for affine cameras for affine cameras inhomogenous method local minima minimizing the cost function problem formulation trifocal tensor trifocal tensor affine algebraic properties computation from camera matrices computation from points gold standard algorithm iterative reprojection error results and recommendations sampson distance specifying lines using algebraic minimization constraints definition definition derivation from four planes geometrically valid line relations parametrization picture point and line relations point relations reduced relation to two views transformation rule trilinearities see also relations trilinear trilinearities twisted cubic properties twisted pair index v vanishing lines vanishing lines vanishing points vanishing points vanishing points computing variance vector geometry vector space norms w weak perspective z zero skew zero skew